

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
    .site-nav ul li a {
      background-image: none;
    }

  </style>

  

  
    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Identifier Design Specification | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Identifier Design Specification" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="http://0.0.0.0:4000/trustweave/advanced/identifier-design/" />
<meta property="og:url" content="http://0.0.0.0:4000/trustweave/advanced/identifier-design/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Identifier Design Specification" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Identifier Design Specification","url":"http://0.0.0.0:4000/trustweave/advanced/identifier-design/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }

  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }

  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }

  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }

  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="http://0.0.0.0:4000/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });

            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');

        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';

                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';

                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';

                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/use-trustweave-facade/" class="nav-list-link">Use TrustWeave Facade for Quick Setup</a></li><li class="nav-list-item"><a href="/trustweave/how-to/configure-trustlayer/" class="nav-list-link">Configure TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li><li class="nav-list-item"><a href="/trustweave/how-to/multi-chain-anchoring/" class="nav-list-link">Multi-Chain Anchoring Patterns</a></li><li class="nav-list-item"><a href="/trustweave/how-to/exchange-credentials/" class="nav-list-link">Exchange Credentials with Multiple Protocols</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li></ul>
  
</nav>




  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
    <li class="breadcrumb-nav-list-item"><a href="/trustweave/advanced/README/">Advanced Topics</a></li>
    <li class="breadcrumb-nav-list-item"><span>Identifier Design Specification</span></li>
  </ol>
</nav>


      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="identifier-design-specification">
  
  
    <a href="#identifier-design-specification" class="anchor-heading" aria-labelledby="identifier-design-specification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Identifier Design Specification
  
  
</h1>
    

<blockquote>
  <p><strong>Version</strong>: 1.0<br />
<strong>Status</strong>: Design Specification<br />
<strong>Last Updated</strong>: 2024<br />
<strong>Authors</strong>: TrustWeave Architecture Team</p>
</blockquote>
<h2 id="executive-summary">
  
  
    <a href="#executive-summary" class="anchor-heading" aria-labelledby="executive-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Executive Summary
  
  
</h2>
    

<p>This document specifies the design for modeling identifiers and types in TrustWeave. It establishes clear separation between <strong>identifiers</strong> (opaque identity references) and <strong>types</strong> (domain classifications), provides type safety through value classes, and ensures consistent validation and serialization across the codebase.</p>

<blockquote>
  <p><strong>Developer Guide</strong>: For practical usage examples and common patterns, see the <a href="/trustweave/core-concepts/identifiers-and-types/">Identifiers and Types</a> guide in Core Concepts.</p>
</blockquote>
<h2 id="table-of-contents">
  
  
    <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents
  
  
</h2>
    

<ol>
  <li><a href="#core-principles">Core Principles</a></li>
  <li><a href="#identifiers-vs-types">Identifiers vs Types</a></li>
  <li><a href="#architecture">Architecture</a></li>
  <li><a href="#base-identifier-iri">Base Identifier: IRI</a></li>
  <li><a href="#module-specific-identifiers">Module-Specific Identifiers</a></li>
  <li><a href="#domain-types">Domain Types</a></li>
  <li><a href="#serialization-strategy">Serialization Strategy</a></li>
  <li><a href="#type-safety--validation">Type Safety &amp; Validation</a></li>
  <li><a href="#package-organization">Package Organization</a></li>
  <li><a href="#api-ergonomic-enhancements">API Ergonomic Enhancements</a></li>
  <li><a href="#migration-strategy">Migration Strategy</a></li>
  <li><a href="#usage-examples">Usage Examples</a></li>
</ol><hr />
<h2 id="core-principles">
  
  
    <a href="#core-principles" class="anchor-heading" aria-labelledby="core-principles"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Core Principles
  
  
</h2>
    
<h3 id="1-type-safety-first">
  
  
    <a href="#1-type-safety-first" class="anchor-heading" aria-labelledby="1-type-safety-first"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. <strong>Type Safety First</strong>
  
  
</h3>
    
<p>All identifiers must be strongly typed classes to prevent misuse at compile time. Specialized identifiers like <code class="language-plaintext highlighter-rouge">Did</code> extend the base <code class="language-plaintext highlighter-rouge">Iri</code> class to maintain proper inheritance semantics.</p>
<h3 id="2-validation-at-construction">
  
  
    <a href="#2-validation-at-construction" class="anchor-heading" aria-labelledby="2-validation-at-construction"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. <strong>Validation at Construction</strong>
  
  
</h3>
    
<p>Identifiers must validate their format during construction, not at usage time.</p>
<h3 id="3-self-contained-modules">
  
  
    <a href="#3-self-contained-modules" class="anchor-heading" aria-labelledby="3-self-contained-modules"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. <strong>Self-Contained Modules</strong>
  
  
</h3>
    
<p>Each module owns and defines its identifiers, avoiding cross-module dependencies where possible.</p>
<h3 id="4-clear-semantics">
  
  
    <a href="#4-clear-semantics" class="anchor-heading" aria-labelledby="4-clear-semantics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. <strong>Clear Semantics</strong>
  
  
</h3>
    
<p>Naming and structure must clearly distinguish between identifiers (identity references) and types (classifications).</p>
<h3 id="5-zero-backward-compatibility">
  
  
    <a href="#5-zero-backward-compatibility" class="anchor-heading" aria-labelledby="5-zero-backward-compatibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. <strong>Zero Backward Compatibility</strong>
  
  
</h3>
    
<p>No String-based identifier fields alongside typed identifiers. Direct migration to typed values.</p><hr />
<h2 id="identifiers-vs-types">
  
  
    <a href="#identifiers-vs-types" class="anchor-heading" aria-labelledby="identifiers-vs-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Identifiers vs Types
  
  
</h2>
    
<h3 id="identifiers---opaque-identity-references">
  
  
    <a href="#identifiers---opaque-identity-references" class="anchor-heading" aria-labelledby="identifiers---opaque-identity-references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>IDENTIFIERS</strong> - Opaque Identity References
  
  
</h3>
    

<p><strong>Purpose</strong>: Reference and identify resources uniquely.</p>

<p><strong>Characteristics</strong>:</p>
<ul>
  <li>Classes wrapping validated strings (regular classes to support inheritance)</li>
  <li>Extend base identifier classes when semantically appropriate (e.g., <code class="language-plaintext highlighter-rouge">Did extends Iri</code>, <code class="language-plaintext highlighter-rouge">CredentialId extends Iri</code>)</li>
  <li>Always validate format in <code class="language-plaintext highlighter-rouge">init</code> blocks</li>
  <li>Serialize as strings in JSON</li>
  <li>Examples: <code class="language-plaintext highlighter-rouge">Did</code> (extends <code class="language-plaintext highlighter-rouge">Iri</code>), <code class="language-plaintext highlighter-rouge">CredentialId</code> (extends <code class="language-plaintext highlighter-rouge">Iri</code>), <code class="language-plaintext highlighter-rouge">IssuerId</code> (extends <code class="language-plaintext highlighter-rouge">Iri</code>), <code class="language-plaintext highlighter-rouge">VerificationMethodId</code>, <code class="language-plaintext highlighter-rouge">KeyId</code></li>
</ul>

<p><strong>Usage Pattern</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:z6Mk..."</span><span class="p">)</span>                    <span class="c1">// IDENTIFIER - which resource?</span>
<span class="kd">val</span> <span class="py">credId</span> <span class="p">=</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="s">"https://..."</span><span class="p">)</span>            <span class="c1">// IDENTIFIER - which credential?</span>
<span class="kd">val</span> <span class="py">iri</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">credId</span>                                <span class="c1">// Polymorphism: CredentialId IS-A Iri</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="types---domain-classifications">
  
  
    <a href="#types---domain-classifications" class="anchor-heading" aria-labelledby="types---domain-classifications"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> <strong>TYPES</strong> - Domain Classifications
  
  
</h3>
    

<p><strong>Purpose</strong>: Classify and categorize concepts semantically.</p>

<p><strong>Characteristics</strong>:</p>
<ul>
  <li>Sealed classes or enums</li>
  <li>Represent categories, not identities</li>
  <li>Serialize as strings in JSON (category names)</li>
  <li>Examples: <code class="language-plaintext highlighter-rouge">ProofType</code>, <code class="language-plaintext highlighter-rouge">CredentialType</code>, <code class="language-plaintext highlighter-rouge">Algorithm</code>, <code class="language-plaintext highlighter-rouge">ContractStatus</code></li>
</ul>

<p><strong>Usage Pattern</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">proofType</span> <span class="p">=</span> <span class="nc">ProofType</span><span class="p">.</span><span class="nc">Ed25519Signature2020</span>   <span class="c1">// TYPE - what kind of proof?</span>
<span class="kd">val</span> <span class="py">credType</span> <span class="p">=</span> <span class="nc">CredentialType</span><span class="p">.</span><span class="nc">Education</span>          <span class="c1">// TYPE - what kind of credential?</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="comparison-table">
  
  
    <a href="#comparison-table" class="anchor-heading" aria-labelledby="comparison-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Comparison Table
  
  
</h3>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Aspect</th>
      <th><strong>IDENTIFIERS</strong></th>
      <th><strong>TYPES</strong></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Purpose</td>
      <td>Reference/identify resources</td>
      <td>Classify/categorize concepts</td>
    </tr>
    <tr>
      <td>Structure</td>
      <td>Value classes (<code class="language-plaintext highlighter-rouge">@JvmInline</code>)</td>
      <td>Sealed classes / Enums</td>
    </tr>
    <tr>
      <td>Package</td>
      <td><code class="language-plaintext highlighter-rouge">{module}.identifiers</code></td>
      <td><code class="language-plaintext highlighter-rouge">{module}.types</code></td>
    </tr>
    <tr>
      <td>Examples</td>
      <td><code class="language-plaintext highlighter-rouge">Did</code>, <code class="language-plaintext highlighter-rouge">CredentialId</code>, <code class="language-plaintext highlighter-rouge">VerificationMethodId</code></td>
      <td><code class="language-plaintext highlighter-rouge">ProofType</code>, <code class="language-plaintext highlighter-rouge">CredentialType</code>, <code class="language-plaintext highlighter-rouge">Algorithm</code></td>
    </tr>
    <tr>
      <td>Question Answered</td>
      <td>“Which resource?”</td>
      <td>“What kind?”</td>
    </tr>
    <tr>
      <td>Validation</td>
      <td>Format validation (IRI, DID pattern)</td>
      <td>Value validation (allowed values)</td>
    </tr>
    <tr>
      <td>Serialization</td>
      <td>As strings (IRI/URI format)</td>
      <td>As strings (category names)</td>
    </tr>
  </tbody>
</table></div><hr />
<h2 id="architecture">
  
  
    <a href="#architecture" class="anchor-heading" aria-labelledby="architecture"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Architecture
  
  
</h2>
    
<h3 id="module-structure">
  
  
    <a href="#module-structure" class="anchor-heading" aria-labelledby="module-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Module Structure
  
  
</h3>
    

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre>common/
  └── identifiers/
      └── Identifiers.kt          (Iri, KeyId - base identifiers)

did/did-core/
  └── identifiers/
      └── DidIdentifiers.kt       (Did, VerificationMethodId, DidUrl)

credentials/credential-core/
  └── identifiers/
      └── CredentialIdentifiers.kt (CredentialId, IssuerId, StatusListId, SchemaId)
  └── types/
      └── CredentialTypes.kt       (ProofType, CredentialType)
      └── SchemaFormat.kt          (SchemaFormat enum)
      └── StatusPurpose.kt         (StatusPurpose enum)

wallet/wallet-core/
  └── identifiers/
      └── WalletIdentifiers.kt     (WalletId, CollectionId)
  └── types/
      └── WalletType.kt            (WalletType sealed class)

kms/kms-core/
  └── identifiers/
      └── KmsIdentifiers.kt        (KeyId re-export)
  └── types/
      └── Algorithm.kt             (Algorithm sealed class)

contract/
  └── identifiers/
      └── ContractIdentifiers.kt   (ContractId if needed)
  └── types/
      └── ContractTypes.kt         (ContractType, ContractStatus, etc.)
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="dependency-flow">
  
  
    <a href="#dependency-flow" class="anchor-heading" aria-labelledby="dependency-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Dependency Flow
  
  
</h3>
    

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre>credentials/credential-core
    ↓ (depends on)
did/did-core
    ↓ (depends on)
common
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Rule</strong>: <code class="language-plaintext highlighter-rouge">VerificationMethodId</code> belongs in <code class="language-plaintext highlighter-rouge">did-core</code> because:</p>
<ul>
  <li>It’s part of the DID Core specification</li>
  <li>Credentials consume it but don’t define it</li>
  <li>This avoids circular dependencies</li>
</ul><hr />
<h2 id="base-identifier-iri">
  
  
    <a href="#base-identifier-iri" class="anchor-heading" aria-labelledby="base-identifier-iri"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Base Identifier: IRI
  
  
</h2>
    
<h3 id="design-rationale">
  
  
    <a href="#design-rationale" class="anchor-heading" aria-labelledby="design-rationale"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Design Rationale
  
  
</h3>
    

<p>All identifiers in TrustWeave are Internationalized Resource Identifiers (IRIs) following RFC 3987. The base <code class="language-plaintext highlighter-rouge">Iri</code> class provides:</p>
<ul>
  <li>Common validation for URI, URN, DID schemes</li>
  <li>Fragment parsing</li>
  <li>Scheme detection</li>
  <li>Foundation for specialized identifiers that extend it</li>
</ul>

<p><strong>Important</strong>: <code class="language-plaintext highlighter-rouge">Iri</code> is a regular class (not a value class) to allow inheritance. <code class="language-plaintext highlighter-rouge">Did</code> extends <code class="language-plaintext highlighter-rouge">Iri</code> because a DID IS-A IRI semantically. This maintains proper “IS-A” relationship semantics while allowing specialized validation for DIDs.</p>
<h3 id="implementation">
  
  
    <a href="#implementation" class="anchor-heading" aria-labelledby="implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementation
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
</pre></td><td class="rouge-code"><pre><span class="c1">// common/src/main/kotlin/com/trustweave/core/identifiers/Identifiers.kt</span>

<span class="k">package</span> <span class="nn">com.trustweave.core.identifiers</span>

<span class="k">import</span> <span class="nn">kotlinx.serialization.KSerializer</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.Serializable</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.descriptors.PrimitiveKind</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.descriptors.PrimitiveSerialDescriptor</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.descriptors.SerialDescriptor</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.encoding.Decoder</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.encoding.Encoder</span>

<span class="cm">/**
 * Base Internationalized Resource Identifier (IRI).
 * 
 * Foundation for all identifier classes. Identifiers are opaque identity references
 * following RFC 3987 (IRI specification).
 * 
 * **Supported Schemes:**
 * - `http://`, `https://` - URIs/URLs
 * - `did:` - Decentralized Identifiers
 * - `urn:` - Uniform Resource Names
 * - `#` - Fragment identifiers
 * 
 * **Note**: This is a regular class (not a value class) to allow other identifiers
 * like `Did` to extend it, maintaining "IS-A" relationship semantics.
 * 
 * **Example:**
 * ```kotlin
 * val iri = Iri("https://example.com/resource#fragment")
 * val did = Did.parse("did:key:z6Mk...")  // Did extends Iri
 * ```
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">IriSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="k">open</span> <span class="kd">class</span> <span class="nc">Iri</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">init</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">isNotBlank</span><span class="p">())</span> <span class="p">{</span>
            <span class="s">"IRI cannot be blank"</span>
        <span class="p">}</span>
        <span class="nf">require</span><span class="p">(</span><span class="nf">isValidIri</span><span class="p">(</span><span class="n">value</span><span class="p">))</span> <span class="p">{</span>
            <span class="s">"Invalid IRI format: '$value'"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Check if this IRI represents a URI/URL (starts with http:// or https://).
     */</span>
    <span class="kd">val</span> <span class="py">isUri</span><span class="p">:</span> <span class="nc">Boolean</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"http://"</span><span class="p">)</span> <span class="p">||</span> <span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"https://"</span><span class="p">)</span>
    
    <span class="cm">/**
     * Check if this IRI represents a URN (starts with urn:).
     */</span>
    <span class="kd">val</span> <span class="py">isUrn</span><span class="p">:</span> <span class="nc">Boolean</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"urn:"</span><span class="p">)</span>
    
    <span class="cm">/**
     * Check if this IRI represents a DID (starts with did:).
     */</span>
    <span class="kd">val</span> <span class="py">isDid</span><span class="p">:</span> <span class="nc">Boolean</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"did:"</span><span class="p">)</span>
    
    <span class="cm">/**
     * Get the scheme of this IRI (e.g., "http", "https", "did", "urn").
     */</span>
    <span class="kd">val</span> <span class="py">scheme</span><span class="p">:</span> <span class="nc">String</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="sc">':'</span><span class="p">)</span>
    
    <span class="cm">/**
     * Parse fragment from IRI if present (e.g., "frag" from "https://example.com#frag").
     */</span>
    <span class="kd">val</span> <span class="py">fragment</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">substringAfter</span><span class="p">(</span><span class="s">"#"</span><span class="p">,</span> <span class="s">""</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">takeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">()</span> <span class="p">&amp;&amp;</span> <span class="n">value</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span> <span class="p">}</span>
    
    <span class="cm">/**
     * Get IRI without fragment.
     */</span>
    <span class="kd">val</span> <span class="py">withoutFragment</span><span class="p">:</span> <span class="nc">Iri</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"#"</span><span class="p">))</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
    
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="cm">/**
         * Basic IRI validation - allows common schemes used in Web-of-Trust.
         */</span>
        <span class="k">private</span> <span class="k">fun</span> <span class="nf">isValidIri</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
            <span class="c1">// Allow: http, https, did, urn, and other common schemes</span>
            <span class="c1">// Also allow relative IRIs (no scheme) for fragments like "#key-1"</span>
            <span class="k">return</span> <span class="n">value</span><span class="p">.</span><span class="nf">matches</span><span class="p">(</span><span class="nc">Regex</span><span class="p">(</span><span class="s">"^[a-zA-Z][a-zA-Z0-9+.-]*:.*$"</span><span class="p">))</span> <span class="p">||</span>
                   <span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span> <span class="p">||</span>
                   <span class="n">value</span><span class="p">.</span><span class="nf">matches</span><span class="p">(</span><span class="nc">Regex</span><span class="p">(</span><span class="s">"^[a-zA-Z0-9._~-]+(/[a-zA-Z0-9._~-]*)*$"</span><span class="p">))</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * Custom serializer for Iri that serializes as String in JSON.
 * Required because Iri has validation in init block.
 */</span>
<span class="kd">object</span> <span class="nc">IriSerializer</span> <span class="p">:</span> <span class="nc">KSerializer</span><span class="p">&lt;</span><span class="nc">Iri</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">descriptor</span><span class="p">:</span> <span class="nc">SerialDescriptor</span> <span class="p">=</span> 
        <span class="nc">PrimitiveSerialDescriptor</span><span class="p">(</span><span class="s">"Iri"</span><span class="p">,</span> <span class="nc">PrimitiveKind</span><span class="p">.</span><span class="nc">STRING</span><span class="p">)</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span> <span class="nc">Encoder</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nc">Iri</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">encoder</span><span class="p">.</span><span class="nf">encodeString</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span> <span class="nc">Decoder</span><span class="p">):</span> <span class="nc">Iri</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">string</span> <span class="p">=</span> <span class="n">decoder</span><span class="p">.</span><span class="nf">decodeString</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">try</span> <span class="p">{</span>
            <span class="nc">Iri</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">kotlinx</span><span class="p">.</span><span class="n">serialization</span><span class="p">.</span><span class="nc">SerializationException</span><span class="p">(</span>
                <span class="s">"Failed to deserialize Iri: ${e.message}"</span><span class="p">,</span>
                <span class="n">e</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * Key identifier fragment.
 * 
 * Used for relative key references (e.g., "#key-1" or "key-1").
 * Can be combined with a DID to form a full verification method ID.
 * 
 * **Example:**
 * ```kotlin
 * val keyId = KeyId("key-1")
 * val vmId = VerificationMethodId(did, keyId)  // "did:key:z6Mk...#key-1"
 * ```
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">KeyIdSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="nd">@JvmInline</span>
<span class="n">value</span> <span class="kd">class</span> <span class="nc">KeyId</span><span class="p">(</span><span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">init</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">isNotBlank</span><span class="p">())</span> <span class="p">{</span>
            <span class="s">"Key ID cannot be blank"</span>
        <span class="p">}</span>
        <span class="nf">require</span><span class="p">(!</span><span class="n">value</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">" "</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="p">!</span><span class="n">value</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"\n"</span><span class="p">))</span> <span class="p">{</span>
            <span class="s">"Key ID cannot contain whitespace"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Check if this is a fragment identifier (starts with #).
     */</span>
    <span class="kd">val</span> <span class="py">isFragment</span><span class="p">:</span> <span class="nc">Boolean</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span>
    
    <span class="cm">/**
     * Get fragment value without #.
     */</span>
    <span class="kd">val</span> <span class="py">fragmentValue</span><span class="p">:</span> <span class="nc">String</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">isFragment</span><span class="p">)</span> <span class="n">value</span><span class="p">.</span><span class="nf">substring</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span> <span class="k">else</span> <span class="n">value</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
<span class="p">}</span>

<span class="kd">object</span> <span class="nc">KeyIdSerializer</span> <span class="p">:</span> <span class="nc">KSerializer</span><span class="p">&lt;</span><span class="nc">KeyId</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">descriptor</span><span class="p">:</span> <span class="nc">SerialDescriptor</span> <span class="p">=</span> 
        <span class="nc">PrimitiveSerialDescriptor</span><span class="p">(</span><span class="s">"KeyId"</span><span class="p">,</span> <span class="nc">PrimitiveKind</span><span class="p">.</span><span class="nc">STRING</span><span class="p">)</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span> <span class="nc">Encoder</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nc">KeyId</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">encoder</span><span class="p">.</span><span class="nf">encodeString</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span> <span class="nc">Decoder</span><span class="p">):</span> <span class="nc">KeyId</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">string</span> <span class="p">=</span> <span class="n">decoder</span><span class="p">.</span><span class="nf">decodeString</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">try</span> <span class="p">{</span>
            <span class="nc">KeyId</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="n">kotlinx</span><span class="p">.</span><span class="n">serialization</span><span class="p">.</span><span class="nc">SerializationException</span><span class="p">(</span>
                <span class="s">"Failed to deserialize KeyId: ${e.message}"</span><span class="p">,</span>
                <span class="n">e</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="module-specific-identifiers">
  
  
    <a href="#module-specific-identifiers" class="anchor-heading" aria-labelledby="module-specific-identifiers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Module-Specific Identifiers
  
  
</h2>
    
<h3 id="did-module-identifiers">
  
  
    <a href="#did-module-identifiers" class="anchor-heading" aria-labelledby="did-module-identifiers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DID Module Identifiers
  
  
</h3>
    

<p><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">did/did-core/src/main/kotlin/com/trustweave/did/identifiers/DidIdentifiers.kt</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.trustweave.did.identifiers</span>

<span class="k">import</span> <span class="nn">com.trustweave.core.identifiers.Iri</span>
<span class="k">import</span> <span class="nn">com.trustweave.core.identifiers.KeyId</span>

<span class="cm">/**
 * Decentralized Identifier (DID).
 * 
 * Extends Iri with DID-specific validation and parsing.
 * Follows W3C DID Core specification: did:method:identifier
 * 
 * **Inheritance**: `Did extends Iri` - a DID IS-A IRI.
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">DidSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">Did</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"#"</span><span class="p">)),</span> <span class="nc">Comparable</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;</span> <span class="p">{</span>  <span class="c1">// Remove fragment, Iri validates format</span>
    
    <span class="nf">init</span> <span class="p">{</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"did:"</span><span class="p">))</span> <span class="p">{</span>
            <span class="s">"Invalid DID format: '$value'. DIDs must start with 'did:'"</span>
        <span class="p">}</span>
        <span class="nf">require</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">":"</span><span class="p">).</span><span class="n">size</span> <span class="p">&gt;=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
            <span class="s">"Invalid DID format: '$value'. Expected format: did:method:identifier"</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">method</span><span class="p">:</span> <span class="nc">String</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">parts</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">substringAfter</span><span class="p">(</span><span class="s">"did:"</span><span class="p">).</span><span class="nf">split</span><span class="p">(</span><span class="s">":"</span><span class="p">,</span> <span class="n">limit</span> <span class="p">=</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parts</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span> <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Invalid DID: ${this.value}"</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">identifier</span><span class="p">:</span> <span class="nc">String</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">substringAfter</span><span class="p">(</span><span class="s">"did:$method:"</span><span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">path</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">parts</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">"/"</span><span class="p">,</span> <span class="n">limit</span> <span class="p">=</span> <span class="mi">2</span><span class="p">)</span>
            <span class="k">return</span> <span class="n">parts</span><span class="p">.</span><span class="nf">getOrNull</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">baseDid</span><span class="p">:</span> <span class="nc">Did</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"/"</span><span class="p">))</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
    
    <span class="cm">/**
     * Operator: did + "fragment" creates VerificationMethodId.
     */</span>
    <span class="k">operator</span> <span class="k">fun</span> <span class="nf">plus</span><span class="p">(</span><span class="n">fragment</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">keyId</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">fragment</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"#"</span><span class="p">))</span> <span class="nc">KeyId</span><span class="p">(</span><span class="n">fragment</span><span class="p">)</span> <span class="k">else</span> <span class="nc">KeyId</span><span class="p">(</span><span class="s">"#$fragment"</span><span class="p">)</span>
        <span class="k">return</span> <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">keyId</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Infix: did with "fragment" - more readable alternative.
     */</span>
    <span class="k">infix</span> <span class="k">fun</span> <span class="nf">with</span><span class="p">(</span><span class="n">fragment</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">=</span> <span class="k">this</span> <span class="p">+</span> <span class="n">fragment</span>
    
    <span class="cm">/**
     * Infix: did with keyId - type-safe alternative.
     */</span>
    <span class="k">infix</span> <span class="k">fun</span> <span class="nf">with</span><span class="p">(</span><span class="n">keyId</span><span class="p">:</span> <span class="nc">KeyId</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">=</span> <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">keyId</span><span class="p">)</span>
    
    <span class="cm">/**
     * Infix: Check if DID belongs to method.
     */</span>
    <span class="k">infix</span> <span class="k">fun</span> <span class="nf">isMethod</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">method</span> <span class="p">==</span> <span class="n">method</span>
    
    <span class="cm">/**
     * Comparable: Natural ordering for sorting.
     */</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Did</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
<span class="p">}</span>

<span class="cm">/**
 * Full verification method identifier.
 * 
 * Combines a DID with a key ID fragment: "did:key:z6Mk...#key-1"
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">VerificationMethodIdSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">data class</span> <span class="nc">VerificationMethodId</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">did</span><span class="p">:</span> <span class="nc">Did</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">keyId</span><span class="p">:</span> <span class="nc">KeyId</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">String</span>
        <span class="k">get</span><span class="p">()</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">fragment</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">keyId</span><span class="p">.</span><span class="n">isFragment</span><span class="p">)</span> <span class="n">keyId</span><span class="p">.</span><span class="n">value</span> <span class="k">else</span> <span class="s">"#${keyId.value}"</span>
            <span class="k">return</span> <span class="s">"${did.value}$fragment"</span>
        <span class="p">}</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
    
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="cm">/**
         * Parse a verification method ID string.
         * 
         * Handles both full IDs ("did:key:z6Mk...#key-1") and relative IDs ("#key-1" when did is known).
         */</span>
        <span class="k">fun</span> <span class="nf">parse</span><span class="p">(</span><span class="n">vmIdString</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">baseDid</span><span class="p">:</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">when</span> <span class="p">{</span>
                <span class="n">vmIdString</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"did:"</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="kd">val</span> <span class="py">parts</span> <span class="p">=</span> <span class="n">vmIdString</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">"#"</span><span class="p">,</span> <span class="n">limit</span> <span class="p">=</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">parts</span><span class="p">.</span><span class="n">size</span> <span class="p">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span>
                            <span class="s">"VerificationMethodId must contain '#' fragment: '$vmIdString'"</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="nc">VerificationMethodId</span><span class="p">(</span>
                        <span class="n">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">keyId</span> <span class="p">=</span> <span class="nc">KeyId</span><span class="p">(</span><span class="s">"#${parts[1]}"</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">}</span>
                <span class="n">vmIdString</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">baseDid</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="n">baseDid</span><span class="p">,</span> <span class="nc">KeyId</span><span class="p">(</span><span class="n">vmIdString</span><span class="p">))</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span>
                    <span class="s">"Cannot parse VerificationMethodId: '$vmIdString'. "</span> <span class="p">+</span>
                    <span class="s">"Must be full DID URL (did:...:#...) or fragment (#...) with baseDid"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Decompose into components for destructuring.
     */</span>
    <span class="k">fun</span> <span class="nf">decompose</span><span class="p">():</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">,</span> <span class="nc">KeyId</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">did</span> <span class="n">to</span> <span class="n">keyId</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="credential-module-identifiers">
  
  
    <a href="#credential-module-identifiers" class="anchor-heading" aria-labelledby="credential-module-identifiers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Credential Module Identifiers
  
  
</h3>
    

<p><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">credentials/credential-core/src/main/kotlin/com/trustweave/credential/identifiers/CredentialIdentifiers.kt</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.trustweave.credential.identifiers</span>

<span class="k">import</span> <span class="nn">com.trustweave.core.identifiers.Iri</span>
<span class="k">import</span> <span class="nn">com.trustweave.did.identifiers.Did</span>

<span class="cm">/**
 * Credential identifier (URI, URN, DID, or other IRI).
 * 
 * Extends Iri with credential-specific semantics.
 * Per W3C VC specification, credential IDs are URIs/IRIs, so CredentialId IS-A Iri.
 * 
 * **Inheritance**: `CredentialId extends Iri` - a credential ID IS-A IRI.
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">CredentialIdSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">CredentialId</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**
     * Try to parse as Did (since both CredentialId and Did extend Iri).
     */</span>
    <span class="k">fun</span> <span class="nf">asDid</span><span class="p">():</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">isDid</span><span class="p">)</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span> <span class="k">else</span> <span class="k">null</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
<span class="p">}</span>

<span class="cm">/**
 * Credential issuer identifier (DID or URI).
 * 
 * Extends Iri with issuer-specific semantics.
 * Per W3C VC specification, issuers are URIs or DIDs, so IssuerId IS-A Iri.
 * 
 * **Inheritance**: `IssuerId extends Iri` - an issuer ID IS-A IRI.
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">IssuerIdSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">IssuerId</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="cm">/**
     * Try to parse as Did (since both IssuerId and Did extend Iri).
     */</span>
    <span class="k">fun</span> <span class="nf">asDid</span><span class="p">():</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">isDid</span><span class="p">)</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span> <span class="k">else</span> <span class="k">null</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
    
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">fromDid</span><span class="p">(</span><span class="n">did</span><span class="p">:</span> <span class="nc">Did</span><span class="p">):</span> <span class="nc">IssuerId</span> <span class="p">{</span>
            <span class="c1">// Did extends Iri, so we can use did.value directly</span>
            <span class="k">return</span> <span class="nc">IssuerId</span><span class="p">(</span><span class="n">did</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="cm">/**
 * Credential status list identifier.
 * 
 * Extends Iri with status list-specific semantics.
 * Status list IDs are URIs/IRIs, so StatusListId IS-A Iri.
 * 
 * **Inheritance**: `StatusListId extends Iri` - a status list ID IS-A IRI.
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">StatusListIdSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">StatusListId</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
<span class="p">}</span>

<span class="cm">/**
 * Credential schema identifier.
 * 
 * Extends Iri with schema-specific semantics.
 * Schema IDs are URIs/IRIs, so SchemaId IS-A Iri.
 * 
 * **Inheritance**: `SchemaId extends Iri` - a schema ID IS-A IRI.
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">SchemaIdSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">SchemaId</span><span class="p">(</span>
    <span class="n">value</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="domain-types">
  
  
    <a href="#domain-types" class="anchor-heading" aria-labelledby="domain-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Domain Types
  
  
</h2>
    
<h3 id="credential-types">
  
  
    <a href="#credential-types" class="anchor-heading" aria-labelledby="credential-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Credential Types
  
  
</h3>
    

<p><strong>Location</strong>: <code class="language-plaintext highlighter-rouge">credentials/credential-core/src/main/kotlin/com/trustweave/credential/types/CredentialTypes.kt</code></p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.trustweave.credential.types</span>

<span class="cm">/**
 * Cryptographic proof/signature type classification.
 * 
 * Represents the TYPE of proof used in verifiable credentials.
 * This is a classification, not an identifier.
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">ProofTypeSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="k">sealed</span> <span class="kd">class</span> <span class="nc">ProofType</span> <span class="p">{</span>
    <span class="k">abstract</span> <span class="kd">val</span> <span class="py">identifier</span><span class="p">:</span> <span class="nc">String</span>
    
    <span class="kd">object</span> <span class="nc">Ed25519Signature2020</span> <span class="p">:</span> <span class="nc">ProofType</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">identifier</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span>
    <span class="p">}</span>
    
    <span class="kd">object</span> <span class="nc">JsonWebSignature2020</span> <span class="p">:</span> <span class="nc">ProofType</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">identifier</span> <span class="p">=</span> <span class="s">"JsonWebSignature2020"</span>
    <span class="p">}</span>
    
    <span class="kd">object</span> <span class="nc">BbsBlsSignature2020</span> <span class="p">:</span> <span class="nc">ProofType</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">identifier</span> <span class="p">=</span> <span class="s">"BbsBlsSignature2020"</span>
    <span class="p">}</span>
    
    <span class="kd">data class</span> <span class="nc">Custom</span><span class="p">(</span><span class="k">override</span> <span class="kd">val</span> <span class="py">identifier</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">ProofType</span><span class="p">()</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">identifier</span>
<span class="p">}</span>

<span class="cm">/**
 * Credential type classification.
 * 
 * Represents the TYPE/CATEGORY of verifiable credential.
 */</span>
<span class="nd">@Serializable</span><span class="p">(</span><span class="n">with</span> <span class="p">=</span> <span class="nc">CredentialTypeSerializer</span><span class="o">::</span><span class="k">class</span><span class="p">)</span>
<span class="k">sealed</span> <span class="kd">class</span> <span class="nc">CredentialType</span> <span class="p">{</span>
    <span class="k">abstract</span> <span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">String</span>
    
    <span class="kd">object</span> <span class="nc">VerifiableCredential</span> <span class="p">:</span> <span class="nc">CredentialType</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="s">"VerifiableCredential"</span>
    <span class="p">}</span>
    
    <span class="kd">object</span> <span class="nc">Education</span> <span class="p">:</span> <span class="nc">CredentialType</span><span class="p">()</span> <span class="p">{</span>
        <span class="k">override</span> <span class="kd">val</span> <span class="py">value</span> <span class="p">=</span> <span class="s">"EducationCredential"</span>
    <span class="p">}</span>
    
    <span class="c1">// ... other types</span>
    
    <span class="kd">data class</span> <span class="nc">Custom</span><span class="p">(</span><span class="k">override</span> <span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">CredentialType</span><span class="p">()</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="simple-enums">
  
  
    <a href="#simple-enums" class="anchor-heading" aria-labelledby="simple-enums"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Simple Enums
  
  
</h3>
    

<p>For simple enumerations, automatic serialization works fine:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="nd">@Serializable</span>
<span class="k">enum</span> <span class="kd">class</span> <span class="nc">StatusPurpose</span> <span class="p">{</span>
    <span class="nc">REVOCATION</span><span class="p">,</span>
    <span class="nc">SUSPENSION</span>
<span class="p">}</span>

<span class="nd">@Serializable</span>
<span class="k">enum</span> <span class="kd">class</span> <span class="nc">SchemaFormat</span> <span class="p">{</span>
    <span class="nc">JSON_SCHEMA</span><span class="p">,</span>
    <span class="nc">SHACL</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="serialization-strategy">
  
  
    <a href="#serialization-strategy" class="anchor-heading" aria-labelledby="serialization-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Serialization Strategy
  
  
</h2>
    
<h3 id="when-custom-serializers-are-required">
  
  
    <a href="#when-custom-serializers-are-required" class="anchor-heading" aria-labelledby="when-custom-serializers-are-required"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> When Custom Serializers Are Required
  
  
</h3>
    

<p><strong>YES - Required for:</strong></p>
<ol>
  <li>Value classes with validation in <code class="language-plaintext highlighter-rouge">init</code> blocks
    <ul>
      <li>Reason: Validation exceptions need better error messages</li>
      <li>Example: <code class="language-plaintext highlighter-rouge">Iri</code>, <code class="language-plaintext highlighter-rouge">Did</code>, <code class="language-plaintext highlighter-rouge">CredentialId</code></li>
    </ul>
  </li>
  <li>Sealed classes with explicit string-to-instance mapping
    <ul>
      <li>Reason: Custom parsing logic</li>
      <li>Example: <code class="language-plaintext highlighter-rouge">ProofType</code>, <code class="language-plaintext highlighter-rouge">CredentialType</code></li>
    </ul>
  </li>
</ol>

<p><strong>NO - Not Required for:</strong></p>
<ol>
  <li>Simple enums
    <ul>
      <li>Reason: Automatic serialization works perfectly</li>
      <li>Example: <code class="language-plaintext highlighter-rouge">StatusPurpose</code>, <code class="language-plaintext highlighter-rouge">SchemaFormat</code></li>
    </ul>
  </li>
</ol>
<h3 id="constructor-vs-factory-methods">
  
  
    <a href="#constructor-vs-factory-methods" class="anchor-heading" aria-labelledby="constructor-vs-factory-methods"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Constructor vs Factory Methods
  
  
</h3>
    

<p><strong>Key Design Decision</strong>: Use direct constructors instead of factory methods like <code class="language-plaintext highlighter-rouge">parse()</code>.</p>

<p><strong>Rationale</strong>:</p>
<ul>
  <li>✅ <strong>Simpler API</strong>: <code class="language-plaintext highlighter-rouge">Did("did:key:...")</code> is more concise than <code class="language-plaintext highlighter-rouge">Did.parse("did:key:...")</code></li>
  <li>✅ <strong>Validation in constructor</strong>: All validation happens in <code class="language-plaintext highlighter-rouge">init</code> blocks, so constructor is sufficient</li>
  <li>✅ <strong>Consistent with Kotlin idioms</strong>: Direct constructors are the standard approach</li>
  <li>✅ <strong>Matches existing codebase</strong>: Current implementation uses direct constructors</li>
  <li>✅ <strong>Less API surface</strong>: Fewer methods to maintain and document</li>
</ul>

<p><strong>For safe parsing</strong> (when you need nullable results), use:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// Option 1: try-catch</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:..."</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="c1">// Option 2: Extension function (if desired)</span>
<span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toDidOrNull</span><span class="p">():</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="s">"did:key:..."</span><span class="p">.</span><span class="nf">toDidOrNull</span><span class="p">()</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="inheritance-model">
  
  
    <a href="#inheritance-model" class="anchor-heading" aria-labelledby="inheritance-model"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Inheritance Model
  
  
</h3>
    

<p><strong>Key Design Decision</strong>: All IRI-based identifiers extend <code class="language-plaintext highlighter-rouge">Iri</code> (inheritance) rather than composing it.</p>

<p><strong>Rationale</strong>:</p>
<ul>
  <li>✅ <strong>True “IS-A” relationship</strong>: These identifiers ARE IRIs semantically</li>
  <li>✅ <strong>Polymorphism</strong>: All identifier instances can be used wherever <code class="language-plaintext highlighter-rouge">Iri</code> is expected</li>
  <li>✅ <strong>Shared behavior</strong>: Inherit all <code class="language-plaintext highlighter-rouge">Iri</code> methods (fragment parsing, scheme detection, etc.)</li>
  <li>✅ <strong>Type safety</strong>: Compiler enforces the relationship</li>
  <li>✅ <strong>Consistency</strong>: Uniform approach across all IRI-based identifiers</li>
</ul>

<p><strong>Identifiers that extend Iri</strong>:</p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">Did extends Iri</code> - A DID IS-A IRI (W3C DID Core spec)</li>
  <li><code class="language-plaintext highlighter-rouge">CredentialId extends Iri</code> - A credential ID IS-A IRI (W3C VC spec)</li>
  <li><code class="language-plaintext highlighter-rouge">IssuerId extends Iri</code> - An issuer ID IS-A IRI (W3C VC spec)</li>
  <li><code class="language-plaintext highlighter-rouge">StatusListId extends Iri</code> - A status list ID IS-A IRI</li>
  <li><code class="language-plaintext highlighter-rouge">SchemaId extends Iri</code> - A schema ID IS-A IRI</li>
</ul>

<p><strong>Example</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:z6Mk..."</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">credId</span> <span class="p">=</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="s">"https://example.com/cred/123"</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">issuerId</span> <span class="p">=</span> <span class="nc">IssuerId</span><span class="p">.</span><span class="nf">fromDid</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>

<span class="c1">// All can be used as Iri (polymorphism)</span>
<span class="kd">val</span> <span class="py">iri1</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">did</span>       <span class="c1">// ✅ Valid: Did IS-A Iri</span>
<span class="kd">val</span> <span class="py">iri2</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">credId</span>    <span class="c1">// ✅ Valid: CredentialId IS-A Iri</span>
<span class="kd">val</span> <span class="py">iri3</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">issuerId</span>  <span class="c1">// ✅ Valid: IssuerId IS-A Iri</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Trade-off</strong>: <code class="language-plaintext highlighter-rouge">Iri</code> must be a regular class (not <code class="language-plaintext highlighter-rouge">@JvmInline</code> value class) to allow inheritance. This is acceptable because:</p>
<ul>
  <li>The inheritance relationship is semantically correct per W3C specifications</li>
  <li>The performance difference is minimal for identifier classes</li>
  <li>Polymorphism benefits outweigh the slight performance cost</li>
  <li>Consistency across all IRI-based identifiers simplifies the API</li>
</ul>
<h3 id="serializer-pattern">
  
  
    <a href="#serializer-pattern" class="anchor-heading" aria-labelledby="serializer-pattern"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Serializer Pattern
  
  
</h3>
    

<p>All custom serializers follow this pattern:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="kd">object</span> <span class="nc">IdentifierSerializer</span> <span class="p">:</span> <span class="nc">KSerializer</span><span class="p">&lt;</span><span class="nc">Identifier</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="kd">val</span> <span class="py">descriptor</span><span class="p">:</span> <span class="nc">SerialDescriptor</span> <span class="p">=</span> 
        <span class="nc">PrimitiveSerialDescriptor</span><span class="p">(</span><span class="s">"Identifier"</span><span class="p">,</span> <span class="nc">PrimitiveKind</span><span class="p">.</span><span class="nc">STRING</span><span class="p">)</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">serialize</span><span class="p">(</span><span class="n">encoder</span><span class="p">:</span> <span class="nc">Encoder</span><span class="p">,</span> <span class="n">value</span><span class="p">:</span> <span class="nc">Identifier</span><span class="p">)</span> <span class="p">{</span>
        <span class="n">encoder</span><span class="p">.</span><span class="nf">encodeString</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">deserialize</span><span class="p">(</span><span class="n">decoder</span><span class="p">:</span> <span class="nc">Decoder</span><span class="p">):</span> <span class="nc">Identifier</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">string</span> <span class="p">=</span> <span class="n">decoder</span><span class="p">.</span><span class="nf">decodeString</span><span class="p">()</span>
        <span class="k">return</span> <span class="k">try</span> <span class="p">{</span>
            <span class="nc">Identifier</span><span class="p">(</span><span class="n">string</span><span class="p">)</span>  <span class="c1">// Constructor validates</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">throw</span> <span class="nc">SerializationException</span><span class="p">(</span>
                <span class="s">"Failed to deserialize Identifier: ${e.message}"</span><span class="p">,</span>
                <span class="n">e</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="json-representation">
  
  
    <a href="#json-representation" class="anchor-heading" aria-labelledby="json-representation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> JSON Representation
  
  
</h3>
    

<p><strong>Identifiers</strong> serialize as strings:</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"id"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK"</span><span class="p">,</span><span class="w">
  </span><span class="nl">"issuer"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:key:z6Mk..."</span><span class="p">,</span><span class="w">
  </span><span class="nl">"verificationMethod"</span><span class="p">:</span><span class="w"> </span><span class="s2">"did:key:z6Mk...#key-1"</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Types</strong> serialize as strings (category names):</p>
<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="p">{</span><span class="w">
  </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="s2">"VerifiableCredential"</span><span class="p">,</span><span class="w"> </span><span class="s2">"EducationCredential"</span><span class="p">],</span><span class="w">
  </span><span class="nl">"proof"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
    </span><span class="nl">"type"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Ed25519Signature2020"</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="type-safety--validation">
  
  
    <a href="#type-safety--validation" class="anchor-heading" aria-labelledby="type-safety--validation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Type Safety &amp; Validation
  
  
</h2>
    
<h3 id="compile-time-safety">
  
  
    <a href="#compile-time-safety" class="anchor-heading" aria-labelledby="compile-time-safety"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Compile-Time Safety
  
  
</h3>
    

<p>Value classes provide compile-time type safety:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Type-safe - compiler prevents misuse</span>
<span class="k">fun</span> <span class="nf">verifyCredential</span><span class="p">(</span>
    <span class="n">credentialId</span><span class="p">:</span> <span class="nc">CredentialId</span><span class="p">,</span>      <span class="c1">// Can't pass Did by mistake</span>
    <span class="n">issuerDid</span><span class="p">:</span> <span class="nc">Did</span><span class="p">,</span>                  <span class="c1">// Can't pass CredentialId by mistake</span>
    <span class="n">vmId</span><span class="p">:</span> <span class="nc">VerificationMethodId</span>       <span class="c1">// Clear intent</span>
<span class="p">)</span>

<span class="c1">// ❌ This won't compile</span>
<span class="nf">verifyCredential</span><span class="p">(</span>
    <span class="n">did</span><span class="p">,</span>          <span class="c1">// Error: Expected CredentialId, found Did</span>
    <span class="n">credId</span><span class="p">,</span>       <span class="c1">// Error: Expected Did, found CredentialId</span>
    <span class="s">"string"</span>      <span class="c1">// Error: Expected VerificationMethodId, found String</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="runtime-validation">
  
  
    <a href="#runtime-validation" class="anchor-heading" aria-labelledby="runtime-validation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Runtime Validation
  
  
</h3>
    

<p>All identifiers validate during construction:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Valid - succeeds</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:z6Mk..."</span><span class="p">)</span>

<span class="c1">// ❌ Invalid - throws IllegalArgumentException</span>
<span class="kd">val</span> <span class="py">invalid</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"not-a-did"</span><span class="p">)</span>
<span class="c1">// Error: Invalid DID format: 'not-a-did'. DIDs must start with 'did:'</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="validation-rules">
  
  
    <a href="#validation-rules" class="anchor-heading" aria-labelledby="validation-rules"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Validation Rules
  
  
</h3>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Identifier</th>
      <th>Validation Rules</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Iri</code></td>
      <td>Non-blank, valid IRI pattern (scheme:value or fragment)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">Did</code></td>
      <td>Must start with “did:”, at least 3 colon-separated parts</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">VerificationMethodId</code></td>
      <td>Must contain DID + fragment separator (#)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">CredentialId</code></td>
      <td>Valid IRI (inherited from Iri)</td>
    </tr>
    <tr>
      <td><code class="language-plaintext highlighter-rouge">KeyId</code></td>
      <td>Non-blank, no whitespace</td>
    </tr>
  </tbody>
</table></div><hr />
<h2 id="package-organization">
  
  
    <a href="#package-organization" class="anchor-heading" aria-labelledby="package-organization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Package Organization
  
  
</h2>
    
<h3 id="package-naming-convention">
  
  
    <a href="#package-naming-convention" class="anchor-heading" aria-labelledby="package-naming-convention"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Package Naming Convention
  
  
</h3>
    

<p><strong>Identifiers</strong>: <code class="language-plaintext highlighter-rouge">com.trustweave.{module}.identifiers</code></p>
<ul>
  <li>Example: <code class="language-plaintext highlighter-rouge">com.trustweave.credential.identifiers.CredentialId</code></li>
  <li>Example: <code class="language-plaintext highlighter-rouge">com.trustweave.did.identifiers.Did</code></li>
</ul>

<p><strong>Types</strong>: <code class="language-plaintext highlighter-rouge">com.trustweave.{module}.types</code></p>
<ul>
  <li>Example: <code class="language-plaintext highlighter-rouge">com.trustweave.credential.types.ProofType</code></li>
  <li>Example: <code class="language-plaintext highlighter-rouge">com.trustweave.kms.types.Algorithm</code></li>
</ul>
<h3 id="file-organization">
  
  
    <a href="#file-organization" class="anchor-heading" aria-labelledby="file-organization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> File Organization
  
  
</h3>
    

<p><strong>One file per module for identifiers:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre>credentials/credential-core/src/main/kotlin/com/trustweave/credential/
  └── identifiers/
      └── CredentialIdentifiers.kt  (all credential identifiers)
  └── types/
      └── CredentialTypes.kt        (all credential types)
      └── SchemaFormat.kt           (enum)
      └── StatusPurpose.kt          (enum)
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Rationale</strong>:</p>
<ul>
  <li>Easy to find all identifiers/types for a module</li>
  <li>Clear ownership</li>
  <li>Reduces file proliferation</li>
</ul><hr />
<h2 id="migration-strategy">
  
  
    <a href="#migration-strategy" class="anchor-heading" aria-labelledby="migration-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Migration Strategy
  
  
</h2>
    
<h3 id="phase-1-create-base-infrastructure">
  
  
    <a href="#phase-1-create-base-infrastructure" class="anchor-heading" aria-labelledby="phase-1-create-base-infrastructure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Phase 1: Create Base Infrastructure
  
  
</h3>
    
<ol>
  <li>Create <code class="language-plaintext highlighter-rouge">Iri</code> and <code class="language-plaintext highlighter-rouge">KeyId</code> in <code class="language-plaintext highlighter-rouge">common/identifiers/</code></li>
  <li>Add custom serializers</li>
  <li>Ensure tests pass</li>
</ol>
<h3 id="phase-2-module-specific-identifiers">
  
  
    <a href="#phase-2-module-specific-identifiers" class="anchor-heading" aria-labelledby="phase-2-module-specific-identifiers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Phase 2: Module-Specific Identifiers
  
  
</h3>
    
<ol>
  <li>Create <code class="language-plaintext highlighter-rouge">DidIdentifiers.kt</code> in <code class="language-plaintext highlighter-rouge">did-core</code></li>
  <li>Create <code class="language-plaintext highlighter-rouge">CredentialIdentifiers.kt</code> in <code class="language-plaintext highlighter-rouge">credential-core</code></li>
  <li>Create identifier files for other modules</li>
</ol>
<h3 id="phase-3-update-models">
  
  
    <a href="#phase-3-update-models" class="anchor-heading" aria-labelledby="phase-3-update-models"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Phase 3: Update Models
  
  
</h3>
    
<ol>
  <li>Replace all <code class="language-plaintext highlighter-rouge">String</code> identifier fields with typed identifiers</li>
  <li>Update all <code class="language-plaintext highlighter-rouge">String</code> type fields with typed types</li>
  <li>Update serialization code</li>
  <li>Update all usages across codebase</li>
</ol>
<h3 id="phase-4-remove-duplicates">
  
  
    <a href="#phase-4-remove-duplicates" class="anchor-heading" aria-labelledby="phase-4-remove-duplicates"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Phase 4: Remove Duplicates
  
  
</h3>
    
<ol>
  <li>Remove old identifier definitions</li>
  <li>Consolidate from multiple locations</li>
  <li>Update imports</li>
</ol>
<h3 id="phase-5-update-public-api">
  
  
    <a href="#phase-5-update-public-api" class="anchor-heading" aria-labelledby="phase-5-update-public-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Phase 5: Update Public API
  
  
</h3>
    
<ol>
  <li>Update all public functions to use typed parameters</li>
  <li>Update documentation</li>
  <li>Remove deprecated String-based methods</li>
</ol><hr />
<h2 id="usage-examples">
  
  
    <a href="#usage-examples" class="anchor-heading" aria-labelledby="usage-examples"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Usage Examples
  
  
</h2>
    
<h3 id="creating-identifiers">
  
  
    <a href="#creating-identifiers" class="anchor-heading" aria-labelledby="creating-identifiers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating Identifiers
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Creating identifiers (direct constructors with validation)</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:z6MkhaXgBZDvotDkL5257faiztiGiC2QtKLGpbnnEGta2doK"</span><span class="p">)</span>
<span class="c1">// All identifiers extend Iri, so they can be used wherever Iri is expected</span>
<span class="kd">val</span> <span class="py">iri1</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">did</span>  <span class="c1">// ✅ Valid: Did IS-A Iri</span>
<span class="kd">val</span> <span class="py">credId</span> <span class="p">=</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="s">"https://example.com/credentials/123"</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">iri2</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">credId</span>  <span class="c1">// ✅ Valid: CredentialId IS-A Iri</span>
<span class="kd">val</span> <span class="py">issuerId</span> <span class="p">=</span> <span class="nc">IssuerId</span><span class="p">.</span><span class="nf">fromDid</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">iri3</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">issuerId</span>  <span class="c1">// ✅ Valid: IssuerId IS-A Iri</span>
<span class="kd">val</span> <span class="py">vmId</span> <span class="p">=</span> <span class="n">did</span> <span class="p">+</span> <span class="s">"key-1"</span>  <span class="c1">// Operator: Creates VerificationMethodId</span>
<span class="kd">val</span> <span class="py">vmId2</span> <span class="p">=</span> <span class="n">did</span> <span class="n">with</span> <span class="s">"key-1"</span>  <span class="c1">// Infix: More readable alternative</span>

<span class="c1">// ✅ Safe parsing (using extension functions)</span>
<span class="kd">val</span> <span class="py">didOrNull</span> <span class="p">=</span> <span class="s">"did:key:..."</span><span class="p">.</span><span class="nf">toDidOrNull</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">credIdOrNull</span> <span class="p">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"id"</span><span class="p">)</span><span class="o">?.</span><span class="nf">toCredentialIdOrNull</span><span class="p">()</span>

<span class="c1">// ✅ Safe parsing (using try-catch if extension not available)</span>
<span class="kd">val</span> <span class="py">didOrNull2</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:..."</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="creating-types">
  
  
    <a href="#creating-types" class="anchor-heading" aria-labelledby="creating-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Creating Types
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Creating types</span>
<span class="kd">val</span> <span class="py">proofType</span> <span class="p">=</span> <span class="nc">ProofType</span><span class="p">.</span><span class="nc">Ed25519Signature2020</span>
<span class="kd">val</span> <span class="py">credType</span> <span class="p">=</span> <span class="nc">CredentialType</span><span class="p">.</span><span class="nc">Education</span>
<span class="kd">val</span> <span class="py">algorithm</span> <span class="p">=</span> <span class="nc">Algorithm</span><span class="p">.</span><span class="nc">Ed25519</span>
<span class="kd">val</span> <span class="py">format</span> <span class="p">=</span> <span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
<span class="kd">val</span> <span class="py">purpose</span> <span class="p">=</span> <span class="nc">StatusPurpose</span><span class="p">.</span><span class="nc">REVOCATION</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="using-in-models">
  
  
    <a href="#using-in-models" class="anchor-heading" aria-labelledby="using-in-models"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Using in Models
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Type-safe credential creation</span>
<span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
    <span class="n">id</span> <span class="p">=</span> <span class="n">credId</span><span class="p">,</span>              <span class="c1">// IDENTIFIER</span>
    <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>            <span class="c1">// TYPES</span>
        <span class="nc">CredentialType</span><span class="p">.</span><span class="nc">VerifiableCredential</span><span class="p">,</span>
        <span class="nc">CredentialType</span><span class="p">.</span><span class="nc">Education</span>
    <span class="p">),</span>
    <span class="n">issuer</span> <span class="p">=</span> <span class="n">issuerId</span><span class="p">,</span>        <span class="c1">// IDENTIFIER</span>
    <span class="n">credentialSubject</span> <span class="p">=</span> <span class="n">subjectJson</span><span class="p">,</span>
    <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
    <span class="n">proof</span> <span class="p">=</span> <span class="nc">Proof</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="n">proofType</span><span class="p">,</span>     <span class="c1">// TYPE</span>
        <span class="n">verificationMethod</span> <span class="p">=</span> <span class="n">vmId</span>  <span class="c1">// IDENTIFIER</span>
    <span class="p">)</span>
<span class="p">)</span>

<span class="c1">// ✅ Type-safe DID document</span>
<span class="kd">val</span> <span class="py">document</span> <span class="p">=</span> <span class="nc">DidDocument</span><span class="p">(</span>
    <span class="n">id</span> <span class="p">=</span> <span class="n">did</span><span class="p">,</span>                 <span class="c1">// IDENTIFIER</span>
    <span class="n">verificationMethod</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
        <span class="nc">VerificationMethod</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="n">vmId</span><span class="p">,</span>        <span class="c1">// IDENTIFIER</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"Ed25519VerificationKey2020"</span><span class="p">,</span>
            <span class="n">controller</span> <span class="p">=</span> <span class="n">did</span>  <span class="c1">// IDENTIFIER</span>
        <span class="p">)</span>
    <span class="p">),</span>
    <span class="n">assertionMethod</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">vmId</span><span class="p">)</span>  <span class="c1">// IDENTIFIER list</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="type-safe-functions">
  
  
    <a href="#type-safe-functions" class="anchor-heading" aria-labelledby="type-safe-functions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Type-Safe Functions
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Clear intent in function signatures</span>
<span class="k">fun</span> <span class="nf">issueCredential</span><span class="p">(</span>
    <span class="n">issuerId</span><span class="p">:</span> <span class="nc">IssuerId</span><span class="p">,</span>           <span class="c1">// IDENTIFIER - who is issuing</span>
    <span class="n">credentialType</span><span class="p">:</span> <span class="nc">CredentialType</span><span class="p">,</span> <span class="c1">// TYPE - what kind</span>
    <span class="n">proofType</span><span class="p">:</span> <span class="nc">ProofType</span>           <span class="c1">// TYPE - what proof algorithm</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span>

<span class="k">fun</span> <span class="nf">verifyCredential</span><span class="p">(</span>
    <span class="n">credentialId</span><span class="p">:</span> <span class="nc">CredentialId</span><span class="p">,</span>    <span class="c1">// IDENTIFIER - which credential</span>
    <span class="n">issuerDid</span><span class="p">:</span> <span class="nc">Did</span><span class="p">,</span>                <span class="c1">// IDENTIFIER - which issuer</span>
    <span class="n">vmId</span><span class="p">:</span> <span class="nc">VerificationMethodId</span>     <span class="c1">// IDENTIFIER - which key</span>
<span class="p">):</span> <span class="nc">VerificationResult</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="benefits">
  
  
    <a href="#benefits" class="anchor-heading" aria-labelledby="benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Benefits
  
  
</h2>
    
<h3 id="1-compile-time-safety">
  
  
    <a href="#1-compile-time-safety" class="anchor-heading" aria-labelledby="1-compile-time-safety"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. <strong>Compile-Time Safety</strong>
  
  
</h3>
    
<ul>
  <li>Prevents identifier misuse (e.g., passing DID where CredentialId expected)</li>
  <li>IDE autocompletion guides developers</li>
  <li>Type system enforces domain rules</li>
</ul>
<h3 id="2-runtime-validation">
  
  
    <a href="#2-runtime-validation" class="anchor-heading" aria-labelledby="2-runtime-validation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. <strong>Runtime Validation</strong>
  
  
</h3>
    
<ul>
  <li>Invalid identifiers rejected at construction</li>
  <li>Clear error messages</li>
  <li>Consistent validation across codebase</li>
</ul>
<h3 id="3-domain-clarity">
  
  
    <a href="#3-domain-clarity" class="anchor-heading" aria-labelledby="3-domain-clarity"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. <strong>Domain Clarity</strong>
  
  
</h3>
    
<ul>
  <li>Identifiers clearly separate from types</li>
  <li>Self-documenting code</li>
  <li>Easy to find module-specific identifiers</li>
</ul>
<h3 id="4-maintainability">
  
  
    <a href="#4-maintainability" class="anchor-heading" aria-labelledby="4-maintainability"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. <strong>Maintainability</strong>
  
  
</h3>
    
<ul>
  <li>Single source of truth per module</li>
  <li>Easy to extend with new identifiers</li>
  <li>Clear package organization</li>
</ul>
<h3 id="5-json-compatibility">
  
  
    <a href="#5-json-compatibility" class="anchor-heading" aria-labelledby="5-json-compatibility"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. <strong>JSON Compatibility</strong>
  
  
</h3>
    
<ul>
  <li>Seamless serialization/deserialization</li>
  <li>Validates on deserialization</li>
  <li>Maintains W3C compliance</li>
</ul><hr />
<h2 id="api-ergonomic-enhancements">
  
  
    <a href="#api-ergonomic-enhancements" class="anchor-heading" aria-labelledby="api-ergonomic-enhancements"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> API Ergonomic Enhancements
  
  
</h2>
    
<h3 id="1-extension-functions-for-safe-parsing">
  
  
    <a href="#1-extension-functions-for-safe-parsing" class="anchor-heading" aria-labelledby="1-extension-functions-for-safe-parsing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Extension Functions for Safe Parsing
  
  
</h3>
    

<p>Provide extension functions for null-safe identifier creation, aligning with Kotlin’s idiomatic patterns:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="c1">// common/src/main/kotlin/com/trustweave/core/identifiers/Identifiers.kt (extensions)</span>

<span class="cm">/**
 * Safe parsing extension functions for all identifiers.
 * Returns null instead of throwing exceptions.
 */</span>
<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toIriOrNull</span><span class="p">():</span> <span class="nc">Iri</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">Iri</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toKeyIdOrNull</span><span class="p">():</span> <span class="nc">KeyId</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">KeyId</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="c1">// did/did-core/src/main/kotlin/com/trustweave/did/identifiers/DidIdentifiersExtensions.kt</span>
<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toDidOrNull</span><span class="p">():</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toVerificationMethodIdOrNull</span><span class="p">(</span><span class="n">baseDid</span><span class="p">:</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">):</span> <span class="nc">VerificationMethodId</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">VerificationMethodId</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">baseDid</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="c1">// credentials/credential-core/.../CredentialIdentifiersExtensions.kt</span>
<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toCredentialIdOrNull</span><span class="p">():</span> <span class="nc">CredentialId</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toIssuerIdOrNull</span><span class="p">():</span> <span class="nc">IssuerId</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">IssuerId</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toStatusListIdOrNull</span><span class="p">():</span> <span class="nc">StatusListId</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">StatusListId</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toSchemaIdOrNull</span><span class="p">():</span> <span class="nc">SchemaId</span><span class="p">?</span> <span class="p">=</span> 
    <span class="k">try</span> <span class="p">{</span> <span class="nc">SchemaId</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Usage</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="s">"did:key:z6Mk..."</span><span class="p">.</span><span class="nf">toDidOrNull</span><span class="p">()</span>  <span class="c1">// Returns Did? instead of throwing</span>
<span class="kd">val</span> <span class="py">credId</span> <span class="p">=</span> <span class="n">json</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"id"</span><span class="p">).</span><span class="nf">toCredentialIdOrNull</span><span class="p">()</span>

<span class="c1">// Chain with null-safety</span>
<span class="n">json</span><span class="p">.</span><span class="nf">getString</span><span class="p">(</span><span class="s">"issuer"</span><span class="p">)</span><span class="o">?.</span><span class="nf">toIssuerIdOrNull</span><span class="p">()</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">issuer</span> <span class="p">-&gt;</span>
    <span class="c1">// Use issuer</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="2-result-based-parsing-alternative-pattern">
  
  
    <a href="#2-result-based-parsing-alternative-pattern" class="anchor-heading" aria-labelledby="2-result-based-parsing-alternative-pattern"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Result-Based Parsing (Alternative Pattern)
  
  
</h3>
    

<p>For codebases using <code class="language-plaintext highlighter-rouge">Result&lt;T&gt;</code> extensively, provide Result-returning parsers:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Result-based parsing for identifiers.
 * Returns Result&lt;T&gt; instead of throwing or returning null.
 */</span>
<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toDid</span><span class="p">():</span> <span class="nc">Result</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">runCatching</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>
<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toCredentialId</span><span class="p">():</span> <span class="nc">Result</span><span class="p">&lt;</span><span class="nc">CredentialId</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">runCatching</span> <span class="p">{</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>
<span class="k">inline</span> <span class="k">fun</span> <span class="nc">String</span><span class="p">.</span><span class="nf">toIri</span><span class="p">():</span> <span class="nc">Result</span><span class="p">&lt;</span><span class="nc">Iri</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">runCatching</span> <span class="p">{</span> <span class="nc">Iri</span><span class="p">(</span><span class="k">this</span><span class="p">)</span> <span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">val</span> <span class="py">didResult</span> <span class="p">=</span> <span class="s">"did:key:..."</span><span class="p">.</span><span class="nf">toDid</span><span class="p">()</span>
    <span class="p">.</span><span class="nf">onSuccess</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"Parsed: $did"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">onFailure</span> <span class="p">{</span> <span class="n">e</span> <span class="p">-&gt;</span> <span class="nf">println</span><span class="p">(</span><span class="s">"Error: ${e.message}"</span><span class="p">)</span> <span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="3-enhanced-operator-overloading">
  
  
    <a href="#3-enhanced-operator-overloading" class="anchor-heading" aria-labelledby="3-enhanced-operator-overloading"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Enhanced Operator Overloading
  
  
</h3>
    

<p>Extend operator overloading for more natural syntax:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">// DidIdentifiers.kt</span>
<span class="kd">class</span> <span class="nc">Did</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"#"</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Existing: operator fun plus(fragment: String)</span>
    
    <span class="c1">// ✅ Add: Infix function for cleaner syntax</span>
    <span class="k">infix</span> <span class="k">fun</span> <span class="nf">with</span><span class="p">(</span><span class="n">keyId</span><span class="p">:</span> <span class="nc">KeyId</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">=</span> <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">keyId</span><span class="p">)</span>
    <span class="k">infix</span> <span class="k">fun</span> <span class="nf">with</span><span class="p">(</span><span class="n">fragment</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">=</span> <span class="k">this</span> <span class="p">+</span> <span class="n">fragment</span>
    
    <span class="c1">// ✅ Add: Comparison operators (for sorting, equality)</span>
    <span class="c1">// Note: Already inherited equals/hashCode from Any, but can add Comparable</span>
<span class="p">}</span>

<span class="c1">// ✅ Make identifiers Comparable for natural sorting</span>
<span class="kd">class</span> <span class="nc">Did</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"#"</span><span class="p">)),</span> <span class="nc">Comparable</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">:</span> <span class="nc">Did</span><span class="p">):</span> <span class="nc">Int</span> <span class="p">=</span> <span class="n">value</span><span class="p">.</span><span class="nf">compareTo</span><span class="p">(</span><span class="n">other</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Usage</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">// Before: did + "key-1"</span>
<span class="c1">// After (both work):</span>
<span class="kd">val</span> <span class="py">vmId1</span> <span class="p">=</span> <span class="n">did</span> <span class="p">+</span> <span class="s">"key-1"</span>
<span class="kd">val</span> <span class="py">vmId2</span> <span class="p">=</span> <span class="n">did</span> <span class="n">with</span> <span class="s">"key-1"</span>      <span class="c1">// Infix - more readable</span>
<span class="kd">val</span> <span class="py">vmId3</span> <span class="p">=</span> <span class="n">did</span> <span class="n">with</span> <span class="nc">KeyId</span><span class="p">(</span><span class="s">"key-1"</span><span class="p">)</span>

<span class="c1">// Sorting</span>
<span class="kd">val</span> <span class="py">sorted</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">did1</span><span class="p">,</span> <span class="n">did2</span><span class="p">,</span> <span class="n">did3</span><span class="p">).</span><span class="nf">sorted</span><span class="p">()</span>  <span class="c1">// Natural order</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="4-smart-type-conversions">
  
  
    <a href="#4-smart-type-conversions" class="anchor-heading" aria-labelledby="4-smart-type-conversions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Smart Type Conversions
  
  
</h3>
    

<p>Add extension functions for safe type narrowing:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="c1">// IriExtensions.kt</span>

<span class="cm">/**
 * Smart cast helpers - safely narrow Iri to specific types.
 */</span>
<span class="k">fun</span> <span class="nc">Iri</span><span class="p">.</span><span class="nf">asDidOrNull</span><span class="p">():</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">if</span> <span class="p">(</span><span class="n">isDid</span><span class="p">)</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">Did</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span> <span class="k">else</span> <span class="k">null</span>
<span class="k">fun</span> <span class="nc">Iri</span><span class="p">.</span><span class="nf">asCredentialIdOrNull</span><span class="p">():</span> <span class="nc">CredentialId</span><span class="p">?</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>
<span class="k">fun</span> <span class="nc">Iri</span><span class="p">.</span><span class="nf">asIssuerIdOrNull</span><span class="p">():</span> <span class="nc">IssuerId</span><span class="p">?</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">IssuerId</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span> <span class="k">null</span> <span class="p">}</span>

<span class="cm">/**
 * Require specific type - throws with clear error if conversion fails.
 */</span>
<span class="k">fun</span> <span class="nc">Iri</span><span class="p">.</span><span class="nf">requireDid</span><span class="p">():</span> <span class="nc">Did</span> <span class="p">=</span> <span class="nf">asDidOrNull</span><span class="p">()</span> 
    <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"IRI '$value' is not a valid DID"</span><span class="p">)</span>

<span class="k">fun</span> <span class="nc">Iri</span><span class="p">.</span><span class="nf">requireCredentialId</span><span class="p">():</span> <span class="nc">CredentialId</span> <span class="p">=</span> <span class="nf">asCredentialIdOrNull</span><span class="p">()</span>
    <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"IRI '$value' is not a valid CredentialId"</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Usage</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">iri</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="nf">someOperation</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="n">iri</span><span class="p">.</span><span class="nf">asDidOrNull</span><span class="p">()</span>  <span class="c1">// Safe</span>
<span class="kd">val</span> <span class="py">did2</span> <span class="p">=</span> <span class="n">iri</span><span class="p">.</span><span class="nf">requireDid</span><span class="p">()</span>   <span class="c1">// Throws if not DID - clear intent</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="5-collection-extensions">
  
  
    <a href="#5-collection-extensions" class="anchor-heading" aria-labelledby="5-collection-extensions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Collection Extensions
  
  
</h3>
    

<p>Add useful extensions for collections of identifiers:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
</pre></td><td class="rouge-code"><pre><span class="c1">// IdentifierCollectionExtensions.kt</span>

<span class="cm">/**
 * Extension functions for collections of identifiers.
 */</span>

<span class="c1">// Safe parsing from string collections</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;.</span><span class="nf">mapToDidOrNull</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toDidOrNull</span><span class="p">()</span> <span class="p">}</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;.</span><span class="nf">mapToCredentialIdOrNull</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">CredentialId</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">toCredentialIdOrNull</span><span class="p">()</span> <span class="p">}</span>

<span class="c1">// Filter by type (polymorphism at work)</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">Iri</span><span class="p">&gt;.</span><span class="nf">filterDids</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">asDidOrNull</span><span class="p">()</span> <span class="p">}</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">Iri</span><span class="p">&gt;.</span><span class="nf">filterCredentialIds</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">CredentialId</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">asCredentialIdOrNull</span><span class="p">()</span> <span class="p">}</span>

<span class="c1">// Convert between types</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;.</span><span class="nf">toIris</span><span class="p">():</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Iri</span><span class="p">&gt;</span> <span class="p">=</span> <span class="k">this</span>  <span class="c1">// Natural conversion</span>

<span class="c1">// Find operations</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;.</span><span class="nf">findByMethod</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="nf">firstOrNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">method</span> <span class="p">==</span> <span class="n">method</span> <span class="p">}</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">CredentialId</span><span class="p">&gt;.</span><span class="nf">findByIssuer</span><span class="p">(</span><span class="n">issuer</span><span class="p">:</span> <span class="nc">Did</span><span class="p">):</span> <span class="nc">CredentialId</span><span class="p">?</span> <span class="p">=</span> 
    <span class="nf">firstOrNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="nf">asDidOrNull</span><span class="p">()</span> <span class="p">==</span> <span class="n">issuer</span> <span class="p">}</span>

<span class="c1">// Validation helpers</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">&gt;.</span><span class="nf">allValid</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="nf">all</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">value</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"did:"</span><span class="p">)</span> <span class="p">}</span>
<span class="k">fun</span> <span class="nf">List</span><span class="p">&lt;</span><span class="nc">Iri</span><span class="p">&gt;.</span><span class="nf">anyInvalid</span><span class="p">():</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="nf">any</span> <span class="p">{</span> <span class="k">try</span> <span class="p">{</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">it</span><span class="p">.</span><span class="n">value</span><span class="p">)</span> <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span> <span class="k">true</span> <span class="p">}</span> <span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Usage</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">didStrings</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"did:key:..."</span><span class="p">,</span> <span class="s">"did:web:..."</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">dids</span> <span class="p">=</span> <span class="n">didStrings</span><span class="p">.</span><span class="nf">mapToDidOrNull</span><span class="p">()</span>  <span class="c1">// Filters out invalid ones</span>
<span class="kd">val</span> <span class="py">keyDids</span> <span class="p">=</span> <span class="n">dids</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">method</span> <span class="p">==</span> <span class="s">"key"</span> <span class="p">}</span>

<span class="kd">val</span> <span class="py">allIris</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">Iri</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">did1</span><span class="p">,</span> <span class="n">credId1</span><span class="p">,</span> <span class="n">issuerId1</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">justDids</span> <span class="p">=</span> <span class="n">allIris</span><span class="p">.</span><span class="nf">filterDids</span><span class="p">()</span>  <span class="c1">// Extract only DIDs</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="6-destructuring-declarators">
  
  
    <a href="#6-destructuring-declarators" class="anchor-heading" aria-labelledby="6-destructuring-declarators"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. Destructuring Declarators
  
  
</h3>
    

<p>Add destructuring for composite identifiers:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">// VerificationMethodId</span>
<span class="kd">data class</span> <span class="nc">VerificationMethodId</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">did</span><span class="p">:</span> <span class="nc">Did</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">keyId</span><span class="p">:</span> <span class="nc">KeyId</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Kotlin automatically provides component1(), component2() for data classes</span>
    <span class="c1">// So destructuring just works:</span>
    <span class="c1">// val (did, keyId) = vmId</span>
<span class="p">}</span>

<span class="c1">// For Did (if we add properties we want to destructure)</span>
<span class="kd">class</span> <span class="nc">Did</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"#"</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Could add if useful:</span>
    <span class="c1">// operator fun component1(): String = method</span>
    <span class="c1">// operator fun component2(): String = identifier</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Usage</strong>:</p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">vmId</span> <span class="p">=</span> <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="n">did</span><span class="p">,</span> <span class="nc">KeyId</span><span class="p">(</span><span class="s">"key-1"</span><span class="p">))</span>
<span class="kd">val</span> <span class="p">(</span><span class="py">did</span><span class="p">,</span> <span class="py">keyId</span><span class="p">)</span> <span class="p">=</span> <span class="n">vmId</span>  <span class="c1">// Destructuring works automatically for data classes</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="7-string-interpolation-support">
  
  
    <a href="#7-string-interpolation-support" class="anchor-heading" aria-labelledby="7-string-interpolation-support"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 7. String Interpolation Support
  
  
</h3>
    

<p>Make identifiers work seamlessly in string templates:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// Already works via toString(), but we can document and enhance:</span>
<span class="kd">class</span> <span class="nc">Did</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">.</span><span class="nf">substringBefore</span><span class="p">(</span><span class="s">"#"</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>  <span class="c1">// ✅ Already implemented</span>
    
    <span class="c1">// Could add formatted variants if needed:</span>
    <span class="c1">// fun toShortString(): String = "did:$method:${identifier.take(8)}..."</span>
<span class="p">}</span>

<span class="c1">// Usage in string interpolation</span>
<span class="kd">val</span> <span class="py">message</span> <span class="p">=</span> <span class="s">"Verifying credential issued by ${did}"</span>  <span class="c1">// ✅ Works automatically</span>
<span class="kd">val</span> <span class="py">logEntry</span> <span class="p">=</span> <span class="s">"DID: ${did.value}, Method: ${did.method}"</span>  <span class="c1">// ✅ Full access</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="8-type-safe-conversion-helpers">
  
  
    <a href="#8-type-safe-conversion-helpers" class="anchor-heading" aria-labelledby="8-type-safe-conversion-helpers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 8. Type-Safe Conversion Helpers
  
  
</h3>
    

<p>Add companion object factory methods for common conversions:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="kd">class</span> <span class="nc">IssuerId</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="cm">/**
         * Create IssuerId from Did (common case).
         * More ergonomic than: IssuerId(did.value)
         */</span>
        <span class="k">fun</span> <span class="nf">fromDid</span><span class="p">(</span><span class="n">did</span><span class="p">:</span> <span class="nc">Did</span><span class="p">):</span> <span class="nc">IssuerId</span> <span class="p">=</span> <span class="nc">IssuerId</span><span class="p">(</span><span class="n">did</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        
        <span class="cm">/**
         * Create IssuerId from Iri (if needed).
         */</span>
        <span class="k">fun</span> <span class="nf">fromIri</span><span class="p">(</span><span class="n">iri</span><span class="p">:</span> <span class="nc">Iri</span><span class="p">):</span> <span class="nc">IssuerId</span> <span class="p">=</span> <span class="nc">IssuerId</span><span class="p">(</span><span class="n">iri</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">class</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">String</span><span class="p">)</span> <span class="p">:</span> <span class="nc">Iri</span><span class="p">(</span><span class="n">value</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="cm">/**
         * Create from Iri (useful when you have an Iri and want to narrow it).
         */</span>
        <span class="k">fun</span> <span class="nf">fromIri</span><span class="p">(</span><span class="n">iri</span><span class="p">:</span> <span class="nc">Iri</span><span class="p">):</span> <span class="nc">CredentialId</span> <span class="p">=</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="n">iri</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        
        <span class="cm">/**
         * Create from Did (when credential ID is a DID).
         */</span>
        <span class="k">fun</span> <span class="nf">fromDid</span><span class="p">(</span><span class="n">did</span><span class="p">:</span> <span class="nc">Did</span><span class="p">):</span> <span class="nc">CredentialId</span> <span class="p">=</span> <span class="nc">CredentialId</span><span class="p">(</span><span class="n">did</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="9-enhanced-verificationmethodid-api">
  
  
    <a href="#9-enhanced-verificationmethodid-api" class="anchor-heading" aria-labelledby="9-enhanced-verificationmethodid-api"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 9. Enhanced VerificationMethodId API
  
  
</h3>
    

<p>Improve <code class="language-plaintext highlighter-rouge">VerificationMethodId</code> ergonomics:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
</pre></td><td class="rouge-code"><pre><span class="kd">data class</span> <span class="nc">VerificationMethodId</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">did</span><span class="p">:</span> <span class="nc">Did</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">keyId</span><span class="p">:</span> <span class="nc">KeyId</span>
<span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">value</span><span class="p">:</span> <span class="nc">String</span> <span class="k">get</span><span class="p">()</span> <span class="p">=</span> <span class="s">"${did.value}${if (keyId.isFragment) keyId.value else "</span><span class="err">#$</span><span class="p">{</span><span class="n">keyId</span><span class="p">.</span><span class="n">value</span><span class="p">}</span><span class="s">"}"</span>
    
    <span class="k">override</span> <span class="k">fun</span> <span class="nf">toString</span><span class="p">():</span> <span class="nc">String</span> <span class="p">=</span> <span class="n">value</span>
    
    <span class="c1">// ✅ Add: Decompose into components</span>
    <span class="k">fun</span> <span class="nf">decompose</span><span class="p">():</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Did</span><span class="p">,</span> <span class="nc">KeyId</span><span class="p">&gt;</span> <span class="p">=</span> <span class="n">did</span> <span class="n">to</span> <span class="n">keyId</span>
    
    <span class="c1">// ✅ Add: Factory from string with better error messages</span>
    <span class="k">companion</span> <span class="k">object</span> <span class="p">{</span>
        <span class="k">fun</span> <span class="nf">parse</span><span class="p">(</span><span class="n">vmIdString</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">baseDid</span><span class="p">:</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">{</span>
            <span class="k">return</span> <span class="k">when</span> <span class="p">{</span>
                <span class="n">vmIdString</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"did:"</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="kd">val</span> <span class="py">parts</span> <span class="p">=</span> <span class="n">vmIdString</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span><span class="s">"#"</span><span class="p">,</span> <span class="n">limit</span> <span class="p">=</span> <span class="mi">2</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">parts</span><span class="p">.</span><span class="n">size</span> <span class="p">!=</span> <span class="mi">2</span><span class="p">)</span> <span class="p">{</span>
                        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span>
                            <span class="s">"VerificationMethodId must contain '#' fragment: '$vmIdString'"</span>
                        <span class="p">)</span>
                    <span class="p">}</span>
                    <span class="nc">VerificationMethodId</span><span class="p">(</span>
                        <span class="n">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="n">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]),</span>
                        <span class="n">keyId</span> <span class="p">=</span> <span class="nc">KeyId</span><span class="p">(</span><span class="s">"#${parts[1]}"</span><span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">}</span>
                <span class="n">vmIdString</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span> <span class="p">&amp;&amp;</span> <span class="n">baseDid</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="n">baseDid</span><span class="p">,</span> <span class="nc">KeyId</span><span class="p">(</span><span class="n">vmIdString</span><span class="p">))</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span>
                    <span class="s">"Cannot parse VerificationMethodId: '$vmIdString'. "</span> <span class="p">+</span>
                    <span class="s">"Must be full DID URL (did:...:#...) or fragment (#...) with baseDid"</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="10-infix-functions-for-fluent-operations">
  
  
    <a href="#10-infix-functions-for-fluent-operations" class="anchor-heading" aria-labelledby="10-infix-functions-for-fluent-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 10. Infix Functions for Fluent Operations
  
  
</h3>
    

<p>Add infix functions for common operations:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="c1">// DidIdentifiersExtensions.kt</span>

<span class="cm">/**
 * Infix function: "did with fragment" - more readable than operator plus
 */</span>
<span class="k">infix</span> <span class="k">fun</span> <span class="nc">Did</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="n">fragment</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">=</span> <span class="k">this</span> <span class="p">+</span> <span class="n">fragment</span>
<span class="k">infix</span> <span class="k">fun</span> <span class="nc">Did</span><span class="p">.</span><span class="nf">with</span><span class="p">(</span><span class="n">keyId</span><span class="p">:</span> <span class="nc">KeyId</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">=</span> <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="n">keyId</span><span class="p">)</span>

<span class="cm">/**
 * Infix function: Check if DID belongs to method
 */</span>
<span class="k">infix</span> <span class="k">fun</span> <span class="nc">Did</span><span class="p">.</span><span class="nf">isMethod</span><span class="p">(</span><span class="n">method</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">=</span> <span class="k">this</span><span class="p">.</span><span class="n">method</span> <span class="p">==</span> <span class="n">method</span>

<span class="c1">// Usage</span>
<span class="kd">val</span> <span class="py">vmId</span> <span class="p">=</span> <span class="n">did</span> <span class="n">with</span> <span class="s">"key-1"</span>  <span class="c1">// More readable</span>
<span class="k">if</span> <span class="p">(</span><span class="n">did</span> <span class="n">isMethod</span> <span class="s">"key"</span><span class="p">)</span> <span class="p">{</span> <span class="o">..</span><span class="p">.</span> <span class="p">}</span>  <span class="c1">// Natural language</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="11-scope-functions-integration">
  
  
    <a href="#11-scope-functions-integration" class="anchor-heading" aria-labelledby="11-scope-functions-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 11. Scope Functions Integration
  
  
</h3>
    

<p>Design identifiers to work well with Kotlin scope functions:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Already works well:</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:..."</span><span class="p">)</span>
    <span class="p">.</span><span class="nf">also</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="s">"Created: $it"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">it</span> <span class="p">+</span> <span class="s">"key-1"</span> <span class="p">}</span>  <span class="c1">// Create VerificationMethodId</span>
    <span class="p">.</span><span class="nf">takeIf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">keyId</span><span class="p">.</span><span class="n">fragmentValue</span><span class="p">.</span><span class="nf">startsWith</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="12-type-safe-builder-pattern-for-complex-identifiers">
  
  
    <a href="#12-type-safe-builder-pattern-for-complex-identifiers" class="anchor-heading" aria-labelledby="12-type-safe-builder-pattern-for-complex-identifiers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 12. Type-Safe Builder Pattern for Complex Identifiers
  
  
</h3>
    

<p>For composite identifiers, consider builder pattern:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c1">// Only if VerificationMethodId construction gets complex</span>
<span class="kd">object</span> <span class="nc">VerificationMethodId</span> <span class="p">{</span>
    <span class="k">inline</span> <span class="k">fun</span> <span class="nf">build</span><span class="p">(</span><span class="n">block</span><span class="p">:</span> <span class="nc">Builder</span><span class="p">.()</span> <span class="p">-&gt;</span> <span class="nc">Unit</span><span class="p">):</span> <span class="nc">VerificationMethodId</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">builder</span> <span class="p">=</span> <span class="nc">Builder</span><span class="p">()</span>
        <span class="n">builder</span><span class="p">.</span><span class="nf">block</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">builder</span><span class="p">.</span><span class="nf">build</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">class</span> <span class="nc">Builder</span> <span class="p">{</span>
        <span class="k">private</span> <span class="kd">var</span> <span class="py">did</span><span class="p">:</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
        <span class="k">private</span> <span class="kd">var</span> <span class="py">keyId</span><span class="p">:</span> <span class="nc">KeyId</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
        
        <span class="k">fun</span> <span class="nf">did</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">Did</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="n">did</span> <span class="p">=</span> <span class="n">value</span> <span class="p">}</span>
        <span class="k">fun</span> <span class="nf">keyId</span><span class="p">(</span><span class="n">value</span><span class="p">:</span> <span class="nc">KeyId</span><span class="p">)</span> <span class="p">{</span> <span class="k">this</span><span class="p">.</span><span class="n">keyId</span> <span class="p">=</span> <span class="n">value</span> <span class="p">}</span>
        
        <span class="k">fun</span> <span class="nf">build</span><span class="p">():</span> <span class="nc">VerificationMethodId</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">d</span> <span class="p">=</span> <span class="n">did</span> <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Did required"</span><span class="p">)</span>
            <span class="kd">val</span> <span class="py">k</span> <span class="p">=</span> <span class="n">keyId</span> <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"KeyId required"</span><span class="p">)</span>
            <span class="k">return</span> <span class="nc">VerificationMethodId</span><span class="p">(</span><span class="n">d</span><span class="p">,</span> <span class="n">k</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Usage (only if needed, simpler API preferred):</span>
<span class="kd">val</span> <span class="py">vmId</span> <span class="p">=</span> <span class="nc">VerificationMethodId</span><span class="p">.</span><span class="nf">build</span> <span class="p">{</span>
    <span class="n">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:..."</span><span class="p">)</span>
    <span class="n">keyId</span> <span class="p">=</span> <span class="nc">KeyId</span><span class="p">(</span><span class="s">"key-1"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Note</strong>: Prefer simple constructors/data classes unless complexity warrants builders.</p><hr />
<h2 id="enhanced-design-summary">
  
  
    <a href="#enhanced-design-summary" class="anchor-heading" aria-labelledby="enhanced-design-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Enhanced Design Summary
  
  
</h2>
    
<h3 id="key-enhancements-applied">
  
  
    <a href="#key-enhancements-applied" class="anchor-heading" aria-labelledby="key-enhancements-applied"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Enhancements Applied:
  
  
</h3>
    

<ol>
  <li>✅ <strong>Extension Functions</strong>: <code class="language-plaintext highlighter-rouge">String.toDidOrNull()</code>, <code class="language-plaintext highlighter-rouge">String.toCredentialIdOrNull()</code></li>
  <li>✅ <strong>Infix Functions</strong>: <code class="language-plaintext highlighter-rouge">did with "key-1"</code> for readability</li>
  <li>✅ <strong>Comparable Interface</strong>: Natural sorting for identifiers</li>
  <li>✅ <strong>Type Narrowing</strong>: <code class="language-plaintext highlighter-rouge">iri.asDidOrNull()</code>, <code class="language-plaintext highlighter-rouge">iri.requireDid()</code></li>
  <li>✅ <strong>Collection Extensions</strong>: <code class="language-plaintext highlighter-rouge">list.mapToDidOrNull()</code>, <code class="language-plaintext highlighter-rouge">list.filterDids()</code></li>
  <li>✅ <strong>Smart Conversions</strong>: Factory methods in companion objects</li>
  <li>✅ <strong>Destructuring</strong>: Automatic for data classes</li>
  <li>✅ <strong>Better Error Messages</strong>: Descriptive exceptions</li>
</ol>
<h3 id="recommended-implementation-order">
  
  
    <a href="#recommended-implementation-order" class="anchor-heading" aria-labelledby="recommended-implementation-order"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recommended Implementation Order:
  
  
</h3>
    

<ol>
  <li><strong>Phase 1</strong> (Must Have): Extension functions for safe parsing</li>
  <li><strong>Phase 2</strong> (Should Have): Comparable interface, infix functions</li>
  <li><strong>Phase 3</strong> (Nice to Have): Collection extensions, type narrowing helpers</li>
  <li><strong>Phase 4</strong> (Future): Result-based parsing if adopted across codebase</li>
</ol><hr />
<h2 id="future-considerations">
  
  
    <a href="#future-considerations" class="anchor-heading" aria-labelledby="future-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Future Considerations
  
  
</h2>
    
<h3 id="potential-extensions">
  
  
    <a href="#potential-extensions" class="anchor-heading" aria-labelledby="potential-extensions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Potential Extensions
  
  
</h3>
    

<ol>
  <li><strong>Identifier Resolution</strong>
    <ul>
      <li>Add resolution helpers (e.g., <code class="language-plaintext highlighter-rouge">CredentialId.resolve()</code>)</li>
      <li>Cache resolved identifiers</li>
    </ul>
  </li>
  <li><strong>Identifier Normalization</strong>
    <ul>
      <li>Add normalization methods (e.g., case-insensitive DID comparison)</li>
      <li>Support canonical forms</li>
    </ul>
  </li>
  <li><strong>Composite Identifiers</strong>
    <ul>
      <li>Support complex identifier patterns</li>
      <li>Multi-part identifiers</li>
    </ul>
  </li>
  <li><strong>Identifier Validation Levels</strong>
    <ul>
      <li>Strict vs. lenient validation modes</li>
      <li>Configurable validation rules</li>
    </ul>
  </li>
</ol><hr />
<h2 id="references">
  
  
    <a href="#references" class="anchor-heading" aria-labelledby="references"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> References
  
  
</h2>
    

<ul>
  <li><a href="https://www.w3.org/TR/did-core/">W3C DID Core Specification</a></li>
  <li><a href="https://www.w3.org/TR/vc-data-model/">W3C Verifiable Credentials Data Model</a></li>
  <li><a href="https://tools.ietf.org/html/rfc3987">RFC 3987 - Internationalized Resource Identifiers (IRIs)</a></li>
  <li><a href="https://kotlinlang.org/docs/inline-classes.html">Kotlin Value Classes</a></li>
  <li><a href="https://github.com/Kotlin/kotlinx.serialization">Kotlinx Serialization</a></li>
</ul><hr />
<h2 id="document-history">
  
  
    <a href="#document-history" class="anchor-heading" aria-labelledby="document-history"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Document History
  
  
</h2>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Version</th>
      <th>Date</th>
      <th>Changes</th>
      <th>Author</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>1.0</td>
      <td>2024</td>
      <td>Initial design specification</td>
      <td>Architecture Team</td>
    </tr>
  </tbody>
</table></div><hr />

<p><strong>Status</strong>: ✅ Approved for Implementation<br />
<strong>Next Steps</strong>: Begin Phase 1 implementation (Base Infrastructure)</p><hr />
<h2 id="api-design-excellence-quick-reference">
  
  
    <a href="#api-design-excellence-quick-reference" class="anchor-heading" aria-labelledby="api-design-excellence-quick-reference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> API Design Excellence: Quick Reference
  
  
</h2>
    
<h3 id="-core-design-principles-applied">
  
  
    <a href="#-core-design-principles-applied" class="anchor-heading" aria-labelledby="-core-design-principles-applied"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ✅ Core Design Principles Applied
  
  
</h3>
    

<div class="table-wrapper"><table>
  <thead>
    <tr>
      <th>Principle</th>
      <th>Implementation</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><strong>Type Safety</strong></td>
      <td>All identifiers are strongly typed classes, no String leakage</td>
    </tr>
    <tr>
      <td><strong>Validation</strong></td>
      <td>Format validation in constructors, clear error messages</td>
    </tr>
    <tr>
      <td><strong>Inheritance</strong></td>
      <td>Proper “IS-A” relationships (<code class="language-plaintext highlighter-rouge">Did extends Iri</code>)</td>
    </tr>
    <tr>
      <td><strong>Polymorphism</strong></td>
      <td>Identifiers can be used as base types (<code class="language-plaintext highlighter-rouge">Iri</code>)</td>
    </tr>
    <tr>
      <td><strong>Simplicity</strong></td>
      <td>Direct constructors, no unnecessary factory methods</td>
    </tr>
    <tr>
      <td><strong>Extensibility</strong></td>
      <td>Extension functions for ergonomic operations</td>
    </tr>
    <tr>
      <td><strong>Discoverability</strong></td>
      <td>Infix functions, operator overloading, clear naming</td>
    </tr>
  </tbody>
</table></div>
<h3 id="-ergonomic-patterns">
  
  
    <a href="#-ergonomic-patterns" class="anchor-heading" aria-labelledby="-ergonomic-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ✅ Ergonomic Patterns
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="c1">// ✅ Direct construction (simple, idiomatic)</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="nc">Did</span><span class="p">(</span><span class="s">"did:key:z6Mk..."</span><span class="p">)</span>

<span class="c1">// ✅ Safe parsing (null-safe)</span>
<span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="s">"did:key:..."</span><span class="p">.</span><span class="nf">toDidOrNull</span><span class="p">()</span>

<span class="c1">// ✅ Infix functions (readable)</span>
<span class="kd">val</span> <span class="py">vmId</span> <span class="p">=</span> <span class="n">did</span> <span class="n">with</span> <span class="s">"key-1"</span>

<span class="c1">// ✅ Operator overloading (concise)</span>
<span class="kd">val</span> <span class="py">vmId</span> <span class="p">=</span> <span class="n">did</span> <span class="p">+</span> <span class="s">"key-1"</span>

<span class="c1">// ✅ Type narrowing (polymorphism)</span>
<span class="kd">val</span> <span class="py">iri</span><span class="p">:</span> <span class="nc">Iri</span> <span class="p">=</span> <span class="n">did</span>
<span class="kd">val</span> <span class="py">did2</span> <span class="p">=</span> <span class="n">iri</span><span class="p">.</span><span class="nf">asDidOrNull</span><span class="p">()</span>

<span class="c1">// ✅ Natural sorting (Comparable)</span>
<span class="kd">val</span> <span class="py">sorted</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">did1</span><span class="p">,</span> <span class="n">did2</span><span class="p">,</span> <span class="n">did3</span><span class="p">).</span><span class="nf">sorted</span><span class="p">()</span>

<span class="c1">// ✅ Collection operations</span>
<span class="kd">val</span> <span class="py">dids</span> <span class="p">=</span> <span class="n">stringList</span><span class="p">.</span><span class="nf">mapToDidOrNull</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">keyDids</span> <span class="p">=</span> <span class="n">dids</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span> <span class="n">isMethod</span> <span class="s">"key"</span> <span class="p">}</span>

<span class="c1">// ✅ Destructuring (data classes)</span>
<span class="kd">val</span> <span class="p">(</span><span class="py">did</span><span class="p">,</span> <span class="py">keyId</span><span class="p">)</span> <span class="p">=</span> <span class="n">vmId</span>

<span class="c1">// ✅ Type-safe conversions</span>
<span class="kd">val</span> <span class="py">issuerId</span> <span class="p">=</span> <span class="nc">IssuerId</span><span class="p">.</span><span class="nf">fromDid</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="-key-enhancements-summary">
  
  
    <a href="#-key-enhancements-summary" class="anchor-heading" aria-labelledby="-key-enhancements-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ✅ Key Enhancements Summary
  
  
</h3>
    

<ol>
  <li><strong>Extension Functions</strong>: <code class="language-plaintext highlighter-rouge">String.toXxxOrNull()</code> for all identifiers</li>
  <li><strong>Infix Functions</strong>: <code class="language-plaintext highlighter-rouge">did with "fragment"</code> for readability</li>
  <li><strong>Comparable Interface</strong>: Natural sorting support</li>
  <li><strong>Type Narrowing</strong>: <code class="language-plaintext highlighter-rouge">iri.asDidOrNull()</code>, <code class="language-plaintext highlighter-rouge">iri.requireDid()</code></li>
  <li><strong>Collection Extensions</strong>: <code class="language-plaintext highlighter-rouge">list.mapToDidOrNull()</code>, <code class="language-plaintext highlighter-rouge">list.filterDids()</code></li>
  <li><strong>Smart Conversions</strong>: Companion object factory methods</li>
  <li><strong>Better Errors</strong>: Descriptive validation messages</li>
  <li><strong>Polymorphism</strong>: All IRI-based identifiers extend <code class="language-plaintext highlighter-rouge">Iri</code></li>
</ol>
<h3 id="-what-makes-this-api-excellent">
  
  
    <a href="#-what-makes-this-api-excellent" class="anchor-heading" aria-labelledby="-what-makes-this-api-excellent"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ✅ What Makes This API Excellent
  
  
</h3>
    

<ul>
  <li><strong>Self-Documenting</strong>: Function signatures express intent clearly</li>
  <li><strong>Type-Safe</strong>: Compiler prevents common mistakes</li>
  <li><strong>Ergonomic</strong>: Extension functions make common operations concise</li>
  <li><strong>Discoverable</strong>: IDE autocompletion guides developers</li>
  <li><strong>Consistent</strong>: Uniform patterns across all identifiers</li>
  <li><strong>Minimal</strong>: No unnecessary abstraction layers</li>
  <li><strong>Kotlin-Idiomatic</strong>: Leverages language features effectively</li>
</ul>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with ❤️ by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();

        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
        footer.style.marginTop = 'auto'; // Push to bottom in flexbox layout
        footer.style.zIndex = '0'; // Below search overlay
      }
    }

    // Function to update footer visibility based on search state
    function updateFooterVisibility() {
      const footer = document.querySelector('.site-footer');
      const htmlElement = document.documentElement;

      if (footer && htmlElement) {
        const isSearchActive = htmlElement.classList.contains('search-active');
        if (isSearchActive) {
          // Hide footer when search is active - use multiple methods to ensure it's hidden
          footer.style.display = 'none';
          footer.style.visibility = 'hidden';
          footer.style.opacity = '0';
          footer.style.zIndex = '-999';
          footer.style.pointerEvents = 'none';
        } else {
          // Show footer when search is not active
          footer.style.display = 'block';
          footer.style.visibility = 'visible';
          footer.style.opacity = '1';
          footer.style.marginTop = 'auto';
          footer.style.position = 'relative';
          footer.style.zIndex = '-1';
          footer.style.pointerEvents = 'auto';
        }
      }
    }

    // Monitor search state and hide/show footer appropriately
    const observer = new MutationObserver(function(mutations) {
      updateFooterVisibility();
    });

    // Also listen for input events on search input as a backup
    // This ensures footer is hidden immediately when user starts typing
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      // Use requestAnimationFrame for better performance
      const handleSearchChange = function() {
        requestAnimationFrame(updateFooterVisibility);
      };

      searchInput.addEventListener('input', handleSearchChange);
      searchInput.addEventListener('focus', handleSearchChange);
      searchInput.addEventListener('keydown', handleSearchChange);
    }

    // Observe documentElement (html) for class changes (like search-active)
    // The search script adds 'search-active' to documentElement, not body
    if (document.documentElement) {
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });

      // Initial check
      updateFooterVisibility();
    }
  });
</script>


    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    





<script type="module">
  
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';
  

  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>



  
</body>
</html>

