

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">

    .site-nav ul li a {
      background-image: none;
    }

  </style>




    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>


  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">





  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Credential Exchange Protocols - Error Handling | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Credential Exchange Protocols - Error Handling" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="http://localhost:4000/trustweave/features/credential-exchange-protocols/ERROR_HANDLING/" />
<meta property="og:url" content="http://localhost:4000/trustweave/features/credential-exchange-protocols/ERROR_HANDLING/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Credential Exchange Protocols - Error Handling" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Credential Exchange Protocols - Error Handling","url":"http://localhost:4000/trustweave/features/credential-exchange-protocols/ERROR_HANDLING/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }

  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }

  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }

  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }

  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });

            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');

        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';

                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';

                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';

                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>


    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>



    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>


</svg>


    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">


    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/use-trustweave-facade/" class="nav-list-link">Use TrustWeave Facade for Quick Setup</a></li><li class="nav-list-item"><a href="/trustweave/how-to/configure-trustlayer/" class="nav-list-link">Configure TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li><li class="nav-list-item"><a href="/trustweave/how-to/multi-chain-anchoring/" class="nav-list-link">Multi-Chain Anchoring Patterns</a></li><li class="nav-list-item"><a href="/trustweave/how-to/exchange-credentials/" class="nav-list-link">Exchange Credentials with Multiple Protocols</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li></ul>

</nav>






    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>

</div>


  <div class="main" id="top">
    <div id="main-header" class="main-header">



<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>




</div>

    <div class="main-content-wrap">

      <div id="main-content" class="main-content">
        <main>

            <h1 id="credential-exchange-protocols---error-handling">


    <a href="#credential-exchange-protocols---error-handling" class="anchor-heading" aria-labelledby="credential-exchange-protocols---error-handling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Credential Exchange Protocols - Error Handling


</h1>


<p>Complete guide to error handling for credential exchange protocols.</p>
<h2 id="overview">


    <a href="#overview" class="anchor-heading" aria-labelledby="overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Overview


</h2>


<p>All credential exchange operations throw structured exceptions from the <code class="language-plaintext highlighter-rouge">ExchangeException</code> hierarchy. These exceptions extend <code class="language-plaintext highlighter-rouge">TrustWeaveException</code> and provide:</p>

<ul>
  <li><strong>Structured error codes</strong> for programmatic handling</li>
  <li><strong>Rich context</strong> with relevant information</li>
  <li><strong>Type-safe error handling</strong> with sealed classes</li>
  <li><strong>Consistent error format</strong> across all TrustWeave modules</li>
</ul>
<h2 id="exception-hierarchy">


    <a href="#exception-hierarchy" class="anchor-heading" aria-labelledby="exception-hierarchy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exception Hierarchy


</h2>


<p>All exchange-related exceptions extend <code class="language-plaintext highlighter-rouge">ExchangeException</code>, which extends <code class="language-plaintext highlighter-rouge">TrustWeaveException</code>. Plugin-specific exceptions are located in their respective plugin modules:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.exchange.exception.ExchangeException</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.didcomm.exception.DidCommException</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.oidc4vci.exception.Oidc4VciException</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.chapi.exception.ChapiException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">ProtocolNotRegistered</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol: ${e.protocolName}"</span><span class="p">)</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Available: ${e.availableProtocols}"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">is</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">OperationNotSupported</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Operation: ${e.operation}"</span><span class="p">)</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Supported: ${e.supportedOperations}"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">// Plugin-specific exceptions also extend ExchangeException</span>
        <span class="k">is</span> <span class="nc">DidCommException</span><span class="p">.</span><span class="nc">EncryptionFailed</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"DIDComm encryption failed: ${e.reason}"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">is</span> <span class="nc">Oidc4VciException</span><span class="p">.</span><span class="nc">HttpRequestFailed</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"OIDC4VCI HTTP request failed: ${e.statusCode}"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">is</span> <span class="nc">ChapiException</span><span class="p">.</span><span class="nc">BrowserNotAvailable</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"CHAPI requires browser: ${e.reason}"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">// ... handle other exceptions</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="exception-module-structure">


    <a href="#exception-module-structure" class="anchor-heading" aria-labelledby="exception-module-structure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Exception Module Structure


</h3>


<ul>
  <li><strong>Core exceptions</strong> (<code class="language-plaintext highlighter-rouge">ExchangeException</code>): Located in <code class="language-plaintext highlighter-rouge">credentials/credential-core</code>
    <ul>
      <li>Registry errors</li>
      <li>Request validation errors</li>
      <li>Resource not found errors</li>
      <li>Generic/unknown errors</li>
    </ul>
  </li>
  <li><strong>Plugin-specific exceptions</strong>: Located in their respective plugin modules
    <ul>
      <li><code class="language-plaintext highlighter-rouge">DidCommException</code>: <code class="language-plaintext highlighter-rouge">credentials/plugins/didcomm</code></li>
      <li><code class="language-plaintext highlighter-rouge">Oidc4VciException</code>: <code class="language-plaintext highlighter-rouge">credentials/plugins/oidc4vci</code></li>
      <li><code class="language-plaintext highlighter-rouge">ChapiException</code>: <code class="language-plaintext highlighter-rouge">credentials/plugins/chapi</code></li>
    </ul>
  </li>
</ul>

<p>All plugin exceptions extend <code class="language-plaintext highlighter-rouge">ExchangeException</code>, ensuring consistent error handling across all protocols.</p>
<h2 id="error-types">


    <a href="#error-types" class="anchor-heading" aria-labelledby="error-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Types


</h2>

<h3 id="registry-errors">


    <a href="#registry-errors" class="anchor-heading" aria-labelledby="registry-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Registry Errors


</h3>

<h4 id="exchangeexceptionprotocolnotregistered">


    <a href="#exchangeexceptionprotocolnotregistered" class="anchor-heading" aria-labelledby="exchangeexceptionprotocolnotregistered"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ExchangeException.ProtocolNotRegistered


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Calling any registry method with an unregistered protocol name</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">PROTOCOL_NOT_REGISTERED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">protocolName: String</code> - The requested protocol name</li>
  <li><code class="language-plaintext highlighter-rouge">availableProtocols: List&lt;String&gt;</code> - List of available protocol names</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">ProtocolNotRegistered</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol: ${e.protocolName}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Available: ${e.availableProtocols}"</span><span class="p">)</span>
    <span class="c1">// Output:</span>
    <span class="c1">// Error code: PROTOCOL_NOT_REGISTERED</span>
    <span class="c1">// Protocol: didcomm</span>
    <span class="c1">// Available: []</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solutions:</strong></p>

<ol>
  <li><strong>Register the protocol before use:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">registry</span> <span class="p">=</span> <span class="nc">CredentialExchangeProtocolRegistry</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">didCommService</span> <span class="p">=</span> <span class="nc">DidCommFactory</span><span class="p">.</span><span class="nf">createInMemoryService</span><span class="p">(</span><span class="n">kms</span><span class="p">,</span> <span class="n">resolveDid</span><span class="p">)</span>
<span class="n">registry</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="nc">DidCommExchangeProtocol</span><span class="p">(</span><span class="n">didCommService</span><span class="p">))</span>

<span class="c1">// Now safe to use</span>
<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Check available protocols:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">available</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">getAllProtocolNames</span><span class="p">()</span>
<span class="k">if</span> <span class="p">(!</span><span class="n">available</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">))</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol not available. Available: $available"</span><span class="p">)</span>
    <span class="c1">// Register protocol or use different protocol</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Use isRegistered() to check:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(!</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Register protocol</span>
    <span class="n">registry</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="nc">DidCommExchangeProtocol</span><span class="p">(</span><span class="n">didCommService</span><span class="p">))</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
</ol>

<p><strong>Prevention:</strong></p>
<ul>
  <li>Always register protocols before use</li>
  <li>Check <code class="language-plaintext highlighter-rouge">registry.isRegistered()</code> before calling methods</li>
  <li>Use <code class="language-plaintext highlighter-rouge">registry.getAllProtocolNames()</code> to see available protocols</li>
</ul><hr />
<h3 id="request-validation-errors">


    <a href="#request-validation-errors" class="anchor-heading" aria-labelledby="request-validation-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Request Validation Errors


</h3>

<h4 id="exchangeexceptionmissingrequiredoption">


    <a href="#exchangeexceptionmissingrequiredoption" class="anchor-heading" aria-labelledby="exchangeexceptionmissingrequiredoption"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ExchangeException.MissingRequiredOption


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>A required option is missing from the request</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">MISSING_REQUIRED_OPTION</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">optionName: String</code> - The name of the missing option</li>
  <li><code class="language-plaintext highlighter-rouge">protocolName: String?</code> - The protocol name (if applicable)</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">CredentialOfferRequest</span><span class="p">(</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
        <span class="n">credentialPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nf">emptyMap</span><span class="p">()</span> <span class="c1">// Missing 'fromKeyId' and 'toKeyId'</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">MissingRequiredOption</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Missing option: ${e.optionName}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol: ${e.protocolName}"</span><span class="p">)</span>
    <span class="c1">// Output:</span>
    <span class="c1">// Error code: MISSING_REQUIRED_OPTION</span>
    <span class="c1">// Missing option: fromKeyId</span>
    <span class="c1">// Protocol: didcomm</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solutions:</strong></p>
<ol>
  <li><strong>Add the missing option:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">CredentialOfferRequest</span><span class="p">(</span>
    <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
    <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
    <span class="n">credentialPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">,</span>
    <span class="n">options</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
        <span class="s">"fromKeyId"</span> <span class="n">to</span> <span class="s">"did:key:issuer#key-1"</span><span class="p">,</span>
        <span class="s">"toKeyId"</span> <span class="n">to</span> <span class="s">"did:key:holder#key-1"</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Check protocol requirements:</strong>
    <ul>
      <li>DIDComm requires: <code class="language-plaintext highlighter-rouge">fromKeyId</code>, <code class="language-plaintext highlighter-rouge">toKeyId</code></li>
      <li>OIDC4VCI requires: <code class="language-plaintext highlighter-rouge">credentialIssuer</code></li>
    </ul>
  </li>
</ol><hr />
<h4 id="exchangeexceptionoffernotfound">


    <a href="#exchangeexceptionoffernotfound" class="anchor-heading" aria-labelledby="exchangeexceptionoffernotfound"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ExchangeException.OfferNotFound


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Requesting a credential using a non-existent offer ID</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">OFFER_NOT_FOUND</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">offerId: String</code> - The offer ID that was not found</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">CredentialRequestRequest</span><span class="p">(</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
        <span class="n">offerId</span> <span class="p">=</span> <span class="s">"non-existent-offer-id"</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">requestCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">OfferNotFound</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Offer ID: ${e.offerId}"</span><span class="p">)</span>
    <span class="c1">// Output:</span>
    <span class="c1">// Error code: OFFER_NOT_FOUND</span>
    <span class="c1">// Offer ID: non-existent-offer-id</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solutions:</strong></p>
<ol>
  <li><strong>Use a valid offer ID:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">// First create an offer</span>
<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">offerRequest</span><span class="p">)</span>

<span class="c1">// Then use the offer ID</span>
<span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">CredentialRequestRequest</span><span class="p">(</span>
    <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
    <span class="n">offerId</span> <span class="p">=</span> <span class="n">offer</span><span class="p">.</span><span class="n">offerId</span> <span class="c1">// Use the actual offer ID</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Store offer IDs:</strong>
    <ul>
      <li>Store offer IDs when creating offers</li>
      <li>Use a database or cache to track offers</li>
    </ul>
  </li>
</ol><hr />
<h4 id="exchangeexceptionrequestnotfound">


    <a href="#exchangeexceptionrequestnotfound" class="anchor-heading" aria-labelledby="exchangeexceptionrequestnotfound"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ExchangeException.RequestNotFound


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Issuing a credential using a non-existent request ID</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">REQUEST_NOT_FOUND</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">requestId: String</code> - The request ID that was not found</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">request</span> <span class="p">=</span> <span class="nc">CredentialIssueRequest</span><span class="p">(</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">credential</span><span class="p">,</span>
        <span class="n">requestId</span> <span class="p">=</span> <span class="s">"non-existent-request-id"</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">issueCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">RequestNotFound</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Request ID: ${e.requestId}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="didcomm-specific-errors">


    <a href="#didcomm-specific-errors" class="anchor-heading" aria-labelledby="didcomm-specific-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DIDComm-Specific Errors


</h3>


<p>DIDComm-specific exceptions are located in the <code class="language-plaintext highlighter-rouge">didcomm</code> plugin module and extend <code class="language-plaintext highlighter-rouge">ExchangeException</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.didcomm.exception.DidCommException</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="didcommexceptionencryptionfailed">


    <a href="#didcommexceptionencryptionfailed" class="anchor-heading" aria-labelledby="didcommexceptionencryptionfailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DidCommException.EncryptionFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>DIDComm message encryption fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">DIDCOMM_ENCRYPTION_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason encryption failed</li>
  <li><code class="language-plaintext highlighter-rouge">fromDid: String?</code> - The sender DID (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">toDid: String?</code> - The recipient DID (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.didcomm.exception.DidCommException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">DidCommException</span><span class="p">.</span><span class="nc">EncryptionFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Reason: ${e.reason}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"From: ${e.fromDid}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"To: ${e.toDid}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Cause: ${e.cause?.message}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Common causes:</strong></p>
<ul>
  <li>Missing or invalid keys</li>
  <li>Key resolution failure</li>
  <li>Cryptographic operation failure</li>
</ul>

<p><strong>Solutions:</strong></p>
<ol>
  <li><strong>Verify keys exist:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">fromKey</span> <span class="p">=</span> <span class="n">kms</span><span class="p">.</span><span class="nf">getPublicKey</span><span class="p">(</span><span class="n">fromKeyId</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">toKey</span> <span class="p">=</span> <span class="n">kms</span><span class="p">.</span><span class="nf">getPublicKey</span><span class="p">(</span><span class="n">toKeyId</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Check DID resolution:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">fromDoc</span> <span class="p">=</span> <span class="nf">resolveDid</span><span class="p">(</span><span class="n">fromDid</span><span class="p">)</span>
<span class="kd">val</span> <span class="py">toDoc</span> <span class="p">=</span> <span class="nf">resolveDid</span><span class="p">(</span><span class="n">toDid</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
</ol><hr />
<h4 id="didcommexceptiondecryptionfailed">


    <a href="#didcommexceptiondecryptionfailed" class="anchor-heading" aria-labelledby="didcommexceptiondecryptionfailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DidCommException.DecryptionFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>DIDComm message decryption fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">DIDCOMM_DECRYPTION_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason decryption failed</li>
  <li><code class="language-plaintext highlighter-rouge">messageId: String?</code> - The message ID (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.didcomm.exception.DidCommException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">message</span> <span class="p">=</span> <span class="n">didCommService</span><span class="p">.</span><span class="nf">unpack</span><span class="p">(</span><span class="n">encryptedMessage</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">DidCommException</span><span class="p">.</span><span class="nc">DecryptionFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Reason: ${e.reason}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Message ID: ${e.messageId}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="didcommexceptionpackingfailed">


    <a href="#didcommexceptionpackingfailed" class="anchor-heading" aria-labelledby="didcommexceptionpackingfailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DidCommException.PackingFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>DIDComm message packing fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">DIDCOMM_PACKING_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason packing failed</li>
  <li><code class="language-plaintext highlighter-rouge">messageId: String?</code> - The message ID (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul><hr />
<h4 id="didcommexceptionunpackingfailed">


    <a href="#didcommexceptionunpackingfailed" class="anchor-heading" aria-labelledby="didcommexceptionunpackingfailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DidCommException.UnpackingFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>DIDComm message unpacking fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">DIDCOMM_UNPACKING_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason unpacking failed</li>
  <li><code class="language-plaintext highlighter-rouge">messageId: String?</code> - The message ID (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul><hr />
<h4 id="didcommexceptionprotocolerror">


    <a href="#didcommexceptionprotocolerror" class="anchor-heading" aria-labelledby="didcommexceptionprotocolerror"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DidCommException.ProtocolError


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>DIDComm protocol error occurs</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">DIDCOMM_PROTOCOL_ERROR</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason for the error</li>
  <li><code class="language-plaintext highlighter-rouge">field: String?</code> - The field that caused the error (if applicable)</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul><hr />
<h3 id="oidc4vci-specific-errors">


    <a href="#oidc4vci-specific-errors" class="anchor-heading" aria-labelledby="oidc4vci-specific-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> OIDC4VCI-Specific Errors


</h3>


<p>OIDC4VCI-specific exceptions are located in the <code class="language-plaintext highlighter-rouge">oidc4vci</code> plugin module and extend <code class="language-plaintext highlighter-rouge">ExchangeException</code>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.oidc4vci.exception.Oidc4VciException</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h4 id="oidc4vciexceptionhttprequestfailed">


    <a href="#oidc4vciexceptionhttprequestfailed" class="anchor-heading" aria-labelledby="oidc4vciexceptionhttprequestfailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Oidc4VciException.HttpRequestFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>OIDC4VCI HTTP request fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">OIDC4VCI_HTTP_REQUEST_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">url: String</code> - The URL that was requested</li>
  <li><code class="language-plaintext highlighter-rouge">statusCode: Int?</code> - The HTTP status code (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason the request failed</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.oidc4vci.exception.Oidc4VciException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Oidc4VciException</span><span class="p">.</span><span class="nc">HttpRequestFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"URL: ${e.url}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Status: ${e.statusCode}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Reason: ${e.reason}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Common causes:</strong></p>
<ul>
  <li>Network connectivity issues</li>
  <li>Invalid credential issuer URL</li>
  <li>Server errors (5xx)</li>
  <li>Client errors (4xx)</li>
</ul>

<p><strong>Solutions:</strong></p>
<ol>
  <li><strong>Check network connectivity:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Verify URL is reachable</span>
<span class="kd">val</span> <span class="py">response</span> <span class="p">=</span> <span class="n">httpClient</span><span class="p">.</span><span class="nf">newCall</span><span class="p">(</span><span class="nc">Request</span><span class="p">.</span><span class="nc">Builder</span><span class="p">().</span><span class="nf">url</span><span class="p">(</span><span class="n">url</span><span class="p">).</span><span class="nf">build</span><span class="p">()).</span><span class="nf">execute</span><span class="p">()</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Verify credential issuer URL:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">metadata</span> <span class="p">=</span> <span class="n">oidc4vciService</span><span class="p">.</span><span class="nf">fetchCredentialIssuerMetadata</span><span class="p">(</span><span class="n">credentialIssuerUrl</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
</ol><hr />
<h4 id="oidc4vciexceptiontokenexchangefailed">


    <a href="#oidc4vciexceptiontokenexchangefailed" class="anchor-heading" aria-labelledby="oidc4vciexceptiontokenexchangefailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Oidc4VciException.TokenExchangeFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>OIDC4VCI token exchange fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">OIDC4VCI_TOKEN_EXCHANGE_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason token exchange failed</li>
  <li><code class="language-plaintext highlighter-rouge">credentialIssuer: String?</code> - The credential issuer URL (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.oidc4vci.exception.Oidc4VciException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">token</span> <span class="p">=</span> <span class="n">oidc4vciService</span><span class="p">.</span><span class="nf">exchangeToken</span><span class="p">(</span><span class="n">authorizationCode</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Oidc4VciException</span><span class="p">.</span><span class="nc">TokenExchangeFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Reason: ${e.reason}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Issuer: ${e.credentialIssuer}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="oidc4vciexceptionmetadatafetchfailed">


    <a href="#oidc4vciexceptionmetadatafetchfailed" class="anchor-heading" aria-labelledby="oidc4vciexceptionmetadatafetchfailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Oidc4VciException.MetadataFetchFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>OIDC4VCI metadata fetch fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">OIDC4VCI_METADATA_FETCH_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">credentialIssuer: String</code> - The credential issuer URL</li>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason metadata fetch failed</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.oidc4vci.exception.Oidc4VciException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">metadata</span> <span class="p">=</span> <span class="n">oidc4vciService</span><span class="p">.</span><span class="nf">fetchCredentialIssuerMetadata</span><span class="p">(</span><span class="n">issuerUrl</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Oidc4VciException</span><span class="p">.</span><span class="nc">MetadataFetchFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Issuer: ${e.credentialIssuer}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Reason: ${e.reason}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="oidc4vciexceptioncredentialrequestfailed">


    <a href="#oidc4vciexceptioncredentialrequestfailed" class="anchor-heading" aria-labelledby="oidc4vciexceptioncredentialrequestfailed"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Oidc4VciException.CredentialRequestFailed


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>OIDC4VCI credential request fails</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">OIDC4VCI_CREDENTIAL_REQUEST_FAILED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">reason: String</code> - The reason credential request failed</li>
  <li><code class="language-plaintext highlighter-rouge">credentialIssuer: String?</code> - The credential issuer URL (if available)</li>
  <li><code class="language-plaintext highlighter-rouge">cause: Throwable?</code> - The underlying exception</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.oidc4vci.exception.Oidc4VciException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="n">oidc4vciService</span><span class="p">.</span><span class="nf">requestCredential</span><span class="p">(</span><span class="n">accessToken</span><span class="p">,</span> <span class="n">credentialOffer</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Oidc4VciException</span><span class="p">.</span><span class="nc">CredentialRequestFailed</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Reason: ${e.reason}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Issuer: ${e.credentialIssuer}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="exchangeexceptionoperationnotsupported">


    <a href="#exchangeexceptionoperationnotsupported" class="anchor-heading" aria-labelledby="exchangeexceptionoperationnotsupported"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ExchangeException.OperationNotSupported


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Protocol doesnt support the requested operation</li>
</ul>

<p><strong>Error code:</strong> <code class="language-plaintext highlighter-rouge">OPERATION_NOT_SUPPORTED</code></p>

<p><strong>Properties:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">protocolName: String</code> - The protocol name</li>
  <li><code class="language-plaintext highlighter-rouge">operation: String</code> - The requested operation</li>
  <li><code class="language-plaintext highlighter-rouge">supportedOperations: List&lt;String&gt;</code> - List of supported operations</li>
</ul>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">proofRequest</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">requestProof</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">OperationNotSupported</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol: ${e.protocolName}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Operation: ${e.operation}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Supported: ${e.supportedOperations}"</span><span class="p">)</span>
    <span class="c1">// Output:</span>
    <span class="c1">// Error code: OPERATION_NOT_SUPPORTED</span>
    <span class="c1">// Protocol: oidc4vci</span>
    <span class="c1">// Operation: REQUEST_PROOF</span>
    <span class="c1">// Supported: [OFFER_CREDENTIAL, REQUEST_CREDENTIAL, ISSUE_CREDENTIAL]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solutions:</strong></p>

<ol>
  <li><strong>Check supported operations:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">protocol</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">protocol</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Supported operations: ${protocol.supportedOperations}"</span><span class="p">)</span>
    <span class="c1">// Output: Supported operations: [OFFER_CREDENTIAL, REQUEST_CREDENTIAL, ISSUE_CREDENTIAL]</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Use a different protocol:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// OIDC4VCI doesn't support proof requests, use DIDComm instead</span>
<span class="kd">val</span> <span class="py">proofRequest</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">requestProof</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Use a different operation:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// If you need proof functionality, use DIDComm or CHAPI</span>
<span class="k">if</span> <span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">))</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">proofRequest</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">requestProof</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"No protocol available for proof requests"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
</ol>

<p><strong>Prevention:</strong></p>
<ul>
  <li>Check <code class="language-plaintext highlighter-rouge">protocol.supportedOperations</code> before calling methods</li>
  <li>Use protocol comparison table to choose the right protocol</li>
  <li>Handle <code class="language-plaintext highlighter-rouge">UnsupportedOperationException</code> gracefully</li>
</ul><hr />
<h3 id="protocol-specific-errors">


    <a href="#protocol-specific-errors" class="anchor-heading" aria-labelledby="protocol-specific-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Protocol-Specific Errors


</h3>

<h4 id="didcomm-errors">


    <a href="#didcomm-errors" class="anchor-heading" aria-labelledby="didcomm-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DIDComm Errors


</h4>

<h5 id="missing-required-options">


    <a href="#missing-required-options" class="anchor-heading" aria-labelledby="missing-required-options"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Missing Required Options


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Missing <code class="language-plaintext highlighter-rouge">fromKeyId</code> or <code class="language-plaintext highlighter-rouge">toKeyId</code> in options</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Missing required option: fromKeyId
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Code example:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span>
        <span class="n">protocolName</span> <span class="p">=</span> <span class="s">"didcomm"</span><span class="p">,</span>
        <span class="n">request</span> <span class="p">=</span> <span class="nc">CredentialOfferRequest</span><span class="p">(</span>
            <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
            <span class="n">credentialPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">,</span>
            <span class="n">options</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
                <span class="c1">// Missing fromKeyId and toKeyId</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">IllegalArgumentException</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error: ${e.message}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span>
    <span class="n">protocolName</span> <span class="p">=</span> <span class="s">"didcomm"</span><span class="p">,</span>
    <span class="n">request</span> <span class="p">=</span> <span class="nc">CredentialOfferRequest</span><span class="p">(</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
        <span class="n">credentialPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"fromKeyId"</span> <span class="n">to</span> <span class="s">"did:key:issuer#key-1"</span><span class="p">,</span>  <span class="c1">// Required</span>
            <span class="s">"toKeyId"</span> <span class="n">to</span> <span class="s">"did:key:holder#key-1"</span>     <span class="c1">// Required</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h5 id="invalid-key-id-format">


    <a href="#invalid-key-id-format" class="anchor-heading" aria-labelledby="invalid-key-id-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Invalid Key ID Format


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Key ID doesnt match expected format</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Invalid key ID format: &lt;key-id&gt;
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Key ID must be in format: did:key:...#key-1</span>
<span class="kd">val</span> <span class="py">keyId</span> <span class="p">=</span> <span class="s">"$issuerDid#key-1"</span>  <span class="c1">// Correct format</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h5 id="did-resolution-failure">


    <a href="#did-resolution-failure" class="anchor-heading" aria-labelledby="did-resolution-failure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> DID Resolution Failure


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Cannot resolve DID to DID document</li>
  <li>DID document doesnt contain required keys</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Failed to resolve DID: did:key:issuer
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// Ensure DID resolver is properly configured</span>
<span class="kd">val</span> <span class="py">resolveDid</span><span class="p">:</span> <span class="k">suspend</span> <span class="p">(</span><span class="nc">String</span><span class="p">)</span> <span class="p">-&gt;</span> <span class="nc">DidDocument</span><span class="p">?</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span>
    <span class="c1">// Implement real DID resolution</span>
    <span class="n">yourDidResolver</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Ensure DID document contains required keys</span>
<span class="kd">val</span> <span class="py">document</span> <span class="p">=</span> <span class="nf">resolveDid</span><span class="p">(</span><span class="s">"did:key:issuer"</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">document</span><span class="o">?.</span><span class="n">verificationMethod</span><span class="o">?.</span><span class="nf">isEmpty</span><span class="p">()</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"DID document has no verification methods"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h5 id="key-not-found-in-kms">


    <a href="#key-not-found-in-kms" class="anchor-heading" aria-labelledby="key-not-found-in-kms"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Not Found in KMS


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Key ID references a key that doesnt exist in KMS</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Key not found: did:key:issuer#key-1
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="c1">// Ensure key exists in KMS before use</span>
<span class="kd">val</span> <span class="py">keyId</span> <span class="p">=</span> <span class="s">"did:key:issuer#key-1"</span>
<span class="k">if</span> <span class="p">(!</span><span class="n">kms</span><span class="p">.</span><span class="nf">keyExists</span><span class="p">(</span><span class="n">keyId</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Create key or use existing key</span>
    <span class="n">kms</span><span class="p">.</span><span class="nf">createKey</span><span class="p">(</span><span class="n">keyId</span><span class="p">,</span> <span class="n">algorithm</span> <span class="p">=</span> <span class="s">"Ed25519"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="oidc4vci-errors">


    <a href="#oidc4vci-errors" class="anchor-heading" aria-labelledby="oidc4vci-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> OIDC4VCI Errors


</h4>

<h5 id="missing-credential-issuer-url">


    <a href="#missing-credential-issuer-url" class="anchor-heading" aria-labelledby="missing-credential-issuer-url"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Missing Credential Issuer URL


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Missing <code class="language-plaintext highlighter-rouge">credentialIssuer</code> in options</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Missing required option: credentialIssuer
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span>
    <span class="n">protocolName</span> <span class="p">=</span> <span class="s">"oidc4vci"</span><span class="p">,</span>
    <span class="n">request</span> <span class="p">=</span> <span class="nc">CredentialOfferRequest</span><span class="p">(</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
        <span class="n">credentialPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"credentialIssuer"</span> <span class="n">to</span> <span class="s">"https://issuer.example.com"</span>  <span class="c1">// Required</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h5 id="http-request-failure">


    <a href="#http-request-failure" class="anchor-heading" aria-labelledby="http-request-failure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HTTP Request Failure


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Network error connecting to credential issuer</li>
  <li>Credential issuer returns error response</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>HTTP request failed: 404 Not Found
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">{</span>
        <span class="n">e</span><span class="p">.</span><span class="n">message</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"404"</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Credential issuer not found. Check URL."</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">e</span><span class="p">.</span><span class="n">message</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"401"</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Authentication failed. Check credentials."</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">e</span><span class="p">.</span><span class="n">message</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"timeout"</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Request timed out. Retry later."</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"HTTP error: ${e.message}"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h5 id="token-exchange-failure">


    <a href="#token-exchange-failure" class="anchor-heading" aria-labelledby="token-exchange-failure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Token Exchange Failure


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Authorization code is invalid</li>
  <li>Token exchange endpoint returns error</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Token exchange failed: invalid_grant
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="c1">// Ensure authorization code is valid and not expired</span>
<span class="kd">val</span> <span class="py">options</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
    <span class="s">"credentialIssuer"</span> <span class="n">to</span> <span class="s">"https://issuer.example.com"</span><span class="p">,</span>
    <span class="s">"authorizationCode"</span> <span class="n">to</span> <span class="n">validAuthorizationCode</span>  <span class="c1">// Must be valid and not expired</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h5 id="invalid-credential-issuer-metadata">


    <a href="#invalid-credential-issuer-metadata" class="anchor-heading" aria-labelledby="invalid-credential-issuer-metadata"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Invalid Credential Issuer Metadata


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Credential issuer metadata is invalid</li>
  <li>Required endpoints are missing</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Invalid credential issuer metadata: missing token_endpoint
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="c1">// Verify credential issuer metadata is valid</span>
<span class="c1">// Check that all required endpoints are present</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="chapi-errors">


    <a href="#chapi-errors" class="anchor-heading" aria-labelledby="chapi-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> CHAPI Errors


</h4>

<h5 id="browser-not-available">


    <a href="#browser-not-available" class="anchor-heading" aria-labelledby="browser-not-available"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Browser Not Available


</h5>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>CHAPI requires browser environment</li>
  <li>Running in non-browser context</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>CHAPI requires browser environment
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">// CHAPI only works in browser</span>
<span class="c1">// Use different protocol for server-side operations</span>
<span class="k">if</span> <span class="p">(</span><span class="nf">isBrowserEnvironment</span><span class="p">())</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"chapi"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Use DIDComm or OIDC4VCI for server-side</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="validation-errors">


    <a href="#validation-errors" class="anchor-heading" aria-labelledby="validation-errors"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Validation Errors


</h3>

<h4 id="invalid-did-format">


    <a href="#invalid-did-format" class="anchor-heading" aria-labelledby="invalid-did-format"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Invalid DID Format


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>DID doesnt match format: <code class="language-plaintext highlighter-rouge">did:&lt;method&gt;:&lt;identifier&gt;</code></li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Invalid DID format: invalid-did
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
</pre></td><td class="rouge-code"><pre><span class="c1">// Validate DID format before use</span>
<span class="k">fun</span> <span class="nf">isValidDid</span><span class="p">(</span><span class="n">did</span><span class="p">:</span> <span class="nc">String</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">did</span><span class="p">.</span><span class="nf">matches</span><span class="p">(</span><span class="nc">Regex</span><span class="p">(</span><span class="s">"^did:[a-z0-9]+:.+$"</span><span class="p">))</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span>
<span class="k">if</span> <span class="p">(!</span><span class="nf">isValidDid</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">))</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Invalid DID format"</span><span class="p">)</span>
    <span class="k">return</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="empty-credential-preview">


    <a href="#empty-credential-preview" class="anchor-heading" aria-labelledby="empty-credential-preview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Empty Credential Preview


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li><code class="language-plaintext highlighter-rouge">credentialPreview.attributes</code> is empty</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Credential preview attributes must not be empty
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">preview</span> <span class="p">=</span> <span class="nc">CredentialPreview</span><span class="p">(</span>
    <span class="n">attributes</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
        <span class="nc">CredentialAttribute</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"Alice"</span><span class="p">)</span>  <span class="c1">// Must have at least one attribute</span>
    <span class="p">)</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h4 id="invalid-credential">


    <a href="#invalid-credential" class="anchor-heading" aria-labelledby="invalid-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Invalid Credential


</h4>


<p><strong>When it occurs:</strong></p>
<ul>
  <li>Credential is missing required fields</li>
  <li>Credential structure is invalid</li>
</ul>

<p><strong>Error message:</strong></p>
<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre>Invalid credential: missing issuer
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
</pre></td><td class="rouge-code"><pre><span class="c1">// Ensure credential has all required fields</span>
<span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
    <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">),</span>  <span class="c1">// Required</span>
    <span class="n">issuer</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>              <span class="c1">// Required</span>
    <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span> <span class="p">},</span> <span class="c1">// Required</span>
    <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span> <span class="c1">// Required</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="error-handling-patterns">


    <a href="#error-handling-patterns" class="anchor-heading" aria-labelledby="error-handling-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Handling Patterns


</h2>

<h3 id="pattern-1-check-before-use">


    <a href="#pattern-1-check-before-use" class="anchor-heading" aria-labelledby="pattern-1-check-before-use"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pattern 1: Check Before Use


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
</pre></td><td class="rouge-code"><pre><span class="c1">// Check protocol is registered</span>
<span class="k">if</span> <span class="p">(!</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">))</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol not registered"</span><span class="p">)</span>
    <span class="k">return</span>
<span class="p">}</span>

<span class="c1">// Check operation is supported</span>
<span class="kd">val</span> <span class="py">protocol</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">protocol</span><span class="o">?.</span><span class="n">supportedOperations</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="nc">ExchangeOperation</span><span class="p">.</span><span class="nc">OFFER_CREDENTIAL</span><span class="p">)</span> <span class="p">!=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Operation not supported"</span><span class="p">)</span>
    <span class="k">return</span>
<span class="p">}</span>

<span class="c1">// Now safe to use</span>
<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="pattern-2-try-catch-with-specific-handling">


    <a href="#pattern-2-try-catch-with-specific-handling" class="anchor-heading" aria-labelledby="pattern-2-try-catch-with-specific-handling"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pattern 2: Try-Catch with Specific Handling


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.exchange.exception.ExchangeException</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.didcomm.exception.DidCommException</span>

<span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Offer created: ${offer.offerId}"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">ProtocolNotRegistered</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol not registered. Register it first."</span><span class="p">)</span>
    <span class="n">registry</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="nc">DidCommExchangeProtocol</span><span class="p">(</span><span class="n">didCommService</span><span class="p">))</span>
    <span class="c1">// Retry</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">MissingRequiredOption</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Missing required option: ${e.optionName}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol: ${e.protocolName}"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nc">OperationNotSupported</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Operation not supported. Use different protocol or operation."</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Supported operations: ${e.supportedOperations}"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">DidCommException</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">when</span> <span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">DidCommException</span><span class="p">.</span><span class="nc">EncryptionFailed</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"DIDComm encryption failed: ${e.reason}"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="k">is</span> <span class="nc">DidCommException</span><span class="p">.</span><span class="nc">DecryptionFailed</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"DIDComm decryption failed: ${e.reason}"</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="c1">// ... handle other DIDComm exceptions</span>
    <span class="p">}</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Exchange error: ${e.message}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Error code: ${e.code}"</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Throwable</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Unexpected error: ${e.message}"</span><span class="p">)</span>
    <span class="n">e</span><span class="p">.</span><span class="nf">printStackTrace</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="pattern-3-fallback-to-alternative-protocol">


    <a href="#pattern-3-fallback-to-alternative-protocol" class="anchor-heading" aria-labelledby="pattern-3-fallback-to-alternative-protocol"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pattern 3: Fallback to Alternative Protocol


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="k">suspend</span> <span class="k">fun</span> <span class="nf">offerCredentialWithFallback</span><span class="p">(</span>
    <span class="n">preferredProtocol</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">fallbackProtocols</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span>
    <span class="n">request</span><span class="p">:</span> <span class="nc">CredentialOfferRequest</span>
<span class="p">):</span> <span class="nc">CredentialOfferResponse</span><span class="p">?</span> <span class="p">{</span>
    <span class="c1">// Try preferred protocol first</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="n">preferredProtocol</span><span class="p">))</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">return</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="n">preferredProtocol</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Preferred protocol failed: ${e.message}"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Try fallback protocols</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">protocol</span> <span class="k">in</span> <span class="n">fallbackProtocols</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="n">protocol</span><span class="p">))</span> <span class="p">{</span>
            <span class="k">try</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"Fallback protocol $protocol failed: ${e.message}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">null</span>
<span class="p">}</span>

<span class="c1">// Usage</span>
<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="nf">offerCredentialWithFallback</span><span class="p">(</span>
    <span class="n">preferredProtocol</span> <span class="p">=</span> <span class="s">"didcomm"</span><span class="p">,</span>
    <span class="n">fallbackProtocols</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">,</span> <span class="s">"chapi"</span><span class="p">),</span>
    <span class="n">request</span> <span class="p">=</span> <span class="n">request</span>
<span class="p">)</span> <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"All protocols failed"</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="pattern-4-validate-before-operation">


    <a href="#pattern-4-validate-before-operation" class="anchor-heading" aria-labelledby="pattern-4-validate-before-operation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Pattern 4: Validate Before Operation


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">validateOfferRequest</span><span class="p">(</span><span class="n">request</span><span class="p">:</span> <span class="nc">CredentialOfferRequest</span><span class="p">):</span> <span class="nc">ValidationResult</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">errors</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;()</span>

    <span class="c1">// Validate DIDs</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">isValidDid</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">issuerDid</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s">"Invalid issuer DID format"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(!</span><span class="nf">isValidDid</span><span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">holderDid</span><span class="p">))</span> <span class="p">{</span>
        <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s">"Invalid holder DID format"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Validate preview</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">request</span><span class="p">.</span><span class="n">credentialPreview</span><span class="p">.</span><span class="n">attributes</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="n">errors</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="s">"Credential preview attributes must not be empty"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Validate protocol-specific options</span>
    <span class="c1">// (Implementation depends on protocol)</span>

    <span class="k">return</span> <span class="k">if</span> <span class="p">(</span><span class="n">errors</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="nc">ValidationResult</span><span class="p">.</span><span class="nc">Valid</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nc">ValidationResult</span><span class="p">.</span><span class="nc">Invalid</span><span class="p">(</span><span class="n">errors</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Use before operation</span>
<span class="kd">val</span> <span class="py">validation</span> <span class="p">=</span> <span class="nf">validateOfferRequest</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">validation</span> <span class="k">is</span> <span class="nc">ValidationResult</span><span class="p">.</span><span class="nc">Invalid</span><span class="p">)</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Validation failed: ${validation.errors}"</span><span class="p">)</span>
    <span class="k">return</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="common-error-scenarios">


    <a href="#common-error-scenarios" class="anchor-heading" aria-labelledby="common-error-scenarios"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common Error Scenarios


</h2>

<h3 id="scenario-1-protocol-not-registered">


    <a href="#scenario-1-protocol-not-registered" class="anchor-heading" aria-labelledby="scenario-1-protocol-not-registered"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scenario 1: Protocol Not Registered


</h3>


<p><strong>Problem:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">registry</span> <span class="p">=</span> <span class="nc">CredentialExchangeProtocolRegistry</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>  <span class="c1">// Throws ExchangeException.MissingRequiredOption</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">registry</span> <span class="p">=</span> <span class="nc">CredentialExchangeProtocolRegistry</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">didCommService</span> <span class="p">=</span> <span class="nc">DidCommFactory</span><span class="p">.</span><span class="nf">createInMemoryService</span><span class="p">(</span><span class="n">kms</span><span class="p">,</span> <span class="n">resolveDid</span><span class="p">)</span>
<span class="n">registry</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="nc">DidCommExchangeProtocol</span><span class="p">(</span><span class="n">didCommService</span><span class="p">))</span>
<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>  <span class="c1">// Now works</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="scenario-2-missing-required-options">


    <a href="#scenario-2-missing-required-options" class="anchor-heading" aria-labelledby="scenario-2-missing-required-options"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scenario 2: Missing Required Options


</h3>


<p><strong>Problem:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span>
    <span class="n">protocolName</span> <span class="p">=</span> <span class="s">"didcomm"</span><span class="p">,</span>
    <span class="n">request</span> <span class="p">=</span> <span class="nc">CredentialOfferRequest</span><span class="p">(</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
        <span class="n">credentialPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nf">emptyMap</span><span class="p">()</span>  <span class="c1">// Missing fromKeyId and toKeyId</span>
    <span class="p">)</span>
<span class="p">)</span>  <span class="c1">// Throws ExchangeException.MissingRequiredOption</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span>
    <span class="n">protocolName</span> <span class="p">=</span> <span class="s">"didcomm"</span><span class="p">,</span>
    <span class="n">request</span> <span class="p">=</span> <span class="nc">CredentialOfferRequest</span><span class="p">(</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="s">"did:key:issuer"</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="s">"did:key:holder"</span><span class="p">,</span>
        <span class="n">credentialPreview</span> <span class="p">=</span> <span class="n">preview</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"fromKeyId"</span> <span class="n">to</span> <span class="s">"did:key:issuer#key-1"</span><span class="p">,</span>  <span class="c1">// Added</span>
            <span class="s">"toKeyId"</span> <span class="n">to</span> <span class="s">"did:key:holder#key-1"</span>     <span class="c1">// Added</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">)</span>  <span class="c1">// Now works</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="scenario-3-operation-not-supported">


    <a href="#scenario-3-operation-not-supported" class="anchor-heading" aria-labelledby="scenario-3-operation-not-supported"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Scenario 3: Operation Not Supported


</h3>


<p><strong>Problem:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">proofRequest</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">requestProof</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>  <span class="c1">// Throws ExchangeException.OperationNotSupported</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Solution:</strong></p>
<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="c1">// Check supported operations first</span>
<span class="kd">val</span> <span class="py">protocol</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">protocol</span><span class="o">?.</span><span class="n">supportedOperations</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="nc">ExchangeOperation</span><span class="p">.</span><span class="nc">REQUEST_PROOF</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">proofRequest</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">requestProof</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="c1">// Use different protocol</span>
    <span class="kd">val</span> <span class="py">proofRequest</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">requestProof</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="error-recovery-utilities">


    <a href="#error-recovery-utilities" class="anchor-heading" aria-labelledby="error-recovery-utilities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Recovery Utilities


</h2>


<p>The <code class="language-plaintext highlighter-rouge">ExchangeExceptionRecovery</code> object provides comprehensive error recovery utilities:</p>
<h3 id="automatic-retry-with-exponential-backoff">


    <a href="#automatic-retry-with-exponential-backoff" class="anchor-heading" aria-labelledby="automatic-retry-with-exponential-backoff"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Automatic Retry with Exponential Backoff


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.exchange.exception.retryExchangeOperation</span>

<span class="c1">// Automatically retries on transient errors</span>
<span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="nf">retryExchangeOperation</span><span class="p">(</span><span class="n">maxRetries</span> <span class="p">=</span> <span class="mi">3</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="error-classification">


    <a href="#error-classification" class="anchor-heading" aria-labelledby="error-classification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Classification


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.exchange.exception.ExchangeExceptionRecovery</span>

<span class="kd">val</span> <span class="py">exception</span><span class="p">:</span> <span class="nc">ExchangeException</span> <span class="p">=</span> <span class="c1">// ... get exception</span>

<span class="c1">// Check if error is retryable</span>
<span class="k">if</span> <span class="p">(</span><span class="nc">ExchangeExceptionRecovery</span><span class="p">.</span><span class="nf">isRetryable</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Retry the operation</span>
<span class="p">}</span>

<span class="c1">// Check if error is transient</span>
<span class="k">if</span> <span class="p">(</span><span class="nc">ExchangeExceptionRecovery</span><span class="p">.</span><span class="nf">isTransient</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Error might resolve on its own</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="user-friendly-error-messages">


    <a href="#user-friendly-error-messages" class="anchor-heading" aria-labelledby="user-friendly-error-messages"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> User-Friendly Error Messages


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">message</span> <span class="p">=</span> <span class="nc">ExchangeExceptionRecovery</span><span class="p">.</span><span class="nf">getUserFriendlyMessage</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
<span class="nf">println</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="c1">// Displays user-friendly error message</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="alternative-protocol-fallback">


    <a href="#alternative-protocol-fallback" class="anchor-heading" aria-labelledby="alternative-protocol-fallback"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Alternative Protocol Fallback


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nc">ExchangeExceptionRecovery</span><span class="p">.</span><span class="nf">tryAlternativeProtocol</span><span class="p">(</span>
    <span class="n">exception</span> <span class="p">=</span> <span class="n">exception</span><span class="p">,</span>
    <span class="n">availableProtocols</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">,</span> <span class="s">"chapi"</span><span class="p">)</span>
<span class="p">)</span> <span class="p">{</span> <span class="n">protocol</span> <span class="p">-&gt;</span>
    <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="companion-object-helpers">


    <a href="#companion-object-helpers" class="anchor-heading" aria-labelledby="companion-object-helpers"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Companion Object Helpers


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.exchange.exception.ExchangeException</span>

<span class="c1">// Use companion object for convenience</span>
<span class="k">if</span> <span class="p">(</span><span class="nc">ExchangeException</span><span class="p">.</span><span class="nf">isRetryable</span><span class="p">(</span><span class="n">exception</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Retry logic</span>
<span class="p">}</span>

<span class="kd">val</span> <span class="py">message</span> <span class="p">=</span> <span class="nc">ExchangeException</span><span class="p">.</span><span class="nf">getUserFriendlyMessage</span><span class="p">(</span><span class="n">exception</span><span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="error-recovery-strategies">


    <a href="#error-recovery-strategies" class="anchor-heading" aria-labelledby="error-recovery-strategies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Recovery Strategies


</h2>

<h3 id="strategy-1-retry-with-different-protocol">


    <a href="#strategy-1-retry-with-different-protocol" class="anchor-heading" aria-labelledby="strategy-1-retry-with-different-protocol"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Strategy 1: Retry with Different Protocol


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="k">suspend</span> <span class="k">fun</span> <span class="nf">offerCredentialWithRetry</span><span class="p">(</span>
    <span class="n">protocols</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span>
    <span class="n">request</span><span class="p">:</span> <span class="nc">CredentialOfferRequest</span>
<span class="p">):</span> <span class="nc">CredentialOfferResponse</span><span class="p">?</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">protocol</span> <span class="k">in</span> <span class="n">protocols</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="n">protocol</span><span class="p">))</span> <span class="p">{</span>
                <span class="k">return</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="n">protocol</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Protocol $protocol failed: ${e.message}"</span><span class="p">)</span>
            <span class="k">continue</span>
        <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="k">null</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h3 id="strategy-2-register-missing-protocol">


    <a href="#strategy-2-register-missing-protocol" class="anchor-heading" aria-labelledby="strategy-2-register-missing-protocol"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Strategy 2: Register Missing Protocol


</h3>


<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">suspend</span> <span class="k">fun</span> <span class="nf">offerCredentialWithAutoRegister</span><span class="p">(</span>
    <span class="n">protocolName</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">request</span><span class="p">:</span> <span class="nc">CredentialOfferRequest</span>
<span class="p">):</span> <span class="nc">CredentialOfferResponse</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="n">protocolName</span><span class="p">))</span> <span class="p">{</span>
        <span class="c1">// Auto-register protocol</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">protocolName</span><span class="p">)</span> <span class="p">{</span>
            <span class="s">"didcomm"</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">service</span> <span class="p">=</span> <span class="nc">DidCommFactory</span><span class="p">.</span><span class="nf">createInMemoryService</span><span class="p">(</span><span class="n">kms</span><span class="p">,</span> <span class="n">resolveDid</span><span class="p">)</span>
                <span class="n">registry</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="nc">DidCommExchangeProtocol</span><span class="p">(</span><span class="n">service</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="s">"oidc4vci"</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">service</span> <span class="p">=</span> <span class="nc">Oidc4VciService</span><span class="p">(</span><span class="n">credentialIssuerUrl</span><span class="p">,</span> <span class="n">kms</span><span class="p">)</span>
                <span class="n">registry</span><span class="p">.</span><span class="nf">register</span><span class="p">(</span><span class="nc">Oidc4VciExchangeProtocol</span><span class="p">(</span><span class="n">service</span><span class="p">))</span>
            <span class="p">}</span>
            <span class="c1">// ... other protocols</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="n">protocolName</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div><hr />
<h2 id="best-practices">


    <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices


</h2>


<ol>
  <li><strong>Always check protocol registration:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(!</span><span class="n">registry</span><span class="p">.</span><span class="nf">isRegistered</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">))</span> <span class="p">{</span>
    <span class="c1">// Register or use different protocol</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Check supported operations:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">protocol</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"oidc4vci"</span><span class="p">)</span>
<span class="k">if</span> <span class="p">(</span><span class="n">protocol</span><span class="o">?.</span><span class="n">supportedOperations</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="nc">ExchangeOperation</span><span class="p">.</span><span class="nc">OFFER_CREDENTIAL</span><span class="p">)</span> <span class="p">!=</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Use different protocol</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Validate inputs before operations:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
</pre></td><td class="rouge-code"><pre><span class="k">if</span> <span class="p">(!</span><span class="nf">isValidDid</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">))</span> <span class="p">{</span>
    <span class="k">return</span> <span class="c1">// Handle error</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Use try-catch for all operations:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="k">try</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">offer</span> <span class="p">=</span> <span class="n">registry</span><span class="p">.</span><span class="nf">offerCredential</span><span class="p">(</span><span class="s">"didcomm"</span><span class="p">,</span> <span class="n">request</span><span class="p">)</span>
<span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// Handle error appropriately</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
  <li><strong>Provide helpful error messages:</strong>
    <div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
</pre></td><td class="rouge-code"><pre><span class="k">catch</span> <span class="p">(</span><span class="n">e</span><span class="p">:</span> <span class="nc">ExchangeException</span><span class="p">)</span> <span class="p">{</span>
    <span class="n">logger</span><span class="p">.</span><span class="nf">error</span><span class="p">(</span><span class="s">"Invalid argument: ${e.message}"</span><span class="p">)</span>
    <span class="c1">// Provide user-friendly message</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div>    </div>
  </li>
</ol><hr />
<h2 id="related-documentation">


    <a href="#related-documentation" class="anchor-heading" aria-labelledby="related-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Related Documentation


</h2>


<ul>
  <li><strong><a href="/trustweave/features/credential-exchange-protocols/QUICK_START.md">Quick Start</a></strong> - Get started quickly (5 minutes)</li>
  <li><strong><a href="/trustweave/features/credential-exchange-protocols/API_REFERENCE/">API Reference</a></strong> - Complete API documentation</li>
  <li><strong><a href="/trustweave/features/credential-exchange-protocols/TROUBLESHOOTING/">Troubleshooting</a></strong> - Common issues and solutions</li>
  <li><strong><a href="/trustweave/features/credential-exchange-protocols/WORKFLOWS/">Workflows</a></strong> - Step-by-step workflows</li>
  <li><strong><a href="/trustweave/features/credential-exchange-protocols/EXAMPLES/">Examples</a></strong> - Code examples with error handling</li>
  <li><strong><a href="/trustweave/features/credential-exchange-protocols/BEST_PRACTICES/">Best Practices</a></strong> - Error handling best practices</li>
  <li><strong><a href="/trustweave/features/credential-exchange-protocols/GLOSSARY/">Glossary</a></strong> - Terms and concepts</li>
</ul>






        </main>


  <hr>
  <footer>


    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with  by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();

        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
        footer.style.marginTop = 'auto'; // Push to bottom in flexbox layout
        footer.style.zIndex = '0'; // Below search overlay
      }
    }

    // Function to update footer visibility based on search state
    function updateFooterVisibility() {
      const footer = document.querySelector('.site-footer');
      const htmlElement = document.documentElement;

      if (footer && htmlElement) {
        const isSearchActive = htmlElement.classList.contains('search-active');
        if (isSearchActive) {
          // Hide footer when search is active - use multiple methods to ensure it's hidden
          footer.style.display = 'none';
          footer.style.visibility = 'hidden';
          footer.style.opacity = '0';
          footer.style.zIndex = '-999';
          footer.style.pointerEvents = 'none';
        } else {
          // Show footer when search is not active
          footer.style.display = 'block';
          footer.style.visibility = 'visible';
          footer.style.opacity = '1';
          footer.style.marginTop = 'auto';
          footer.style.position = 'relative';
          footer.style.zIndex = '-1';
          footer.style.pointerEvents = 'auto';
        }
      }
    }

    // Monitor search state and hide/show footer appropriately
    const observer = new MutationObserver(function(mutations) {
      updateFooterVisibility();
    });

    // Also listen for input events on search input as a backup
    // This ensures footer is hidden immediately when user starts typing
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      // Use requestAnimationFrame for better performance
      const handleSearchChange = function() {
        requestAnimationFrame(updateFooterVisibility);
      };

      searchInput.addEventListener('input', handleSearchChange);
      searchInput.addEventListener('focus', handleSearchChange);
      searchInput.addEventListener('keydown', handleSearchChange);
    }

    // Observe documentElement (html) for class changes (like search-active)
    // The search script adds 'search-active' to documentElement, not body
    if (document.documentElement) {
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });

      // Initial check
      updateFooterVisibility();
    }
  });
</script>



  </footer>


      </div>
    </div>



<div class="search-overlay"></div>


  </div>








<script type="module">

  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';


  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>




</body>
</html>

