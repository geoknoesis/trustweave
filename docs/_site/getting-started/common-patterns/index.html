

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  

    .site-nav > ul.nav-list:first-child > li > a,
    
    .site-nav > ul.nav-list:first-child > li > ul > li:not(:nth-child(6)) > a,
    .site-nav > ul.nav-list:first-child > li > ul > li > ul > li a {
      background-image: none;
    }

    .site-nav > ul.nav-list:not(:first-child) a,
    .site-nav li.external a {
      background-image: none;
    }

    .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(6) > a {
      font-weight: 600;
      text-decoration: none;
    }.site-nav > ul.nav-list:first-child > li:nth-child(2) > button svg,
    .site-nav > ul.nav-list:first-child > li:nth-child(2) > ul > li:nth-child(6) > button svg {
      transform: rotate(-90deg);
    }.site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list,
    .site-nav > ul.nav-list:first-child > li.nav-list-item:nth-child(2) > ul.nav-list > li.nav-list-item:nth-child(6) > ul.nav-list {
      display: block;
    }
  </style>

  

  
    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Common Patterns | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Common Patterns" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="http://0.0.0.0:4000/trustweave/getting-started/common-patterns/" />
<meta property="og:url" content="http://0.0.0.0:4000/trustweave/getting-started/common-patterns/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Common Patterns" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Common Patterns","url":"http://0.0.0.0:4000/trustweave/getting-started/common-patterns/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }

  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }

  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }

  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }

  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="http://0.0.0.0:4000/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });

            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');

        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';

                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';

                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';

                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/use-trustweave-facade/" class="nav-list-link">Use TrustWeave Facade for Quick Setup</a></li><li class="nav-list-item"><a href="/trustweave/how-to/configure-trustlayer/" class="nav-list-link">Configure TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li><li class="nav-list-item"><a href="/trustweave/how-to/multi-chain-anchoring/" class="nav-list-link">Multi-Chain Anchoring Patterns</a></li><li class="nav-list-item"><a href="/trustweave/how-to/exchange-credentials/" class="nav-list-link">Exchange Credentials with Multiple Protocols</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li></ul>
  
</nav>




  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      <nav aria-label="Breadcrumb" class="breadcrumb-nav">
  <ol class="breadcrumb-nav-list">
    <li class="breadcrumb-nav-list-item"><a href="/trustweave/getting-started/README/">Getting Started</a></li>
    <li class="breadcrumb-nav-list-item"><span>Common Patterns</span></li>
  </ol>
</nav>


      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="common-patterns">
  
  
    <a href="#common-patterns" class="anchor-heading" aria-labelledby="common-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Common Patterns
  
  
</h1>
    

<blockquote>
  <p><strong>Version:</strong> 1.0.0-SNAPSHOT
Learn common usage patterns and best practices for TrustWeave.</p>
</blockquote>
<h2 id="table-of-contents">
  
  
    <a href="#table-of-contents" class="anchor-heading" aria-labelledby="table-of-contents"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table of Contents
  
  
</h2>
    

<ol>
  <li><a href="#issuer--holder--verifier-workflow">Issuer → Holder → Verifier Workflow</a></li>
  <li><a href="#batch-operations">Batch Operations</a></li>
  <li><a href="#error-recovery-with-fallbacks">Error Recovery with Fallbacks</a></li>
  <li><a href="#credential-lifecycle-management">Credential Lifecycle Management</a></li>
  <li><a href="#multi-chain-anchoring">Multi-Chain Anchoring</a></li>
  <li><a href="#wallet-organization-patterns">Wallet Organization Patterns</a></li>
</ol><hr />
<h2 id="issuer--holder--verifier-workflow">
  
  
    <a href="#issuer--holder--verifier-workflow" class="anchor-heading" aria-labelledby="issuer--holder--verifier-workflow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Issuer → Holder → Verifier Workflow
  
  
</h2>
    

<p>Complete workflow showing all three parties in a credential ecosystem. This example uses production-ready error handling patterns with <code class="language-plaintext highlighter-rouge">fold()</code>.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.example.patterns.workflow</span>

<span class="k">import</span> <span class="nn">org.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">org.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">trustweave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span><span class="p">()</span>

    <span class="c1">// ============================================</span>
    <span class="c1">// 1. ISSUER: Create DID and issue credential</span>
    <span class="c1">// ============================================</span>
    <span class="kd">val</span> <span class="py">issuerDidDoc</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">is</span> <span class="nc">IllegalStateException</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="k">if</span> <span class="p">(</span><span class="n">error</span><span class="p">.</span><span class="n">message</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"not configured"</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span><span class="p">)</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ DID method not registered: ${error.method}"</span><span class="p">)</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"   Available methods: ${error.availableMethods}"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create issuer DID: ${error.message}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">issuerDid</span> <span class="p">=</span> <span class="n">issuerDidDoc</span><span class="p">.</span><span class="n">id</span>
    <span class="kd">val</span> <span class="py">issuerKeyId</span> <span class="p">=</span> <span class="n">issuerDidDoc</span><span class="p">.</span><span class="n">verificationMethod</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span>
        <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">issue</span> <span class="p">{</span>
            <span class="nf">credential</span> <span class="p">{</span>
                <span class="nf">issuer</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">)</span>
                <span class="nf">subject</span> <span class="p">{</span>
                    <span class="nf">id</span><span class="p">(</span><span class="s">"did:key:holder-123"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="s">"Alice"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"degree"</span><span class="p">,</span> <span class="s">"Bachelor of Science"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">config</span> <span class="p">=</span> <span class="nc">IssuanceConfig</span><span class="p">(</span>
                <span class="n">proofType</span> <span class="p">=</span> <span class="nc">ProofType</span><span class="p">.</span><span class="nc">Ed25519Signature2020</span><span class="p">,</span>
                <span class="n">keyId</span> <span class="p">=</span> <span class="n">issuerKeyId</span><span class="p">,</span>
                <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">issuerDid</span>
            <span class="p">),</span>
            <span class="n">types</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"DegreeCredential"</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">TrustWeaveError</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">is</span> <span class="nc">TrustWeaveError</span><span class="p">.</span><span class="nc">CredentialInvalid</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Credential issuance failed: ${error.reason}"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">is</span> <span class="nc">TrustWeaveError</span><span class="p">.</span><span class="nc">InvalidDidFormat</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Invalid issuer DID format: ${error.reason}"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to issue credential: ${error.message}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Issuer created credential: ${credential.id}"</span><span class="p">)</span>

    <span class="c1">// ============================================</span>
    <span class="c1">// 2. HOLDER: Store credential in wallet</span>
    <span class="c1">// ============================================</span>
    <span class="kd">val</span> <span class="py">holderDid</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create holder DID: ${error.message}"</span><span class="p">)</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">wallet</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustweave</span><span class="p">.</span><span class="n">wallets</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">holderDid</span> <span class="p">=</span> <span class="n">holderDid</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">TrustWeaveError</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">is</span> <span class="nc">TrustWeaveError</span><span class="p">.</span><span class="nc">WalletCreationFailed</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Wallet creation failed: ${error.reason}"</span><span class="p">)</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"   Provider: ${error.provider}"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create wallet: ${error.message}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">credentialId</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Holder stored credential: $credentialId"</span><span class="p">)</span>

    <span class="c1">// ============================================</span>
    <span class="c1">// 3. VERIFIER: Verify credential</span>
    <span class="c1">// ============================================</span>
    <span class="kd">val</span> <span class="py">verification</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">verify</span> <span class="p">{</span>
            <span class="nf">credential</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">when</span> <span class="p">(</span><span class="n">error</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">is</span> <span class="nc">IllegalStateException</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Credential validation failed: ${error.reason}"</span><span class="p">)</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"   Field: ${error.field}"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Verification failed: ${error.message}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verification</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Verifier confirmed credential is valid"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"   Proof valid: ${verification.proofValid}"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"   Issuer valid: ${verification.issuerValid}"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"   Not revoked: ${verification.notRevoked}"</span><span class="p">)</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">verification</span><span class="p">.</span><span class="n">warnings</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">())</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"   Warnings: ${verification.warnings.joinToString()}"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Verifier rejected credential"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"   Errors: ${verification.errors.joinToString()}"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Points:</strong></p>
<ul>
  <li>Each party has their own DID</li>
  <li>Issuer signs the credential with their key</li>
  <li>Holder stores the credential in their wallet</li>
  <li>Verifier checks the credential without contacting issuer</li>
</ul>
<h3 id="workflow-diagram">
  
  
    <a href="#workflow-diagram" class="anchor-heading" aria-labelledby="workflow-diagram"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Workflow Diagram
  
  
</h3>
    

<pre><code class="language-mermaid">sequenceDiagram
    participant I as Issuer
    participant VC as TrustWeave
    participant H as Holder
    participant V as Verifier

    Note over I: 1. Issuer Setup
    I-&gt;&gt;VC: createDid()
    VC--&gt;&gt;I: DidDocument

    Note over I: 2. Credential Issuance
    I-&gt;&gt;VC: issueCredential(issuerDid, claims)
    VC-&gt;&gt;VC: Resolve issuer DID
    VC-&gt;&gt;VC: Sign credential with issuer key
    VC--&gt;&gt;I: VerifiableCredential (with proof)

    Note over I,H: 3. Credential Transfer
    I-&gt;&gt;H: Send VerifiableCredential

    Note over H: 4. Holder Storage
    H-&gt;&gt;VC: createWallet(holderDid)
    VC--&gt;&gt;H: Wallet
    H-&gt;&gt;VC: wallet.store(credential)
    VC--&gt;&gt;H: credentialId

    Note over H,V: 5. Credential Presentation
    H-&gt;&gt;V: Present VerifiableCredential

    Note over V: 6. Verification
    V-&gt;&gt;VC: verifyCredential(credential)
    VC-&gt;&gt;VC: Resolve issuer DID
    VC-&gt;&gt;VC: Verify proof signature
    VC-&gt;&gt;VC: Check expiration/revocation
    VC--&gt;&gt;V: CredentialVerificationResult

    alt Credential Valid
        V-&gt;&gt;V: Accept credential
    else Credential Invalid
        V-&gt;&gt;V: Reject credential
    end
</code></pre><hr />
<h2 id="batch-operations">
  
  
    <a href="#batch-operations" class="anchor-heading" aria-labelledby="batch-operations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Batch Operations
  
  
</h2>
    

<p>Process multiple DIDs or credentials efficiently using coroutines.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.example.patterns.batch</span>

<span class="k">import</span> <span class="nn">org.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">org.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">trustweave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span><span class="p">()</span>

    <span class="c1">// Batch DID resolution</span>
    <span class="kd">val</span> <span class="py">dids</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
        <span class="s">"did:key:z6Mk..."</span><span class="p">,</span>
        <span class="s">"did:key:z6Mk..."</span><span class="p">,</span>
        <span class="s">"did:key:z6Mk..."</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">results</span> <span class="p">=</span> <span class="n">dids</span><span class="p">.</span><span class="nf">mapAsync</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span>
        <span class="nf">runCatching</span> <span class="p">{</span>
            <span class="n">trustWeave</span><span class="p">.</span><span class="nf">resolveDid</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="n">results</span><span class="p">.</span><span class="nf">forEachIndexed</span> <span class="p">{</span> <span class="n">index</span><span class="p">,</span> <span class="n">result</span> <span class="p">-&gt;</span>
        <span class="n">result</span><span class="p">.</span><span class="nf">fold</span><span class="p">(</span>
            <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span> <span class="n">resolution</span> <span class="p">-&gt;</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"✅ DID ${index + 1} resolved: ${resolution.document?.id}"</span><span class="p">)</span>
            <span class="p">},</span>
            <span class="n">onFailure</span> <span class="p">=</span> <span class="p">{</span> <span class="n">error</span> <span class="p">-&gt;</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"❌ DID ${index + 1} failed: ${error.message}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Batch credential creation</span>
    <span class="k">import</span> <span class="nn">org.trustweave.trust.types.DidCreationResult</span>
    <span class="k">import</span> <span class="nn">org.trustweave.trust.types.IssuanceResult</span>
    
    <span class="kd">val</span> <span class="py">credentials</span> <span class="p">=</span> <span class="p">(</span><span class="mi">1</span><span class="o">..</span><span class="mi">10</span><span class="p">).</span><span class="nf">mapAsync</span> <span class="p">{</span> <span class="n">index</span> <span class="p">-&gt;</span>
        <span class="nf">runCatching</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">didResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
            <span class="kd">val</span> <span class="py">issuerDid</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">didResult</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">is</span> <span class="nc">DidCreationResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">didResult</span><span class="p">.</span><span class="n">did</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Failed to create DID: ${didResult.reason}"</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="kd">val</span> <span class="py">issuerResolution</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">resolveDid</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">)</span>
            <span class="kd">val</span> <span class="py">issuerDoc</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuerResolution</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">is</span> <span class="nc">DidResolutionResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuerResolution</span><span class="p">.</span><span class="n">document</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Failed to resolve issuer DID"</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="kd">val</span> <span class="py">issuerKeyId</span> <span class="p">=</span> <span class="n">issuerDoc</span><span class="p">.</span><span class="n">verificationMethod</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span><span class="o">?.</span><span class="nf">substringAfter</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span>
                <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>
            
            <span class="kd">val</span> <span class="py">issuanceResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">issue</span> <span class="p">{</span>
                <span class="nf">credential</span> <span class="p">{</span>
                    <span class="nf">issuer</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="nf">subject</span> <span class="p">{</span>
                        <span class="nf">id</span><span class="p">(</span><span class="s">"did:key:holder-$index"</span><span class="p">)</span>
                        <span class="s">"index"</span> <span class="n">to</span> <span class="n">index</span>
                    <span class="p">}</span>
                    <span class="nf">issued</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">())</span>
                <span class="p">}</span>
                <span class="nf">signedBy</span><span class="p">(</span><span class="n">issuerDid</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">=</span> <span class="n">issuerKeyId</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="k">when</span> <span class="p">(</span><span class="n">issuanceResult</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">is</span> <span class="nc">IssuanceResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuanceResult</span><span class="p">.</span><span class="n">credential</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Failed to issue credential: ${issuanceResult.reason}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">successful</span> <span class="p">=</span> <span class="n">credentials</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">isSuccess</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">failed</span> <span class="p">=</span> <span class="n">credentials</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">isFailure</span> <span class="p">}</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Created ${successful.size} credentials out of ${credentials.size}"</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">failed</span><span class="p">.</span><span class="nf">isNotEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"Failed: ${failed.size} credentials"</span><span class="p">)</span>
        <span class="n">failed</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">result</span> <span class="p">-&gt;</span>
            <span class="n">result</span><span class="p">.</span><span class="nf">fold</span><span class="p">(</span>
                <span class="n">onSuccess</span> <span class="p">=</span> <span class="p">{</span> <span class="p">},</span>
                <span class="n">onFailure</span> <span class="p">=</span> <span class="p">{</span> <span class="n">error</span> <span class="p">-&gt;</span>
                    <span class="nf">println</span><span class="p">(</span><span class="s">"  Error: ${error.message}"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Points:</strong></p>
<ul>
  <li>Use <code class="language-plaintext highlighter-rouge">mapAsync</code> for parallel operations</li>
  <li>Handle each result individually</li>
  <li>Filter successful results for further processing</li>
</ul><hr />
<h2 id="error-recovery-with-fallbacks">
  
  
    <a href="#error-recovery-with-fallbacks" class="anchor-heading" aria-labelledby="error-recovery-with-fallbacks"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Error Recovery with Fallbacks
  
  
</h2>
    

<p>Handle errors gracefully with fallback strategies.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.example.patterns.recovery</span>

<span class="k">import</span> <span class="nn">org.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">org.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">TrustWeave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span><span class="p">()</span>

    <span class="c1">// Pattern: Try multiple DID methods with fallback</span>
    <span class="k">import</span> <span class="nn">org.trustweave.trust.types.DidCreationResult</span>
    
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">createDidWithFallback</span><span class="p">(</span><span class="n">methods</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;):</span> <span class="nc">Did</span><span class="p">?</span> <span class="p">{</span>
        <span class="k">for</span> <span class="p">(</span><span class="n">method</span> <span class="k">in</span> <span class="n">methods</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">didResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="n">method</span><span class="p">)</span> <span class="p">}</span>
            <span class="k">when</span> <span class="p">(</span><span class="n">didResult</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">is</span> <span class="nc">DidCreationResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="k">return</span> <span class="n">didResult</span><span class="p">.</span><span class="n">did</span>
                <span class="k">is</span> <span class="nc">DidCreationResult</span><span class="p">.</span><span class="nc">Failure</span><span class="p">.</span><span class="nc">MethodNotRegistered</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nf">println</span><span class="p">(</span><span class="s">"Method '$method' not available, trying next..."</span><span class="p">)</span>
                    <span class="c1">// Continue to next method</span>
                <span class="p">}</span>
                <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="nf">println</span><span class="p">(</span><span class="s">"Unexpected error with method '$method': ${didResult.reason}"</span><span class="p">)</span>
                    <span class="c1">// Try next method anyway</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="k">null</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">did</span> <span class="p">=</span> <span class="nf">createDidWithFallback</span><span class="p">(</span><span class="nf">listOf</span><span class="p">(</span><span class="s">"web"</span><span class="p">,</span> <span class="s">"ion"</span><span class="p">,</span> <span class="s">"key"</span><span class="p">))</span>
        <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"All DID methods failed"</span><span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Created DID: ${did.id}"</span><span class="p">)</span>

    <span class="c1">// Pattern: Retry with exponential backoff</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">resolveDidWithRetry</span><span class="p">(</span><span class="n">did</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">maxRetries</span><span class="p">:</span> <span class="nc">Int</span> <span class="p">=</span> <span class="mi">3</span><span class="p">):</span> <span class="nc">DidResolutionResult</span><span class="p">?</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="py">lastError</span><span class="p">:</span> <span class="nc">Throwable</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">attempt</span> <span class="k">in</span> <span class="mi">1</span><span class="o">..</span><span class="n">maxRetries</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">resolution</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">resolveDid</span><span class="p">(</span><span class="n">did</span><span class="p">)</span>
            <span class="k">when</span> <span class="p">(</span><span class="n">resolution</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">is</span> <span class="nc">DidResolutionResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="k">return</span> <span class="n">resolution</span>
                <span class="k">is</span> <span class="nc">DidResolutionResult</span><span class="p">.</span><span class="nc">Failure</span> <span class="p">-&gt;</span> <span class="p">{</span>
                    <span class="n">lastError</span> <span class="p">=</span> <span class="nc">Exception</span><span class="p">(</span><span class="n">resolution</span><span class="p">.</span><span class="n">reason</span><span class="p">)</span>
                    <span class="k">if</span> <span class="p">(</span><span class="n">attempt</span> <span class="p">&lt;</span> <span class="n">maxRetries</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">val</span> <span class="py">delay</span> <span class="p">=</span> <span class="p">(</span><span class="n">attempt</span> <span class="p">*</span> <span class="n">attempt</span> <span class="p">*</span> <span class="mi">100</span><span class="p">).</span><span class="nf">toLong</span><span class="p">()</span> <span class="c1">// Exponential backoff</span>
                        <span class="n">kotlinx</span><span class="p">.</span><span class="n">coroutines</span><span class="p">.</span><span class="nf">delay</span><span class="p">(</span><span class="n">delay</span><span class="p">)</span>
                        <span class="nf">println</span><span class="p">(</span><span class="s">"Retry $attempt/$maxRetries after ${delay}ms..."</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">}</span>

        <span class="nf">println</span><span class="p">(</span><span class="s">"Failed after $maxRetries attempts: ${lastError?.message}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="k">null</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Points:</strong></p>
<ul>
  <li>Try multiple methods/strategies in order</li>
  <li>Use exponential backoff for retries</li>
  <li>Always have a fallback plan</li>
  <li>Log attempts for debugging</li>
</ul><hr />
<h2 id="credential-lifecycle-management">
  
  
    <a href="#credential-lifecycle-management" class="anchor-heading" aria-labelledby="credential-lifecycle-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Credential Lifecycle Management
  
  
</h2>
    

<p>Manage credentials through their entire lifecycle: issuance, storage, presentation, verification, and expiration.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.example.patterns.lifecycle</span>

<span class="k">import</span> <span class="nn">org.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">org.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">org.trustweave.credential.PresentationOptions</span>
<span class="k">import</span> <span class="nn">org.trustweave.spi.services.WalletCreationOptionsBuilder</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>
<span class="k">import</span> <span class="nn">java.time.Instant</span>
<span class="k">import</span> <span class="nn">java.time.temporal.ChronoUnit</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">TrustWeave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span><span class="p">()</span>

    <span class="c1">// Create issuer and holder</span>
    <span class="kd">val</span> <span class="py">issuerDidResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">issuerDid</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuerDidResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">DidCreationResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuerDidResult</span><span class="p">.</span><span class="n">did</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Failed to create issuer DID: ${issuerDidResult.reason}"</span><span class="p">)</span>
            <span class="k">return</span><span class="nd">@runBlocking</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">holderDidResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">holderDid</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">holderDidResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">DidCreationResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">holderDidResult</span><span class="p">.</span><span class="n">did</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Failed to create holder DID: ${holderDidResult.reason}"</span><span class="p">)</span>
            <span class="k">return</span><span class="nd">@runBlocking</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Issue credential with expiration</span>
    <span class="kd">val</span> <span class="py">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">YEARS</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">issuerResolution</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">resolveDid</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">issuerDoc</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuerResolution</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">DidResolutionResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuerResolution</span><span class="p">.</span><span class="n">document</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Failed to resolve issuer DID"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">val</span> <span class="py">issuerKeyId</span> <span class="p">=</span> <span class="n">issuerDoc</span><span class="p">.</span><span class="n">verificationMethod</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span><span class="o">?.</span><span class="nf">substringAfter</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span>
        <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">issuanceResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">issue</span> <span class="p">{</span>
        <span class="nf">credential</span> <span class="p">{</span>
            <span class="nf">issuer</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
            <span class="nf">subject</span> <span class="p">{</span>
                <span class="nf">id</span><span class="p">(</span><span class="n">holderDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
                <span class="s">"name"</span> <span class="n">to</span> <span class="s">"Alice"</span>
            <span class="p">}</span>
            <span class="nf">issued</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">())</span>
            <span class="nf">expires</span><span class="p">(</span><span class="n">expirationDate</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="nf">signedBy</span><span class="p">(</span><span class="n">issuerDid</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">=</span> <span class="n">issuerKeyId</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuanceResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">IssuanceResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuanceResult</span><span class="p">.</span><span class="n">credential</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to issue credential: ${issuanceResult.reason}"</span><span class="p">)</span>
            <span class="k">return</span><span class="nd">@runBlocking</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Store in wallet with lifecycle support</span>
    <span class="kd">val</span> <span class="py">walletResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">wallet</span> <span class="p">{</span>
        <span class="nf">holder</span><span class="p">(</span><span class="n">holderDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
        <span class="nf">enableOrganization</span><span class="p">()</span>
        <span class="nf">enablePresentation</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">wallet</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">walletResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">WalletCreationResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">walletResult</span><span class="p">.</span><span class="n">wallet</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create wallet: ${walletResult.reason}"</span><span class="p">)</span>
            <span class="k">return</span><span class="nd">@runBlocking</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">credentialId</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>

    <span class="c1">// Organize credential</span>
    <span class="n">wallet</span><span class="p">.</span><span class="nf">withOrganization</span> <span class="p">{</span> <span class="n">org</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">collectionId</span> <span class="p">=</span> <span class="n">org</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span><span class="s">"Education"</span><span class="p">,</span> <span class="s">"Academic credentials"</span><span class="p">)</span>
        <span class="n">org</span><span class="p">.</span><span class="nf">addToCollection</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="n">collectionId</span><span class="p">)</span>
        <span class="n">org</span><span class="p">.</span><span class="nf">tagCredential</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="nf">setOf</span><span class="p">(</span><span class="s">"degree"</span><span class="p">,</span> <span class="s">"verified"</span><span class="p">))</span>
    <span class="p">}</span>

    <span class="c1">// Create presentation when needed</span>
    <span class="kd">val</span> <span class="py">presentation</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="nf">withPresentation</span> <span class="p">{</span> <span class="n">pres</span> <span class="p">-&gt;</span>
        <span class="n">pres</span><span class="p">.</span><span class="nf">createPresentation</span><span class="p">(</span>
            <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">holderDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
                <span class="n">holderDid</span> <span class="p">=</span> <span class="n">holderDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
                <span class="n">challenge</span> <span class="p">=</span> <span class="s">"job-application-${System.currentTimeMillis()}"</span>
            <span class="p">)</span>
        <span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Verify before using</span>
    <span class="kd">val</span> <span class="py">verification</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">verify</span> <span class="p">{</span>
            <span class="nf">credential</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Verification failed: ${error.message}"</span><span class="p">)</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="k">when</span> <span class="p">(</span><span class="n">verification</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">VerificationResult</span><span class="p">.</span><span class="nc">Valid</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="c1">// Credential is valid, continue</span>
        <span class="p">}</span>
        <span class="k">is</span> <span class="nc">VerificationResult</span><span class="p">.</span><span class="nc">Invalid</span> <span class="p">-&gt;</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"⚠️ Credential invalid: ${verification.errors.joinToString()}"</span><span class="p">)</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="c1">// Check expiration</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">credential</span><span class="p">.</span><span class="n">expirationDate</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">expiration</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">credential</span><span class="p">.</span><span class="n">expirationDate</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">expiration</span><span class="p">.</span><span class="nf">isBefore</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">()))</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"⚠️ Credential expired on ${credential.expirationDate}"</span><span class="p">)</span>
            <span class="c1">// Archive expired credential</span>
            <span class="n">wallet</span><span class="p">.</span><span class="nf">withLifecycle</span> <span class="p">{</span> <span class="n">lifecycle</span> <span class="p">-&gt;</span>
                <span class="n">lifecycle</span><span class="p">.</span><span class="nf">archive</span><span class="p">(</span><span class="n">credentialId</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Credential lifecycle managed successfully"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Points:</strong></p>
<ul>
  <li>Always set expiration dates for time-sensitive credentials</li>
  <li>Organize credentials for easy retrieval</li>
  <li>Verify credentials before use</li>
  <li>Archive expired credentials</li>
  <li>Use presentations for selective disclosure</li>
</ul><hr />
<h2 id="multi-chain-anchoring">
  
  
    <a href="#multi-chain-anchoring" class="anchor-heading" aria-labelledby="multi-chain-anchoring"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Chain Anchoring
  
  
</h2>
    

<p>Anchor the same credential to multiple blockchains for redundancy and interoperability.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.example.patterns.multichain</span>

<span class="k">import</span> <span class="nn">org.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">org.trustweave.anchor.BlockchainAnchorRegistry</span>
<span class="k">import</span> <span class="nn">org.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">org.trustweave.credential.models.VerifiableCredential</span>
<span class="k">import</span> <span class="nn">org.trustweave.testkit.anchor.InMemoryBlockchainAnchorClient</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.Json</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.encodeToJsonElement</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">TrustWeave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span> <span class="p">{</span>
        <span class="nf">blockchains</span> <span class="p">{</span>
            <span class="s">"algorand:testnet"</span> <span class="n">to</span> <span class="nc">InMemoryBlockchainAnchorClient</span><span class="p">(</span><span class="s">"algorand:testnet"</span><span class="p">)</span>
            <span class="s">"polygon:testnet"</span> <span class="n">to</span> <span class="nc">InMemoryBlockchainAnchorClient</span><span class="p">(</span><span class="s">"polygon:testnet"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Issue credential</span>
    <span class="kd">val</span> <span class="py">issuerDidResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">issuerDid</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuerDidResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">DidCreationResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuerDidResult</span><span class="p">.</span><span class="n">did</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create issuer DID: ${issuerDidResult.reason}"</span><span class="p">)</span>
            <span class="k">return</span><span class="nd">@runBlocking</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">issuerResolution</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">resolveDid</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">issuerDoc</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuerResolution</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">DidResolutionResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuerResolution</span><span class="p">.</span><span class="n">document</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Failed to resolve issuer DID"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">val</span> <span class="py">issuerKeyId</span> <span class="p">=</span> <span class="n">issuerDoc</span><span class="p">.</span><span class="n">verificationMethod</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span><span class="o">?.</span><span class="nf">substringAfter</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span>
        <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">issuanceResult</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">issue</span> <span class="p">{</span>
        <span class="nf">credential</span> <span class="p">{</span>
            <span class="nf">issuer</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
            <span class="nf">subject</span> <span class="p">{</span>
                <span class="nf">id</span><span class="p">(</span><span class="s">"did:key:holder"</span><span class="p">)</span>
                <span class="s">"data"</span> <span class="n">to</span> <span class="s">"important-data"</span>
            <span class="p">}</span>
            <span class="nf">issued</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">())</span>
        <span class="p">}</span>
        <span class="nf">signedBy</span><span class="p">(</span><span class="n">issuerDid</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">=</span> <span class="n">issuerKeyId</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuanceResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">IssuanceResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuanceResult</span><span class="p">.</span><span class="n">credential</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to issue credential: ${issuanceResult.reason}"</span><span class="p">)</span>
            <span class="k">return</span><span class="nd">@runBlocking</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Anchor to multiple chains</span>
    <span class="kd">val</span> <span class="py">chains</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"algorand:testnet"</span><span class="p">,</span> <span class="s">"polygon:testnet"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">anchorResults</span> <span class="p">=</span> <span class="n">chains</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">chainId</span> <span class="p">-&gt;</span>
        <span class="k">try</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">anchor</span> <span class="p">=</span> <span class="n">trustweave</span><span class="p">.</span><span class="n">blockchains</span><span class="p">.</span><span class="nf">anchor</span><span class="p">(</span>
                <span class="n">data</span> <span class="p">=</span> <span class="n">credential</span><span class="p">,</span>
                <span class="n">serializer</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
                <span class="n">chainId</span> <span class="p">=</span> <span class="n">chainId</span>
            <span class="p">)</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Anchored to $chainId: ${anchor.ref.txHash}"</span><span class="p">)</span>
            <span class="n">anchor</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">TrustWeaveError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to anchor to $chainId: ${error.message}"</span><span class="p">)</span>
            <span class="k">null</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Anchored to ${anchorResults.size} out of ${chains.size} chains"</span><span class="p">)</span>

    <span class="c1">// Store all anchor references</span>
    <span class="kd">val</span> <span class="py">anchorRefs</span> <span class="p">=</span> <span class="n">anchorResults</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">ref</span> <span class="p">}</span>
    <span class="c1">// In production, store these in a database for later verification</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Points:</strong></p>
<ul>
  <li>Anchor to multiple chains for redundancy</li>
  <li>Handle failures gracefully (some chains may be unavailable)</li>
  <li>Store all anchor references for verification</li>
  <li>Use different chains for different use cases</li>
</ul><hr />
<h2 id="wallet-organization-patterns">
  
  
    <a href="#wallet-organization-patterns" class="anchor-heading" aria-labelledby="wallet-organization-patterns"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Wallet Organization Patterns
  
  
</h2>
    

<p>Organize credentials efficiently using collections, tags, and metadata.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.example.patterns.organization</span>

<span class="k">import</span> <span class="nn">org.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">org.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">org.trustweave.spi.services.WalletCreationOptionsBuilder</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">trustweave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">holderDid</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create holder DID: ${error.message}"</span><span class="p">)</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">wallet</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">wallet</span> <span class="p">{</span>
            <span class="nf">holder</span><span class="p">(</span><span class="n">holderDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
            <span class="nf">type</span><span class="p">(</span><span class="s">"inMemory"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create wallet: ${error.message}"</span><span class="p">)</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="c1">// Issue multiple credentials</span>
    <span class="kd">val</span> <span class="py">issuerDid</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
        <span class="n">trustWeave</span><span class="p">.</span><span class="nf">createDid</span> <span class="p">{</span> <span class="nf">method</span><span class="p">(</span><span class="s">"key"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">Exception</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to create issuer DID: ${error.message}"</span><span class="p">)</span>
        <span class="k">return</span><span class="nd">@runBlocking</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">issuerResolution</span> <span class="p">=</span> <span class="n">trustWeave</span><span class="p">.</span><span class="nf">resolveDid</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">issuerDoc</span> <span class="p">=</span> <span class="k">when</span> <span class="p">(</span><span class="n">issuerResolution</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">is</span> <span class="nc">DidResolutionResult</span><span class="p">.</span><span class="nc">Success</span> <span class="p">-&gt;</span> <span class="n">issuerResolution</span><span class="p">.</span><span class="n">document</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"Failed to resolve issuer DID"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="kd">val</span> <span class="py">issuerKeyId</span> <span class="p">=</span> <span class="n">issuerDoc</span><span class="p">.</span><span class="n">verificationMethod</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span><span class="o">?.</span><span class="nf">substringAfter</span><span class="p">(</span><span class="s">"#"</span><span class="p">)</span>
        <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalStateException</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">credentials</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
        <span class="s">"Bachelor of Science"</span> <span class="n">to</span> <span class="s">"education"</span><span class="p">,</span>
        <span class="s">"Professional License"</span> <span class="n">to</span> <span class="s">"professional"</span><span class="p">,</span>
        <span class="s">"Membership Card"</span> <span class="n">to</span> <span class="s">"membership"</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">credentialIds</span> <span class="p">=</span> <span class="n">credentials</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="p">(</span><span class="n">name</span><span class="p">,</span> <span class="n">category</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="k">try</span> <span class="p">{</span>
            <span class="n">trustWeave</span><span class="p">.</span><span class="nf">issue</span> <span class="p">{</span>
                <span class="nf">credential</span> <span class="p">{</span>
                    <span class="nf">issuer</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
                    <span class="nf">subject</span> <span class="p">{</span>
                        <span class="nf">id</span><span class="p">(</span><span class="n">holderDid</span><span class="p">.</span><span class="n">value</span><span class="p">)</span>
                        <span class="s">"credentialName"</span> <span class="n">to</span> <span class="n">name</span>
                    <span class="p">}</span>
                    <span class="nf">issued</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">())</span>
                <span class="p">}</span>
                <span class="nf">signedBy</span><span class="p">(</span><span class="n">issuerDid</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">.</span><span class="n">value</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">=</span> <span class="n">issuerKeyId</span><span class="p">)</span>
            <span class="p">}</span>
                    <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">.</span><span class="n">id</span>
                <span class="p">),</span>
                <span class="n">types</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"${category}Credential"</span><span class="p">)</span>
            <span class="p">)</span>
        <span class="p">}</span> <span class="k">catch</span> <span class="p">(</span><span class="n">error</span><span class="p">:</span> <span class="nc">TrustWeaveError</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Failed to issue credential '$name': ${error.message}"</span><span class="p">)</span>
            <span class="k">return</span><span class="nd">@mapNotNull</span> <span class="k">null</span>
        <span class="p">}</span>

        <span class="kd">val</span> <span class="py">credentialId</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>

        <span class="c1">// Organize immediately after storage</span>
        <span class="n">wallet</span><span class="p">.</span><span class="nf">withOrganization</span> <span class="p">{</span> <span class="n">org</span> <span class="p">-&gt;</span>
            <span class="c1">// Create collection by category</span>
            <span class="kd">val</span> <span class="py">collectionId</span> <span class="p">=</span> <span class="n">org</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span>
                <span class="n">name</span> <span class="p">=</span> <span class="n">category</span><span class="p">.</span><span class="nf">capitalize</span><span class="p">(),</span>
                <span class="n">description</span> <span class="p">=</span> <span class="s">"$category credentials"</span>
            <span class="p">)</span>
            <span class="n">org</span><span class="p">.</span><span class="nf">addToCollection</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="n">collectionId</span><span class="p">)</span>

            <span class="c1">// Add tags</span>
            <span class="n">org</span><span class="p">.</span><span class="nf">tagCredential</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="nf">setOf</span><span class="p">(</span><span class="n">category</span><span class="p">,</span> <span class="s">"verified"</span><span class="p">,</span> <span class="s">"active"</span><span class="p">))</span>

            <span class="c1">// Add metadata</span>
            <span class="n">org</span><span class="p">.</span><span class="nf">addMetadata</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="nf">mapOf</span><span class="p">(</span>
                <span class="s">"category"</span> <span class="n">to</span> <span class="n">category</span><span class="p">,</span>
                <span class="s">"storedAt"</span> <span class="n">to</span> <span class="nc">System</span><span class="p">.</span><span class="nf">currentTimeMillis</span><span class="p">()</span>
            <span class="p">))</span>
        <span class="p">}</span>

        <span class="n">credentialId</span>
    <span class="p">}</span>

    <span class="c1">// Query by collection</span>
    <span class="n">wallet</span><span class="p">.</span><span class="nf">withOrganization</span> <span class="p">{</span> <span class="n">org</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">educationCollection</span> <span class="p">=</span> <span class="n">org</span><span class="p">.</span><span class="nf">listCollections</span><span class="p">()</span>
            <span class="p">.</span><span class="nf">firstOrNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">name</span> <span class="p">==</span> <span class="s">"Education"</span> <span class="p">}</span>

        <span class="k">if</span> <span class="p">(</span><span class="n">educationCollection</span> <span class="p">!=</span> <span class="k">null</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">val</span> <span class="py">educationCreds</span> <span class="p">=</span> <span class="n">org</span><span class="p">.</span><span class="nf">getCredentialsInCollection</span><span class="p">(</span><span class="n">educationCollection</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"Education credentials: ${educationCreds.size}"</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Query by tag</span>
    <span class="n">wallet</span><span class="p">.</span><span class="nf">withOrganization</span> <span class="p">{</span> <span class="n">org</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">verifiedCreds</span> <span class="p">=</span> <span class="n">org</span><span class="p">.</span><span class="nf">findByTag</span><span class="p">(</span><span class="s">"verified"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"Verified credentials: ${verifiedCreds.size}"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Get statistics</span>
    <span class="kd">val</span> <span class="py">stats</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="nf">getStatistics</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Wallet stats:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  Total: ${stats.totalCredentials}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  Collections: ${stats.collectionsCount}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  Tags: ${stats.tagsCount}"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Key Points:</strong></p>
<ul>
  <li>Organize credentials immediately after storage</li>
  <li>Use collections for broad categories</li>
  <li>Use tags for flexible querying</li>
  <li>Add metadata for custom properties</li>
  <li>Query by collection, tag, or metadata</li>
</ul><hr />
<h2 id="related-documentation">
  
  
    <a href="#related-documentation" class="anchor-heading" aria-labelledby="related-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Related Documentation
  
  
</h2>
    

<ul>
  <li><a href="/trustweave/getting-started/quick-start/">Quick Start</a> - Getting started guide</li>
  <li><a href="/trustweave/api-reference/wallet-api/">Wallet API Reference</a> - Complete wallet API</li>
  <li><a href="/trustweave/advanced/error-handling/">Error Handling</a> - Error handling patterns</li>
  <li><a href="/trustweave/getting-started/troubleshooting/">Troubleshooting</a> - Common issues and solutions</li>
</ul>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with ❤️ by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();

        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
        footer.style.marginTop = 'auto'; // Push to bottom in flexbox layout
        footer.style.zIndex = '0'; // Below search overlay
      }
    }

    // Function to update footer visibility based on search state
    function updateFooterVisibility() {
      const footer = document.querySelector('.site-footer');
      const htmlElement = document.documentElement;

      if (footer && htmlElement) {
        const isSearchActive = htmlElement.classList.contains('search-active');
        if (isSearchActive) {
          // Hide footer when search is active - use multiple methods to ensure it's hidden
          footer.style.display = 'none';
          footer.style.visibility = 'hidden';
          footer.style.opacity = '0';
          footer.style.zIndex = '-999';
          footer.style.pointerEvents = 'none';
        } else {
          // Show footer when search is not active
          footer.style.display = 'block';
          footer.style.visibility = 'visible';
          footer.style.opacity = '1';
          footer.style.marginTop = 'auto';
          footer.style.position = 'relative';
          footer.style.zIndex = '-1';
          footer.style.pointerEvents = 'auto';
        }
      }
    }

    // Monitor search state and hide/show footer appropriately
    const observer = new MutationObserver(function(mutations) {
      updateFooterVisibility();
    });

    // Also listen for input events on search input as a backup
    // This ensures footer is hidden immediately when user starts typing
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      // Use requestAnimationFrame for better performance
      const handleSearchChange = function() {
        requestAnimationFrame(updateFooterVisibility);
      };

      searchInput.addEventListener('input', handleSearchChange);
      searchInput.addEventListener('focus', handleSearchChange);
      searchInput.addEventListener('keydown', handleSearchChange);
    }

    // Observe documentElement (html) for class changes (like search-active)
    // The search script adds 'search-active' to documentElement, not body
    if (document.documentElement) {
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });

      // Initial check
      updateFooterVisibility();
    }
  });
</script>


    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    





<script type="module">
  
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';
  

  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>



  
</body>
</html>

