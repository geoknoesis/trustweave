

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
    .site-nav ul li a {
      background-image: none;
    }

  </style>

  

  
    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Healthcare &amp; Medical Records Scenario | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Healthcare &amp; Medical Records Scenario" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="http://0.0.0.0:4000/trustweave/scenarios/healthcare-medical-records-scenario/" />
<meta property="og:url" content="http://0.0.0.0:4000/trustweave/scenarios/healthcare-medical-records-scenario/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Healthcare &amp; Medical Records Scenario" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Healthcare &amp; Medical Records Scenario","url":"http://0.0.0.0:4000/trustweave/scenarios/healthcare-medical-records-scenario/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }

  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }

  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }

  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }

  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="http://0.0.0.0:4000/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });

            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');

        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';

                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';

                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';

                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/use-trustweave-facade/" class="nav-list-link">Use TrustWeave Facade for Quick Setup</a></li><li class="nav-list-item"><a href="/trustweave/how-to/configure-trustlayer/" class="nav-list-link">Configure TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li><li class="nav-list-item"><a href="/trustweave/how-to/multi-chain-anchoring/" class="nav-list-link">Multi-Chain Anchoring Patterns</a></li><li class="nav-list-item"><a href="/trustweave/how-to/exchange-credentials/" class="nav-list-link">Exchange Credentials with Multiple Protocols</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li></ul>
  
</nav>




  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="healthcare--medical-records-scenario">
  
  
    <a href="#healthcare--medical-records-scenario" class="anchor-heading" aria-labelledby="healthcare--medical-records-scenario"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Healthcare &amp; Medical Records Scenario
  
  
</h1>
    

<p>This guide demonstrates how to build a healthcare credential system using TrustWeave that enables patient privacy, secure medical record sharing, HIPAA compliance, and cross-provider interoperability.</p>
<h2 id="what-youll-build">
  
  
    <a href="#what-youll-build" class="anchor-heading" aria-labelledby="what-youll-build"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What You’ll Build
  
  
</h2>
    

<p>By the end of this tutorial, you’ll have:</p>

<ul>
  <li>✅ Created DIDs for patients, healthcare providers, and medical institutions</li>
  <li>✅ Issued medical credentials (prescriptions, lab results, vaccination records)</li>
  <li>✅ Implemented selective disclosure for privacy-preserving data sharing</li>
  <li>✅ Built consent management system</li>
  <li>✅ Created cross-provider credential sharing workflow</li>
  <li>✅ Anchored critical medical records to blockchain</li>
  <li>✅ Verified medical credentials cryptographically</li>
</ul>
<h2 id="big-picture--significance">
  
  
    <a href="#big-picture--significance" class="anchor-heading" aria-labelledby="big-picture--significance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Big Picture &amp; Significance
  
  
</h2>
    
<h3 id="the-healthcare-data-challenge">
  
  
    <a href="#the-healthcare-data-challenge" class="anchor-heading" aria-labelledby="the-healthcare-data-challenge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Healthcare Data Challenge
  
  
</h3>
    

<p>Healthcare data is among the most sensitive personal information, yet current systems struggle with interoperability, privacy, and patient control. The healthcare industry faces a critical need for secure, patient-controlled medical data sharing.</p>

<p><strong>Industry Context</strong>:</p>
<ul>
  <li><strong>Market Size</strong>: Global healthcare data analytics market projected to reach $84.2 billion by 2028</li>
  <li><strong>Regulatory Pressure</strong>: HIPAA, GDPR, and other regulations require strict data protection</li>
  <li><strong>Interoperability Crisis</strong>: Healthcare systems can’t easily share patient data across providers</li>
  <li><strong>Patient Rights</strong>: Growing demand for patient-controlled health data</li>
  <li><strong>Cost Impact</strong>: Poor interoperability costs $30+ billion annually in the US alone</li>
</ul>

<p><strong>Why This Matters</strong>:</p>
<ol>
  <li><strong>Patient Safety</strong>: Immediate access to medical history prevents medical errors</li>
  <li><strong>Privacy</strong>: Patients need granular control over who sees what medical data</li>
  <li><strong>Interoperability</strong>: Seamless data sharing across healthcare providers</li>
  <li><strong>Compliance</strong>: Meet HIPAA and GDPR requirements with cryptographic guarantees</li>
  <li><strong>Research</strong>: Enable privacy-preserving medical research with patient consent</li>
</ol>
<h3 id="the-current-healthcare-data-problem">
  
  
    <a href="#the-current-healthcare-data-problem" class="anchor-heading" aria-labelledby="the-current-healthcare-data-problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Current Healthcare Data Problem
  
  
</h3>
    

<p>Traditional healthcare systems face critical issues:</p>
<ul>
  <li><strong>Siloed Data</strong>: Medical records locked in proprietary systems</li>
  <li><strong>Privacy Breaches</strong>: Centralized databases are attractive targets</li>
  <li><strong>No Patient Control</strong>: Patients can’t easily access or share their own data</li>
  <li><strong>Interoperability Failures</strong>: Different systems can’t communicate</li>
  <li><strong>Compliance Burden</strong>: Complex HIPAA compliance requirements</li>
</ul>
<h2 id="value-proposition">
  
  
    <a href="#value-proposition" class="anchor-heading" aria-labelledby="value-proposition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Value Proposition
  
  
</h2>
    
<h3 id="problems-solved">
  
  
    <a href="#problems-solved" class="anchor-heading" aria-labelledby="problems-solved"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Problems Solved
  
  
</h3>
    

<ol>
  <li><strong>Patient Privacy</strong>: Selective disclosure allows sharing only necessary information</li>
  <li><strong>Interoperability</strong>: Standard DID/VC format works across all healthcare systems</li>
  <li><strong>Patient Control</strong>: Patients own and control their medical credentials</li>
  <li><strong>Compliance</strong>: Cryptographic proof meets HIPAA audit requirements</li>
  <li><strong>Security</strong>: Decentralized storage reduces breach risk</li>
  <li><strong>Efficiency</strong>: Instant verification without API calls to source systems</li>
  <li><strong>Portability</strong>: Medical records follow patients across providers</li>
</ol>
<h3 id="business-benefits">
  
  
    <a href="#business-benefits" class="anchor-heading" aria-labelledby="business-benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Business Benefits
  
  
</h3>
    

<p><strong>For Healthcare Providers</strong>:</p>
<ul>
  <li><strong>Reduced Costs</strong>: Eliminate expensive interoperability infrastructure</li>
  <li><strong>Faster Care</strong>: Instant access to patient history</li>
  <li><strong>Compliance</strong>: Automated HIPAA audit trails</li>
  <li><strong>Better Outcomes</strong>: Complete medical history improves care quality</li>
</ul>

<p><strong>For Patients</strong>:</p>
<ul>
  <li><strong>Privacy</strong>: Control what medical information is shared</li>
  <li><strong>Convenience</strong>: Access medical records from any device</li>
  <li><strong>Portability</strong>: Records work across all healthcare providers</li>
  <li><strong>Transparency</strong>: See who accessed their data and when</li>
</ul>

<p><strong>For Healthcare Systems</strong>:</p>
<ul>
  <li><strong>Interoperability</strong>: Standard format works across all systems</li>
  <li><strong>Security</strong>: Reduced breach risk with decentralized storage</li>
  <li><strong>Innovation</strong>: Enable new patient-centric applications</li>
  <li><strong>Compliance</strong>: Automated regulatory compliance</li>
</ul>
<h3 id="roi-considerations">
  
  
    <a href="#roi-considerations" class="anchor-heading" aria-labelledby="roi-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ROI Considerations
  
  
</h3>
    

<ul>
  <li><strong>Interoperability Savings</strong>: 40-60% reduction in integration costs</li>
  <li><strong>Compliance</strong>: 50% reduction in HIPAA compliance costs</li>
  <li><strong>Patient Safety</strong>: Reduced medical errors save lives and costs</li>
  <li><strong>Efficiency</strong>: 10x faster medical record access</li>
  <li><strong>Innovation</strong>: Enable new revenue streams from patient data applications</li>
</ul>
<h2 id="understanding-the-problem">
  
  
    <a href="#understanding-the-problem" class="anchor-heading" aria-labelledby="understanding-the-problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding the Problem
  
  
</h2>
    

<p>Healthcare data management faces several critical challenges:</p>

<ol>
  <li><strong>Data Silos</strong>: Medical records are trapped in proprietary systems</li>
  <li><strong>Privacy Concerns</strong>: Patients have little control over their data</li>
  <li><strong>Interoperability</strong>: Different systems can’t share data easily</li>
  <li><strong>Security</strong>: Centralized databases are vulnerable to breaches</li>
  <li><strong>Compliance</strong>: Complex HIPAA requirements are difficult to meet</li>
  <li><strong>Patient Access</strong>: Patients struggle to access their own records</li>
  <li><strong>Consent Management</strong>: No granular consent for data sharing</li>
</ol>
<h3 id="real-world-pain-points">
  
  
    <a href="#real-world-pain-points" class="anchor-heading" aria-labelledby="real-world-pain-points"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-World Pain Points
  
  
</h3>
    

<p><strong>Example 1: Emergency Care</strong></p>
<ul>
  <li>Current: Medical history unavailable, leading to delayed or incorrect treatment</li>
  <li>Problem: Life-threatening delays, medical errors</li>
  <li>Solution: Instant access to critical medical credentials (allergies, medications, conditions)</li>
</ul>

<p><strong>Example 2: Specialist Referrals</strong></p>
<ul>
  <li>Current: Paper records or incomplete digital transfers</li>
  <li>Problem: Specialists lack complete medical history</li>
  <li>Solution: Patient-controlled sharing of relevant medical credentials</li>
</ul>

<p><strong>Example 3: Insurance Claims</strong></p>
<ul>
  <li>Current: Manual submission of medical records</li>
  <li>Problem: Slow processing, privacy concerns</li>
  <li>Solution: Verifiable credentials with selective disclosure</li>
</ul>
<h2 id="how-it-works-healthcare-credential-flow">
  
  
    <a href="#how-it-works-healthcare-credential-flow" class="anchor-heading" aria-labelledby="how-it-works-healthcare-credential-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How It Works: Healthcare Credential Flow
  
  
</h2>
    

<pre><code class="language-mermaid">flowchart TD
    A["Healthcare Provider&lt;br/&gt;Creates Provider DID&lt;br/&gt;Issues Medical Credentials&lt;br/&gt;Manages Patient Consent"] --&gt;|issues credentials| B["Medical Credentials&lt;br/&gt;Prescription&lt;br/&gt;Lab Results&lt;br/&gt;Vaccination Record&lt;br/&gt;Diagnosis&lt;br/&gt;Proof cryptographic"]
    B --&gt;|stored in patient wallet| C["Patient Wallet&lt;br/&gt;Stores all medical credentials&lt;br/&gt;Manages consent&lt;br/&gt;Creates selective presentations"]
    C --&gt;|shares with consent| D["Healthcare Provider New&lt;br/&gt;Receives presentation&lt;br/&gt;Verifies credentials&lt;br/&gt;Accesses authorized data"]

    style A fill:#1976d2,stroke:#0d47a1,stroke-width:2px,color:#fff
    style B fill:#f57c00,stroke:#e65100,stroke-width:2px,color:#fff
    style C fill:#388e3c,stroke:#1b5e20,stroke-width:2px,color:#fff
    style D fill:#c2185b,stroke:#880e4f,stroke-width:2px,color:#fff
</code></pre>
<h2 id="key-concepts">
  
  
    <a href="#key-concepts" class="anchor-heading" aria-labelledby="key-concepts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Concepts
  
  
</h2>
    
<h3 id="medical-credential-types">
  
  
    <a href="#medical-credential-types" class="anchor-heading" aria-labelledby="medical-credential-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Medical Credential Types
  
  
</h3>
    

<ol>
  <li><strong>Prescription Credential</strong>: Medication prescriptions with dosage, frequency, duration</li>
  <li><strong>Lab Result Credential</strong>: Laboratory test results with reference ranges</li>
  <li><strong>Vaccination Credential</strong>: Vaccination records with dates, types, lot numbers</li>
  <li><strong>Diagnosis Credential</strong>: Medical diagnoses with ICD codes</li>
  <li><strong>Treatment Credential</strong>: Treatment plans and procedures</li>
  <li><strong>Consent Credential</strong>: Patient consent for data sharing</li>
</ol>
<h3 id="patient-privacy">
  
  
    <a href="#patient-privacy" class="anchor-heading" aria-labelledby="patient-privacy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Patient Privacy
  
  
</h3>
    

<ul>
  <li><strong>Selective Disclosure</strong>: Share only specific fields (e.g., vaccination status without dates)</li>
  <li><strong>Consent Management</strong>: Granular consent for different data types</li>
  <li><strong>Access Logging</strong>: Track who accessed what data and when</li>
  <li><strong>Revocation</strong>: Revoke consent at any time</li>
</ul>
<h3 id="hipaa-compliance">
  
  
    <a href="#hipaa-compliance" class="anchor-heading" aria-labelledby="hipaa-compliance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> HIPAA Compliance
  
  
</h3>
    

<ul>
  <li><strong>Audit Trails</strong>: Immutable records of data access</li>
  <li><strong>Minimum Necessary</strong>: Share only required information</li>
  <li><strong>Patient Rights</strong>: Patients control their data</li>
  <li><strong>Security</strong>: Cryptographic protection of sensitive data</li>
</ul>
<h2 id="prerequisites">
  
  
    <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites
  
  
</h2>
    

<ul>
  <li>Java 21+</li>
  <li>Kotlin 2.2.0+</li>
  <li>Gradle 8.5+</li>
  <li>Basic understanding of Kotlin and coroutines</li>
  <li>Familiarity with healthcare data concepts (HL7, FHIR helpful but not required)</li>
  <li>Understanding of HIPAA basics (helpful but not required)</li>
</ul>
<h2 id="step-1-add-dependencies">
  
  
    <a href="#step-1-add-dependencies" class="anchor-heading" aria-labelledby="step-1-add-dependencies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Add Dependencies
  
  
</h2>
    

<p>Add TrustWeave dependencies to your <code class="language-plaintext highlighter-rouge">build.gradle.kts</code>. These cover DID management, credential issuance, wallet storage, and the in-memory services used in the healthcare walkthrough.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nf">dependencies</span> <span class="p">{</span>
    <span class="c1">// Core TrustWeave modules</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-core:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-json:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-kms:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-did:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-anchor:1.0.0-SNAPSHOT"</span><span class="p">)</span>

    <span class="c1">// Test kit for in-memory implementations</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-testkit:1.0.0-SNAPSHOT"</span><span class="p">)</span>

    <span class="c1">// Kotlinx Serialization</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-serialization-json:1.6.0"</span><span class="p">)</span>

    <span class="c1">// Coroutines</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Result:</strong> Once the dependencies sync you can run every snippet in this guide without additional setup.</p>
<h2 id="step-2-complete-example">
  
  
    <a href="#step-2-complete-example" class="anchor-heading" aria-labelledby="step-2-complete-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Complete Example
  
  
</h2>
    

<p>Here’s the full healthcare credential management flow. Execute it first to see the big picture, then read on for step-by-step explanations.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiableCredential</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiablePresentation</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialIssuanceOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialVerificationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.PresentationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.issuer.CredentialIssuer</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.verifier.CredentialVerifier</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.Ed25519ProofGenerator</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.ProofGeneratorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.credential.InMemoryWallet</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.did.DidKeyMockMethod</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.kms.InMemoryKeyManagementService</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.anchor.InMemoryBlockchainAnchorClient</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.BlockchainAnchorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.anchorTyped</span>
<span class="k">import</span> <span class="nn">com.trustweave.did.DidMethodRegistry</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.Serializable</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.Json</span>
<span class="k">import</span> <span class="nn">java.time.Instant</span>
<span class="k">import</span> <span class="nn">java.time.temporal.ChronoUnit</span>

<span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">ConsentRecord</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">patientDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">providerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">dataTypes</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span>
    <span class="kd">val</span> <span class="py">purpose</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">expirationDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">credentialDigest</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"=== Healthcare &amp; Medical Records Scenario ===\n"</span><span class="p">)</span>

    <span class="c1">// Step 1: Setup services</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Step 1: Setting up services..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">hospitalKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">patientKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">specialistKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">didMethod</span> <span class="p">=</span> <span class="nc">DidKeyMockMethod</span><span class="p">(</span><span class="n">hospitalKms</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">didRegistry</span> <span class="p">=</span> <span class="nc">DidMethodRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">didMethod</span><span class="p">)</span> <span class="p">}</span>

    <span class="c1">// Setup blockchain for anchoring critical records</span>
    <span class="kd">val</span> <span class="py">anchorClient</span> <span class="p">=</span> <span class="nc">InMemoryBlockchainAnchorClient</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="nf">emptyMap</span><span class="p">())</span>
    <span class="kd">val</span> <span class="py">blockchainRegistry</span> <span class="p">=</span> <span class="nc">BlockchainAnchorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
        <span class="nf">register</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="n">anchorClient</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Step 2: Create DIDs</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 2: Creating DIDs..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">hospitalDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Hospital DID: ${hospitalDid.id}"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">patientDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Patient DID: ${patientDid.id}"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">specialistDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Specialist DID: ${specialistDid.id}"</span><span class="p">)</span>

    <span class="c1">// Step 3: Create patient wallet</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 3: Creating patient wallet..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">patientWallet</span> <span class="p">=</span> <span class="nc">InMemoryWallet</span><span class="p">(</span>
        <span class="n">walletDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span>
    <span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Patient wallet created: ${patientWallet.walletId}"</span><span class="p">)</span>

    <span class="c1">// Step 4: Issue prescription credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 4: Issuing prescription credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">prescriptionCredential</span> <span class="p">=</span> <span class="nf">createPrescriptionCredential</span><span class="p">(</span>
        <span class="n">patientDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">providerDid</span> <span class="p">=</span> <span class="n">hospitalDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">medication</span> <span class="p">=</span> <span class="s">"Lisinopril"</span><span class="p">,</span>
        <span class="n">dosage</span> <span class="p">=</span> <span class="s">"10mg"</span><span class="p">,</span>
        <span class="n">frequency</span> <span class="p">=</span> <span class="s">"Once daily"</span><span class="p">,</span>
        <span class="n">duration</span> <span class="p">=</span> <span class="s">"30 days"</span><span class="p">,</span>
        <span class="n">prescribingDoctor</span> <span class="p">=</span> <span class="s">"Dr. Smith"</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">hospitalKey</span> <span class="p">=</span> <span class="n">hospitalKms</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span><span class="s">"Ed25519"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">proofGenerator</span> <span class="p">=</span> <span class="nc">Ed25519ProofGenerator</span><span class="p">(</span>
        <span class="n">signer</span> <span class="p">=</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">hospitalKms</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">keyId</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="p">},</span>
        <span class="n">getPublicKeyId</span> <span class="p">=</span> <span class="p">{</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">hospitalKey</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">proofRegistry</span> <span class="p">=</span> <span class="nc">ProofGeneratorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">proofGenerator</span><span class="p">)</span> <span class="p">}</span>

    <span class="kd">val</span> <span class="py">credentialIssuer</span> <span class="p">=</span> <span class="nc">CredentialIssuer</span><span class="p">(</span>
        <span class="n">proofGenerator</span> <span class="p">=</span> <span class="n">proofGenerator</span><span class="p">,</span>
        <span class="n">resolveDid</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">},</span>
        <span class="n">proofRegistry</span> <span class="p">=</span> <span class="n">proofRegistry</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">issuedPrescription</span> <span class="p">=</span> <span class="n">credentialIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">prescriptionCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">hospitalDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">hospitalKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Prescription credential issued:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Medication: Lisinopril 10mg"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Has proof: ${issuedPrescription.proof != null}"</span><span class="p">)</span>

    <span class="c1">// Step 5: Issue lab results credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 5: Issuing lab results credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">labResultsCredential</span> <span class="p">=</span> <span class="nf">createLabResultsCredential</span><span class="p">(</span>
        <span class="n">patientDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">providerDid</span> <span class="p">=</span> <span class="n">hospitalDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">testName</span> <span class="p">=</span> <span class="s">"Complete Blood Count"</span><span class="p">,</span>
        <span class="n">results</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"WBC"</span> <span class="n">to</span> <span class="s">"7.2"</span><span class="p">,</span>
            <span class="s">"RBC"</span> <span class="n">to</span> <span class="s">"4.8"</span><span class="p">,</span>
            <span class="s">"Hemoglobin"</span> <span class="n">to</span> <span class="s">"14.5"</span><span class="p">,</span>
            <span class="s">"Platelets"</span> <span class="n">to</span> <span class="s">"250"</span>
        <span class="p">),</span>
        <span class="n">referenceRanges</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"WBC"</span> <span class="n">to</span> <span class="s">"4.0-11.0"</span><span class="p">,</span>
            <span class="s">"RBC"</span> <span class="n">to</span> <span class="s">"4.5-5.5"</span><span class="p">,</span>
            <span class="s">"Hemoglobin"</span> <span class="n">to</span> <span class="s">"12.0-16.0"</span><span class="p">,</span>
            <span class="s">"Platelets"</span> <span class="n">to</span> <span class="s">"150-450"</span>
        <span class="p">),</span>
        <span class="n">labDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">issuedLabResults</span> <span class="p">=</span> <span class="n">credentialIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">labResultsCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">hospitalDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">hospitalKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Lab results credential issued"</span><span class="p">)</span>

    <span class="c1">// Step 6: Issue vaccination credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 6: Issuing vaccination credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">vaccinationCredential</span> <span class="p">=</span> <span class="nf">createVaccinationCredential</span><span class="p">(</span>
        <span class="n">patientDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">providerDid</span> <span class="p">=</span> <span class="n">hospitalDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">vaccineType</span> <span class="p">=</span> <span class="s">"COVID-19"</span><span class="p">,</span>
        <span class="n">manufacturer</span> <span class="p">=</span> <span class="s">"Pfizer-BioNTech"</span><span class="p">,</span>
        <span class="n">lotNumber</span> <span class="p">=</span> <span class="s">"EW0167"</span><span class="p">,</span>
        <span class="n">administrationDate</span> <span class="p">=</span> <span class="s">"2023-03-15"</span><span class="p">,</span>
        <span class="n">administeringProvider</span> <span class="p">=</span> <span class="s">"Dr. Johnson"</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">issuedVaccination</span> <span class="p">=</span> <span class="n">credentialIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">vaccinationCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">hospitalDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">hospitalKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Vaccination credential issued"</span><span class="p">)</span>

    <span class="c1">// Step 7: Store credentials in patient wallet</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 7: Storing credentials in patient wallet..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">prescriptionId</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">issuedPrescription</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">labResultsId</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">issuedLabResults</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">vaccinationId</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">issuedVaccination</span><span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Stored ${patientWallet.list().size} medical credentials"</span><span class="p">)</span>

    <span class="c1">// Step 8: Organize credentials</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 8: Organizing credentials..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">prescriptionsCollection</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"Prescriptions"</span><span class="p">,</span>
        <span class="n">description</span> <span class="p">=</span> <span class="s">"Medication prescriptions"</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">labResultsCollection</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"Lab Results"</span><span class="p">,</span>
        <span class="n">description</span> <span class="p">=</span> <span class="s">"Laboratory test results"</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">vaccinationsCollection</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"Vaccinations"</span><span class="p">,</span>
        <span class="n">description</span> <span class="p">=</span> <span class="s">"Vaccination records"</span>
    <span class="p">)</span>

    <span class="n">patientWallet</span><span class="p">.</span><span class="nf">addToCollection</span><span class="p">(</span><span class="n">prescriptionId</span><span class="p">,</span> <span class="n">prescriptionsCollection</span><span class="p">)</span>
    <span class="n">patientWallet</span><span class="p">.</span><span class="nf">addToCollection</span><span class="p">(</span><span class="n">labResultsId</span><span class="p">,</span> <span class="n">labResultsCollection</span><span class="p">)</span>
    <span class="n">patientWallet</span><span class="p">.</span><span class="nf">addToCollection</span><span class="p">(</span><span class="n">vaccinationId</span><span class="p">,</span> <span class="n">vaccinationsCollection</span><span class="p">)</span>

    <span class="c1">// Tag credentials</span>
    <span class="n">patientWallet</span><span class="p">.</span><span class="nf">tagCredential</span><span class="p">(</span><span class="n">prescriptionId</span><span class="p">,</span> <span class="nf">setOf</span><span class="p">(</span><span class="s">"medication"</span><span class="p">,</span> <span class="s">"prescription"</span><span class="p">,</span> <span class="s">"active"</span><span class="p">))</span>
    <span class="n">patientWallet</span><span class="p">.</span><span class="nf">tagCredential</span><span class="p">(</span><span class="n">labResultsId</span><span class="p">,</span> <span class="nf">setOf</span><span class="p">(</span><span class="s">"lab"</span><span class="p">,</span> <span class="s">"test-results"</span><span class="p">,</span> <span class="s">"blood-work"</span><span class="p">))</span>
    <span class="n">patientWallet</span><span class="p">.</span><span class="nf">tagCredential</span><span class="p">(</span><span class="n">vaccinationId</span><span class="p">,</span> <span class="nf">setOf</span><span class="p">(</span><span class="s">"vaccination"</span><span class="p">,</span> <span class="s">"immunization"</span><span class="p">,</span> <span class="s">"covid-19"</span><span class="p">))</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Created ${patientWallet.listCollections().size} collections"</span><span class="p">)</span>

    <span class="c1">// Step 9: Create consent for data sharing</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 9: Creating consent credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">consentCredential</span> <span class="p">=</span> <span class="nf">createConsentCredential</span><span class="p">(</span>
        <span class="n">patientDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">providerDid</span> <span class="p">=</span> <span class="n">specialistDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">authorizedDataTypes</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"lab-results"</span><span class="p">,</span> <span class="s">"diagnosis"</span><span class="p">),</span>
        <span class="n">purpose</span> <span class="p">=</span> <span class="s">"Specialist consultation"</span><span class="p">,</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">DAYS</span><span class="p">).</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">issuedConsent</span> <span class="p">=</span> <span class="n">credentialIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">consentCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span> <span class="c1">// Patient issues their own consent</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">patientKms</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span><span class="s">"Ed25519"</span><span class="p">).</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">consentId</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">issuedConsent</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Consent credential created and stored"</span><span class="p">)</span>

    <span class="c1">// Step 10: Create selective disclosure presentation</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 10: Creating selective disclosure presentation..."</span><span class="p">)</span>
    <span class="c1">// Patient shares only lab results with specialist (not prescriptions or full vaccination details)</span>
    <span class="kd">val</span> <span class="py">selectivePresentation</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createSelectiveDisclosure</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">labResultsId</span><span class="p">),</span>
        <span class="n">disclosedFields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
            <span class="s">"testName"</span><span class="p">,</span>
            <span class="s">"results.WBC"</span><span class="p">,</span>
            <span class="s">"results.RBC"</span><span class="p">,</span>
            <span class="s">"results.Hemoglobin"</span>
            <span class="c1">// Platelets and reference ranges NOT disclosed</span>
        <span class="p">),</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"specialist-consultation-${Instant.now().toEpochMilli()}"</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Selective disclosure presentation created:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Shared: Lab results (partial)"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Not shared: Prescriptions, full vaccination details"</span><span class="p">)</span>

    <span class="c1">// Step 11: Verify credentials</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 11: Verifying medical credentials..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">verifier</span> <span class="p">=</span> <span class="nc">CredentialVerifier</span><span class="p">(</span>
        <span class="n">didResolver</span> <span class="p">=</span> <span class="nc">CredentialDidResolver</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span>
            <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">).</span><span class="nf">toCredentialDidResolution</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">prescriptionVerification</span> <span class="p">=</span> <span class="n">verifier</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">issuedPrescription</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialVerificationOptions</span><span class="p">(</span>
            <span class="n">checkRevocation</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
            <span class="n">checkExpiration</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
            <span class="n">validateSchema</span> <span class="p">=</span> <span class="k">true</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">prescriptionVerification</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Prescription credential is valid!"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Prescription verification failed:"</span><span class="p">)</span>
        <span class="n">prescriptionVerification</span><span class="p">.</span><span class="n">errors</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="s">"  - $it"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Step 12: Anchor critical records to blockchain</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 12: Anchoring critical records to blockchain..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">prescriptionDigest</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
        <span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span>
            <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">issuedPrescription</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">consentRecord</span> <span class="p">=</span> <span class="nc">ConsentRecord</span><span class="p">(</span>
        <span class="n">patientDid</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">providerDid</span> <span class="p">=</span> <span class="n">specialistDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">dataTypes</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"lab-results"</span><span class="p">,</span> <span class="s">"diagnosis"</span><span class="p">),</span>
        <span class="n">purpose</span> <span class="p">=</span> <span class="s">"Specialist consultation"</span><span class="p">,</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">90</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">DAYS</span><span class="p">).</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">credentialDigest</span> <span class="p">=</span> <span class="n">prescriptionDigest</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">anchorResult</span> <span class="p">=</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="nf">anchorTyped</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">=</span> <span class="n">consentRecord</span><span class="p">,</span>
        <span class="n">serializer</span> <span class="p">=</span> <span class="nc">ConsentRecord</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
        <span class="n">targetChainId</span> <span class="p">=</span> <span class="s">"eip155:1"</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Consent record anchored:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Transaction hash: ${anchorResult.ref.txHash}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Provides HIPAA audit trail"</span><span class="p">)</span>

    <span class="c1">// Step 13: Query medical credentials</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 13: Querying medical credentials..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">activePrescriptions</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"PrescriptionCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Active prescriptions: ${activePrescriptions.size}"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">recentLabResults</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"LabResultsCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Recent lab results: ${recentLabResults.size}"</span><span class="p">)</span>

    <span class="c1">// Step 14: Wallet statistics</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 14: Patient wallet statistics..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">stats</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">getStatistics</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"""
        Total medical credentials: ${stats.totalCredentials}
        Valid credentials: ${stats.validCredentials}
        Collections: ${stats.collectionsCount}
        Tags: ${stats.tagsCount}
    """</span><span class="p">.</span><span class="nf">trimIndent</span><span class="p">())</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"\n=== Scenario Complete ==="</span><span class="p">)</span>
<span class="p">}</span>

<span class="p">**</span><span class="nc">Result</span><span class="p">:**</span> <span class="nc">The</span> <span class="n">program</span> <span class="n">prints</span> <span class="n">each</span> <span class="n">milestone</span><span class="err">—</span><span class="nc">DID</span> <span class="n">creation</span><span class="p">,</span> <span class="n">issuance</span><span class="p">,</span> <span class="n">wallet</span> <span class="n">storage</span><span class="p">,</span> <span class="n">verification</span><span class="p">,</span> <span class="n">anchoring</span><span class="err">—</span><span class="n">ending</span> <span class="n">with</span> <span class="n">a</span> <span class="n">success</span> <span class="n">message</span><span class="p">.</span> <span class="nc">Use</span> <span class="n">that</span> <span class="n">console</span> <span class="n">output</span> <span class="k">as</span> <span class="n">your</span> <span class="n">baseline</span> <span class="k">when</span> <span class="n">customising</span> <span class="n">the</span> <span class="n">scenario</span><span class="p">.</span>

<span class="k">fun</span> <span class="nf">createPrescriptionCredential</span><span class="p">(</span>
    <span class="n">patientDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">providerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">medication</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">dosage</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">frequency</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">duration</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">prescribingDoctor</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://hospital.example.com/prescriptions/${patientDid.substringAfterLast("</span><span class="p">:</span><span class="s">")}-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"PrescriptionCredential"</span><span class="p">,</span> <span class="s">"MedicalCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">providerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">patientDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"prescription"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"medication"</span><span class="p">,</span> <span class="n">medication</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dosage"</span><span class="p">,</span> <span class="n">dosage</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"frequency"</span><span class="p">,</span> <span class="n">frequency</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"duration"</span><span class="p">,</span> <span class="n">duration</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"prescribingDoctor"</span><span class="p">,</span> <span class="n">prescribingDoctor</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"prescriptionDate"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">DAYS</span><span class="p">).</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/prescription.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">createLabResultsCredential</span><span class="p">(</span>
    <span class="n">patientDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">providerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">testName</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">results</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;,</span>
    <span class="n">referenceRanges</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;,</span>
    <span class="n">labDate</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://hospital.example.com/lab-results/${patientDid.substringAfterLast("</span><span class="p">:</span><span class="s">")}-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"LabResultsCredential"</span><span class="p">,</span> <span class="s">"MedicalCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">providerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">patientDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"labResults"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"testName"</span><span class="p">,</span> <span class="n">testName</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"labDate"</span><span class="p">,</span> <span class="n">labDate</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"results"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                    <span class="n">results</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">-&gt;</span>
                        <span class="nf">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">})</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"referenceRanges"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                    <span class="n">referenceRanges</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">-&gt;</span>
                        <span class="nf">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">})</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Lab results don't expire</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/lab-results.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">createVaccinationCredential</span><span class="p">(</span>
    <span class="n">patientDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">providerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">vaccineType</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">manufacturer</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">lotNumber</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">administrationDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">administeringProvider</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://hospital.example.com/vaccinations/${patientDid.substringAfterLast("</span><span class="p">:</span><span class="s">")}-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"VaccinationCredential"</span><span class="p">,</span> <span class="s">"MedicalCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">providerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">patientDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"vaccination"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"vaccineType"</span><span class="p">,</span> <span class="n">vaccineType</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"manufacturer"</span><span class="p">,</span> <span class="n">manufacturer</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"lotNumber"</span><span class="p">,</span> <span class="n">lotNumber</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"administrationDate"</span><span class="p">,</span> <span class="n">administrationDate</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"administeringProvider"</span><span class="p">,</span> <span class="n">administeringProvider</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Vaccination records don't expire</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/vaccination.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">createConsentCredential</span><span class="p">(</span>
    <span class="n">patientDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">providerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">authorizedDataTypes</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span>
    <span class="n">purpose</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">expirationDate</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://patient.example.com/consents/${patientDid.substringAfterLast("</span><span class="p">:</span><span class="s">")}-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"ConsentCredential"</span><span class="p">,</span> <span class="s">"MedicalCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">,</span> <span class="c1">// Patient issues their own consent</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">patientDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"consent"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"providerDid"</span><span class="p">,</span> <span class="n">providerDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"authorizedDataTypes"</span><span class="p">,</span> <span class="n">authorizedDataTypes</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"purpose"</span><span class="p">,</span> <span class="n">purpose</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"consentDate"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"expirationDate"</span><span class="p">,</span> <span class="n">expirationDate</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="n">expirationDate</span><span class="p">,</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/consent.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="extensive-step-by-step-breakdown">
  
  
    <a href="#extensive-step-by-step-breakdown" class="anchor-heading" aria-labelledby="extensive-step-by-step-breakdown"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Extensive Step-by-Step Breakdown
  
  
</h2>
    
<h3 id="step-1-setup-and-initialization">
  
  
    <a href="#step-1-setup-and-initialization" class="anchor-heading" aria-labelledby="step-1-setup-and-initialization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Setup and Initialization
  
  
</h3>
    

<p><strong>Purpose</strong>: Initialize healthcare credential system with proper key management.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Multiple KMS Instances</strong>: Separate key management for hospital, patient, and specialist ensures proper key isolation</li>
  <li><strong>DID Method Registration</strong>: Register DID method for creating identities</li>
  <li><strong>Blockchain Setup</strong>: Initialize blockchain client for anchoring critical records (HIPAA audit trail)</li>
</ol>

<p><strong>Why This Matters</strong>: Healthcare data requires the highest security standards. Proper initialization ensures cryptographic security and auditability.</p>
<h3 id="step-2-create-healthcare-entity-dids">
  
  
    <a href="#step-2-create-healthcare-entity-dids" class="anchor-heading" aria-labelledby="step-2-create-healthcare-entity-dids"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Create Healthcare Entity DIDs
  
  
</h3>
    

<p><strong>Purpose</strong>: Establish verifiable identities for all healthcare participants.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ul>
  <li><strong>Hospital DID</strong>: Represents healthcare institution, used to issue medical credentials</li>
  <li><strong>Patient DID</strong>: Represents patient, owns medical credentials</li>
  <li><strong>Specialist DID</strong>: Represents specialist provider who may need access to patient data</li>
</ul>

<p><strong>Key Considerations</strong>:</p>
<ul>
  <li>DIDs provide persistent, verifiable identities</li>
  <li>No central registry required</li>
  <li>Works across different healthcare systems</li>
  <li>Cryptographic proof of identity</li>
</ul>
<h3 id="step-3-create-patient-wallet">
  
  
    <a href="#step-3-create-patient-wallet" class="anchor-heading" aria-labelledby="step-3-create-patient-wallet"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3: Create Patient Wallet
  
  
</h3>
    

<p><strong>Purpose</strong>: Provide secure storage for patient’s medical credentials.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ul>
  <li>Patient wallet stores all medical credentials</li>
  <li>Provides organization capabilities (collections, tags)</li>
  <li>Enables selective disclosure</li>
  <li>Patient controls access</li>
</ul>

<p><strong>Privacy Benefits</strong>:</p>
<ul>
  <li>Patient owns their data</li>
  <li>Can revoke access at any time</li>
  <li>Selective disclosure minimizes data exposure</li>
  <li>Audit trail of data access</li>
</ul>
<h3 id="step-4-issue-prescription-credential">
  
  
    <a href="#step-4-issue-prescription-credential" class="anchor-heading" aria-labelledby="step-4-issue-prescription-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4: Issue Prescription Credential
  
  
</h3>
    

<p><strong>Purpose</strong>: Create verifiable prescription credential.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Prescription Data</strong>: Medication, dosage, frequency, duration, prescribing doctor</li>
  <li><strong>Credential Structure</strong>: Follows W3C VC standard</li>
  <li><strong>Proof Generation</strong>: Cryptographic signature from hospital</li>
  <li><strong>Expiration</strong>: Prescriptions expire after duration period</li>
</ol>

<p><strong>Security Features</strong>:</p>
<ul>
  <li>Tamper-proof cryptographic proof</li>
  <li>Verifiable issuer (hospital)</li>
  <li>Expiration prevents misuse</li>
  <li>Can be revoked if needed</li>
</ul>
<h3 id="step-5-issue-lab-results-credential">
  
  
    <a href="#step-5-issue-lab-results-credential" class="anchor-heading" aria-labelledby="step-5-issue-lab-results-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5: Issue Lab Results Credential
  
  
</h3>
    

<p><strong>Purpose</strong>: Create verifiable laboratory test results.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Test Information</strong>: Test name, date, results</li>
  <li><strong>Reference Ranges</strong>: Normal ranges for comparison</li>
  <li><strong>No Expiration</strong>: Lab results are permanent records</li>
  <li><strong>Structured Data</strong>: Results in structured format for easy querying</li>
</ol>

<p><strong>Use Cases</strong>:</p>
<ul>
  <li>Share with specialists</li>
  <li>Insurance claims</li>
  <li>Research (with consent)</li>
  <li>Personal health tracking</li>
</ul>
<h3 id="step-6-issue-vaccination-credential">
  
  
    <a href="#step-6-issue-vaccination-credential" class="anchor-heading" aria-labelledby="step-6-issue-vaccination-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 6: Issue Vaccination Credential
  
  
</h3>
    

<p><strong>Purpose</strong>: Create verifiable vaccination record.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Vaccine Information</strong>: Type, manufacturer, lot number</li>
  <li><strong>Administration Details</strong>: Date, provider</li>
  <li><strong>Permanent Record</strong>: Vaccination records don’t expire</li>
  <li><strong>Verification</strong>: Can verify vaccination status without revealing other medical data</li>
</ol>

<p><strong>Privacy-Preserving Use Cases</strong>:</p>
<ul>
  <li>Travel requirements (show vaccination status only)</li>
  <li>Workplace requirements</li>
  <li>School enrollment</li>
  <li>Public health tracking (anonymized)</li>
</ul>
<h3 id="step-7-store-credentials-in-patient-wallet">
  
  
    <a href="#step-7-store-credentials-in-patient-wallet" class="anchor-heading" aria-labelledby="step-7-store-credentials-in-patient-wallet"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 7: Store Credentials in Patient Wallet
  
  
</h3>
    

<p><strong>Purpose</strong>: Enable patient to manage their medical records.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ul>
  <li>Store all medical credentials in one place</li>
  <li>Patient has full control</li>
  <li>Can organize and query credentials</li>
  <li>Enables selective sharing</li>
</ul>

<p><strong>Patient Benefits</strong>:</p>
<ul>
  <li>Single source of truth for medical records</li>
  <li>Easy access from any device</li>
  <li>Can share with any provider</li>
  <li>Complete medical history</li>
</ul>
<h3 id="step-8-organize-credentials">
  
  
    <a href="#step-8-organize-credentials" class="anchor-heading" aria-labelledby="step-8-organize-credentials"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 8: Organize Credentials
  
  
</h3>
    

<p><strong>Purpose</strong>: Enable efficient credential management.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Collections</strong>: Group related credentials (prescriptions, lab results, vaccinations)</li>
  <li><strong>Tags</strong>: Add metadata for easy searching</li>
  <li><strong>Organization Benefits</strong>: Quick access to specific credential types</li>
</ol>

<p><strong>Real-World Value</strong>:</p>
<ul>
  <li>Quick access to active prescriptions</li>
  <li>Find lab results by date or type</li>
  <li>Organize by medical condition</li>
  <li>Track vaccination history</li>
</ul>
<h3 id="step-9-create-consent-credential">
  
  
    <a href="#step-9-create-consent-credential" class="anchor-heading" aria-labelledby="step-9-create-consent-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 9: Create Consent Credential
  
  
</h3>
    

<p><strong>Purpose</strong>: Enable granular consent management for data sharing.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Patient-Issued</strong>: Patient creates their own consent credentials</li>
  <li><strong>Granular Control</strong>: Specify which data types can be shared</li>
  <li><strong>Purpose Limitation</strong>: Specify purpose for data use</li>
  <li><strong>Expiration</strong>: Consent expires after specified period</li>
</ol>

<p><strong>HIPAA Compliance</strong>:</p>
<ul>
  <li>Patient controls access (HIPAA requirement)</li>
  <li>Purpose limitation (minimum necessary)</li>
  <li>Expiration ensures consent doesn’t last forever</li>
  <li>Audit trail via blockchain anchoring</li>
</ul>
<h3 id="step-10-create-selective-disclosure-presentation">
  
  
    <a href="#step-10-create-selective-disclosure-presentation" class="anchor-heading" aria-labelledby="step-10-create-selective-disclosure-presentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 10: Create Selective Disclosure Presentation
  
  
</h3>
    

<p><strong>Purpose</strong>: Share only necessary medical information.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Selective Fields</strong>: Share only specific fields (e.g., WBC count, not full lab results)</li>
  <li><strong>Privacy Preservation</strong>: Don’t share sensitive information unnecessarily</li>
  <li><strong>Purpose-Driven</strong>: Share only what’s needed for specific purpose</li>
</ol>

<p><strong>Example</strong>: Share lab results with specialist but not prescriptions or full vaccination details.</p>

<p><strong>Privacy Benefits</strong>:</p>
<ul>
  <li>Minimum necessary disclosure (HIPAA principle)</li>
  <li>Patient controls what’s shared</li>
  <li>Reduces privacy risk</li>
  <li>Enables targeted data sharing</li>
</ul>
<h3 id="step-11-verify-medical-credentials">
  
  
    <a href="#step-11-verify-medical-credentials" class="anchor-heading" aria-labelledby="step-11-verify-medical-credentials"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 11: Verify Medical Credentials
  
  
</h3>
    

<p><strong>Purpose</strong>: Ensure medical credentials are valid before use.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Proof Verification</strong>: Verify cryptographic signature</li>
  <li><strong>Issuer Verification</strong>: Verify healthcare provider DID</li>
  <li><strong>Expiration Check</strong>: Ensure credential hasn’t expired</li>
  <li><strong>Revocation Check</strong>: Verify credential hasn’t been revoked</li>
  <li><strong>Schema Validation</strong>: Validate credential structure</li>
</ol>

<p><strong>Security Importance</strong>:</p>
<ul>
  <li>Prevents use of tampered credentials</li>
  <li>Ensures credentials from trusted providers</li>
  <li>Prevents use of expired prescriptions</li>
  <li>Maintains data integrity</li>
</ul>
<h3 id="step-12-anchor-critical-records-to-blockchain">
  
  
    <a href="#step-12-anchor-critical-records-to-blockchain" class="anchor-heading" aria-labelledby="step-12-anchor-critical-records-to-blockchain"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 12: Anchor Critical Records to Blockchain
  
  
</h3>
    

<p><strong>Purpose</strong>: Create immutable audit trail for HIPAA compliance.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Consent Records</strong>: Anchor consent decisions to blockchain</li>
  <li><strong>Audit Trail</strong>: Provides permanent record of data access</li>
  <li><strong>Non-Repudiation</strong>: Cannot deny consent was given</li>
  <li><strong>Compliance</strong>: Meets HIPAA audit requirements</li>
</ol>

<p><strong>HIPAA Benefits</strong>:</p>
<ul>
  <li>Immutable audit trail</li>
  <li>Timestamped records</li>
  <li>Cannot be tampered with</li>
  <li>Meets regulatory requirements</li>
</ul>
<h3 id="step-13-query-medical-credentials">
  
  
    <a href="#step-13-query-medical-credentials" class="anchor-heading" aria-labelledby="step-13-query-medical-credentials"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 13: Query Medical Credentials
  
  
</h3>
    

<p><strong>Purpose</strong>: Enable efficient credential retrieval.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ul>
  <li>Query by type (prescriptions, lab results, etc.)</li>
  <li>Filter by validity</li>
  <li>Search by tags</li>
  <li>Find credentials by date range</li>
</ul>

<p><strong>Use Cases</strong>:</p>
<ul>
  <li>Find active prescriptions</li>
  <li>Get recent lab results</li>
  <li>Check vaccination status</li>
  <li>Retrieve medical history</li>
</ul>
<h3 id="step-14-wallet-statistics">
  
  
    <a href="#step-14-wallet-statistics" class="anchor-heading" aria-labelledby="step-14-wallet-statistics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 14: Wallet Statistics
  
  
</h3>
    

<p><strong>Purpose</strong>: Provide overview of patient’s medical credentials.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ul>
  <li>Total credentials count</li>
  <li>Valid credentials count</li>
  <li>Collections count</li>
  <li>Tags count</li>
</ul>

<p><strong>Patient Benefits</strong>:</p>
<ul>
  <li>Overview of medical records</li>
  <li>Track credential status</li>
  <li>Monitor data organization</li>
  <li>Health data insights</li>
</ul>
<h2 id="advanced-features">
  
  
    <a href="#advanced-features" class="anchor-heading" aria-labelledby="advanced-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced Features
  
  
</h2>
    
<h3 id="cross-provider-data-sharing">
  
  
    <a href="#cross-provider-data-sharing" class="anchor-heading" aria-labelledby="cross-provider-data-sharing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Cross-Provider Data Sharing
  
  
</h3>
    

<p>Share medical credentials across different healthcare providers:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">shareMedicalDataWithProvider</span><span class="p">(</span>
    <span class="n">patientWallet</span><span class="p">:</span> <span class="nc">Wallet</span><span class="p">,</span>
    <span class="n">targetProviderDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">credentialIds</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span>
    <span class="n">purpose</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiablePresentation</span> <span class="p">{</span>
    <span class="c1">// Create consent first</span>
    <span class="kd">val</span> <span class="py">consent</span> <span class="p">=</span> <span class="nf">createConsentCredential</span><span class="p">(</span>
        <span class="n">patientDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
        <span class="n">providerDid</span> <span class="p">=</span> <span class="n">targetProviderDid</span><span class="p">,</span>
        <span class="n">authorizedDataTypes</span> <span class="p">=</span> <span class="n">credentialIds</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="s">"medical-credential"</span> <span class="p">},</span>
        <span class="n">purpose</span> <span class="p">=</span> <span class="n">purpose</span><span class="p">,</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">DAYS</span><span class="p">).</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="c1">// Create presentation with consent</span>
    <span class="k">return</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createPresentation</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="n">credentialIds</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
            <span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"provider-sharing-${Instant.now().toEpochMilli()}"</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="emergency-access">
  
  
    <a href="#emergency-access" class="anchor-heading" aria-labelledby="emergency-access"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Emergency Access
  
  
</h3>
    

<p>Enable emergency access to critical medical information:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createEmergencyAccessCredential</span><span class="p">(</span>
    <span class="n">patientDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">emergencyProviderDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"EmergencyAccessCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">patientDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"emergencyAccess"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"providerDid"</span><span class="p">,</span> <span class="n">emergencyProviderDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"allowedDataTypes"</span><span class="p">,</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"allergies"</span><span class="p">,</span> <span class="s">"medications"</span><span class="p">,</span> <span class="s">"conditions"</span><span class="p">))</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"purpose"</span><span class="p">,</span> <span class="s">"emergency-care"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"expirationDate"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">HOURS</span><span class="p">).</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">24</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">HOURS</span><span class="p">).</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="medication-adherence-tracking">
  
  
    <a href="#medication-adherence-tracking" class="anchor-heading" aria-labelledby="medication-adherence-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Medication Adherence Tracking
  
  
</h3>
    

<p>Track medication adherence:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createAdherenceCredential</span><span class="p">(</span>
    <span class="n">patientDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">prescriptionId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">adherenceData</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Boolean</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"MedicationAdherenceCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">patientDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">patientDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"prescriptionId"</span><span class="p">,</span> <span class="n">prescriptionId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"adherence"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="n">adherenceData</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">taken</span><span class="p">)</span> <span class="p">-&gt;</span>
                    <span class="nf">put</span><span class="p">(</span><span class="n">date</span><span class="p">,</span> <span class="n">taken</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="real-world-use-cases">
  
  
    <a href="#real-world-use-cases" class="anchor-heading" aria-labelledby="real-world-use-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-World Use Cases
  
  
</h2>
    
<h3 id="1-emergency-care">
  
  
    <a href="#1-emergency-care" class="anchor-heading" aria-labelledby="1-emergency-care"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Emergency Care
  
  
</h3>
    

<p><strong>Scenario</strong>: Patient arrives at emergency room unconscious. Medical staff needs critical information.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createEmergencyMedicalPresentation</span><span class="p">(</span>
    <span class="n">patientWallet</span><span class="p">:</span> <span class="nc">Wallet</span><span class="p">,</span>
    <span class="n">emergencyProviderDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiablePresentation</span> <span class="p">{</span>
    <span class="c1">// Find critical credentials</span>
    <span class="kd">val</span> <span class="py">allergies</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"AllergyCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">medications</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"PrescriptionCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="kd">val</span> <span class="py">conditions</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"DiagnosisCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}</span>

    <span class="c1">// Create emergency access presentation</span>
    <span class="kd">val</span> <span class="py">credentialIds</span> <span class="p">=</span> <span class="p">(</span><span class="n">allergies</span> <span class="p">+</span> <span class="n">medications</span> <span class="p">+</span> <span class="n">conditions</span><span class="p">).</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>

    <span class="k">return</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createPresentation</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="n">credentialIds</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
            <span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"emergency-care-${Instant.now().toEpochMilli()}"</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="2-specialist-referral">
  
  
    <a href="#2-specialist-referral" class="anchor-heading" aria-labelledby="2-specialist-referral"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Specialist Referral
  
  
</h3>
    

<p><strong>Scenario</strong>: Primary care doctor refers patient to specialist. Patient shares relevant medical history.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">shareRelevantMedicalHistory</span><span class="p">(</span>
    <span class="n">patientWallet</span><span class="p">:</span> <span class="nc">Wallet</span><span class="p">,</span>
    <span class="n">specialistDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">condition</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiablePresentation</span> <span class="p">{</span>
    <span class="c1">// Find relevant credentials</span>
    <span class="kd">val</span> <span class="py">relevantCredentials</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"DiagnosisCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">credential</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">diagnosis</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"diagnosis"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
            <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"condition"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
        <span class="n">diagnosis</span><span class="o">?.</span><span class="nf">contains</span><span class="p">(</span><span class="n">condition</span><span class="p">,</span> <span class="n">ignoreCase</span> <span class="p">=</span> <span class="k">true</span><span class="p">)</span> <span class="p">==</span> <span class="k">true</span>
    <span class="p">}</span>

    <span class="c1">// Create selective disclosure presentation</span>
    <span class="k">return</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createSelectiveDisclosure</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="n">relevantCredentials</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">},</span>
        <span class="n">disclosedFields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
            <span class="s">"diagnosis.condition"</span><span class="p">,</span>
            <span class="s">"diagnosis.date"</span><span class="p">,</span>
            <span class="s">"diagnosis.severity"</span>
            <span class="c1">// Treatment details NOT disclosed</span>
        <span class="p">),</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"specialist-referral-${Instant.now().toEpochMilli()}"</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="3-insurance-claims">
  
  
    <a href="#3-insurance-claims" class="anchor-heading" aria-labelledby="3-insurance-claims"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Insurance Claims
  
  
</h3>
    

<p><strong>Scenario</strong>: Patient submits medical claim to insurance company.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createInsuranceClaimPresentation</span><span class="p">(</span>
    <span class="n">patientWallet</span><span class="p">:</span> <span class="nc">Wallet</span><span class="p">,</span>
    <span class="n">insuranceCompanyDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">claimDetails</span><span class="p">:</span> <span class="nc">ClaimDetails</span>
<span class="p">):</span> <span class="nc">VerifiablePresentation</span> <span class="p">{</span>
    <span class="c1">// Find relevant medical credentials</span>
    <span class="kd">val</span> <span class="py">treatmentCredentials</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"TreatmentCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">credential</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">treatmentDate</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"treatment"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
            <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"date"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
        <span class="n">treatmentDate</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            <span class="nc">Instant</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="nf">isAfter</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">claimDetails</span><span class="p">.</span><span class="n">startDate</span><span class="p">))</span> <span class="p">&amp;&amp;</span>
            <span class="nc">Instant</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">it</span><span class="p">).</span><span class="nf">isBefore</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">claimDetails</span><span class="p">.</span><span class="n">endDate</span><span class="p">))</span>
        <span class="p">}</span> <span class="o">?:</span> <span class="k">false</span>
    <span class="p">}</span>

    <span class="c1">// Create presentation with minimal necessary information</span>
    <span class="k">return</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createSelectiveDisclosure</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="n">treatmentCredentials</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">},</span>
        <span class="n">disclosedFields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
            <span class="s">"treatment.procedure"</span><span class="p">,</span>
            <span class="s">"treatment.date"</span><span class="p">,</span>
            <span class="s">"treatment.provider"</span>
            <span class="c1">// Detailed medical information NOT disclosed</span>
        <span class="p">),</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"insurance-claim-${claimDetails.claimId}"</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">ClaimDetails</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">claimId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">startDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">endDate</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="4-telemedicine-authentication">
  
  
    <a href="#4-telemedicine-authentication" class="anchor-heading" aria-labelledby="4-telemedicine-authentication"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Telemedicine Authentication
  
  
</h3>
    

<p><strong>Scenario</strong>: Patient authenticates for telemedicine appointment.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">authenticateForTelemedicine</span><span class="p">(</span>
    <span class="n">patientWallet</span><span class="p">:</span> <span class="nc">Wallet</span><span class="p">,</span>
    <span class="n">telemedicineProviderDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiablePresentation</span> <span class="p">{</span>
    <span class="c1">// Create identity presentation</span>
    <span class="kd">val</span> <span class="py">identityCredential</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"IdentityCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}.</span><span class="nf">firstOrNull</span><span class="p">()</span>

    <span class="c1">// Create appointment-specific presentation</span>
    <span class="k">return</span> <span class="n">patientWallet</span><span class="p">.</span><span class="nf">createPresentation</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOfNotNull</span><span class="p">(</span><span class="n">identityCredential</span><span class="o">?.</span><span class="n">id</span><span class="p">),</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">patientWallet</span><span class="p">.</span><span class="n">holderDid</span><span class="o">!!</span><span class="p">,</span>
            <span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"telemedicine-auth-${Instant.now().toEpochMilli()}"</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="benefits">
  
  
    <a href="#benefits" class="anchor-heading" aria-labelledby="benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Benefits
  
  
</h2>
    

<ol>
  <li><strong>Patient Privacy</strong>: Granular control over medical data sharing</li>
  <li><strong>Interoperability</strong>: Standard format works across all healthcare systems</li>
  <li><strong>Patient Control</strong>: Patients own and control their medical records</li>
  <li><strong>HIPAA Compliance</strong>: Cryptographic proof meets regulatory requirements</li>
  <li><strong>Security</strong>: Decentralized storage reduces breach risk</li>
  <li><strong>Efficiency</strong>: Instant verification without API calls</li>
  <li><strong>Portability</strong>: Medical records follow patients across providers</li>
  <li><strong>Selective Disclosure</strong>: Share only necessary information</li>
  <li><strong>Audit Trail</strong>: Immutable records of data access</li>
  <li><strong>Consent Management</strong>: Granular consent for different data types</li>
</ol>
<h2 id="best-practices">
  
  
    <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices
  
  
</h2>
    

<ol>
  <li><strong>Privacy First</strong>: Always use selective disclosure</li>
  <li><strong>Consent Management</strong>: Get explicit consent before sharing data</li>
  <li><strong>Minimum Necessary</strong>: Share only required information</li>
  <li><strong>Expiration</strong>: Set appropriate expiration dates</li>
  <li><strong>Revocation</strong>: Enable credential revocation</li>
  <li><strong>Audit Logging</strong>: Log all data access</li>
  <li><strong>Schema Validation</strong>: Validate credential structure</li>
  <li><strong>Key Management</strong>: Use secure key storage</li>
  <li><strong>Error Handling</strong>: Handle verification failures gracefully</li>
  <li><strong>Patient Education</strong>: Educate patients on credential management</li>
</ol>
<h2 id="next-steps">
  
  
    <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps
  
  
</h2>
    

<ul>
  <li>Learn about <a href="/trustweave/tutorials/wallet-api-tutorial/">Wallet API Tutorial</a></li>
  <li>Explore <a href="/trustweave/scenarios/professional-identity-scenario/">Professional Identity Scenario</a> for related credential management</li>
  <li>Check out <a href="/trustweave/scenarios/government-digital-identity-scenario/">Government &amp; Digital Identity Scenario</a> for identity verification</li>
  <li>Review <a href="/trustweave/core-concepts/verifiable-credentials/">Core Concepts: Verifiable Credentials</a> for credential details</li>
  <li>Study <a href="/trustweave/core-concepts/wallets/">Core Concepts: Wallets</a> for wallet management</li>
</ul>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with ❤️ by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();

        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
        footer.style.marginTop = 'auto'; // Push to bottom in flexbox layout
        footer.style.zIndex = '0'; // Below search overlay
      }
    }

    // Function to update footer visibility based on search state
    function updateFooterVisibility() {
      const footer = document.querySelector('.site-footer');
      const htmlElement = document.documentElement;

      if (footer && htmlElement) {
        const isSearchActive = htmlElement.classList.contains('search-active');
        if (isSearchActive) {
          // Hide footer when search is active - use multiple methods to ensure it's hidden
          footer.style.display = 'none';
          footer.style.visibility = 'hidden';
          footer.style.opacity = '0';
          footer.style.zIndex = '-999';
          footer.style.pointerEvents = 'none';
        } else {
          // Show footer when search is not active
          footer.style.display = 'block';
          footer.style.visibility = 'visible';
          footer.style.opacity = '1';
          footer.style.marginTop = 'auto';
          footer.style.position = 'relative';
          footer.style.zIndex = '-1';
          footer.style.pointerEvents = 'auto';
        }
      }
    }

    // Monitor search state and hide/show footer appropriately
    const observer = new MutationObserver(function(mutations) {
      updateFooterVisibility();
    });

    // Also listen for input events on search input as a backup
    // This ensures footer is hidden immediately when user starts typing
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      // Use requestAnimationFrame for better performance
      const handleSearchChange = function() {
        requestAnimationFrame(updateFooterVisibility);
      };

      searchInput.addEventListener('input', handleSearchChange);
      searchInput.addEventListener('focus', handleSearchChange);
      searchInput.addEventListener('keydown', handleSearchChange);
    }

    // Observe documentElement (html) for class changes (like search-active)
    // The search script adds 'search-active' to documentElement, not body
    if (document.documentElement) {
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });

      // Initial check
      updateFooterVisibility();
    }
  });
</script>


    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    





<script type="module">
  
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';
  

  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>



  
</body>
</html>

