

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
    .site-nav ul li a {
      background-image: none;
    }

  </style>

  

  
    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Parametric Insurance MGA Implementation Guide with TrustWeave | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Parametric Insurance MGA Implementation Guide with TrustWeave" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="http://localhost:4000/trustweave/scenarios/parametric-insurance-mga-implementation-guide/" />
<meta property="og:url" content="http://localhost:4000/trustweave/scenarios/parametric-insurance-mga-implementation-guide/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Parametric Insurance MGA Implementation Guide with TrustWeave" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Parametric Insurance MGA Implementation Guide with TrustWeave","url":"http://localhost:4000/trustweave/scenarios/parametric-insurance-mga-implementation-guide/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
  
  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }
  
  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }
  
  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }
  
  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }
  
  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');
        
        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });
            
            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');
        
        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';
                
                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                
                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';
                
                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/use-trustweave-facade/" class="nav-list-link">Use TrustWeave Facade for Quick Setup</a></li><li class="nav-list-item"><a href="/trustweave/how-to/configure-trustlayer/" class="nav-list-link">Configure TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li><li class="nav-list-item"><a href="/trustweave/how-to/multi-chain-anchoring/" class="nav-list-link">Multi-Chain Anchoring Patterns</a></li><li class="nav-list-item"><a href="/trustweave/how-to/exchange-credentials/" class="nav-list-link">Exchange Credentials with Multiple Protocols</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li></ul>
  
</nav>




  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="parametric-insurance-mga-implementation-guide-with-trustweave">
  
  
    <a href="#parametric-insurance-mga-implementation-guide-with-trustweave" class="anchor-heading" aria-labelledby="parametric-insurance-mga-implementation-guide-with-trustweave"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Parametric Insurance MGA Implementation Guide with TrustWeave
  
  
</h1>
    

<blockquote>
  <p><strong>Building “Atlas Parametric” - An EO-Driven Parametric Insurance MGA</strong></p>
</blockquote>

<p>This comprehensive guide shows you how to build your parametric insurance MGA solution using TrustWeave as the trust and integrity foundation. This implementation covers SAR flood, heatwave, solar attenuation, hurricane, and drought parametric products with instant payouts and objective EO triggers.</p>
<h2 id="executive-summary">
  
  
    <a href="#executive-summary" class="anchor-heading" aria-labelledby="executive-summary"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Executive Summary
  
  
</h2>
    

<p><strong>What You’re Building:</strong></p>
<ul>
  <li>A parametric insurance MGA (Managing General Agent) platform</li>
  <li>EO-driven triggers (SAR, NDVI, AOD, LST, InSAR)</li>
  <li>Automated 24-72 hour payouts</li>
  <li>Multi-provider EO data acceptance</li>
  <li>Tamper-proof trigger verification</li>
  <li>Regulatory-compliant audit trails</li>
</ul>

<p><strong>Why TrustWeave:</strong></p>
<ul>
  <li><strong>Trust Foundation</strong>: Verifiable Credentials for EO data integrity</li>
  <li><strong>Multi-Provider Support</strong>: Accept data from ESA, Planet, NASA, NOAA without custom integrations</li>
  <li><strong>Blockchain Anchoring</strong>: Tamper-proof trigger records for regulatory compliance</li>
  <li><strong>Standardization</strong>: W3C-compliant format works across all providers</li>
  <li><strong>Automation</strong>: Enable instant payouts with verifiable triggers</li>
</ul>
<h2 id="architecture-overview">
  
  
    <a href="#architecture-overview" class="anchor-heading" aria-labelledby="architecture-overview"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Architecture Overview
  
  
</h2>
    

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre>┌─────────────────────────────────────────────────────────────────┐
│                    Atlas Parametric MGA Platform                │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌──────────────────┐  ┌──────────────────┐  ┌─────────────────┐  │
│  │  EO Data        │  │  Pricing        │  │  Payout        │  │
│  │  Ingestion      │  │  Engine         │  │  Automation    │  │
│  │  (SAR, NDVI,    │  │  (Actuarial)    │  │  (Banking API) │  │
│  │   AOD, LST)     │  │                 │  │                │  │
│  └────────┬────────┘  └────────┬────────┘  └────────┬───────┘  │
│           │                    │                     │          │
│           └────────────────────┼─────────────────────┘          │
│                                │                                 │
│                    ┌───────────▼────────────┐                   │
│                    │   TrustWeave Trust Layer │                   │
│                    │  ┌──────────────────┐  │                   │
│                    │  │ DID Management   │  │                   │
│                    │  │ VC Issuance      │  │                   │
│                    │  │ VC Verification │  │                   │
│                    │  │ Blockchain Anchor│  │                   │
│                    │  │ Data Integrity  │  │                   │
│                    │  └──────────────────┘  │                   │
│                    └───────────┬────────────┘                   │
│                                │                                 │
│  ┌──────────────────┐  ┌────────▼────────┐  ┌──────────────────┐  │
│  │  Broker Portal  │  │  Trigger       │  │  Reinsurer      │  │
│  │  (Distribution)  │  │  Engine        │  │  Dashboard      │  │
│  └──────────────────┘  └────────────────┘  └──────────────────┘  │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="core-components">
  
  
    <a href="#core-components" class="anchor-heading" aria-labelledby="core-components"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Core Components
  
  
</h2>
    
<h3 id="1-trustweave-trust-layer">
  
  
    <a href="#1-trustweave-trust-layer" class="anchor-heading" aria-labelledby="1-trustweave-trust-layer"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. TrustWeave Trust Layer
  
  
</h3>
    

<p>TrustWeave provides:</p>
<ul>
  <li><strong>DID Management</strong>: Identity for insurers, EO providers, reinsurers, brokers</li>
  <li><strong>Verifiable Credentials</strong>: EO data wrapped in VCs for integrity</li>
  <li><strong>Blockchain Anchoring</strong>: Tamper-proof trigger records</li>
  <li><strong>Multi-Provider Support</strong>: Accept EO data from any certified provider</li>
</ul>
<h3 id="2-eo-data-ingestion-pipeline">
  
  
    <a href="#2-eo-data-ingestion-pipeline" class="anchor-heading" aria-labelledby="2-eo-data-ingestion-pipeline"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. EO Data Ingestion Pipeline
  
  
</h3>
    

<p>Processes:</p>
<ul>
  <li>Sentinel-1 SAR (flood detection)</li>
  <li>MODIS/VIIRS LST (heatwave)</li>
  <li>AOD + irradiance (solar attenuation)</li>
  <li>NDVI (drought/agriculture)</li>
  <li>GPM/IMERG (rainfall)</li>
  <li>InSAR (deformation)</li>
</ul>
<h3 id="3-trigger-engine">
  
  
    <a href="#3-trigger-engine" class="anchor-heading" aria-labelledby="3-trigger-engine"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Trigger Engine
  
  
</h3>
    

<p>Evaluates parametric triggers:</p>
<ul>
  <li>Real-time EO data ingestion</li>
  <li>Threshold evaluation</li>
  <li>Tiered payout calculation</li>
  <li>Automatic trigger verification</li>
</ul>
<h3 id="4-pricing-engine">
  
  
    <a href="#4-pricing-engine" class="anchor-heading" aria-labelledby="4-pricing-engine"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Pricing Engine
  
  
</h3>
    

<p>Actuarial pricing:</p>
<ul>
  <li>EO climate archive (20-40 years)</li>
  <li>Hazard-frequency modeling</li>
  <li>Geographic risk scoring</li>
  <li>Reinsurer-approved rates</li>
</ul>
<h3 id="5-payout-automation">
  
  
    <a href="#5-payout-automation" class="anchor-heading" aria-labelledby="5-payout-automation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Payout Automation
  
  
</h3>
    

<p>Automated payouts:</p>
<ul>
  <li>KYC/AML integration</li>
  <li>Banking API integration</li>
  <li>Reinsurer notification</li>
  <li>Audit trail generation</li>
</ul>
<h2 id="implementation-product-suite">
  
  
    <a href="#implementation-product-suite" class="anchor-heading" aria-labelledby="implementation-product-suite"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementation: Product Suite
  
  
</h2>
    
<h3 id="product-1-sar-based-flood-parametric">
  
  
    <a href="#product-1-sar-based-flood-parametric" class="anchor-heading" aria-labelledby="product-1-sar-based-flood-parametric"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Product 1: SAR-Based Flood Parametric
  
  
</h3>
    

<p><strong>Data Sources:</strong> Sentinel-1 SAR + DEM
<strong>Markets:</strong> US (NC, SC, FL, GA)
<strong>Payout Range:</strong> $25k - $5M
<strong>Triggers:</strong> Depth thresholds (20cm, 50cm, 1m)</p>
<h4 id="implementation">
  
  
    <a href="#implementation" class="anchor-heading" aria-labelledby="implementation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementation
  
  
</h4>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.atlasparametric.products.flood</span>

<span class="k">import</span> <span class="nn">com.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">com.trustweave.contract.models.*</span>
<span class="k">import</span> <span class="nn">com.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">com.trustweave.json.DigestUtils</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>
<span class="k">import</span> <span class="nn">java.time.Instant</span>

<span class="cm">/**
 * SAR Flood Parametric Product using Smart Contracts
 * 
 * Uses Sentinel-1 SAR data to detect flood depth and trigger automatic payouts
 */</span>
<span class="kd">class</span> <span class="nc">SarFloodProduct</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">TrustWeave</span><span class="p">:</span> <span class="nc">TrustWeave</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eoProviderDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">{</span>
    
    <span class="cm">/**
     * Create a flood insurance contract
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">createFloodContract</span><span class="p">(</span>
        <span class="n">insurerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">insuredDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">coverageAmount</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
        <span class="n">location</span><span class="p">:</span> <span class="nc">Location</span>
    <span class="p">):</span> <span class="nc">SmartContract</span> <span class="p">{</span>
        
        <span class="kd">val</span> <span class="py">contract</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">contracts</span><span class="p">.</span><span class="nf">draft</span><span class="p">(</span>
            <span class="n">request</span> <span class="p">=</span> <span class="nc">ContractDraftRequest</span><span class="p">(</span>
                <span class="n">contractType</span> <span class="p">=</span> <span class="nc">ContractType</span><span class="p">.</span><span class="nc">Insurance</span><span class="p">,</span>
                <span class="n">executionModel</span> <span class="p">=</span> <span class="nc">ExecutionModel</span><span class="p">.</span><span class="nc">Parametric</span><span class="p">(</span>
                    <span class="n">triggerType</span> <span class="p">=</span> <span class="nc">TriggerType</span><span class="p">.</span><span class="nc">EarthObservation</span><span class="p">,</span>
                    <span class="n">evaluationEngine</span> <span class="p">=</span> <span class="s">"parametric-insurance"</span>
                <span class="p">),</span>
                <span class="n">parties</span> <span class="p">=</span> <span class="nc">ContractParties</span><span class="p">(</span>
                    <span class="n">primaryPartyDid</span> <span class="p">=</span> <span class="n">insurerDid</span><span class="p">,</span>
                    <span class="n">counterpartyDid</span> <span class="p">=</span> <span class="n">insuredDid</span>
                <span class="p">),</span>
                <span class="n">terms</span> <span class="p">=</span> <span class="nc">ContractTerms</span><span class="p">(</span>
                    <span class="n">obligations</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                        <span class="nc">Obligation</span><span class="p">(</span>
                            <span class="n">id</span> <span class="p">=</span> <span class="s">"payout-obligation"</span><span class="p">,</span>
                            <span class="n">partyDid</span> <span class="p">=</span> <span class="n">insurerDid</span><span class="p">,</span>
                            <span class="n">description</span> <span class="p">=</span> <span class="s">"Pay out based on flood depth tier"</span><span class="p">,</span>
                            <span class="n">obligationType</span> <span class="p">=</span> <span class="nc">ObligationType</span><span class="p">.</span><span class="nc">PAYMENT</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">conditions</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                        <span class="nc">ContractCondition</span><span class="p">(</span>
                            <span class="n">id</span> <span class="p">=</span> <span class="s">"flood-threshold-20cm"</span><span class="p">,</span>
                            <span class="n">description</span> <span class="p">=</span> <span class="s">"Flood depth &gt;= 20cm (Tier 1)"</span><span class="p">,</span>
                            <span class="n">conditionType</span> <span class="p">=</span> <span class="nc">ConditionType</span><span class="p">.</span><span class="nc">THRESHOLD</span><span class="p">,</span>
                            <span class="n">expression</span> <span class="p">=</span> <span class="s">"$.floodDepthCm &gt;= 20"</span>
                        <span class="p">),</span>
                        <span class="nc">ContractCondition</span><span class="p">(</span>
                            <span class="n">id</span> <span class="p">=</span> <span class="s">"flood-threshold-50cm"</span><span class="p">,</span>
                            <span class="n">description</span> <span class="p">=</span> <span class="s">"Flood depth &gt;= 50cm (Tier 2)"</span><span class="p">,</span>
                            <span class="n">conditionType</span> <span class="p">=</span> <span class="nc">ConditionType</span><span class="p">.</span><span class="nc">THRESHOLD</span><span class="p">,</span>
                            <span class="n">expression</span> <span class="p">=</span> <span class="s">"$.floodDepthCm &gt;= 50"</span>
                        <span class="p">),</span>
                        <span class="nc">ContractCondition</span><span class="p">(</span>
                            <span class="n">id</span> <span class="p">=</span> <span class="s">"flood-threshold-100cm"</span><span class="p">,</span>
                            <span class="n">description</span> <span class="p">=</span> <span class="s">"Flood depth &gt;= 100cm (Tier 3)"</span><span class="p">,</span>
                            <span class="n">conditionType</span> <span class="p">=</span> <span class="nc">ConditionType</span><span class="p">.</span><span class="nc">THRESHOLD</span><span class="p">,</span>
                            <span class="n">expression</span> <span class="p">=</span> <span class="s">"$.floodDepthCm &gt;= 100"</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">jurisdiction</span> <span class="p">=</span> <span class="s">"US"</span><span class="p">,</span>
                    <span class="n">governingLaw</span> <span class="p">=</span> <span class="s">"State of North Carolina"</span>
                <span class="p">),</span>
                <span class="n">effectiveDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
                <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plusSeconds</span><span class="p">(</span><span class="mi">365</span> <span class="p">*</span> <span class="mi">24</span> <span class="p">*</span> <span class="mi">60</span> <span class="p">*</span> <span class="mi">60</span><span class="p">).</span><span class="nf">toString</span><span class="p">(),</span>
                <span class="n">contractData</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"productType"</span><span class="p">,</span> <span class="s">"SarFlood"</span><span class="p">)</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"coverageAmount"</span><span class="p">,</span> <span class="n">coverageAmount</span><span class="p">)</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"address"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"region"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">region</span><span class="p">)</span>
                    <span class="p">})</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"thresholds"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"tier1Cm"</span><span class="p">,</span> <span class="mf">20.0</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"tier2Cm"</span><span class="p">,</span> <span class="mf">50.0</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"tier3Cm"</span><span class="p">,</span> <span class="mf">100.0</span><span class="p">)</span>
                    <span class="p">})</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"payoutTiers"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"tier1"</span><span class="p">,</span> <span class="mf">0.25</span><span class="p">)</span>  <span class="c1">// 25% of coverage</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"tier2"</span><span class="p">,</span> <span class="mf">0.50</span><span class="p">)</span>  <span class="c1">// 50% of coverage</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"tier3"</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">)</span>   <span class="c1">// 100% of coverage</span>
                    <span class="p">})</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Flood contract draft created: ${contract.id}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">contract</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Bind contract (issue VC and anchor to blockchain)
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">bindFloodContract</span><span class="p">(</span>
        <span class="n">contract</span><span class="p">:</span> <span class="nc">SmartContract</span><span class="p">,</span>
        <span class="n">insurerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">insurerKeyId</span><span class="p">:</span> <span class="nc">String</span>
    <span class="p">):</span> <span class="nc">BoundContract</span> <span class="p">{</span>
        
        <span class="kd">val</span> <span class="py">bound</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">contracts</span><span class="p">.</span><span class="nf">bindContract</span><span class="p">(</span>
            <span class="n">contractId</span> <span class="p">=</span> <span class="n">contract</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">insurerDid</span><span class="p">,</span>
            <span class="n">issuerKeyId</span> <span class="p">=</span> <span class="n">insurerKeyId</span><span class="p">,</span>
            <span class="n">chainId</span> <span class="p">=</span> <span class="s">"algorand:mainnet"</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Contract bound: ${bound.credentialId}, anchored: ${bound.anchorRef.txHash}"</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">bound</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Process SAR flood data and issue verifiable credential
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">processSarFloodData</span><span class="p">(</span>
        <span class="n">location</span><span class="p">:</span> <span class="nc">Location</span><span class="p">,</span>
        <span class="n">sarData</span><span class="p">:</span> <span class="nc">SarFloodMeasurement</span><span class="p">,</span>
        <span class="n">timestamp</span><span class="p">:</span> <span class="nc">Instant</span>
    <span class="p">):</span> <span class="nc">Result</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">trustweaveCatching</span> <span class="p">{</span>
        
        <span class="c1">// Step 1: Create EO data payload</span>
        <span class="kd">val</span> <span class="py">floodData</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"sar-flood-${location.id}-${timestamp.toEpochMilli()}"</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span> <span class="s">"SarFloodMeasurement"</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"address"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">address</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"region"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">region</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"measurement"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"floodDepthCm"</span><span class="p">,</span> <span class="n">sarData</span><span class="p">.</span><span class="n">floodDepthCm</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"floodAreaSqKm"</span><span class="p">,</span> <span class="n">sarData</span><span class="p">.</span><span class="n">floodAreaSqKm</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"confidence"</span><span class="p">,</span> <span class="n">sarData</span><span class="p">.</span><span class="n">confidence</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"source"</span><span class="p">,</span> <span class="s">"Sentinel-1 SAR"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"processingMethod"</span><span class="p">,</span> <span class="s">"SAR Flood Extraction"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"demUsed"</span><span class="p">,</span> <span class="n">sarData</span><span class="p">.</span><span class="n">demUsed</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"quality"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"validationStatus"</span><span class="p">,</span> <span class="s">"validated"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataQuality"</span><span class="p">,</span> <span class="n">sarData</span><span class="p">.</span><span class="n">quality</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">}</span>
        
        <span class="c1">// Step 2: Compute data digest for integrity</span>
        <span class="kd">val</span> <span class="py">dataDigest</span> <span class="p">=</span> <span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span><span class="n">floodData</span><span class="p">)</span>
        
        <span class="c1">// Step 3: Issue verifiable credential for EO data</span>
        <span class="kd">val</span> <span class="py">eoProviderKeyId</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">eoProviderDid</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">getOrThrow</span><span class="p">()</span>
            <span class="p">.</span><span class="n">verificationMethod</span>
            <span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">floodCredential</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">credentials</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
            <span class="n">issuer</span> <span class="p">=</span> <span class="n">eoProviderDid</span><span class="p">,</span>
            <span class="n">subject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"sar-flood-${location.id}-${timestamp.toEpochMilli()}"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataType"</span><span class="p">,</span> <span class="s">"SarFloodMeasurement"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"data"</span><span class="p">,</span> <span class="n">floodData</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataDigest"</span><span class="p">,</span> <span class="n">dataDigest</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"provider"</span><span class="p">,</span> <span class="n">eoProviderDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">},</span>
            <span class="n">config</span> <span class="p">=</span> <span class="nc">IssuanceConfig</span><span class="p">(</span>
                <span class="n">proofType</span> <span class="p">=</span> <span class="nc">ProofType</span><span class="p">.</span><span class="nc">Ed25519Signature2020</span><span class="p">,</span>
                <span class="n">keyId</span> <span class="p">=</span> <span class="n">eoProviderKeyId</span>
            <span class="p">),</span>
            <span class="n">types</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                <span class="s">"VerifiableCredential"</span><span class="p">,</span>
                <span class="s">"EarthObservationCredential"</span><span class="p">,</span>
                <span class="s">"InsuranceOracleCredential"</span><span class="p">,</span>
                <span class="s">"SarFloodCredential"</span>
            <span class="p">)</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="c1">// Step 4: Anchor to blockchain for tamper-proof record</span>
        <span class="kd">val</span> <span class="py">anchorResult</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">blockchains</span><span class="p">.</span><span class="nf">anchor</span><span class="p">(</span>
            <span class="n">data</span> <span class="p">=</span> <span class="n">floodCredential</span><span class="p">,</span>
            <span class="n">serializer</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">chainId</span> <span class="p">=</span> <span class="s">"algorand:mainnet"</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ SAR Flood Credential issued and anchored: ${anchorResult.ref.txHash}"</span><span class="p">)</span>
        
        <span class="n">floodCredential</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Execute contract with flood data
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">executeFloodContract</span><span class="p">(</span>
        <span class="n">contract</span><span class="p">:</span> <span class="nc">SmartContract</span><span class="p">,</span>
        <span class="n">floodCredential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span>
    <span class="p">):</span> <span class="nc">ExecutionResult</span> <span class="p">{</span>
        
        <span class="c1">// Extract flood depth from credential</span>
        <span class="kd">val</span> <span class="py">credentialSubject</span> <span class="p">=</span> <span class="n">floodCredential</span><span class="p">.</span><span class="n">credentialSubject</span>
        <span class="kd">val</span> <span class="py">floodDepthCm</span> <span class="p">=</span> <span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"measurement"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"floodDepthCm"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Flood depth not found in credential"</span><span class="p">)</span>
        
        <span class="c1">// Create execution context with trigger data</span>
        <span class="kd">val</span> <span class="py">executionContext</span> <span class="p">=</span> <span class="nc">ExecutionContext</span><span class="p">(</span>
            <span class="n">triggerData</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"floodDepthCm"</span><span class="p">,</span> <span class="n">floodDepthCm</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"credentialId"</span><span class="p">,</span> <span class="n">floodCredential</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="c1">// Execute contract</span>
        <span class="kd">val</span> <span class="py">result</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">contracts</span><span class="p">.</span><span class="nf">executeContract</span><span class="p">(</span>
            <span class="n">contract</span> <span class="p">=</span> <span class="n">contract</span><span class="p">,</span>
            <span class="n">executionContext</span> <span class="p">=</span> <span class="n">executionContext</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">result</span><span class="p">.</span><span class="n">executed</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Contract executed! Payout triggered for flood depth: ${floodDepthCm}cm"</span><span class="p">)</span>
            <span class="n">result</span><span class="p">.</span><span class="n">outcomes</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">outcome</span> <span class="p">-&gt;</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"   Outcome: ${outcome.description}"</span><span class="p">)</span>
                <span class="n">outcome</span><span class="p">.</span><span class="n">monetaryImpact</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
                    <span class="nf">println</span><span class="p">(</span><span class="s">"   Amount: ${it.amount} ${it.currency}"</span><span class="p">)</span>
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="nf">println</span><span class="p">(</span><span class="s">"⚠️  Contract conditions not met (flood depth: ${floodDepthCm}cm)"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">result</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Data Models</span>
<span class="kd">data class</span> <span class="nc">Location</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">latitude</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">longitude</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">address</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">region</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

<span class="kd">data class</span> <span class="nc">SarFloodMeasurement</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">floodDepthCm</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">floodAreaSqKm</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">confidence</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">demUsed</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">quality</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="product-2-heatwave-parametric">
  
  
    <a href="#product-2-heatwave-parametric" class="anchor-heading" aria-labelledby="product-2-heatwave-parametric"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Product 2: Heatwave Parametric
  
  
</h3>
    

<p><strong>Data Sources:</strong> MODIS LST + ERA5
<strong>Markets:</strong> GCC (Saudi Arabia, UAE)
<strong>Triggers:</strong> &gt; X°C for Y days
<strong>Clients:</strong> Construction, energy, government</p>
<h4 id="implementation-1">
  
  
    <a href="#implementation-1" class="anchor-heading" aria-labelledby="implementation-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementation
  
  
</h4>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.atlasparametric.products.heatwave</span>

<span class="k">import</span> <span class="nn">com.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">com.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">com.trustweave.json.DigestUtils</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>
<span class="k">import</span> <span class="nn">java.time.Instant</span>
<span class="k">import</span> <span class="nn">java.time.Duration</span>

<span class="kd">class</span> <span class="nc">HeatwaveProduct</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">TrustWeave</span><span class="p">:</span> <span class="nc">TrustWeave</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eoProviderDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">{</span>
    
    <span class="cm">/**
     * Process heatwave data from MODIS LST
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">processHeatwaveData</span><span class="p">(</span>
        <span class="n">location</span><span class="p">:</span> <span class="nc">Location</span><span class="p">,</span>
        <span class="n">lstData</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">LstMeasurement</span><span class="p">&gt;,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nc">HeatwaveThreshold</span>
    <span class="p">):</span> <span class="nc">Result</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">trustweaveCatching</span> <span class="p">{</span>
        
        <span class="c1">// Calculate consecutive days above threshold</span>
        <span class="kd">val</span> <span class="py">consecutiveDays</span> <span class="p">=</span> <span class="nf">calculateConsecutiveDays</span><span class="p">(</span><span class="n">lstData</span><span class="p">,</span> <span class="n">threshold</span><span class="p">.</span><span class="n">temperatureC</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">heatwaveData</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"heatwave-${location.id}-${Instant.now().toEpochMilli()}"</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span> <span class="s">"HeatwaveMeasurement"</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"region"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">region</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"measurement"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"maxTemperatureC"</span><span class="p">,</span> <span class="n">lstData</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">temperatureC</span> <span class="p">})</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"avgTemperatureC"</span><span class="p">,</span> <span class="n">lstData</span><span class="p">.</span><span class="nf">average</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">temperatureC</span> <span class="p">})</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"consecutiveDays"</span><span class="p">,</span> <span class="n">consecutiveDays</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"thresholdC"</span><span class="p">,</span> <span class="n">threshold</span><span class="p">.</span><span class="n">temperatureC</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"minDaysRequired"</span><span class="p">,</span> <span class="n">threshold</span><span class="p">.</span><span class="n">minDays</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"source"</span><span class="p">,</span> <span class="s">"MODIS LST + ERA5"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">})</span>
        <span class="p">}</span>
        
        <span class="kd">val</span> <span class="py">dataDigest</span> <span class="p">=</span> <span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span><span class="n">heatwaveData</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">eoProviderKeyId</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">eoProviderDid</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">getOrThrow</span><span class="p">()</span>
            <span class="p">.</span><span class="n">verificationMethod</span>
            <span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">heatwaveCredential</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">credentials</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
            <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">eoProviderDid</span><span class="p">,</span>
            <span class="n">issuerKeyId</span> <span class="p">=</span> <span class="n">eoProviderKeyId</span><span class="p">,</span>
            <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"heatwave-${location.id}-${Instant.now().toEpochMilli()}"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataType"</span><span class="p">,</span> <span class="s">"HeatwaveMeasurement"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"data"</span><span class="p">,</span> <span class="n">heatwaveData</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataDigest"</span><span class="p">,</span> <span class="n">dataDigest</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"provider"</span><span class="p">,</span> <span class="n">eoProviderDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">},</span>
            <span class="n">types</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                <span class="s">"VerifiableCredential"</span><span class="p">,</span>
                <span class="s">"EarthObservationCredential"</span><span class="p">,</span>
                <span class="s">"InsuranceOracleCredential"</span><span class="p">,</span>
                <span class="s">"HeatwaveCredential"</span>
            <span class="p">)</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="c1">// Anchor to blockchain</span>
        <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">blockchains</span><span class="p">.</span><span class="nf">anchor</span><span class="p">(</span>
            <span class="n">data</span> <span class="p">=</span> <span class="n">heatwaveCredential</span><span class="p">,</span>
            <span class="n">serializer</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">chainId</span> <span class="p">=</span> <span class="s">"algorand:mainnet"</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="n">heatwaveCredential</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Create heatwave insurance contract
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">createHeatwaveContract</span><span class="p">(</span>
        <span class="n">insurerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">insuredDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
        <span class="n">basePayout</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
        <span class="n">threshold</span><span class="p">:</span> <span class="nc">HeatwaveThreshold</span><span class="p">,</span>
        <span class="n">location</span><span class="p">:</span> <span class="nc">Location</span>
    <span class="p">):</span> <span class="nc">SmartContract</span> <span class="p">{</span>
        
        <span class="kd">val</span> <span class="py">contract</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">contracts</span><span class="p">.</span><span class="nf">draft</span><span class="p">(</span>
            <span class="n">request</span> <span class="p">=</span> <span class="nc">ContractDraftRequest</span><span class="p">(</span>
                <span class="n">contractType</span> <span class="p">=</span> <span class="nc">ContractType</span><span class="p">.</span><span class="nc">Insurance</span><span class="p">,</span>
                <span class="n">executionModel</span> <span class="p">=</span> <span class="nc">ExecutionModel</span><span class="p">.</span><span class="nc">Parametric</span><span class="p">(</span>
                    <span class="n">triggerType</span> <span class="p">=</span> <span class="nc">TriggerType</span><span class="p">.</span><span class="nc">EarthObservation</span><span class="p">,</span>
                    <span class="n">evaluationEngine</span> <span class="p">=</span> <span class="s">"parametric-insurance"</span>
                <span class="p">),</span>
                <span class="n">parties</span> <span class="p">=</span> <span class="nc">ContractParties</span><span class="p">(</span>
                    <span class="n">primaryPartyDid</span> <span class="p">=</span> <span class="n">insurerDid</span><span class="p">,</span>
                    <span class="n">counterpartyDid</span> <span class="p">=</span> <span class="n">insuredDid</span>
                <span class="p">),</span>
                <span class="n">terms</span> <span class="p">=</span> <span class="nc">ContractTerms</span><span class="p">(</span>
                    <span class="n">obligations</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                        <span class="nc">Obligation</span><span class="p">(</span>
                            <span class="n">id</span> <span class="p">=</span> <span class="s">"heatwave-payout"</span><span class="p">,</span>
                            <span class="n">partyDid</span> <span class="p">=</span> <span class="n">insurerDid</span><span class="p">,</span>
                            <span class="n">description</span> <span class="p">=</span> <span class="s">"Pay out for consecutive days above threshold"</span><span class="p">,</span>
                            <span class="n">obligationType</span> <span class="p">=</span> <span class="nc">ObligationType</span><span class="p">.</span><span class="nc">PAYMENT</span>
                        <span class="p">)</span>
                    <span class="p">),</span>
                    <span class="n">conditions</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                        <span class="nc">ContractCondition</span><span class="p">(</span>
                            <span class="n">id</span> <span class="p">=</span> <span class="s">"heatwave-threshold"</span><span class="p">,</span>
                            <span class="n">description</span> <span class="p">=</span> <span class="s">"Temperature &gt;= ${threshold.temperatureC}°C for ${threshold.minDays} days"</span><span class="p">,</span>
                            <span class="n">conditionType</span> <span class="p">=</span> <span class="nc">ConditionType</span><span class="p">.</span><span class="nc">COMPOSITE</span><span class="p">,</span>
                            <span class="n">expression</span> <span class="p">=</span> <span class="s">"$.consecutiveDays &gt;= ${threshold.minDays} &amp;&amp; $.maxTemperatureC &gt;= ${threshold.temperatureC}"</span>
                        <span class="p">)</span>
                    <span class="p">)</span>
                <span class="p">),</span>
                <span class="n">effectiveDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
                <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plusSeconds</span><span class="p">(</span><span class="mi">365</span> <span class="p">*</span> <span class="mi">24</span> <span class="p">*</span> <span class="mi">60</span> <span class="p">*</span> <span class="mi">60</span><span class="p">).</span><span class="nf">toString</span><span class="p">(),</span>
                <span class="n">contractData</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"productType"</span><span class="p">,</span> <span class="s">"Heatwave"</span><span class="p">)</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"basePayout"</span><span class="p">,</span> <span class="n">basePayout</span><span class="p">)</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"threshold"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"temperatureC"</span><span class="p">,</span> <span class="n">threshold</span><span class="p">.</span><span class="n">temperatureC</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"minDays"</span><span class="p">,</span> <span class="n">threshold</span><span class="p">.</span><span class="n">minDays</span><span class="p">)</span>
                    <span class="p">})</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                        <span class="nf">put</span><span class="p">(</span><span class="s">"region"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">region</span><span class="p">)</span>
                    <span class="p">})</span>
                <span class="p">}</span>
            <span class="p">)</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="n">contract</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Execute heatwave contract
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">executeHeatwaveContract</span><span class="p">(</span>
        <span class="n">contract</span><span class="p">:</span> <span class="nc">SmartContract</span><span class="p">,</span>
        <span class="n">heatwaveCredential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span>
    <span class="p">):</span> <span class="nc">ExecutionResult</span> <span class="p">{</span>
        
        <span class="kd">val</span> <span class="py">credentialSubject</span> <span class="p">=</span> <span class="n">heatwaveCredential</span><span class="p">.</span><span class="n">credentialSubject</span>
        <span class="kd">val</span> <span class="py">consecutiveDays</span> <span class="p">=</span> <span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"measurement"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"consecutiveDays"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toInt</span><span class="p">()</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Consecutive days not found"</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">maxTemp</span> <span class="p">=</span> <span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"measurement"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"maxTemperatureC"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Max temperature not found"</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">executionContext</span> <span class="p">=</span> <span class="nc">ExecutionContext</span><span class="p">(</span>
            <span class="n">triggerData</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"consecutiveDays"</span><span class="p">,</span> <span class="n">consecutiveDays</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"maxTemperatureC"</span><span class="p">,</span> <span class="n">maxTemp</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"credentialId"</span><span class="p">,</span> <span class="n">heatwaveCredential</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">contracts</span><span class="p">.</span><span class="nf">executeContract</span><span class="p">(</span>
            <span class="n">contract</span> <span class="p">=</span> <span class="n">contract</span><span class="p">,</span>
            <span class="n">executionContext</span> <span class="p">=</span> <span class="n">executionContext</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">calculateConsecutiveDays</span><span class="p">(</span>
        <span class="n">lstData</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">LstMeasurement</span><span class="p">&gt;,</span>
        <span class="n">thresholdC</span><span class="p">:</span> <span class="nc">Double</span>
    <span class="p">):</span> <span class="nc">Int</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="py">maxConsecutive</span> <span class="p">=</span> <span class="mi">0</span>
        <span class="kd">var</span> <span class="py">currentConsecutive</span> <span class="p">=</span> <span class="mi">0</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="n">measurement</span> <span class="k">in</span> <span class="n">lstData</span><span class="p">.</span><span class="nf">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">timestamp</span> <span class="p">})</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">measurement</span><span class="p">.</span><span class="n">temperatureC</span> <span class="p">&gt;</span> <span class="n">thresholdC</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">currentConsecutive</span><span class="p">++</span>
                <span class="n">maxConsecutive</span> <span class="p">=</span> <span class="nf">maxOf</span><span class="p">(</span><span class="n">maxConsecutive</span><span class="p">,</span> <span class="n">currentConsecutive</span><span class="p">)</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
                <span class="n">currentConsecutive</span> <span class="p">=</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">maxConsecutive</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">LstMeasurement</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">temperatureC</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timestamp</span><span class="p">:</span> <span class="nc">Instant</span>
<span class="p">)</span>

<span class="kd">data class</span> <span class="nc">HeatwaveThreshold</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">temperatureC</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">minDays</span><span class="p">:</span> <span class="nc">Int</span>
<span class="p">)</span>

<span class="kd">data class</span> <span class="nc">HeatwavePolicy</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">location</span><span class="p">:</span> <span class="nc">Location</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">threshold</span><span class="p">:</span> <span class="nc">HeatwaveThreshold</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">basePayout</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">dailyIncrement</span><span class="p">:</span> <span class="nc">Double</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="product-3-solar-attenuation-parametric">
  
  
    <a href="#product-3-solar-attenuation-parametric" class="anchor-heading" aria-labelledby="product-3-solar-attenuation-parametric"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Product 3: Solar Attenuation Parametric
  
  
</h3>
    

<p><strong>Data Sources:</strong> AOD (MODIS, VIIRS) + Irradiance (CERES)
<strong>Markets:</strong> GCC (Solar farms)
<strong>Triggers:</strong> &gt;30% irradiance drop
<strong>Clients:</strong> ACWA Power, NEOM, UAE utilities</p>
<h4 id="implementation-2">
  
  
    <a href="#implementation-2" class="anchor-heading" aria-labelledby="implementation-2"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Implementation
  
  
</h4>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.atlasparametric.products.solar</span>

<span class="k">import</span> <span class="nn">com.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">com.trustweave.core.*</span>
<span class="k">import</span> <span class="nn">com.trustweave.json.DigestUtils</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>
<span class="k">import</span> <span class="nn">java.time.Instant</span>

<span class="kd">class</span> <span class="nc">SolarAttenuationProduct</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">TrustWeave</span><span class="p">:</span> <span class="nc">TrustWeave</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">eoProviderDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span> <span class="p">{</span>
    
    <span class="cm">/**
     * Process solar attenuation data
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">processSolarAttenuation</span><span class="p">(</span>
        <span class="n">location</span><span class="p">:</span> <span class="nc">Location</span><span class="p">,</span>
        <span class="n">aodData</span><span class="p">:</span> <span class="nc">AodMeasurement</span><span class="p">,</span>
        <span class="n">irradianceData</span><span class="p">:</span> <span class="nc">IrradianceMeasurement</span>
    <span class="p">):</span> <span class="nc">Result</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">trustweaveCatching</span> <span class="p">{</span>
        
        <span class="c1">// Calculate attenuation percentage</span>
        <span class="kd">val</span> <span class="py">baselineIrradiance</span> <span class="p">=</span> <span class="n">irradianceData</span><span class="p">.</span><span class="n">baselineWattPerSqM</span>
        <span class="kd">val</span> <span class="py">currentIrradiance</span> <span class="p">=</span> <span class="n">irradianceData</span><span class="p">.</span><span class="n">currentWattPerSqM</span>
        <span class="kd">val</span> <span class="py">attenuationPercent</span> <span class="p">=</span> <span class="p">((</span><span class="n">baselineIrradiance</span> <span class="p">-</span> <span class="n">currentIrradiance</span><span class="p">)</span> <span class="p">/</span> <span class="n">baselineIrradiance</span><span class="p">)</span> <span class="p">*</span> <span class="mf">100.0</span>
        
        <span class="kd">val</span> <span class="py">solarData</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"solar-attenuation-${location.id}-${Instant.now().toEpochMilli()}"</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"type"</span><span class="p">,</span> <span class="s">"SolarAttenuationMeasurement"</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"solarFarmId"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">solarFarmId</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"measurement"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"aod"</span><span class="p">,</span> <span class="n">aodData</span><span class="p">.</span><span class="n">aodValue</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"baselineIrradiance"</span><span class="p">,</span> <span class="n">baselineIrradiance</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"currentIrradiance"</span><span class="p">,</span> <span class="n">currentIrradiance</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"attenuationPercent"</span><span class="p">,</span> <span class="n">attenuationPercent</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"source"</span><span class="p">,</span> <span class="s">"MODIS/VIIRS AOD + CERES Irradiance"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">})</span>
        <span class="p">}</span>
        
        <span class="kd">val</span> <span class="py">dataDigest</span> <span class="p">=</span> <span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span><span class="n">solarData</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">eoProviderKeyId</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">eoProviderDid</span><span class="p">)</span>
            <span class="p">.</span><span class="nf">getOrThrow</span><span class="p">()</span>
            <span class="p">.</span><span class="n">verificationMethod</span>
            <span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"No verification method found"</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">solarCredential</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">credentials</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
            <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">eoProviderDid</span><span class="p">,</span>
            <span class="n">issuerKeyId</span> <span class="p">=</span> <span class="n">eoProviderKeyId</span><span class="p">,</span>
            <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="s">"solar-attenuation-${location.id}-${Instant.now().toEpochMilli()}"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataType"</span><span class="p">,</span> <span class="s">"SolarAttenuationMeasurement"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"data"</span><span class="p">,</span> <span class="n">solarData</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataDigest"</span><span class="p">,</span> <span class="n">dataDigest</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"provider"</span><span class="p">,</span> <span class="n">eoProviderDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">},</span>
            <span class="n">types</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                <span class="s">"VerifiableCredential"</span><span class="p">,</span>
                <span class="s">"EarthObservationCredential"</span><span class="p">,</span>
                <span class="s">"InsuranceOracleCredential"</span><span class="p">,</span>
                <span class="s">"SolarAttenuationCredential"</span>
            <span class="p">)</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="c1">// Anchor to blockchain</span>
        <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">blockchains</span><span class="p">.</span><span class="nf">anchor</span><span class="p">(</span>
            <span class="n">data</span> <span class="p">=</span> <span class="n">solarCredential</span><span class="p">,</span>
            <span class="n">serializer</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">chainId</span> <span class="p">=</span> <span class="s">"algorand:mainnet"</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="n">solarCredential</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Evaluate solar attenuation trigger
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">evaluateSolarTrigger</span><span class="p">(</span>
        <span class="n">policy</span><span class="p">:</span> <span class="nc">SolarPolicy</span><span class="p">,</span>
        <span class="n">solarCredential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span>
    <span class="p">):</span> <span class="nc">TriggerResult</span> <span class="p">{</span>
        
        <span class="kd">val</span> <span class="py">verification</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">credentials</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span><span class="n">solarCredential</span><span class="p">)</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">verification</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nc">TriggerResult</span><span class="p">(</span><span class="n">triggered</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">reason</span> <span class="p">=</span> <span class="s">"Credential invalid"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="kd">val</span> <span class="py">credentialSubject</span> <span class="p">=</span> <span class="n">solarCredential</span><span class="p">.</span><span class="n">credentialSubject</span>
        <span class="kd">val</span> <span class="py">attenuationPercent</span> <span class="p">=</span> <span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"measurement"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonObject</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"attenuationPercent"</span><span class="p">)</span>
            <span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span>
            <span class="o">?:</span> <span class="k">return</span> <span class="nc">TriggerResult</span><span class="p">(</span><span class="n">triggered</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="n">reason</span> <span class="p">=</span> <span class="s">"Attenuation not found"</span><span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">thresholdPercent</span> <span class="p">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">thresholdPercent</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">attenuationPercent</span> <span class="p">&lt;</span> <span class="n">thresholdPercent</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">return</span> <span class="nc">TriggerResult</span><span class="p">(</span>
                <span class="n">triggered</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
                <span class="n">reason</span> <span class="p">=</span> <span class="s">"Attenuation ($attenuationPercent%) below threshold ($thresholdPercent%)"</span>
            <span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// Calculate payout based on attenuation severity</span>
        <span class="kd">val</span> <span class="py">excessAttenuation</span> <span class="p">=</span> <span class="n">attenuationPercent</span> <span class="p">-</span> <span class="n">thresholdPercent</span>
        <span class="kd">val</span> <span class="py">payoutAmount</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
            <span class="n">excessAttenuation</span> <span class="p">&gt;=</span> <span class="mi">20</span> <span class="p">-&gt;</span> <span class="n">policy</span><span class="p">.</span><span class="n">coverageAmount</span> <span class="p">*</span> <span class="mf">1.0</span>  <span class="c1">// Full payout</span>
            <span class="n">excessAttenuation</span> <span class="p">&gt;=</span> <span class="mi">10</span> <span class="p">-&gt;</span> <span class="n">policy</span><span class="p">.</span><span class="n">coverageAmount</span> <span class="p">*</span> <span class="mf">0.75</span>
            <span class="k">else</span> <span class="p">-&gt;</span> <span class="n">policy</span><span class="p">.</span><span class="n">coverageAmount</span> <span class="p">*</span> <span class="mf">0.50</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="nc">TriggerResult</span><span class="p">(</span>
            <span class="n">triggered</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
            <span class="n">attenuationPercent</span> <span class="p">=</span> <span class="n">attenuationPercent</span><span class="p">,</span>
            <span class="n">payoutAmount</span> <span class="p">=</span> <span class="n">payoutAmount</span><span class="p">,</span>
            <span class="n">dataCredentialId</span> <span class="p">=</span> <span class="n">solarCredential</span><span class="p">.</span><span class="n">id</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">AodMeasurement</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">aodValue</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timestamp</span><span class="p">:</span> <span class="nc">Instant</span>
<span class="p">)</span>

<span class="kd">data class</span> <span class="nc">IrradianceMeasurement</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">baselineWattPerSqM</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">currentWattPerSqM</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timestamp</span><span class="p">:</span> <span class="nc">Instant</span>
<span class="p">)</span>

<span class="kd">data class</span> <span class="nc">SolarPolicy</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">id</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">location</span><span class="p">:</span> <span class="nc">Location</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">thresholdPercent</span><span class="p">:</span> <span class="nc">Double</span> <span class="p">=</span> <span class="mf">30.0</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">coverageAmount</span><span class="p">:</span> <span class="nc">Double</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="complete-workflow-example">
  
  
    <a href="#complete-workflow-example" class="anchor-heading" aria-labelledby="complete-workflow-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Complete Workflow Example
  
  
</h2>
    
<h3 id="complete-flood-insurance-workflow-with-smart-contracts">
  
  
    <a href="#complete-flood-insurance-workflow-with-smart-contracts" class="anchor-heading" aria-labelledby="complete-flood-insurance-workflow-with-smart-contracts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Complete Flood Insurance Workflow with Smart Contracts
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
</pre></td><td class="rouge-code"><pre><span class="k">suspend</span> <span class="k">fun</span> <span class="nf">completeFloodInsuranceWorkflow</span><span class="p">()</span> <span class="p">{</span>
    <span class="c1">// Step 1: Initialize TrustWeave</span>
    <span class="kd">val</span> <span class="py">TrustWeave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span> <span class="p">{</span>
        <span class="nf">blockchains</span> <span class="p">{</span>
            <span class="s">"algorand:mainnet"</span> <span class="n">to</span> <span class="n">algorandClient</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="c1">// Step 2: Create DIDs for parties</span>
    <span class="kd">val</span> <span class="py">insurerDid</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">method</span> <span class="p">=</span> <span class="s">"key"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">insuredDid</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">method</span> <span class="p">=</span> <span class="s">"key"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">eoProviderDid</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">method</span> <span class="p">=</span> <span class="s">"key"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">insurerKeyId</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">insurerDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
        <span class="p">.</span><span class="n">verificationMethod</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span> <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"No key found"</span><span class="p">)</span>
    
    <span class="c1">// Step 3: Initialize product</span>
    <span class="kd">val</span> <span class="py">floodProduct</span> <span class="p">=</span> <span class="nc">SarFloodProduct</span><span class="p">(</span><span class="nc">TrustWeave</span><span class="p">,</span> <span class="n">eoProviderDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
    
    <span class="c1">// Step 4: Create contract</span>
    <span class="kd">val</span> <span class="py">contract</span> <span class="p">=</span> <span class="n">floodProduct</span><span class="p">.</span><span class="nf">createFloodContract</span><span class="p">(</span>
        <span class="n">insurerDid</span> <span class="p">=</span> <span class="n">insurerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">insuredDid</span> <span class="p">=</span> <span class="n">insuredDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">coverageAmount</span> <span class="p">=</span> <span class="mf">1_000_000.0</span><span class="p">,</span>
        <span class="n">location</span> <span class="p">=</span> <span class="nc">Location</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"loc-001"</span><span class="p">,</span>
            <span class="n">latitude</span> <span class="p">=</span> <span class="mf">35.2271</span><span class="p">,</span>
            <span class="n">longitude</span> <span class="p">=</span> <span class="p">-</span><span class="mf">80.8431</span><span class="p">,</span>
            <span class="n">address</span> <span class="p">=</span> <span class="s">"Charlotte, NC"</span><span class="p">,</span>
            <span class="n">region</span> <span class="p">=</span> <span class="s">"North Carolina"</span>
        <span class="p">)</span>
    <span class="p">)</span>
    
    <span class="c1">// Step 5: Bind contract (issue VC and anchor)</span>
    <span class="kd">val</span> <span class="py">bound</span> <span class="p">=</span> <span class="n">floodProduct</span><span class="p">.</span><span class="nf">bindFloodContract</span><span class="p">(</span>
        <span class="n">contract</span> <span class="p">=</span> <span class="n">contract</span><span class="p">,</span>
        <span class="n">insurerDid</span> <span class="p">=</span> <span class="n">insurerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">insurerKeyId</span> <span class="p">=</span> <span class="n">insurerKeyId</span>
    <span class="p">)</span>
    
    <span class="c1">// Step 6: Activate contract</span>
    <span class="kd">val</span> <span class="py">active</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">contracts</span><span class="p">.</span><span class="nf">activateContract</span><span class="p">(</span><span class="n">bound</span><span class="p">.</span><span class="n">contract</span><span class="p">.</span><span class="n">id</span><span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
    
    <span class="c1">// Step 7: Process EO data (in production, this comes from EO provider)</span>
    <span class="kd">val</span> <span class="py">floodCredential</span> <span class="p">=</span> <span class="n">floodProduct</span><span class="p">.</span><span class="nf">processSarFloodData</span><span class="p">(</span>
        <span class="n">location</span> <span class="p">=</span> <span class="nc">Location</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"loc-001"</span><span class="p">,</span>
            <span class="n">latitude</span> <span class="p">=</span> <span class="mf">35.2271</span><span class="p">,</span>
            <span class="n">longitude</span> <span class="p">=</span> <span class="p">-</span><span class="mf">80.8431</span><span class="p">,</span>
            <span class="n">address</span> <span class="p">=</span> <span class="s">"Charlotte, NC"</span><span class="p">,</span>
            <span class="n">region</span> <span class="p">=</span> <span class="s">"North Carolina"</span>
        <span class="p">),</span>
        <span class="n">sarData</span> <span class="p">=</span> <span class="nc">SarFloodMeasurement</span><span class="p">(</span>
            <span class="n">floodDepthCm</span> <span class="p">=</span> <span class="mf">75.0</span><span class="p">,</span>
            <span class="n">floodAreaSqKm</span> <span class="p">=</span> <span class="mf">15.5</span><span class="p">,</span>
            <span class="n">confidence</span> <span class="p">=</span> <span class="mf">0.95</span><span class="p">,</span>
            <span class="n">demUsed</span> <span class="p">=</span> <span class="s">"SRTM"</span><span class="p">,</span>
            <span class="n">quality</span> <span class="p">=</span> <span class="s">"high"</span>
        <span class="p">),</span>
        <span class="n">timestamp</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
    <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
    
    <span class="c1">// Step 8: Execute contract</span>
    <span class="kd">val</span> <span class="py">executionResult</span> <span class="p">=</span> <span class="n">floodProduct</span><span class="p">.</span><span class="nf">executeFloodContract</span><span class="p">(</span>
        <span class="n">contract</span> <span class="p">=</span> <span class="n">active</span><span class="p">,</span>
        <span class="n">floodCredential</span> <span class="p">=</span> <span class="n">floodCredential</span>
    <span class="p">)</span>
    
    <span class="c1">// Step 9: Process payout (application-specific)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">executionResult</span><span class="p">.</span><span class="n">executed</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">processPayout</span><span class="p">(</span><span class="n">executionResult</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="complete-system-integration">
  
  
    <a href="#complete-system-integration" class="anchor-heading" aria-labelledby="complete-system-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Complete System Integration
  
  
</h2>
    
<h3 id="main-application">
  
  
    <a href="#main-application" class="anchor-heading" aria-labelledby="main-application"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Main Application
  
  
</h3>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
</pre></td><td class="rouge-code"><pre><span class="k">package</span> <span class="nn">com.atlasparametric</span>

<span class="k">import</span> <span class="nn">com.trustweave.TrustWeave</span>
<span class="k">import</span> <span class="nn">com.trustweave.chains.algorand.AlgorandBlockchainAnchorClient</span>
<span class="k">import</span> <span class="nn">com.atlasparametric.products.flood.SarFloodProduct</span>
<span class="k">import</span> <span class="nn">com.atlasparametric.products.heatwave.HeatwaveProduct</span>
<span class="k">import</span> <span class="nn">com.atlasparametric.products.solar.SolarAttenuationProduct</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>

<span class="cm">/**
 * Atlas Parametric MGA Platform
 * 
 * Main application entry point
 */</span>
<span class="kd">class</span> <span class="nc">AtlasParametricPlatform</span> <span class="p">{</span>
    
    <span class="k">private</span> <span class="kd">val</span> <span class="py">TrustWeave</span><span class="p">:</span> <span class="nc">TrustWeave</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">sarFloodProduct</span><span class="p">:</span> <span class="nc">SarFloodProduct</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">heatwaveProduct</span><span class="p">:</span> <span class="nc">HeatwaveProduct</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">solarProduct</span><span class="p">:</span> <span class="nc">SolarAttenuationProduct</span>
    
    <span class="nf">init</span> <span class="p">{</span>
        <span class="c1">// Initialize TrustWeave with blockchain anchoring</span>
        <span class="nc">TrustWeave</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">create</span> <span class="p">{</span>
            <span class="nf">blockchains</span> <span class="p">{</span>
                <span class="s">"algorand:mainnet"</span> <span class="n">to</span> <span class="nc">AlgorandBlockchainAnchorClient</span><span class="p">(</span>
                    <span class="n">chainId</span> <span class="p">=</span> <span class="s">"algorand:mainnet"</span><span class="p">,</span>
                    <span class="n">apiKey</span> <span class="p">=</span> <span class="nc">System</span><span class="p">.</span><span class="nf">getenv</span><span class="p">(</span><span class="s">"ALGORAND_API_KEY"</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
        
        <span class="c1">// Create DIDs for EO providers</span>
        <span class="kd">val</span> <span class="py">eoProviderDid</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
            <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">dids</span><span class="p">.</span><span class="nf">create</span><span class="p">(</span><span class="n">method</span> <span class="p">=</span> <span class="s">"key"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// Initialize products</span>
        <span class="n">sarFloodProduct</span> <span class="p">=</span> <span class="nc">SarFloodProduct</span><span class="p">(</span><span class="nc">TrustWeave</span><span class="p">,</span> <span class="n">eoProviderDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">heatwaveProduct</span> <span class="p">=</span> <span class="nc">HeatwaveProduct</span><span class="p">(</span><span class="nc">TrustWeave</span><span class="p">,</span> <span class="n">eoProviderDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
        <span class="n">solarProduct</span> <span class="p">=</span> <span class="nc">SolarAttenuationProduct</span><span class="p">(</span><span class="nc">TrustWeave</span><span class="p">,</span> <span class="n">eoProviderDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Process EO data and execute contracts
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">processEoDataAndExecute</span><span class="p">(</span>
        <span class="n">productType</span><span class="p">:</span> <span class="nc">ProductType</span><span class="p">,</span>
        <span class="n">eoData</span><span class="p">:</span> <span class="nc">Any</span><span class="p">,</span>
        <span class="n">contracts</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">SmartContract</span><span class="p">&gt;</span>
    <span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ExecutionResult</span><span class="p">&gt;</span> <span class="p">{</span>
        
        <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">productType</span><span class="p">)</span> <span class="p">{</span>
            <span class="nc">ProductType</span><span class="p">.</span><span class="nc">SAR_FLOOD</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">floodData</span> <span class="p">=</span> <span class="n">eoData</span> <span class="k">as</span> <span class="nc">SarFloodMeasurement</span>
                <span class="nf">processFloodExecutions</span><span class="p">(</span><span class="n">floodData</span><span class="p">,</span> <span class="n">contracts</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nc">ProductType</span><span class="p">.</span><span class="nc">HEATWAVE</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">heatData</span> <span class="p">=</span> <span class="n">eoData</span> <span class="k">as</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">LstMeasurement</span><span class="p">&gt;</span>
                <span class="nf">processHeatwaveExecutions</span><span class="p">(</span><span class="n">heatData</span><span class="p">,</span> <span class="n">contracts</span><span class="p">)</span>
            <span class="p">}</span>
            <span class="nc">ProductType</span><span class="p">.</span><span class="nc">SOLAR_ATTENUATION</span> <span class="p">-&gt;</span> <span class="p">{</span>
                <span class="kd">val</span> <span class="py">solarData</span> <span class="p">=</span> <span class="n">eoData</span> <span class="k">as</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">AodMeasurement</span><span class="p">,</span> <span class="nc">IrradianceMeasurement</span><span class="p">&gt;</span>
                <span class="nf">processSolarExecutions</span><span class="p">(</span><span class="n">solarData</span><span class="p">,</span> <span class="n">contracts</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">processFloodExecutions</span><span class="p">(</span>
        <span class="n">floodData</span><span class="p">:</span> <span class="nc">SarFloodMeasurement</span><span class="p">,</span>
        <span class="n">contracts</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">SmartContract</span><span class="p">&gt;</span>
    <span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">ExecutionResult</span><span class="p">&gt;</span> <span class="p">{</span>
        
        <span class="kd">val</span> <span class="py">results</span> <span class="p">=</span> <span class="n">mutableListOf</span><span class="p">&lt;</span><span class="nc">ExecutionResult</span><span class="p">&gt;()</span>
        
        <span class="k">for</span> <span class="p">(</span><span class="n">contract</span> <span class="k">in</span> <span class="n">contracts</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> 
            <span class="n">it</span><span class="p">.</span><span class="n">contractData</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"productType"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span> <span class="p">==</span> <span class="s">"SarFlood"</span> 
        <span class="p">})</span> <span class="p">{</span>
            <span class="c1">// Process SAR data and issue credential</span>
            <span class="kd">val</span> <span class="py">location</span> <span class="p">=</span> <span class="nf">extractLocation</span><span class="p">(</span><span class="n">contract</span><span class="p">)</span>
            <span class="kd">val</span> <span class="py">floodCredential</span> <span class="p">=</span> <span class="n">sarFloodProduct</span><span class="p">.</span><span class="nf">processSarFloodData</span><span class="p">(</span>
                <span class="n">location</span> <span class="p">=</span> <span class="n">location</span><span class="p">,</span>
                <span class="n">sarData</span> <span class="p">=</span> <span class="n">floodData</span><span class="p">,</span>
                <span class="n">timestamp</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
            <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
            
            <span class="c1">// Execute contract</span>
            <span class="kd">val</span> <span class="py">executionResult</span> <span class="p">=</span> <span class="n">sarFloodProduct</span><span class="p">.</span><span class="nf">executeFloodContract</span><span class="p">(</span>
                <span class="n">contract</span> <span class="p">=</span> <span class="n">contract</span><span class="p">,</span>
                <span class="n">floodCredential</span> <span class="p">=</span> <span class="n">floodCredential</span>
            <span class="p">)</span>
            
            <span class="k">if</span> <span class="p">(</span><span class="n">executionResult</span><span class="p">.</span><span class="n">executed</span><span class="p">)</span> <span class="p">{</span>
                <span class="c1">// Process payout</span>
                <span class="nf">processPayout</span><span class="p">(</span><span class="n">executionResult</span><span class="p">)</span>
            <span class="p">}</span>
            
            <span class="n">results</span><span class="p">.</span><span class="nf">add</span><span class="p">(</span><span class="n">executionResult</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="k">return</span> <span class="n">results</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">fun</span> <span class="nf">extractLocation</span><span class="p">(</span><span class="n">contract</span><span class="p">:</span> <span class="nc">SmartContract</span><span class="p">):</span> <span class="nc">Location</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">locationData</span> <span class="p">=</span> <span class="n">contract</span><span class="p">.</span><span class="n">contractData</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"location"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"Location not found in contract"</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nc">Location</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="n">locationData</span><span class="p">[</span><span class="s">"address"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span> <span class="o">?:</span> <span class="s">"unknown"</span><span class="p">,</span>
            <span class="n">latitude</span> <span class="p">=</span> <span class="n">locationData</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">longitude</span> <span class="p">=</span> <span class="n">locationData</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="mf">0.0</span><span class="p">,</span>
            <span class="n">address</span> <span class="p">=</span> <span class="n">locationData</span><span class="p">[</span><span class="s">"address"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span> <span class="o">?:</span> <span class="s">""</span><span class="p">,</span>
            <span class="n">region</span> <span class="p">=</span> <span class="n">locationData</span><span class="p">[</span><span class="s">"region"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span> <span class="o">?:</span> <span class="s">""</span>
        <span class="p">)</span>
    <span class="p">}</span>
    
    <span class="k">private</span> <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">processPayout</span><span class="p">(</span><span class="n">executionResult</span><span class="p">:</span> <span class="nc">ExecutionResult</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// Integrate with banking API (Stripe, Plaid, etc.)</span>
        <span class="c1">// Extract payout amount from executionResult.outcomes</span>
        <span class="n">executionResult</span><span class="p">.</span><span class="n">outcomes</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">outcome</span> <span class="p">-&gt;</span>
            <span class="n">outcome</span><span class="p">.</span><span class="n">monetaryImpact</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">amount</span> <span class="p">-&gt;</span>
                <span class="c1">// Execute payout via banking API</span>
                <span class="nf">println</span><span class="p">(</span><span class="s">"Processing payout: ${amount.amount} ${amount.currency}"</span><span class="p">)</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">ProductType</span> <span class="p">{</span>
    <span class="nc">SAR_FLOOD</span><span class="p">,</span>
    <span class="nc">HEATWAVE</span><span class="p">,</span>
    <span class="nc">SOLAR_ATTENUATION</span><span class="p">,</span>
    <span class="nc">HURRICANE</span><span class="p">,</span>
    <span class="nc">DROUGHT</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">PayoutResult</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">policyId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">amount</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">status</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">payoutCredentialId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timestamp</span><span class="p">:</span> <span class="nc">Instant</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="multi-provider-eo-data-acceptance">
  
  
    <a href="#multi-provider-eo-data-acceptance" class="anchor-heading" aria-labelledby="multi-provider-eo-data-acceptance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Provider EO Data Acceptance
  
  
</h2>
    

<p>One of TrustWeave’s key advantages is accepting EO data from multiple providers:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Accept EO data from any certified provider
 */</span>
<span class="kd">class</span> <span class="nc">MultiProviderEoDataService</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">TrustWeave</span><span class="p">:</span> <span class="nc">TrustWeave</span>
<span class="p">)</span> <span class="p">{</span>
    
    <span class="k">private</span> <span class="kd">val</span> <span class="py">certifiedProviders</span> <span class="p">=</span> <span class="nf">setOf</span><span class="p">(</span>
        <span class="s">"did:key:esa-provider"</span><span class="p">,</span>
        <span class="s">"did:key:planet-provider"</span><span class="p">,</span>
        <span class="s">"did:key:nasa-provider"</span><span class="p">,</span>
        <span class="s">"did:key:noaa-provider"</span>
    <span class="p">)</span>
    
    <span class="cm">/**
     * Accept EO data credential from any certified provider
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">acceptEoDataCredential</span><span class="p">(</span>
        <span class="n">dataCredential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span>
    <span class="p">):</span> <span class="nc">Result</span><span class="p">&lt;</span><span class="nc">EoData</span><span class="p">&gt;</span> <span class="p">=</span> <span class="nf">trustweaveCatching</span> <span class="p">{</span>
        
        <span class="c1">// Step 1: Verify credential</span>
        <span class="kd">val</span> <span class="py">verification</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">verifyCredential</span><span class="p">(</span><span class="n">dataCredential</span><span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">verification</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">error</span><span class="p">(</span><span class="s">"Credential verification failed: ${verification.errors}"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// Step 2: Check if provider is certified</span>
        <span class="kd">val</span> <span class="py">issuerDid</span> <span class="p">=</span> <span class="n">dataCredential</span><span class="p">.</span><span class="n">issuer</span><span class="p">.</span><span class="nf">firstOrNull</span><span class="p">()</span><span class="o">?.</span><span class="n">id</span>
            <span class="o">?:</span> <span class="nf">error</span><span class="p">(</span><span class="s">"No issuer found in credential"</span><span class="p">)</span>
        
        <span class="k">if</span> <span class="p">(!</span><span class="n">certifiedProviders</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">issuerDid</span><span class="p">))</span> <span class="p">{</span>
            <span class="nf">error</span><span class="p">(</span><span class="s">"Provider $issuerDid is not certified"</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// Step 3: Extract and return data</span>
        <span class="kd">val</span> <span class="py">credentialSubject</span> <span class="p">=</span> <span class="n">dataCredential</span><span class="p">.</span><span class="n">credentialSubject</span>
        <span class="kd">val</span> <span class="py">dataType</span> <span class="p">=</span> <span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"dataType"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
        <span class="kd">val</span> <span class="py">data</span> <span class="p">=</span> <span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"data"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        
        <span class="nc">EoData</span><span class="p">(</span>
            <span class="n">type</span> <span class="p">=</span> <span class="n">dataType</span> <span class="o">?:</span> <span class="s">"Unknown"</span><span class="p">,</span>
            <span class="n">data</span> <span class="p">=</span> <span class="n">data</span> <span class="o">?:</span> <span class="nf">buildJsonObject</span> <span class="p">{},</span>
            <span class="n">provider</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">,</span>
            <span class="n">credentialId</span> <span class="p">=</span> <span class="n">dataCredential</span><span class="p">.</span><span class="n">id</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="kd">data class</span> <span class="nc">EoData</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">type</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">data</span><span class="p">:</span> <span class="nc">JsonObject</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">provider</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">credentialId</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="broker-portal-integration">
  
  
    <a href="#broker-portal-integration" class="anchor-heading" aria-labelledby="broker-portal-integration"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Broker Portal Integration
  
  
</h2>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Broker Portal API
 */</span>
<span class="nd">@RestController</span>
<span class="nd">@RequestMapping</span><span class="p">(</span><span class="s">"/api/broker"</span><span class="p">)</span>
<span class="kd">class</span> <span class="nc">BrokerPortalController</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">platform</span><span class="p">:</span> <span class="nc">AtlasParametricPlatform</span><span class="p">,</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">pricingEngine</span><span class="p">:</span> <span class="nc">PricingEngine</span>
<span class="p">)</span> <span class="p">{</span>
    
    <span class="cm">/**
     * Get quote for parametric insurance
     */</span>
    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">"/quote"</span><span class="p">)</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">getQuote</span><span class="p">(</span>
        <span class="nd">@RequestBody</span> <span class="n">request</span><span class="p">:</span> <span class="nc">QuoteRequest</span>
    <span class="p">):</span> <span class="nc">QuoteResponse</span> <span class="p">{</span>
        
        <span class="kd">val</span> <span class="py">premium</span> <span class="p">=</span> <span class="n">pricingEngine</span><span class="p">.</span><span class="nf">calculatePremium</span><span class="p">(</span>
            <span class="n">productType</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">productType</span><span class="p">,</span>
            <span class="n">location</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">location</span><span class="p">,</span>
            <span class="n">coverageAmount</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">coverageAmount</span>
        <span class="p">)</span>
        
        <span class="k">return</span> <span class="nc">QuoteResponse</span><span class="p">(</span>
            <span class="n">premium</span> <span class="p">=</span> <span class="n">premium</span><span class="p">,</span>
            <span class="n">coverageAmount</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">coverageAmount</span><span class="p">,</span>
            <span class="n">productType</span> <span class="p">=</span> <span class="n">request</span><span class="p">.</span><span class="n">productType</span>
        <span class="p">)</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Bind policy
     */</span>
    <span class="nd">@PostMapping</span><span class="p">(</span><span class="s">"/bind"</span><span class="p">)</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">bindPolicy</span><span class="p">(</span>
        <span class="nd">@RequestBody</span> <span class="n">request</span><span class="p">:</span> <span class="nc">BindRequest</span>
    <span class="p">):</span> <span class="nc">PolicyResponse</span> <span class="p">{</span>
        
        <span class="c1">// Create policy</span>
        <span class="kd">val</span> <span class="py">policy</span> <span class="p">=</span> <span class="nf">createPolicy</span><span class="p">(</span><span class="n">request</span><span class="p">)</span>
        
        <span class="c1">// Issue policy credential</span>
        <span class="kd">val</span> <span class="py">policyCredential</span> <span class="p">=</span> <span class="nf">issuePolicyCredential</span><span class="p">(</span><span class="n">policy</span><span class="p">)</span>
        
        <span class="k">return</span> <span class="nc">PolicyResponse</span><span class="p">(</span>
            <span class="n">policyId</span> <span class="p">=</span> <span class="n">policy</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">policyCredentialId</span> <span class="p">=</span> <span class="n">policyCredential</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">status</span> <span class="p">=</span> <span class="s">"BOUND"</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="regulatory-compliance--audit-trails">
  
  
    <a href="#regulatory-compliance--audit-trails" class="anchor-heading" aria-labelledby="regulatory-compliance--audit-trails"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Regulatory Compliance &amp; Audit Trails
  
  
</h2>
    

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
</pre></td><td class="rouge-code"><pre><span class="cm">/**
 * Audit Trail Service using TrustWeave blockchain anchoring
 */</span>
<span class="kd">class</span> <span class="nc">AuditTrailService</span><span class="p">(</span>
    <span class="k">private</span> <span class="kd">val</span> <span class="py">TrustWeave</span><span class="p">:</span> <span class="nc">TrustWeave</span>
<span class="p">)</span> <span class="p">{</span>
    
    <span class="cm">/**
     * Record audit event and anchor to blockchain
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">recordAuditEvent</span><span class="p">(</span>
        <span class="n">event</span><span class="p">:</span> <span class="nc">AuditEvent</span>
    <span class="p">):</span> <span class="nc">AuditRecord</span> <span class="p">{</span>
        
        <span class="c1">// Create audit record</span>
        <span class="kd">val</span> <span class="py">auditRecord</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">timestamp</span><span class="p">.</span><span class="nf">toString</span><span class="p">())</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"eventType"</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">type</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"actor"</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">actor</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"resource"</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">resource</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"details"</span><span class="p">,</span> <span class="n">event</span><span class="p">.</span><span class="n">details</span><span class="p">)</span>
        <span class="p">}</span>
        
        <span class="c1">// Anchor to blockchain for immutability</span>
        <span class="kd">val</span> <span class="py">anchorResult</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="n">blockchains</span><span class="p">.</span><span class="nf">anchor</span><span class="p">(</span>
            <span class="n">data</span> <span class="p">=</span> <span class="n">auditRecord</span><span class="p">,</span>
            <span class="n">serializer</span> <span class="p">=</span> <span class="nc">JsonObject</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">chainId</span> <span class="p">=</span> <span class="s">"algorand:mainnet"</span>
        <span class="p">).</span><span class="nf">getOrThrow</span><span class="p">()</span>
        
        <span class="k">return</span> <span class="nc">AuditRecord</span><span class="p">(</span>
            <span class="n">eventId</span> <span class="p">=</span> <span class="n">event</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">anchorRef</span> <span class="p">=</span> <span class="n">anchorResult</span><span class="p">.</span><span class="n">ref</span><span class="p">,</span>
            <span class="n">timestamp</span> <span class="p">=</span> <span class="n">event</span><span class="p">.</span><span class="n">timestamp</span>
        <span class="p">)</span>
    <span class="p">}</span>
    
    <span class="cm">/**
     * Verify audit record integrity
     */</span>
    <span class="k">suspend</span> <span class="k">fun</span> <span class="nf">verifyAuditRecord</span><span class="p">(</span>
        <span class="n">record</span><span class="p">:</span> <span class="nc">AuditRecord</span>
    <span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
        
        <span class="c1">// Read from blockchain</span>
        <span class="kd">val</span> <span class="py">client</span> <span class="p">=</span> <span class="nc">TrustWeave</span><span class="p">.</span><span class="nf">getBlockchainClient</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">anchorRef</span><span class="p">.</span><span class="n">chainId</span><span class="p">)</span>
            <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>
        
        <span class="kd">val</span> <span class="py">anchorResult</span> <span class="p">=</span> <span class="n">client</span><span class="p">.</span><span class="nf">readPayload</span><span class="p">(</span><span class="n">record</span><span class="p">.</span><span class="n">anchorRef</span><span class="p">)</span>
        
        <span class="c1">// Verify integrity</span>
        <span class="k">return</span> <span class="n">anchorResult</span><span class="p">.</span><span class="n">payload</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span> <span class="p">==</span> <span class="n">record</span><span class="p">.</span><span class="n">eventId</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="deployment-strategy">
  
  
    <a href="#deployment-strategy" class="anchor-heading" aria-labelledby="deployment-strategy"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Deployment Strategy
  
  
</h2>
    
<h3 id="phase-1-mvp-weeks-1-6">
  
  
    <a href="#phase-1-mvp-weeks-1-6" class="anchor-heading" aria-labelledby="phase-1-mvp-weeks-1-6"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Phase 1: MVP (Weeks 1-6)
  
  
</h3>
    

<ol>
  <li><strong>Setup TrustWeave</strong>
    <ul>
      <li>Initialize TrustWeave with Algorand or Polygon</li>
      <li>Create DIDs for EO providers</li>
      <li>Setup blockchain anchoring</li>
    </ul>
  </li>
  <li><strong>Build SAR Flood Product</strong>
    <ul>
      <li>Implement SAR flood detection</li>
      <li>Create trigger evaluation logic</li>
      <li>Build payout automation</li>
    </ul>
  </li>
  <li><strong>Broker Portal MVP</strong>
    <ul>
      <li>Quote generation</li>
      <li>Policy binding</li>
      <li>Trigger dashboard</li>
    </ul>
  </li>
</ol>
<h3 id="phase-2-production-months-2-12">
  
  
    <a href="#phase-2-production-months-2-12" class="anchor-heading" aria-labelledby="phase-2-production-months-2-12"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Phase 2: Production (Months 2-12)
  
  
</h3>
    

<ol>
  <li><strong>Add Heatwave Product</strong></li>
  <li><strong>Add Solar Attenuation Product</strong></li>
  <li><strong>Multi-provider EO data acceptance</strong></li>
  <li><strong>Regulatory compliance features</strong></li>
  <li><strong>Reinsurer dashboard</strong></li>
</ol>
<h2 id="key-benefits-of-using-trustweave">
  
  
    <a href="#key-benefits-of-using-trustweave" class="anchor-heading" aria-labelledby="key-benefits-of-using-trustweave"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Benefits of Using TrustWeave
  
  
</h2>
    

<ol>
  <li><strong>Standardization</strong>: W3C-compliant format works with all EO providers</li>
  <li><strong>Trust</strong>: Cryptographic proof of data integrity</li>
  <li><strong>Multi-Provider</strong>: Accept data from ESA, Planet, NASA without custom integrations</li>
  <li><strong>Regulatory Compliance</strong>: Blockchain-anchored audit trails</li>
  <li><strong>Automation</strong>: Enable instant payouts with verifiable triggers</li>
  <li><strong>Cost Reduction</strong>: Eliminate custom API integrations</li>
</ol>
<h2 id="next-steps">
  
  
    <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps
  
  
</h2>
    

<ol>
  <li><strong>Review Existing Scenarios</strong>:
    <ul>
      <li><a href="/trustweave/scenarios/parametric-insurance-eo-scenario/">Parametric Insurance with EO Data</a></li>
      <li><a href="/trustweave/scenarios/earth-observation-scenario/">Earth Observation Scenario</a></li>
    </ul>
  </li>
  <li><strong>Explore TrustWeave APIs</strong>:
    <ul>
      <li><a href="/trustweave/api-reference/core-api/">Core API Reference</a></li>
      <li><a href="/trustweave/core-concepts/blockchain-anchoring/">Blockchain Anchoring</a></li>
    </ul>
  </li>
  <li><strong>Start Building</strong>:
    <ul>
      <li>Clone TrustWeave repository</li>
      <li>Follow <a href="/trustweave/getting-started/quick-start/">Quick Start Guide</a></li>
      <li>Implement SAR flood product first</li>
    </ul>
  </li>
</ol>
<h2 id="related-documentation">
  
  
    <a href="#related-documentation" class="anchor-heading" aria-labelledby="related-documentation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Related Documentation
  
  
</h2>
    

<ul>
  <li><a href="/trustweave/scenarios/parametric-insurance-eo-scenario/">Parametric Insurance with EO Data</a> - EO data insurance patterns</li>
  <li><a href="/trustweave/scenarios/earth-observation-scenario/">Earth Observation Scenario</a> - EO data integrity</li>
  <li><a href="/trustweave/core-concepts/blockchain-anchoring/">Blockchain Anchoring</a> - Anchoring concepts</li>
  <li><a href="/trustweave/api-reference/core-api/">API Reference</a> - Complete API documentation</li>
</ul>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with ❤️ by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();
        
        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
        footer.style.marginTop = 'auto'; // Push to bottom in flexbox layout
        footer.style.zIndex = '0'; // Below search overlay
      }
    }
    
    // Function to update footer visibility based on search state
    function updateFooterVisibility() {
      const footer = document.querySelector('.site-footer');
      const htmlElement = document.documentElement;
      
      if (footer && htmlElement) {
        const isSearchActive = htmlElement.classList.contains('search-active');
        if (isSearchActive) {
          // Hide footer when search is active - use multiple methods to ensure it's hidden
          footer.style.display = 'none';
          footer.style.visibility = 'hidden';
          footer.style.opacity = '0';
          footer.style.zIndex = '-999';
          footer.style.pointerEvents = 'none';
        } else {
          // Show footer when search is not active
          footer.style.display = 'block';
          footer.style.visibility = 'visible';
          footer.style.opacity = '1';
          footer.style.marginTop = 'auto';
          footer.style.position = 'relative';
          footer.style.zIndex = '-1';
          footer.style.pointerEvents = 'auto';
        }
      }
    }
    
    // Monitor search state and hide/show footer appropriately
    const observer = new MutationObserver(function(mutations) {
      updateFooterVisibility();
    });
    
    // Also listen for input events on search input as a backup
    // This ensures footer is hidden immediately when user starts typing
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      // Use requestAnimationFrame for better performance
      const handleSearchChange = function() {
        requestAnimationFrame(updateFooterVisibility);
      };
      
      searchInput.addEventListener('input', handleSearchChange);
      searchInput.addEventListener('focus', handleSearchChange);
      searchInput.addEventListener('keydown', handleSearchChange);
    }
    
    // Observe documentElement (html) for class changes (like search-active)
    // The search script adds 'search-active' to documentElement, not body
    if (document.documentElement) {
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });
      
      // Initial check
      updateFooterVisibility();
    }
  });
</script>


    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    





<script type="module">
  
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';
  

  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>



  
</body>
</html>

