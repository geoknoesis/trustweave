

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
    .site-nav ul li a {
      background-image: none;
    }

  </style>

  

  
    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Proof of Location Scenario | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Proof of Location Scenario" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="http://0.0.0.0:4000/trustweave/scenarios/proof-of-location-scenario/" />
<meta property="og:url" content="http://0.0.0.0:4000/trustweave/scenarios/proof-of-location-scenario/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Proof of Location Scenario" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Proof of Location Scenario","url":"http://0.0.0.0:4000/trustweave/scenarios/proof-of-location-scenario/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }

  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }

  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }

  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }

  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="http://0.0.0.0:4000/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });

            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');

        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';

                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';

                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';

                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/use-trustweave-facade/" class="nav-list-link">Use TrustWeave Facade for Quick Setup</a></li><li class="nav-list-item"><a href="/trustweave/how-to/configure-trustlayer/" class="nav-list-link">Configure TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li><li class="nav-list-item"><a href="/trustweave/how-to/multi-chain-anchoring/" class="nav-list-link">Multi-Chain Anchoring Patterns</a></li><li class="nav-list-item"><a href="/trustweave/how-to/exchange-credentials/" class="nav-list-link">Exchange Credentials with Multiple Protocols</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li></ul>
  
</nav>




  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="proof-of-location-scenario">
  
  
    <a href="#proof-of-location-scenario" class="anchor-heading" aria-labelledby="proof-of-location-scenario"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Proof of Location Scenario
  
  
</h1>
    

<p>This guide demonstrates how to implement proof of location credentials using TrustWeave, inspired by decentralized geospatial web concepts. You’ll learn how to create location-based verifiable credentials, anchor them to blockchains for tamper-proof verification, and build a system for geospatial data integrity.</p>
<h2 id="what-youll-build">
  
  
    <a href="#what-youll-build" class="anchor-heading" aria-labelledby="what-youll-build"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What You’ll Build
  
  
</h2>
    

<p>By the end of this tutorial, you’ll have:</p>

<ul>
  <li>✅ Created DIDs for location providers and verifiers</li>
  <li>✅ Issued Verifiable Credentials proving location claims</li>
  <li>✅ Anchored location proofs to blockchain for immutability</li>
  <li>✅ Built a location verification system</li>
  <li>✅ Created location-based presentations with selective disclosure</li>
  <li>✅ Implemented geospatial data integrity verification</li>
</ul>
<h2 id="big-picture--significance">
  
  
    <a href="#big-picture--significance" class="anchor-heading" aria-labelledby="big-picture--significance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Big Picture &amp; Significance
  
  
</h2>
    
<h3 id="the-location-verification-challenge">
  
  
    <a href="#the-location-verification-challenge" class="anchor-heading" aria-labelledby="the-location-verification-challenge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Location Verification Challenge
  
  
</h3>
    

<p>Location data is critical for many applications, but verifying location claims and protecting privacy are fundamental challenges. Traditional systems rely on central authorities and don’t protect user privacy.</p>

<p><strong>Industry Context</strong>:</p>
<ul>
  <li><strong>Market Size</strong>: Location-based services market projected to reach $157 billion by 2026</li>
  <li><strong>Privacy Concerns</strong>: Location data is highly sensitive</li>
  <li><strong>Trust Requirements</strong>: Need to verify location claims for critical applications</li>
  <li><strong>Regulatory Pressure</strong>: GDPR and other regulations require location data protection</li>
  <li><strong>Decentralization</strong>: Growing demand for decentralized location verification</li>
</ul>

<p><strong>Why This Matters</strong>:</p>
<ol>
  <li><strong>Privacy</strong>: Protect sensitive location data</li>
  <li><strong>Trust</strong>: Verify location claims cryptographically</li>
  <li><strong>Decentralization</strong>: Avoid reliance on central authorities</li>
  <li><strong>Integrity</strong>: Ensure location data hasn’t been tampered with</li>
  <li><strong>Selective Disclosure</strong>: Share location without revealing exact coordinates</li>
  <li><strong>Compliance</strong>: Meet regulatory requirements for location data</li>
</ol>
<h3 id="the-location-verification-problem">
  
  
    <a href="#the-location-verification-problem" class="anchor-heading" aria-labelledby="the-location-verification-problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Location Verification Problem
  
  
</h3>
    

<p>Traditional location systems face critical issues:</p>
<ul>
  <li><strong>Centralized Trust</strong>: Reliance on single authorities creates bottlenecks</li>
  <li><strong>Privacy Violations</strong>: Location data often shared without consent</li>
  <li><strong>No Verification</strong>: Can’t verify location claims</li>
  <li><strong>No Integrity</strong>: Location data can be tampered with</li>
  <li><strong>No Interoperability</strong>: Different systems can’t verify each other’s claims</li>
</ul>
<h2 id="value-proposition">
  
  
    <a href="#value-proposition" class="anchor-heading" aria-labelledby="value-proposition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Value Proposition
  
  
</h2>
    
<h3 id="problems-solved">
  
  
    <a href="#problems-solved" class="anchor-heading" aria-labelledby="problems-solved"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Problems Solved
  
  
</h3>
    

<ol>
  <li><strong>Cryptographic Proof</strong>: Location claims are cryptographically signed</li>
  <li><strong>Privacy Protection</strong>: Selective disclosure protects sensitive data</li>
  <li><strong>Blockchain Anchoring</strong>: Immutable proof of when/where data was created</li>
  <li><strong>Verifiable Credentials</strong>: Standard format for location claims</li>
  <li><strong>Self-Sovereign</strong>: Users control their location data</li>
  <li><strong>Interoperability</strong>: Standard format works across systems</li>
  <li><strong>Decentralization</strong>: No reliance on central authorities</li>
</ol>
<h3 id="business-benefits">
  
  
    <a href="#business-benefits" class="anchor-heading" aria-labelledby="business-benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Business Benefits
  
  
</h3>
    

<p><strong>For Users</strong>:</p>
<ul>
  <li><strong>Privacy</strong>: Control what location information is shared</li>
  <li><strong>Trust</strong>: Verify location claims cryptographically</li>
  <li><strong>Control</strong>: Own and control location data</li>
  <li><strong>Portability</strong>: Location credentials work across platforms</li>
</ul>

<p><strong>For Service Providers</strong>:</p>
<ul>
  <li><strong>Trust</strong>: Verify location claims without intermediaries</li>
  <li><strong>Compliance</strong>: Meet regulatory requirements</li>
  <li><strong>Efficiency</strong>: Automated location verification</li>
  <li><strong>Innovation</strong>: Enable new location-based services</li>
</ul>

<p><strong>For Regulators</strong>:</p>
<ul>
  <li><strong>Audit Trails</strong>: Complete location data records</li>
  <li><strong>Privacy</strong>: Enhanced privacy protection</li>
  <li><strong>Compliance</strong>: Meet regulatory requirements</li>
</ul>
<h3 id="roi-considerations">
  
  
    <a href="#roi-considerations" class="anchor-heading" aria-labelledby="roi-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ROI Considerations
  
  
</h3>
    

<ul>
  <li><strong>Privacy</strong>: Enhanced privacy protection reduces liability</li>
  <li><strong>Trust</strong>: Increased trust enables new use cases</li>
  <li><strong>Compliance</strong>: Automated compliance reduces costs</li>
  <li><strong>Innovation</strong>: Enable new location-based services</li>
</ul>
<h2 id="understanding-the-problem">
  
  
    <a href="#understanding-the-problem" class="anchor-heading" aria-labelledby="understanding-the-problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding the Problem
  
  
</h2>
    

<p>Geospatial data and location claims face several challenges:</p>

<ol>
  <li><strong>Trust</strong>: How do you verify someone was actually at a location?</li>
  <li><strong>Privacy</strong>: Location data is highly sensitive and needs protection</li>
  <li><strong>Integrity</strong>: Geospatial data can be tampered with</li>
  <li><strong>Provenance</strong>: Need to track where location data came from</li>
  <li><strong>Decentralization</strong>: Avoid reliance on central authorities</li>
</ol>

<p>TrustWeave solves this by enabling:</p>

<ul>
  <li><strong>Cryptographic proof</strong>: Location claims are cryptographically signed</li>
  <li><strong>Selective disclosure</strong>: Share location without revealing exact coordinates</li>
  <li><strong>Blockchain anchoring</strong>: Immutable proof of when/where data was created</li>
  <li><strong>Verifiable credentials</strong>: Standard format for location claims</li>
  <li><strong>Self-sovereign</strong>: Users control their location data</li>
</ul>
<h2 id="how-it-works-location-proof-flow">
  
  
    <a href="#how-it-works-location-proof-flow" class="anchor-heading" aria-labelledby="how-it-works-location-proof-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How It Works: Location Proof Flow
  
  
</h2>
    

<pre><code class="language-mermaid">flowchart TD
    A["Location Provider&lt;br/&gt;GPS Device&lt;br/&gt;IoT Sensor&lt;br/&gt;Mobile App"] --&gt;|captures location| B["Location Data&lt;br/&gt;Coordinates lat/lon&lt;br/&gt;Timestamp&lt;br/&gt;Accuracy&lt;br/&gt;Device ID"]
    B --&gt;|issues credential| C["Verifiable Credential&lt;br/&gt;Location Claim&lt;br/&gt;Proof cryptographic&lt;br/&gt;Metadata"]
    C --&gt;|anchors to blockchain| D["Blockchain Anchor&lt;br/&gt;Immutable timestamp&lt;br/&gt;Location digest&lt;br/&gt;Integrity proof"]
    D --&gt;|stores in wallet| E["Location Wallet&lt;br/&gt;Stores location credentials&lt;br/&gt;Creates presentations&lt;br/&gt;Selective disclosure"]

    style A fill:#1976d2,stroke:#0d47a1,stroke-width:2px,color:#fff
    style B fill:#f57c00,stroke:#e65100,stroke-width:2px,color:#fff
    style C fill:#388e3c,stroke:#1b5e20,stroke-width:2px,color:#fff
    style D fill:#c2185b,stroke:#880e4f,stroke-width:2px,color:#fff
    style E fill:#7b1fa2,stroke:#4a148c,stroke-width:2px,color:#fff
</code></pre>
<h2 id="prerequisites">
  
  
    <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites
  
  
</h2>
    

<ul>
  <li>Java 21+</li>
  <li>Kotlin 2.2.0+</li>
  <li>Gradle 8.5+</li>
  <li>Basic understanding of Kotlin and coroutines</li>
  <li>Basic understanding of geospatial concepts (coordinates, bounding boxes)</li>
</ul>
<h2 id="step-1-add-dependencies">
  
  
    <a href="#step-1-add-dependencies" class="anchor-heading" aria-labelledby="step-1-add-dependencies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Add Dependencies
  
  
</h2>
    

<p>Add TrustWeave dependencies to your <code class="language-plaintext highlighter-rouge">build.gradle.kts</code>. These modules provide DID support, credential issuance, wallet storage, and the in-memory services used for location proofs.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nf">dependencies</span> <span class="p">{</span>
    <span class="c1">// Core TrustWeave modules</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-core:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-json:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-kms:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-did:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-anchor:1.0.0-SNAPSHOT"</span><span class="p">)</span>

    <span class="c1">// Test kit for in-memory implementations</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-testkit:1.0.0-SNAPSHOT"</span><span class="p">)</span>

    <span class="c1">// Kotlinx Serialization</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-serialization-json:1.6.0"</span><span class="p">)</span>

    <span class="c1">// Coroutines</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Result:</strong> With these dependencies synced, you can run the location proof samples without adding more modules or adapters.</p>
<h2 id="step-2-complete-example">
  
  
    <a href="#step-2-complete-example" class="anchor-heading" aria-labelledby="step-2-complete-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Complete Example
  
  
</h2>
    

<p>Here’s the complete proof-of-location workflow. Execute it once to see the happy path (capture → issue → store → present → verify → anchor) before you inspect each step in detail.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiableCredential</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiablePresentation</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialIssuanceOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialVerificationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.PresentationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.issuer.CredentialIssuer</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.verifier.CredentialVerifier</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.Ed25519ProofGenerator</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.ProofGeneratorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.credential.InMemoryWallet</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.did.DidKeyMockMethod</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.kms.InMemoryKeyManagementService</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.anchor.InMemoryBlockchainAnchorClient</span>
<span class="k">import</span> <span class="nn">com.trustweave.did.DidMethodRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.BlockchainAnchorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.anchorTyped</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.AnchorResult</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.Json</span>

<span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">LocationClaim</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">latitude</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">longitude</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">accuracy</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span> <span class="c1">// meters</span>
    <span class="kd">val</span> <span class="py">altitude</span><span class="p">:</span> <span class="nc">Double</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timestamp</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">deviceId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">locationMethod</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="s">"GPS"</span> <span class="c1">// GPS, WiFi, Cell Tower, etc.</span>
<span class="p">)</span>

<span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">LocationProof</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">locationClaim</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">credentialDigest</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">anchorRef</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
<span class="p">)</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"=== Proof of Location Scenario ===\n"</span><span class="p">)</span>

    <span class="c1">// Step 1: Setup services</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Step 1: Setting up services..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">locationProviderKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">verifierKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">didMethod</span> <span class="p">=</span> <span class="nc">DidKeyMockMethod</span><span class="p">(</span><span class="n">locationProviderKms</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">didRegistry</span> <span class="p">=</span> <span class="nc">DidMethodRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">didMethod</span><span class="p">)</span> <span class="p">}</span>

    <span class="c1">// Setup blockchain for anchoring</span>
    <span class="kd">val</span> <span class="py">anchorClient</span> <span class="p">=</span> <span class="nc">InMemoryBlockchainAnchorClient</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="nf">emptyMap</span><span class="p">())</span>
    <span class="kd">val</span> <span class="py">blockchainRegistry</span> <span class="p">=</span> <span class="nc">BlockchainAnchorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
        <span class="nf">register</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="n">anchorClient</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Step 2: Create DIDs</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 2: Creating DIDs..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">locationProviderDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Location Provider DID: ${locationProviderDid.id}"</span><span class="p">)</span>

    <span class="kd">val</span> <span class="py">deviceDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Device DID: ${deviceDid.id}"</span><span class="p">)</span>

    <span class="c1">// Step 3: Create location wallet</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 3: Creating location wallet..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">locationWallet</span> <span class="p">=</span> <span class="nc">InMemoryWallet</span><span class="p">(</span>
        <span class="n">walletDid</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span>
    <span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Location wallet created: ${locationWallet.walletId}"</span><span class="p">)</span>

    <span class="c1">// Step 4: Capture location data</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 4: Capturing location data..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">locationClaim</span> <span class="p">=</span> <span class="nc">LocationClaim</span><span class="p">(</span>
        <span class="n">latitude</span> <span class="p">=</span> <span class="mf">37.7749</span><span class="p">,</span>
        <span class="n">longitude</span> <span class="p">=</span> <span class="p">-</span><span class="mf">122.4194</span><span class="p">,</span>
        <span class="n">accuracy</span> <span class="p">=</span> <span class="mf">10.5</span><span class="p">,</span> <span class="c1">// 10.5 meters accuracy</span>
        <span class="n">altitude</span> <span class="p">=</span> <span class="mf">52.0</span><span class="p">,</span>
        <span class="n">timestamp</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">deviceId</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">locationMethod</span> <span class="p">=</span> <span class="s">"GPS"</span>
    <span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Location captured:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Coordinates: (${locationClaim.latitude}, ${locationClaim.longitude})"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Accuracy: ${locationClaim.accuracy} meters"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Timestamp: ${locationClaim.timestamp}"</span><span class="p">)</span>

    <span class="c1">// Step 5: Create location credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 5: Creating location credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">locationCredential</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/location/${deviceDid.id.substringAfterLast("</span><span class="p">:</span><span class="s">")}-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"LocationCredential"</span><span class="p">,</span> <span class="s">"ProofOfLocation"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">locationProviderDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
                <span class="n">locationClaim</span><span class="p">.</span><span class="n">altitude</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="nf">put</span><span class="p">(</span><span class="s">"altitude"</span><span class="p">,</span> <span class="n">it</span><span class="p">)</span> <span class="p">}</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"deviceId"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">deviceId</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"locationMethod"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">locationMethod</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span> <span class="c1">// Location proofs typically don't expire</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/location.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">// Step 6: Issue credential with proof</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 6: Issuing credential with proof..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">issuerKey</span> <span class="p">=</span> <span class="n">locationProviderKms</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span><span class="s">"Ed25519"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">proofGenerator</span> <span class="p">=</span> <span class="nc">Ed25519ProofGenerator</span><span class="p">(</span>
        <span class="n">signer</span> <span class="p">=</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">locationProviderKms</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">keyId</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="p">},</span>
        <span class="n">getPublicKeyId</span> <span class="p">=</span> <span class="p">{</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">issuerKey</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">proofRegistry</span> <span class="p">=</span> <span class="nc">ProofGeneratorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">proofGenerator</span><span class="p">)</span> <span class="p">}</span>

    <span class="kd">val</span> <span class="py">credentialIssuer</span> <span class="p">=</span> <span class="nc">CredentialIssuer</span><span class="p">(</span>
        <span class="n">proofGenerator</span> <span class="p">=</span> <span class="n">proofGenerator</span><span class="p">,</span>
        <span class="n">resolveDid</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">},</span>
        <span class="n">proofRegistry</span> <span class="p">=</span> <span class="n">proofRegistry</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">issuedCredential</span> <span class="p">=</span> <span class="n">credentialIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">locationCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">locationProviderDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">issuerKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Credential issued:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Type: ${issuedCredential.type}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Has proof: ${issuedCredential.proof != null}"</span><span class="p">)</span>

    <span class="c1">// Step 7: Compute digest and anchor to blockchain</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 7: Anchoring location proof to blockchain..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">credentialDigest</span> <span class="p">=</span> <span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
        <span class="n">kotlinx</span><span class="p">.</span><span class="n">serialization</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span>
            <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">issuedCredential</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">locationProof</span> <span class="p">=</span> <span class="nc">LocationProof</span><span class="p">(</span>
        <span class="n">locationClaim</span> <span class="p">=</span> <span class="n">locationClaim</span><span class="p">,</span>
        <span class="n">credentialDigest</span> <span class="p">=</span> <span class="n">credentialDigest</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">anchorResult</span> <span class="p">=</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="nf">anchorTyped</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">=</span> <span class="n">locationProof</span><span class="p">,</span>
        <span class="n">serializer</span> <span class="p">=</span> <span class="nc">LocationProof</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
        <span class="n">targetChainId</span> <span class="p">=</span> <span class="s">"eip155:1"</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Location proof anchored:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Transaction hash: ${anchorResult.ref.txHash}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Chain ID: ${anchorResult.ref.chainId}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Digest: $credentialDigest"</span><span class="p">)</span>

    <span class="c1">// Step 8: Store credential in wallet</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 8: Storing credential in wallet..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">credentialId</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">issuedCredential</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Credential stored with ID: $credentialId"</span><span class="p">)</span>

    <span class="c1">// Step 9: Organize location credentials</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 9: Organizing location credentials..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">locationCollection</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span>
        <span class="n">name</span> <span class="p">=</span> <span class="s">"Location History"</span><span class="p">,</span>
        <span class="n">description</span> <span class="p">=</span> <span class="s">"Historical location proofs"</span>
    <span class="p">)</span>
    <span class="n">locationWallet</span><span class="p">.</span><span class="nf">addToCollection</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="n">locationCollection</span><span class="p">)</span>

    <span class="c1">// Tag by location type</span>
    <span class="kd">val</span> <span class="py">locationTags</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
        <span class="n">locationClaim</span><span class="p">.</span><span class="n">latitude</span> <span class="p">&gt;</span> <span class="mf">37.7</span> <span class="p">&amp;&amp;</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">latitude</span> <span class="p">&lt;</span> <span class="mf">37.8</span> <span class="p">-&gt;</span>
            <span class="nf">setOf</span><span class="p">(</span><span class="s">"san-francisco"</span><span class="p">,</span> <span class="s">"california"</span><span class="p">,</span> <span class="s">"usa"</span><span class="p">,</span> <span class="s">"gps"</span><span class="p">)</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="nf">setOf</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="s">"gps"</span><span class="p">,</span> <span class="s">"verified"</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="n">locationWallet</span><span class="p">.</span><span class="nf">tagCredential</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="n">locationTags</span><span class="p">)</span>

    <span class="c1">// Add metadata</span>
    <span class="n">locationWallet</span><span class="p">.</span><span class="nf">addMetadata</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="nf">mapOf</span><span class="p">(</span>
        <span class="s">"city"</span> <span class="n">to</span> <span class="s">"San Francisco"</span><span class="p">,</span>
        <span class="s">"country"</span> <span class="n">to</span> <span class="s">"USA"</span><span class="p">,</span>
        <span class="s">"anchorTxHash"</span> <span class="n">to</span> <span class="n">anchorResult</span><span class="p">.</span><span class="n">ref</span><span class="p">.</span><span class="n">txHash</span><span class="p">,</span>
        <span class="s">"accuracy"</span> <span class="n">to</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">accuracy</span>
    <span class="p">))</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Created collection: $locationCollection"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Added tags: ${locationTags.joinToString()}"</span><span class="p">)</span>

    <span class="c1">// Step 10: Query location credentials</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 10: Querying location credentials..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">recentLocations</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">query</span> <span class="p">{</span>
        <span class="nf">byType</span><span class="p">(</span><span class="s">"LocationCredential"</span><span class="p">)</span>
        <span class="nf">valid</span><span class="p">()</span>
    <span class="p">}</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Found ${recentLocations.size} valid location credentials"</span><span class="p">)</span>

    <span class="c1">// Find locations in specific area (using tags)</span>
    <span class="kd">val</span> <span class="py">sfLocations</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">findByTag</span><span class="p">(</span><span class="s">"san-francisco"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"San Francisco locations: ${sfLocations.size}"</span><span class="p">)</span>

    <span class="c1">// Step 11: Create location presentation with selective disclosure</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 11: Creating location presentation..."</span><span class="p">)</span>

    <span class="c1">// Selective disclosure: reveal approximate location but not exact coordinates</span>
    <span class="kd">val</span> <span class="py">approximatePresentation</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">createSelectiveDisclosure</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
        <span class="n">disclosedFields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
            <span class="s">"location.timestamp"</span><span class="p">,</span>
            <span class="s">"location.locationMethod"</span>
            <span class="c1">// Exact coordinates NOT disclosed for privacy</span>
        <span class="p">),</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"location-verification-${Instant.now().toEpochMilli()}"</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Approximate location presentation created (coordinates hidden)"</span><span class="p">)</span>

    <span class="c1">// Full location presentation (for trusted verifiers)</span>
    <span class="kd">val</span> <span class="py">fullPresentation</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">createPresentation</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"full-location-verification"</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Full location presentation created"</span><span class="p">)</span>

    <span class="c1">// Step 12: Verify location credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 12: Verifying location credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">verifier</span> <span class="p">=</span> <span class="nc">CredentialVerifier</span><span class="p">(</span><span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span> <span class="o">?:</span> <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"Device DID not found"</span><span class="p">))</span>

    <span class="kd">val</span> <span class="py">verificationResult</span> <span class="p">=</span> <span class="n">verifier</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">issuedCredential</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialVerificationOptions</span><span class="p">(</span>
            <span class="n">checkRevocation</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
            <span class="n">checkExpiration</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span> <span class="c1">// Location proofs don't expire</span>
            <span class="n">validateSchema</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
            <span class="n">didResolver</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">}</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verificationResult</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Location credential is valid!"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Proof valid: ${verificationResult.proofValid}"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Issuer valid: ${verificationResult.issuerValid}"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Schema valid: ${verificationResult.schemaValid}"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Location credential verification failed:"</span><span class="p">)</span>
        <span class="n">verificationResult</span><span class="p">.</span><span class="n">errors</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="s">"  - $it"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Step 13: Verify blockchain anchor</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 13: Verifying blockchain anchor..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">retrievedProof</span> <span class="p">=</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="n">readTyped</span><span class="p">&lt;</span><span class="nc">LocationProof</span><span class="p">&gt;(</span>
        <span class="n">ref</span> <span class="p">=</span> <span class="n">anchorResult</span><span class="p">.</span><span class="n">ref</span><span class="p">,</span>
        <span class="n">serializer</span> <span class="p">=</span> <span class="nc">LocationProof</span><span class="p">.</span><span class="nf">serializer</span><span class="p">()</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">retrievedDigest</span> <span class="p">=</span> <span class="n">retrievedProof</span><span class="p">.</span><span class="n">credentialDigest</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">retrievedDigest</span> <span class="p">==</span> <span class="n">credentialDigest</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Blockchain anchor verified!"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Digest matches: $retrievedDigest"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Location proof is immutable"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Digest mismatch - location proof may have been tampered with"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Step 14: Location-based queries</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 14: Location-based queries..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">stats</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">getStatistics</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"""
        Location Wallet Statistics:
        - Total location credentials: ${stats.totalCredentials}
        - Valid credentials: ${stats.validCredentials}
        - Collections: ${stats.collectionsCount}
        - Tags: ${stats.tagsCount}
    """</span><span class="p">.</span><span class="nf">trimIndent</span><span class="p">())</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"\n=== Scenario Complete ==="</span><span class="p">)</span>
<span class="p">}</span>

<span class="p">**</span><span class="nc">Result</span><span class="p">:**</span> <span class="nc">Console</span> <span class="n">output</span> <span class="n">walks</span> <span class="n">through</span> <span class="n">each</span> <span class="n">milestone</span><span class="err">—</span><span class="n">location</span> <span class="n">capture</span><span class="p">,</span> <span class="n">credential</span> <span class="n">issuance</span><span class="p">,</span> <span class="n">wallet</span> <span class="n">storage</span><span class="p">,</span> <span class="n">presentation</span><span class="p">,</span> <span class="n">verification</span><span class="p">,</span> <span class="n">anchoring</span><span class="p">.</span> <span class="nc">Use</span> <span class="n">it</span> <span class="k">as</span> <span class="n">your</span> <span class="n">regression</span> <span class="n">baseline</span><span class="p">.</span>

<span class="err">##</span> <span class="nc">Step-by-Step</span> <span class="nc">Breakdown</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="nc">Setup</span> <span class="nc">Services</span>

<span class="nc">Captures</span> <span class="n">a</span> <span class="n">raw</span> <span class="n">location</span> <span class="n">claim</span> <span class="n">and</span> <span class="n">sets</span> <span class="n">up</span> <span class="nc">DID</span> <span class="n">registries</span><span class="p">,</span> <span class="n">wallets</span><span class="p">,</span> <span class="n">and</span> <span class="n">proof</span> <span class="n">generators</span> <span class="k">for</span> <span class="n">both</span> <span class="n">provider</span> <span class="n">and</span> <span class="n">verifier</span><span class="p">.</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Outcome</span><span class="p">:**</span> <span class="nc">The</span> <span class="n">environment</span> <span class="n">mirrors</span> <span class="n">a</span> <span class="n">decentralised</span> <span class="n">location</span> <span class="n">system</span> <span class="n">without</span> <span class="k">external</span> <span class="n">infrastructure</span><span class="p">.</span>

<span class="err">``</span><span class="n">`kotlin</span>
<span class="kd">val</span> <span class="py">locationProviderKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
<span class="kd">val</span> <span class="py">anchorClient</span> <span class="p">=</span> <span class="nc">InMemoryBlockchainAnchorClient</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="nf">emptyMap</span><span class="p">())</span>
<span class="kd">val</span> <span class="py">blockchainRegistry</span> <span class="p">=</span> <span class="nc">BlockchainAnchorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
    <span class="nf">register</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="n">anchorClient</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="step-2-create-location-claim">
  
  
    <a href="#step-2-create-location-claim" class="anchor-heading" aria-labelledby="step-2-create-location-claim"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Create Location Claim
  
  
</h3>
    

<p>Capture location data from device:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">locationClaim</span> <span class="p">=</span> <span class="nc">LocationClaim</span><span class="p">(</span>
    <span class="n">latitude</span> <span class="p">=</span> <span class="mf">37.7749</span><span class="p">,</span>
    <span class="n">longitude</span> <span class="p">=</span> <span class="p">-</span><span class="mf">122.4194</span><span class="p">,</span>
    <span class="n">accuracy</span> <span class="p">=</span> <span class="mf">10.5</span><span class="p">,</span> <span class="c1">// meters</span>
    <span class="n">timestamp</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
    <span class="n">deviceId</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">locationMethod</span> <span class="p">=</span> <span class="s">"GPS"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="step-3-create-location-credential">
  
  
    <a href="#step-3-create-location-credential" class="anchor-heading" aria-labelledby="step-3-create-location-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3: Create Location Credential
  
  
</h3>
    

<p>Create a verifiable credential for the location:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">locationCredential</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
    <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"LocationCredential"</span><span class="p">),</span>
    <span class="n">issuer</span> <span class="p">=</span> <span class="n">locationProviderDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
        <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">locationClaim</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="p">})</span>
    <span class="p">},</span>
    <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="step-4-issue-and-anchor">
  
  
    <a href="#step-4-issue-and-anchor" class="anchor-heading" aria-labelledby="step-4-issue-and-anchor"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4: Issue and Anchor
  
  
</h3>
    

<p>Issues a location credential with typed geospatial claims plus metadata (accuracy, method, timestamp).</p>
<ul>
  <li><strong>Outcome:</strong> <code class="language-plaintext highlighter-rouge">locationCredential</code> is ready to store, present, and anchor.</li>
</ul>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">issuedCredential</span> <span class="p">=</span> <span class="n">credentialIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>

<span class="kd">val</span> <span class="py">credentialDigest</span> <span class="p">=</span> <span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
    <span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span><span class="n">issuedCredential</span><span class="p">)</span>
<span class="p">)</span>

<span class="kd">val</span> <span class="py">locationProof</span> <span class="p">=</span> <span class="nc">LocationProof</span><span class="p">(</span>
    <span class="n">locationClaim</span> <span class="p">=</span> <span class="n">locationClaim</span><span class="p">,</span>
    <span class="n">credentialDigest</span> <span class="p">=</span> <span class="n">credentialDigest</span>
<span class="p">)</span>

<span class="kd">val</span> <span class="py">anchorResult</span> <span class="p">=</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="nf">anchorTyped</span><span class="p">(</span>
    <span class="n">value</span> <span class="p">=</span> <span class="n">locationProof</span><span class="p">,</span>
    <span class="n">serializer</span> <span class="p">=</span> <span class="nc">LocationProof</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
    <span class="n">targetChainId</span> <span class="p">=</span> <span class="s">"eip155:1"</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="step-5-store-and-organize">
  
  
    <a href="#step-5-store-and-organize" class="anchor-heading" aria-labelledby="step-5-store-and-organize"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5: Store and Organize
  
  
</h3>
    

<p>Stores the credential in the user’s wallet so it can be queried and presented later.</p>
<ul>
  <li><strong>Outcome:</strong> The user gains custody of the proof for subsequent sharing.</li>
</ul>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
</pre></td><td class="rouge-code"><pre><span class="kd">val</span> <span class="py">credentialId</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">issuedCredential</span><span class="p">)</span>

<span class="kd">val</span> <span class="py">locationCollection</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">createCollection</span><span class="p">(</span><span class="s">"Location History"</span><span class="p">)</span>
<span class="n">locationWallet</span><span class="p">.</span><span class="nf">addToCollection</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="n">locationCollection</span><span class="p">)</span>
<span class="n">locationWallet</span><span class="p">.</span><span class="nf">tagCredential</span><span class="p">(</span><span class="n">credentialId</span><span class="p">,</span> <span class="nf">setOf</span><span class="p">(</span><span class="s">"san-francisco"</span><span class="p">,</span> <span class="s">"gps"</span><span class="p">))</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="step-6-selective-disclosure">
  
  
    <a href="#step-6-selective-disclosure" class="anchor-heading" aria-labelledby="step-6-selective-disclosure"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 6: Selective Disclosure
  
  
</h3>
    

<p>Share location with privacy:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
</pre></td><td class="rouge-code"><pre><span class="c1">// Approximate location (privacy-preserving)</span>
<span class="kd">val</span> <span class="py">approximatePresentation</span> <span class="p">=</span> <span class="n">locationWallet</span><span class="p">.</span><span class="nf">createSelectiveDisclosure</span><span class="p">(</span>
    <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
    <span class="n">disclosedFields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
        <span class="s">"location.timestamp"</span><span class="p">,</span>
        <span class="s">"location.locationMethod"</span>
        <span class="c1">// Coordinates hidden</span>
    <span class="p">),</span>
    <span class="n">holderDid</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="advanced-geospatial-features">
  
  
    <a href="#advanced-geospatial-features" class="anchor-heading" aria-labelledby="advanced-geospatial-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced Geospatial Features
  
  
</h2>
    
<h3 id="geofencing-verification">
  
  
    <a href="#geofencing-verification" class="anchor-heading" aria-labelledby="geofencing-verification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Geofencing Verification
  
  
</h3>
    

<p>Verify location within a geographic boundary:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">verifyLocationInGeofence</span><span class="p">(</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span><span class="p">,</span>
    <span class="n">minLat</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">maxLat</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">minLon</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">maxLon</span><span class="p">:</span> <span class="nc">Double</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">location</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"location"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>

    <span class="kd">val</span> <span class="py">lat</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>
    <span class="kd">val</span> <span class="py">lon</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>

    <span class="k">return</span> <span class="n">lat</span> <span class="k">in</span> <span class="n">minLat</span><span class="o">..</span><span class="n">maxLat</span> <span class="p">&amp;&amp;</span> <span class="n">lon</span> <span class="k">in</span> <span class="n">minLon</span><span class="o">..</span><span class="n">maxLon</span>
<span class="p">}</span>

<span class="c1">// Usage: Verify device is in San Francisco</span>
<span class="kd">val</span> <span class="py">inSF</span> <span class="p">=</span> <span class="nf">verifyLocationInGeofence</span><span class="p">(</span>
    <span class="n">credential</span> <span class="p">=</span> <span class="n">issuedCredential</span><span class="p">,</span>
    <span class="n">minLat</span> <span class="p">=</span> <span class="mf">37.7</span><span class="p">,</span>
    <span class="n">maxLat</span> <span class="p">=</span> <span class="mf">37.8</span><span class="p">,</span>
    <span class="n">minLon</span> <span class="p">=</span> <span class="p">-</span><span class="mf">122.5</span><span class="p">,</span>
    <span class="n">maxLon</span> <span class="p">=</span> <span class="p">-</span><span class="mf">122.3</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="distance-based-verification">
  
  
    <a href="#distance-based-verification" class="anchor-heading" aria-labelledby="distance-based-verification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Distance-Based Verification
  
  
</h3>
    

<p>Verify location within a certain distance:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">verifyLocationWithinDistance</span><span class="p">(</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span><span class="p">,</span>
    <span class="n">targetLat</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">targetLon</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">maxDistance</span><span class="p">:</span> <span class="nc">Double</span> <span class="c1">// meters</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">location</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"location"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>

    <span class="kd">val</span> <span class="py">lat</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>
    <span class="kd">val</span> <span class="py">lon</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>
    <span class="kd">val</span> <span class="py">accuracy</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"accuracy"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="nc">Double</span><span class="p">.</span><span class="nc">MAX_VALUE</span>

    <span class="kd">val</span> <span class="py">distance</span> <span class="p">=</span> <span class="nf">calculateHaversineDistance</span><span class="p">(</span><span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span> <span class="n">targetLat</span><span class="p">,</span> <span class="n">targetLon</span><span class="p">)</span>

    <span class="c1">// Account for location accuracy</span>
    <span class="k">return</span> <span class="n">distance</span> <span class="p">&lt;=</span> <span class="p">(</span><span class="n">maxDistance</span> <span class="p">+</span> <span class="n">accuracy</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Haversine formula for great-circle distance</span>
<span class="k">fun</span> <span class="nf">calculateHaversineDistance</span><span class="p">(</span>
    <span class="n">lat1</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">lon1</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">lat2</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="n">lon2</span><span class="p">:</span> <span class="nc">Double</span>
<span class="p">):</span> <span class="nc">Double</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">earthRadius</span> <span class="p">=</span> <span class="mf">6371000.0</span> <span class="c1">// meters</span>
    <span class="kd">val</span> <span class="py">dLat</span> <span class="p">=</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">toRadians</span><span class="p">(</span><span class="n">lat2</span> <span class="p">-</span> <span class="n">lat1</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">dLon</span> <span class="p">=</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">toRadians</span><span class="p">(</span><span class="n">lon2</span> <span class="p">-</span> <span class="n">lon1</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">a</span> <span class="p">=</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dLat</span> <span class="p">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">*</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dLat</span> <span class="p">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">+</span>
            <span class="nc">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nc">Math</span><span class="p">.</span><span class="nf">toRadians</span><span class="p">(</span><span class="n">lat1</span><span class="p">))</span> <span class="p">*</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">cos</span><span class="p">(</span><span class="nc">Math</span><span class="p">.</span><span class="nf">toRadians</span><span class="p">(</span><span class="n">lat2</span><span class="p">))</span> <span class="p">*</span>
            <span class="nc">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dLon</span> <span class="p">/</span> <span class="mi">2</span><span class="p">)</span> <span class="p">*</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">sin</span><span class="p">(</span><span class="n">dLon</span> <span class="p">/</span> <span class="mi">2</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">c</span> <span class="p">=</span> <span class="mi">2</span> <span class="p">*</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">atan2</span><span class="p">(</span><span class="nc">Math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="n">a</span><span class="p">),</span> <span class="nc">Math</span><span class="p">.</span><span class="nf">sqrt</span><span class="p">(</span><span class="mi">1</span> <span class="p">-</span> <span class="n">a</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">earthRadius</span> <span class="p">*</span> <span class="n">c</span>
<span class="p">}</span>

<span class="err">###</span> <span class="nc">Privacy-Preserving</span> <span class="nc">Location</span> <span class="nc">Sharing</span>

<span class="nc">Share</span> <span class="n">location</span> <span class="n">without</span> <span class="n">revealing</span> <span class="n">exact</span> <span class="n">coordinates</span><span class="p">:</span>

<span class="err">``</span><span class="n">`kotlin</span>
<span class="k">fun</span> <span class="nf">createPrivacyPreservingLocationPresentation</span><span class="p">(</span>
    <span class="n">wallet</span><span class="p">:</span> <span class="nc">Wallet</span><span class="p">,</span>
    <span class="n">credentialId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">privacyLevel</span><span class="p">:</span> <span class="nc">PrivacyLevel</span>
<span class="p">):</span> <span class="nc">VerifiablePresentation</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">when</span> <span class="p">(</span><span class="n">privacyLevel</span><span class="p">)</span> <span class="p">{</span>
        <span class="nc">PrivacyLevel</span><span class="p">.</span><span class="nc">EXACT</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="c1">// Share exact coordinates</span>
            <span class="n">wallet</span><span class="p">.</span><span class="nf">createPresentation</span><span class="p">(</span>
                <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
                <span class="n">holderDid</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="n">holderDid</span><span class="p">,</span>
                <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="nc">PrivacyLevel</span><span class="p">.</span><span class="nc">APPROXIMATE</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="c1">// Share approximate location (rounded coordinates)</span>
            <span class="n">wallet</span><span class="p">.</span><span class="nf">createSelectiveDisclosure</span><span class="p">(</span>
                <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
                <span class="n">disclosedFields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                    <span class="s">"location.timestamp"</span><span class="p">,</span>
                    <span class="s">"location.locationMethod"</span>
                    <span class="c1">// Coordinates rounded/obfuscated</span>
                <span class="p">),</span>
                <span class="n">holderDid</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="n">holderDid</span><span class="p">,</span>
                <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>
            <span class="p">)</span>
        <span class="p">}</span>
        <span class="nc">PrivacyLevel</span><span class="p">.</span><span class="nc">REGION</span> <span class="p">-&gt;</span> <span class="p">{</span>
            <span class="c1">// Share only region/city, not coordinates</span>
            <span class="n">wallet</span><span class="p">.</span><span class="nf">createSelectiveDisclosure</span><span class="p">(</span>
                <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
                <span class="n">disclosedFields</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
                    <span class="s">"location.timestamp"</span>
                    <span class="c1">// Only timestamp, no coordinates</span>
                <span class="p">),</span>
                <span class="n">holderDid</span> <span class="p">=</span> <span class="n">wallet</span><span class="p">.</span><span class="n">holderDid</span><span class="p">,</span>
                <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span><span class="o">..</span><span class="p">.)</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">enum</span> <span class="kd">class</span> <span class="nc">PrivacyLevel</span> <span class="p">{</span>
    <span class="nc">EXACT</span><span class="p">,</span>      <span class="c1">// Exact coordinates</span>
    <span class="nc">APPROXIMATE</span><span class="p">,</span> <span class="c1">// Approximate location</span>
    <span class="nc">REGION</span>      <span class="c1">// Region only</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p>data class BoundingBox(
    val minLat: Double,
    val maxLat: Double,
    val minLon: Double,
    val maxLon: Double
)</p>
<h2 id="real-world-use-cases">
  
  
    <a href="#real-world-use-cases" class="anchor-heading" aria-labelledby="real-world-use-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-World Use Cases
  
  
</h2>
    
<h3 id="1-emergency-response-ng9-1-1">
  
  
    <a href="#1-emergency-response-ng9-1-1" class="anchor-heading" aria-labelledby="1-emergency-response-ng9-1-1"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Emergency Response (NG9-1-1)
  
  
</h3>
    

<p>Verify caller location for emergency services:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createEmergencyLocationCredential</span><span class="p">(</span>
    <span class="n">callerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">location</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">,</span>
    <span class="n">emergencyType</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"EmergencyLocationCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">emergencyServiceDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">callerDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"emergencyType"</span><span class="p">,</span> <span class="n">emergencyType</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="2-vehicular-network-security">
  
  
    <a href="#2-vehicular-network-security" class="anchor-heading" aria-labelledby="2-vehicular-network-security"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Vehicular Network Security
  
  
</h3>
    

<p>Prevent Sybil attacks in VANETs using location proofs:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createVehicleLocationProof</span><span class="p">(</span>
    <span class="n">vehicleDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">location</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">,</span>
    <span class="n">roadsideUnitDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"VehicleLocationProof"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">roadsideUnitDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">vehicleDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"roadsideUnit"</span><span class="p">,</span> <span class="n">roadsideUnitDid</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="n">location</span><span class="p">.</span><span class="n">timestamp</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Verify vehicle trajectory using multiple proofs</span>
<span class="k">fun</span> <span class="nf">verifyVehicleTrajectory</span><span class="p">(</span>
    <span class="n">locationProofs</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="c1">// Check proofs are from different roadside units</span>
    <span class="kd">val</span> <span class="py">issuers</span> <span class="p">=</span> <span class="n">locationProofs</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">issuer</span> <span class="p">}.</span><span class="nf">toSet</span><span class="p">()</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">issuers</span><span class="p">.</span><span class="n">size</span> <span class="p">&lt;</span> <span class="mi">2</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span> <span class="c1">// Need multiple sources</span>

    <span class="c1">// Verify temporal sequence</span>
    <span class="kd">val</span> <span class="py">timestamps</span> <span class="p">=</span> <span class="n">locationProofs</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">credential</span> <span class="p">-&gt;</span>
        <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"location"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
            <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
    <span class="p">}.</span><span class="nf">sorted</span><span class="p">()</span>

    <span class="c1">// Check timestamps are sequential</span>
    <span class="k">return</span> <span class="n">timestamps</span><span class="p">.</span><span class="nf">zipWithNext</span><span class="p">().</span><span class="nf">all</span> <span class="p">{</span> <span class="p">(</span><span class="n">t1</span><span class="p">,</span> <span class="n">t2</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="nc">Instant</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">t1</span><span class="p">).</span><span class="nf">isBefore</span><span class="p">(</span><span class="nc">Instant</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="n">t2</span><span class="p">))</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="3-cloud-data-location-verification">
  
  
    <a href="#3-cloud-data-location-verification" class="anchor-heading" aria-labelledby="3-cloud-data-location-verification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Cloud Data Location Verification
  
  
</h3>
    

<p>Verify data is stored in authorized geographic locations:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createDataLocationCredential</span><span class="p">(</span>
    <span class="n">dataHash</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">storageLocation</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">,</span>
    <span class="n">dataCenterDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"DataLocationCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">dataCenterDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"dataHash"</span><span class="p">,</span> <span class="n">dataHash</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"storageLocation"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">storageLocation</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">storageLocation</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"dataCenter"</span><span class="p">,</span> <span class="n">dataCenterDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">storageLocation</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="n">storageLocation</span><span class="p">.</span><span class="n">timestamp</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Verify data is in authorized region</span>
<span class="k">fun</span> <span class="nf">verifyDataLocationCompliance</span><span class="p">(</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span><span class="p">,</span>
    <span class="n">allowedRegions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">BoundingBox</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">location</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"storageLocation"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>

    <span class="kd">val</span> <span class="py">lat</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>
    <span class="kd">val</span> <span class="py">lon</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>

    <span class="k">return</span> <span class="n">allowedRegions</span><span class="p">.</span><span class="nf">any</span> <span class="p">{</span> <span class="n">region</span> <span class="p">-&gt;</span>
        <span class="n">lat</span> <span class="k">in</span> <span class="n">region</span><span class="p">.</span><span class="n">minLat</span><span class="o">..</span><span class="n">region</span><span class="p">.</span><span class="n">maxLat</span> <span class="p">&amp;&amp;</span> <span class="n">lon</span> <span class="k">in</span> <span class="n">region</span><span class="p">.</span><span class="n">minLon</span><span class="o">..</span><span class="n">region</span><span class="p">.</span><span class="n">maxLon</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="4-multimedia-content-authentication">
  
  
    <a href="#4-multimedia-content-authentication" class="anchor-heading" aria-labelledby="4-multimedia-content-authentication"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Multimedia Content Authentication
  
  
</h3>
    

<p>Verify location where media was captured (like ProofMode):</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createMediaLocationCredential</span><span class="p">(</span>
    <span class="n">mediaHash</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">captureLocation</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">,</span>
    <span class="n">deviceDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">mediaType</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"MediaLocationCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">deviceDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"mediaHash"</span><span class="p">,</span> <span class="n">mediaHash</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"mediaType"</span><span class="p">,</span> <span class="n">mediaType</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"captureLocation"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">captureLocation</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">captureLocation</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">captureLocation</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">captureLocation</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"deviceId"</span><span class="p">,</span> <span class="n">deviceDid</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="n">captureLocation</span><span class="p">.</span><span class="n">timestamp</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Verify media authenticity</span>
<span class="k">fun</span> <span class="nf">verifyMediaLocation</span><span class="p">(</span>
    <span class="n">mediaHash</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">claimedLocation</span><span class="p">:</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Double</span><span class="p">,</span> <span class="nc">Double</span><span class="p">&gt;,</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">credentialHash</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"mediaHash"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">credentialHash</span> <span class="p">!=</span> <span class="n">mediaHash</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

    <span class="kd">val</span> <span class="py">location</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"captureLocation"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>

    <span class="kd">val</span> <span class="py">lat</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"latitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>
    <span class="kd">val</span> <span class="py">lon</span> <span class="p">=</span> <span class="n">location</span><span class="p">[</span><span class="s">"longitude"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">toDouble</span><span class="p">()</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>

    <span class="kd">val</span> <span class="py">distance</span> <span class="p">=</span> <span class="nf">calculateHaversineDistance</span><span class="p">(</span>
        <span class="n">lat</span><span class="p">,</span> <span class="n">lon</span><span class="p">,</span>
        <span class="n">claimedLocation</span><span class="p">.</span><span class="n">first</span><span class="p">,</span>
        <span class="n">claimedLocation</span><span class="p">.</span><span class="n">second</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">distance</span> <span class="p">&lt;</span> <span class="mf">100.0</span> <span class="c1">// Within 100 meters</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="5-supply-chain-tracking">
  
  
    <a href="#5-supply-chain-tracking" class="anchor-heading" aria-labelledby="5-supply-chain-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 5. Supply Chain Tracking
  
  
</h3>
    

<p>Track products through supply chain with location proofs:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createSupplyChainLocationProof</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">location</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">,</span>
    <span class="n">facility</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">timestamp</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"SupplyChainLocationCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">facilityDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"facility"</span><span class="p">,</span> <span class="n">facility</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="n">timestamp</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="6-iot-device-location">
  
  
    <a href="#6-iot-device-location" class="anchor-heading" aria-labelledby="6-iot-device-location"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 6. IoT Device Location
  
  
</h3>
    

<p>Track IoT device locations:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createIoTLocationCredential</span><span class="p">(</span>
    <span class="n">deviceId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">location</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">,</span>
    <span class="n">sensorData</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Any</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"IoTLocationCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">iotGatewayDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"deviceId"</span><span class="p">,</span> <span class="n">deviceId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">location</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"sensorData"</span><span class="p">,</span> <span class="n">sensorData</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="n">location</span><span class="p">.</span><span class="n">timestamp</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="decentralized-geospatial-data-sharing">
  
  
    <a href="#decentralized-geospatial-data-sharing" class="anchor-heading" aria-labelledby="decentralized-geospatial-data-sharing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Decentralized Geospatial Data Sharing
  
  
</h3>
    

<p>Share geospatial datasets with verifiable provenance:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
</pre></td><td class="rouge-code"><pre><span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">GeospatialDataset</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">datasetId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">name</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">boundingBox</span><span class="p">:</span> <span class="nc">BoundingBox</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">dataHash</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">format</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="s">"GeoJSON"</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">crs</span><span class="p">:</span> <span class="nc">String</span> <span class="p">=</span> <span class="s">"EPSG:4326"</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">providerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timestamp</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

<span class="k">fun</span> <span class="nf">createGeospatialDatasetCredential</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="nc">GeospatialDataset</span><span class="p">,</span>
    <span class="n">issuerDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"GeospatialDatasetCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"datasetId"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">datasetId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"name"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">name</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"description"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">description</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"boundingBox"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"minLat"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">boundingBox</span><span class="p">.</span><span class="n">minLat</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"maxLat"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">boundingBox</span><span class="p">.</span><span class="n">maxLat</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"minLon"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">boundingBox</span><span class="p">.</span><span class="n">minLon</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"maxLon"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">boundingBox</span><span class="p">.</span><span class="n">maxLon</span><span class="p">)</span>
            <span class="p">})</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"dataHash"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">dataHash</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"format"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">format</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"crs"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">crs</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"providerDid"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">providerDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="n">dataset</span><span class="p">.</span><span class="n">timestamp</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Anchor dataset metadata to blockchain</span>
<span class="k">fun</span> <span class="nf">anchorGeospatialDataset</span><span class="p">(</span>
    <span class="n">dataset</span><span class="p">:</span> <span class="nc">GeospatialDataset</span><span class="p">,</span>
    <span class="n">blockchainRegistry</span><span class="p">:</span> <span class="nc">BlockchainAnchorRegistry</span><span class="p">,</span>
    <span class="n">chainId</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">AnchorResult</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">credential</span> <span class="p">=</span> <span class="nf">createGeospatialDatasetCredential</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">dataset</span><span class="p">.</span><span class="n">providerDid</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">digest</span> <span class="p">=</span> <span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
        <span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span><span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span> <span class="n">credential</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="nf">anchorTyped</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">=</span> <span class="nc">LocationProof</span><span class="p">(</span><span class="n">dataset</span><span class="p">,</span> <span class="n">digest</span><span class="p">),</span>
        <span class="n">serializer</span> <span class="p">=</span> <span class="nc">LocationProof</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
        <span class="n">targetChainId</span> <span class="p">=</span> <span class="n">chainId</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="multi-source-location-verification">
  
  
    <a href="#multi-source-location-verification" class="anchor-heading" aria-labelledby="multi-source-location-verification"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Source Location Verification
  
  
</h3>
    

<p>Verify location using multiple sources (GPS, WiFi, Cell Tower):</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createMultiSourceLocationCredential</span><span class="p">(</span>
    <span class="n">deviceDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">gpsLocation</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">?,</span>
    <span class="n">wifiLocation</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">?,</span>
    <span class="n">cellLocation</span><span class="p">:</span> <span class="nc">LocationClaim</span><span class="p">?,</span>
    <span class="n">issuerDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">locations</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
        <span class="n">gpsLocation</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"gps"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">}</span>
        <span class="n">wifiLocation</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"wifi"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">}</span>
        <span class="n">cellLocation</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"cell"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">latitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">longitude</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"accuracy"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">accuracy</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"timestamp"</span><span class="p">,</span> <span class="n">it</span><span class="p">.</span><span class="n">timestamp</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Calculate consensus location</span>
    <span class="kd">val</span> <span class="py">consensusLocation</span> <span class="p">=</span> <span class="nf">calculateConsensusLocation</span><span class="p">(</span>
        <span class="nf">listOfNotNull</span><span class="p">(</span><span class="n">gpsLocation</span><span class="p">,</span> <span class="n">wifiLocation</span><span class="p">,</span> <span class="n">cellLocation</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"MultiSourceLocationCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">deviceDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"locations"</span><span class="p">,</span> <span class="n">locations</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"consensus"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"latitude"</span><span class="p">,</span> <span class="n">consensusLocation</span><span class="p">.</span><span class="n">first</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"longitude"</span><span class="p">,</span> <span class="n">consensusLocation</span><span class="p">.</span><span class="n">second</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"confidence"</span><span class="p">,</span> <span class="n">consensusLocation</span><span class="p">.</span><span class="n">third</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">calculateConsensusLocation</span><span class="p">(</span>
    <span class="n">locations</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">LocationClaim</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">Triple</span><span class="p">&lt;</span><span class="nc">Double</span><span class="p">,</span> <span class="nc">Double</span><span class="p">,</span> <span class="nc">Double</span><span class="p">&gt;</span> <span class="p">{</span> <span class="c1">// lat, lon, confidence</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">locations</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"At least one location required"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Weighted average based on accuracy (lower accuracy = higher weight)</span>
    <span class="kd">val</span> <span class="py">weights</span> <span class="p">=</span> <span class="n">locations</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="mf">1.0</span> <span class="p">/</span> <span class="n">it</span><span class="p">.</span><span class="n">accuracy</span> <span class="p">}</span>
    <span class="kd">val</span> <span class="py">totalWeight</span> <span class="p">=</span> <span class="n">weights</span><span class="p">.</span><span class="nf">sum</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">avgLat</span> <span class="p">=</span> <span class="n">locations</span><span class="p">.</span><span class="nf">zip</span><span class="p">(</span><span class="n">weights</span><span class="p">).</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="n">loc</span><span class="p">.</span><span class="n">latitude</span> <span class="p">*</span> <span class="n">weight</span>
    <span class="p">}</span> <span class="p">/</span> <span class="n">totalWeight</span>

    <span class="kd">val</span> <span class="py">avgLon</span> <span class="p">=</span> <span class="n">locations</span><span class="p">.</span><span class="nf">zip</span><span class="p">(</span><span class="n">weights</span><span class="p">).</span><span class="nf">sumOf</span> <span class="p">{</span> <span class="p">(</span><span class="n">loc</span><span class="p">,</span> <span class="n">weight</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="n">loc</span><span class="p">.</span><span class="n">longitude</span> <span class="p">*</span> <span class="n">weight</span>
    <span class="p">}</span> <span class="p">/</span> <span class="n">totalWeight</span>

    <span class="c1">// Confidence based on number of sources and agreement</span>
    <span class="kd">val</span> <span class="py">confidence</span> <span class="p">=</span> <span class="k">when</span> <span class="p">{</span>
        <span class="n">locations</span><span class="p">.</span><span class="n">size</span> <span class="p">&gt;=</span> <span class="mi">3</span> <span class="p">-&gt;</span> <span class="mf">0.95</span>
        <span class="n">locations</span><span class="p">.</span><span class="n">size</span> <span class="p">==</span> <span class="mi">2</span> <span class="p">-&gt;</span> <span class="mf">0.85</span>
        <span class="k">else</span> <span class="p">-&gt;</span> <span class="mf">0.70</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nc">Triple</span><span class="p">(</span><span class="n">avgLat</span><span class="p">,</span> <span class="n">avgLon</span><span class="p">,</span> <span class="n">confidence</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="benefits">
  
  
    <a href="#benefits" class="anchor-heading" aria-labelledby="benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Benefits
  
  
</h2>
    

<ol>
  <li><strong>Cryptographic Proof</strong>: Location claims are cryptographically verifiable</li>
  <li><strong>Privacy Control</strong>: Selective disclosure protects sensitive location data</li>
  <li><strong>Immutability</strong>: Blockchain anchoring provides tamper-proof records</li>
  <li><strong>Decentralized</strong>: No reliance on central location services</li>
  <li><strong>Standard Format</strong>: W3C VC standard for interoperability</li>
  <li><strong>Self-Sovereign</strong>: Users control their location data</li>
</ol>
<h2 id="best-practices">
  
  
    <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices
  
  
</h2>
    

<ol>
  <li><strong>Privacy First</strong>: Use selective disclosure to minimize location exposure</li>
  <li><strong>Anchor Important Locations</strong>: Anchor critical location proofs to blockchain</li>
  <li><strong>Organize by Context</strong>: Use collections and tags for location types</li>
  <li><strong>Verify Before Trust</strong>: Always verify location credentials</li>
  <li><strong>Consider Accuracy</strong>: Include accuracy information in claims</li>
  <li><strong>Timestamp Everything</strong>: Always include precise timestamps</li>
</ol>
<h2 id="next-steps">
  
  
    <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps
  
  
</h2>
    

<ul>
  <li>Learn about <a href="/trustweave/tutorials/wallet-api-tutorial/">Wallet API Tutorial</a></li>
  <li>Explore <a href="/trustweave/core-concepts/blockchain-anchoring/">Blockchain Anchoring</a></li>
  <li>Check out <a href="/trustweave/scenarios/earth-observation-scenario/">Earth Observation Scenario</a> for related geospatial concepts</li>
</ul>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with ❤️ by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();

        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
        footer.style.marginTop = 'auto'; // Push to bottom in flexbox layout
        footer.style.zIndex = '0'; // Below search overlay
      }
    }

    // Function to update footer visibility based on search state
    function updateFooterVisibility() {
      const footer = document.querySelector('.site-footer');
      const htmlElement = document.documentElement;

      if (footer && htmlElement) {
        const isSearchActive = htmlElement.classList.contains('search-active');
        if (isSearchActive) {
          // Hide footer when search is active - use multiple methods to ensure it's hidden
          footer.style.display = 'none';
          footer.style.visibility = 'hidden';
          footer.style.opacity = '0';
          footer.style.zIndex = '-999';
          footer.style.pointerEvents = 'none';
        } else {
          // Show footer when search is not active
          footer.style.display = 'block';
          footer.style.visibility = 'visible';
          footer.style.opacity = '1';
          footer.style.marginTop = 'auto';
          footer.style.position = 'relative';
          footer.style.zIndex = '-1';
          footer.style.pointerEvents = 'auto';
        }
      }
    }

    // Monitor search state and hide/show footer appropriately
    const observer = new MutationObserver(function(mutations) {
      updateFooterVisibility();
    });

    // Also listen for input events on search input as a backup
    // This ensures footer is hidden immediately when user starts typing
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      // Use requestAnimationFrame for better performance
      const handleSearchChange = function() {
        requestAnimationFrame(updateFooterVisibility);
      };

      searchInput.addEventListener('input', handleSearchChange);
      searchInput.addEventListener('focus', handleSearchChange);
      searchInput.addEventListener('keydown', handleSearchChange);
    }

    // Observe documentElement (html) for class changes (like search-active)
    // The search script adds 'search-active' to documentElement, not body
    if (document.documentElement) {
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });

      // Initial check
      updateFooterVisibility();
    }
  });
</script>


    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    





<script type="module">
  
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';
  

  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>



  
</body>
</html>

