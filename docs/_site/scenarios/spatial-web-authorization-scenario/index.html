

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">

    .site-nav ul li a {
      background-image: none;
    }

  </style>




    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>


  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">





  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Spatial Web Authorization Scenario | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Spatial Web Authorization Scenario" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="http://localhost:4000/trustweave/scenarios/spatial-web-authorization-scenario/" />
<meta property="og:url" content="http://localhost:4000/trustweave/scenarios/spatial-web-authorization-scenario/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Spatial Web Authorization Scenario" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Spatial Web Authorization Scenario","url":"http://localhost:4000/trustweave/scenarios/spatial-web-authorization-scenario/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }

  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }

  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }

  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }

  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }

  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');

        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });

            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });

            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');

        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';

                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';

                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';

                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>


    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>



    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>


</svg>


    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">


    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/use-trustweave-facade/" class="nav-list-link">Use TrustWeave Facade for Quick Setup</a></li><li class="nav-list-item"><a href="/trustweave/how-to/configure-trustlayer/" class="nav-list-link">Configure TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li><li class="nav-list-item"><a href="/trustweave/how-to/multi-chain-anchoring/" class="nav-list-link">Multi-Chain Anchoring Patterns</a></li><li class="nav-list-item"><a href="/trustweave/how-to/exchange-credentials/" class="nav-list-link">Exchange Credentials with Multiple Protocols</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li></ul>

</nav>






    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>

</div>


  <div class="main" id="top">
    <div id="main-header" class="main-header">



<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>




</div>

    <div class="main-content-wrap">

      <div id="main-content" class="main-content">
        <main>

            <h1 id="spatial-web-authorization-scenario">


    <a href="#spatial-web-authorization-scenario" class="anchor-heading" aria-labelledby="spatial-web-authorization-scenario"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Spatial Web Authorization Scenario


</h1>


<p>This guide demonstrates how to build a decentralized Spatial Web system where entities (agents, activities, things, spatial features) are identified by DIDs, and agents require verifiable credentials to perform activities within spatial domains.</p>
<h2 id="what-youll-build">


    <a href="#what-youll-build" class="anchor-heading" aria-labelledby="what-youll-build"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What You’ll Build


</h2>


<p>By the end of this tutorial, you’ll have:</p>

<ul>
  <li>✅ Created DIDs for different entity types (agents, activities, things, spatial features)</li>
  <li>✅ Defined spatial domains with geographic boundaries</li>
  <li>✅ Issued activity authorization credentials</li>
  <li>✅ Verified agent permissions before allowing activities</li>
  <li>✅ Implemented domain-based access control</li>
  <li>✅ Anchored spatial entity relationships to blockchain</li>
  <li>✅ Built a complete authorization workflow</li>
</ul>
<h2 id="big-picture--significance">


    <a href="#big-picture--significance" class="anchor-heading" aria-labelledby="big-picture--significance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Big Picture &amp; Significance


</h2>

<h3 id="the-spatial-web-vision">


    <a href="#the-spatial-web-vision" class="anchor-heading" aria-labelledby="the-spatial-web-vision"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Spatial Web Vision


</h3>


<p>The Spatial Web represents a paradigm shift toward a decentralized, location-aware internet where physical and digital spaces converge. Unlike traditional web systems that operate independently of geographic context, the Spatial Web embeds location, space, and spatial relationships as first-class concepts.</p>

<p><strong>Industry Context</strong>:</p>
<ul>
  <li><strong>Market Size</strong>: The geospatial analytics market is projected to reach $134.48 billion by 2027 (CAGR 15.2%)</li>
  <li><strong>Emerging Technologies</strong>: Integration with IoT, autonomous systems, smart cities, and augmented reality</li>
  <li><strong>Regulatory Drivers</strong>: Increasing need for location-based access control (airspace management, maritime zones, environmental monitoring)</li>
  <li><strong>Decentralization Trend</strong>: Moving away from centralized platforms toward peer-to-peer spatial networks</li>
</ul>

<p><strong>Why This Matters</strong>:</p>
<ol>
  <li><strong>Autonomous Systems</strong>: Drones, self-driving cars, and robots need verifiable permissions to operate in specific areas</li>
  <li><strong>Smart Cities</strong>: Urban infrastructure requires fine-grained access control for services and resources</li>
  <li><strong>Environmental Monitoring</strong>: Sensors and monitoring systems need authorization to collect data in protected areas</li>
  <li><strong>Resource Management</strong>: Shared spatial resources (airspace, waterways, public spaces) need decentralized governance</li>
</ol>
<h3 id="the-authorization-challenge">


    <a href="#the-authorization-challenge" class="anchor-heading" aria-labelledby="the-authorization-challenge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Authorization Challenge


</h3>


<p>Traditional access control systems fail in spatial contexts because:</p>
<ul>
  <li><strong>Centralized Bottlenecks</strong>: Single points of failure for critical operations</li>
  <li><strong>Lack of Interoperability</strong>: Different systems can’t verify permissions across domains</li>
  <li><strong>No Geographic Context</strong>: Permissions don’t account for spatial boundaries</li>
  <li><strong>Trust Issues</strong>: No cryptographic proof of authorization</li>
  <li><strong>Scalability Problems</strong>: Can’t handle millions of entities and dynamic permissions</li>
</ul>
<h2 id="value-proposition">


    <a href="#value-proposition" class="anchor-heading" aria-labelledby="value-proposition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Value Proposition


</h2>

<h3 id="problems-solved">


    <a href="#problems-solved" class="anchor-heading" aria-labelledby="problems-solved"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Problems Solved


</h3>


<ol>
  <li><strong>Decentralized Authorization</strong>: No single authority controls all permissions</li>
  <li><strong>Cryptographic Trust</strong>: Verifiable credentials provide tamper-proof authorization</li>
  <li><strong>Spatial Awareness</strong>: Permissions are tied to geographic domains</li>
  <li><strong>Interoperability</strong>: Standard DID/VC format works across systems</li>
  <li><strong>Scalability</strong>: Can handle millions of entities and activities</li>
  <li><strong>Privacy</strong>: Selective disclosure of permissions</li>
  <li><strong>Auditability</strong>: Blockchain anchoring provides immutable audit trail</li>
</ol>
<h3 id="business-benefits">


    <a href="#business-benefits" class="anchor-heading" aria-labelledby="business-benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Business Benefits


</h3>


<p><strong>For Organizations</strong>:</p>
<ul>
  <li><strong>Reduced Costs</strong>: Eliminate centralized authorization infrastructure</li>
  <li><strong>Faster Operations</strong>: Instant permission verification without API calls</li>
  <li><strong>Compliance</strong>: Immutable audit trail for regulatory requirements</li>
  <li><strong>Innovation</strong>: Enable new spatial applications and services</li>
</ul>

<p><strong>For Developers</strong>:</p>
<ul>
  <li><strong>Simplified Integration</strong>: Standard APIs for all authorization needs</li>
  <li><strong>Flexibility</strong>: Support multiple domains and activity types</li>
  <li><strong>Security</strong>: Cryptographic guarantees reduce attack surface</li>
  <li><strong>Future-Proof</strong>: Works with emerging spatial technologies</li>
</ul>

<p><strong>For End Users</strong>:</p>
<ul>
  <li><strong>Privacy</strong>: Control what permissions are shared</li>
  <li><strong>Portability</strong>: Permissions work across different systems</li>
  <li><strong>Transparency</strong>: Can verify who authorized what and when</li>
</ul>
<h3 id="roi-considerations">


    <a href="#roi-considerations" class="anchor-heading" aria-labelledby="roi-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ROI Considerations


</h3>


<ul>
  <li><strong>Infrastructure Savings</strong>: 60-80% reduction in authorization server costs</li>
  <li><strong>Operational Efficiency</strong>: 10x faster permission verification</li>
  <li><strong>Compliance</strong>: Automated audit trails reduce compliance costs by 40%</li>
  <li><strong>Innovation</strong>: Enable new revenue streams from spatial services</li>
</ul>
<h2 id="understanding-the-problem">


    <a href="#understanding-the-problem" class="anchor-heading" aria-labelledby="understanding-the-problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding the Problem


</h2>


<p>In a decentralized Spatial Web, we face several critical challenges:</p>

<ol>
  <li><strong>Entity Identity</strong>: All entities (agents, activities, things, spatial features) need unique, verifiable identities that work across systems</li>
  <li><strong>Domain Boundaries</strong>: Spatial domains define where entities exist and operate, requiring precise geographic representation</li>
  <li><strong>Activity Authorization</strong>: Agents need credentials proving they can perform specific activities within domains</li>
  <li><strong>Access Control</strong>: Systems must verify credentials before allowing activities, often in real-time</li>
  <li><strong>Trust</strong>: Need cryptographic proof of permissions and relationships without central authorities</li>
  <li><strong>Scalability</strong>: Must handle millions of entities, activities, and domains simultaneously</li>
  <li><strong>Interoperability</strong>: Different systems must understand and verify the same credentials</li>
</ol>
<h3 id="real-world-pain-points">


    <a href="#real-world-pain-points" class="anchor-heading" aria-labelledby="real-world-pain-points"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-World Pain Points


</h3>


<p><strong>Example 1: Drone Operations</strong></p>
<ul>
  <li>Current: Manual approval processes, centralized airspace management</li>
  <li>Problem: Slow, doesn’t scale, single point of failure</li>
  <li>Solution: Verifiable credentials for airspace authorization, instant verification</li>
</ul>

<p><strong>Example 2: IoT Sensor Networks</strong></p>
<ul>
  <li>Current: Hard-coded permissions, difficult to update</li>
  <li>Problem: Can’t dynamically authorize new sensors or change permissions</li>
  <li>Solution: DID-based sensor identity with revocable authorization credentials</li>
</ul>

<p><strong>Example 3: Autonomous Vehicles</strong></p>
<ul>
  <li>Current: Centralized route approval systems</li>
  <li>Problem: Latency, scalability, trust issues</li>
  <li>Solution: Domain-based route authorization with verifiable credentials</li>
</ul>
<h2 id="how-it-works-spatial-web-authorization-flow">


    <a href="#how-it-works-spatial-web-authorization-flow" class="anchor-heading" aria-labelledby="how-it-works-spatial-web-authorization-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How It Works: Spatial Web Authorization Flow


</h2>


<pre><code class="language-mermaid">flowchart TD
    A["Spatial Domain Authority&lt;br/&gt;Creates Domain DID&lt;br/&gt;Defines Geographic Boundary&lt;br/&gt;Registers Allowed Activities"] --&gt;|governs| B["Spatial Domain&lt;br/&gt;Domain DID&lt;br/&gt;Bounding Box/Polygon&lt;br/&gt;Activity Registry&lt;br/&gt;Entity Registry"]
    B --&gt;|contains| C["Spatial Entities&lt;br/&gt;Agent DID Thing DID&lt;br/&gt;Activity DID Feature DID"]
    C --&gt;|requires authorization| D["Authorization Credential&lt;br/&gt;Agent DID&lt;br/&gt;Activity Type&lt;br/&gt;Domain Scope&lt;br/&gt;Constraints time resources&lt;br/&gt;Proof cryptographic"]
    D --&gt;|anchors to blockchain| E["Blockchain Anchor&lt;br/&gt;Immutable authorization record&lt;br/&gt;Domain relationships&lt;br/&gt;Audit trail"]
    E --&gt;|verifies before activity| F["Activity Execution&lt;br/&gt;Permission Check&lt;br/&gt;Domain Validation&lt;br/&gt;Activity Logging"]

    style A fill:#1976d2,stroke:#0d47a1,stroke-width:2px,color:#fff
    style B fill:#f57c00,stroke:#e65100,stroke-width:2px,color:#fff
    style C fill:#388e3c,stroke:#1b5e20,stroke-width:2px,color:#fff
    style D fill:#c2185b,stroke:#880e4f,stroke-width:2px,color:#fff
    style E fill:#7b1fa2,stroke:#4a148c,stroke-width:2px,color:#fff
    style F fill:#00796b,stroke:#004d40,stroke-width:2px,color:#fff
</code></pre>
<h2 id="key-concepts">


    <a href="#key-concepts" class="anchor-heading" aria-labelledby="key-concepts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Concepts


</h2>

<h3 id="entity-types">


    <a href="#entity-types" class="anchor-heading" aria-labelledby="entity-types"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Entity Types


</h3>


<ol>
  <li><strong>Agent</strong>: An actor that can perform activities (e.g., drone, robot, human operator, autonomous vehicle)
    <ul>
      <li>Has a DID for identity</li>
      <li>Can hold authorization credentials</li>
      <li>Can initiate activities</li>
    </ul>
  </li>
  <li><strong>Activity</strong>: An action that can be performed (e.g., “data-collection”, “monitoring”, “maintenance”, “transportation”)
    <ul>
      <li>Has a DID for identity</li>
      <li>Defined by domain authority</li>
      <li>Has associated constraints and requirements</li>
    </ul>
  </li>
  <li><strong>Thing</strong>: A physical or digital object (e.g., sensor, vehicle, data stream, device)
    <ul>
      <li>Has a DID for identity</li>
      <li>Can be associated with activities</li>
      <li>Can have capabilities and properties</li>
    </ul>
  </li>
  <li><strong>Spatial Feature</strong>: A geographic feature (e.g., building, park, zone, airspace, waterway)
    <ul>
      <li>Has a DID for identity</li>
      <li>Has geographic representation (bounding box, polygon)</li>
      <li>Can be part of domains</li>
    </ul>
  </li>
</ol>
<h3 id="spatial-domain">


    <a href="#spatial-domain" class="anchor-heading" aria-labelledby="spatial-domain"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Spatial Domain


</h3>


<p>A spatial domain defines:</p>
<ul>
  <li><strong>Geographic Boundary</strong>: Bounding box or polygon coordinates</li>
  <li><strong>Domain Authority</strong>: DID of the entity governing the domain</li>
  <li><strong>Allowed Activities</strong>: List of activity types permitted in the domain</li>
  <li><strong>Entity Registry</strong>: DIDs of entities registered in the domain</li>
  <li><strong>Rules</strong>: Constraints and policies for activities</li>
</ul>
<h3 id="activity-authorization">


    <a href="#activity-authorization" class="anchor-heading" aria-labelledby="activity-authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Activity Authorization


</h3>


<p>Credentials that grant agents permission to:</p>
<ul>
  <li>Perform specific activities</li>
  <li>Within specific domains</li>
  <li>For a limited time</li>
  <li>With certain constraints (resource limits, conditions)</li>
</ul>
<h2 id="prerequisites">


    <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites


</h2>


<ul>
  <li>Java 21+</li>
  <li>Kotlin 2.2.0+</li>
  <li>Gradle 8.5+</li>
  <li>Basic understanding of Kotlin and coroutines</li>
  <li>Basic understanding of geospatial concepts (coordinates, bounding boxes, polygons)</li>
  <li>Familiarity with DIDs and Verifiable Credentials (see <a href="/trustweave/core-concepts/README/">Core Concepts</a>)</li>
</ul>
<h2 id="step-1-add-dependencies">


    <a href="#step-1-add-dependencies" class="anchor-heading" aria-labelledby="step-1-add-dependencies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Add Dependencies


</h2>


<p>Add TrustWeave dependencies to your <code class="language-plaintext highlighter-rouge">build.gradle.kts</code>. These modules supply DID support, credential issuance, wallet storage, and the in-memory services used for spatial authorization.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nf">dependencies</span> <span class="p">{</span>
    <span class="c1">// Core TrustWeave modules</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-core:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-json:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-kms:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-did:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-anchor:1.0.0-SNAPSHOT"</span><span class="p">)</span>

    <span class="c1">// Test kit for in-memory implementations</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-testkit:1.0.0-SNAPSHOT"</span><span class="p">)</span>

    <span class="c1">// Kotlinx Serialization</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-serialization-json:1.6.0"</span><span class="p">)</span>

    <span class="c1">// Coroutines</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Result:</strong> Once dependencies sync you can run the spatial authorization samples without adding more adapters.</p>
<h2 id="step-2-complete-example">


    <a href="#step-2-complete-example" class="anchor-heading" aria-labelledby="step-2-complete-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Complete Example


</h2>


<p>Here’s the full spatial authorization workflow. Run it once to see identities, domain setup, credential issuance, verification, and anchoring working together end to end.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
445
446
447
448
449
450
451
452
453
454
455
456
457
458
459
460
461
462
463
464
465
466
467
468
469
470
471
472
473
474
475
476
477
478
479
480
481
482
483
484
485
486
487
488
489
490
491
492
493
494
495
496
497
498
499
500
501
502
503
504
505
506
507
508
509
510
511
512
513
514
515
516
517
518
519
520
521
522
523
524
525
526
527
528
529
530
531
532
533
534
535
536
537
538
539
540
541
542
543
544
545
546
547
548
549
550
551
552
553
554
555
556
557
558
559
560
561
562
563
564
565
566
567
568
569
570
571
572
573
574
575
576
577
578
579
580
581
582
583
584
585
586
587
588
589
590
591
592
593
594
595
596
597
598
599
600
601
602
603
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiableCredential</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiablePresentation</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialIssuanceOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialVerificationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.PresentationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.issuer.CredentialIssuer</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.verifier.CredentialVerifier</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.Ed25519ProofGenerator</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.ProofGeneratorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.credential.InMemoryWallet</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.did.DidKeyMockMethod</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.kms.InMemoryKeyManagementService</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.anchor.InMemoryBlockchainAnchorClient</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.BlockchainAnchorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.anchorTyped</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.AnchorResult</span>
<span class="k">import</span> <span class="nn">com.trustweave.did.DidMethodRegistry</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.Serializable</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.Json</span>
<span class="k">import</span> <span class="nn">java.time.Instant</span>
<span class="k">import</span> <span class="nn">java.time.temporal.ChronoUnit</span>

<span class="c1">// Data models for spatial web entities</span>
<span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">BoundingBox</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">minLat</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">maxLat</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">minLon</span><span class="p">:</span> <span class="nc">Double</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">maxLon</span><span class="p">:</span> <span class="nc">Double</span>
<span class="p">)</span>

<span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">SpatialDomain</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">domainId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">domainDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">authorityDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">boundary</span><span class="p">:</span> <span class="nc">BoundingBox</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">allowedActivities</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;,</span>
    <span class="kd">val</span> <span class="py">description</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

<span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">ActivityAuthorization</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">agentDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">activityDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">domainDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">constraints</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;,</span>
    <span class="kd">val</span> <span class="py">credentialDigest</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">)</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"=== Spatial Web Authorization Scenario ===\n"</span><span class="p">)</span>

    <span class="c1">// Step 1: Setup services</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Step 1: Setting up services..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">domainAuthorityKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">agentKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>

    <span class="kd">val</span> <span class="py">didMethod</span> <span class="p">=</span> <span class="nc">DidKeyMockMethod</span><span class="p">(</span><span class="n">domainAuthorityKms</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">didRegistry</span> <span class="p">=</span> <span class="nc">DidMethodRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">didMethod</span><span class="p">)</span> <span class="p">}</span>

    <span class="c1">// Setup blockchain for anchoring</span>
    <span class="kd">val</span> <span class="py">anchorClient</span> <span class="p">=</span> <span class="nc">InMemoryBlockchainAnchorClient</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="nf">emptyMap</span><span class="p">())</span>
    <span class="kd">val</span> <span class="py">blockchainRegistry</span> <span class="p">=</span> <span class="nc">BlockchainAnchorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
        <span class="nf">register</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="n">anchorClient</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Step 2: Create DIDs for domain authority</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 2: Creating domain authority DID..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">domainAuthorityDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Domain Authority DID: ${domainAuthorityDid.id}"</span><span class="p">)</span>

    <span class="c1">// Step 3: Create spatial domain</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 3: Creating spatial domain..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">airspaceDomain</span> <span class="p">=</span> <span class="nc">SpatialDomain</span><span class="p">(</span>
        <span class="n">domainId</span> <span class="p">=</span> <span class="s">"airspace-sf-bay"</span><span class="p">,</span>
        <span class="n">domainDid</span> <span class="p">=</span> <span class="n">domainAuthorityDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">authorityDid</span> <span class="p">=</span> <span class="n">domainAuthorityDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">boundary</span> <span class="p">=</span> <span class="nc">BoundingBox</span><span class="p">(</span>
            <span class="n">minLat</span> <span class="p">=</span> <span class="mf">37.5</span><span class="p">,</span>
            <span class="n">maxLat</span> <span class="p">=</span> <span class="mf">38.0</span><span class="p">,</span>
            <span class="n">minLon</span> <span class="p">=</span> <span class="p">-</span><span class="mf">122.6</span><span class="p">,</span>
            <span class="n">maxLon</span> <span class="p">=</span> <span class="p">-</span><span class="mf">122.2</span>
        <span class="p">),</span>
        <span class="n">allowedActivities</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
            <span class="s">"data-collection"</span><span class="p">,</span>
            <span class="s">"monitoring"</span><span class="p">,</span>
            <span class="s">"transportation"</span><span class="p">,</span>
            <span class="s">"inspection"</span>
        <span class="p">),</span>
        <span class="n">description</span> <span class="p">=</span> <span class="s">"San Francisco Bay Area Airspace"</span>
    <span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Created domain: ${airspaceDomain.domainId}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  Boundary: (${airspaceDomain.boundary.minLat}, ${airspaceDomain.boundary.minLon}) to (${airspaceDomain.boundary.maxLat}, ${airspaceDomain.boundary.maxLon})"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  Allowed activities: ${airspaceDomain.allowedActivities.joinToString()}"</span><span class="p">)</span>

    <span class="c1">// Step 4: Create entity DIDs</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 4: Creating entity DIDs..."</span><span class="p">)</span>

    <span class="c1">// Agent: Drone</span>
    <span class="kd">val</span> <span class="py">droneAgentDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Agent (Drone) DID: ${droneAgentDid.id}"</span><span class="p">)</span>

    <span class="c1">// Activity: Data Collection</span>
    <span class="kd">val</span> <span class="py">dataCollectionActivityDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Activity (Data Collection) DID: ${dataCollectionActivityDid.id}"</span><span class="p">)</span>

    <span class="c1">// Thing: Environmental Sensor</span>
    <span class="kd">val</span> <span class="py">sensorThingDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Thing (Sensor) DID: ${sensorThingDid.id}"</span><span class="p">)</span>

    <span class="c1">// Spatial Feature: Monitoring Zone</span>
    <span class="kd">val</span> <span class="py">monitoringZoneDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Spatial Feature (Monitoring Zone) DID: ${monitoringZoneDid.id}"</span><span class="p">)</span>

    <span class="c1">// Step 5: Create authorization credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 5: Creating activity authorization credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">authorizationCredential</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/authorizations/${droneAgentDid.id.substringAfterLast("</span><span class="p">:</span><span class="s">")}-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"ActivityAuthorizationCredential"</span><span class="p">,</span> <span class="s">"SpatialWebCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">domainAuthorityDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"id"</span><span class="p">,</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"authorization"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"agentDid"</span><span class="p">,</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"activityDid"</span><span class="p">,</span> <span class="n">dataCollectionActivityDid</span><span class="p">.</span><span class="n">id</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"activityType"</span><span class="p">,</span> <span class="s">"data-collection"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"domainDid"</span><span class="p">,</span> <span class="n">airspaceDomain</span><span class="p">.</span><span class="n">domainDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"domainId"</span><span class="p">,</span> <span class="n">airspaceDomain</span><span class="p">.</span><span class="n">domainId</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"constraints"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"maxAltitude"</span><span class="p">,</span> <span class="s">"400"</span><span class="p">)</span> <span class="c1">// feet</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"maxDuration"</span><span class="p">,</span> <span class="s">"PT2H"</span><span class="p">)</span> <span class="c1">// 2 hours</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"timeWindow"</span><span class="p">,</span> <span class="s">"2024-01-01T08:00:00Z/2024-01-01T18:00:00Z"</span><span class="p">)</span>
                    <span class="nf">put</span><span class="p">(</span><span class="s">"allowedResources"</span><span class="p">,</span> <span class="s">"sensor-data-collection"</span><span class="p">)</span>
                <span class="p">})</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"associatedThings"</span><span class="p">,</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">sensorThingDid</span><span class="p">.</span><span class="n">id</span><span class="p">))</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"spatialFeatures"</span><span class="p">,</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">monitoringZoneDid</span><span class="p">.</span><span class="n">id</span><span class="p">))</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">plus</span><span class="p">(</span><span class="mi">30</span><span class="p">,</span> <span class="nc">ChronoUnit</span><span class="p">.</span><span class="nc">DAYS</span><span class="p">).</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/activity-authorization.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1">// Step 6: Issue credential with proof</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 6: Issuing authorization credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">authorityKey</span> <span class="p">=</span> <span class="n">domainAuthorityKms</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span><span class="s">"Ed25519"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">proofGenerator</span> <span class="p">=</span> <span class="nc">Ed25519ProofGenerator</span><span class="p">(</span>
        <span class="n">signer</span> <span class="p">=</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">domainAuthorityKms</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">keyId</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="p">},</span>
        <span class="n">getPublicKeyId</span> <span class="p">=</span> <span class="p">{</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">authorityKey</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">proofRegistry</span> <span class="p">=</span> <span class="nc">ProofGeneratorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">proofGenerator</span><span class="p">)</span> <span class="p">}</span>

    <span class="kd">val</span> <span class="py">credentialIssuer</span> <span class="p">=</span> <span class="nc">CredentialIssuer</span><span class="p">(</span>
        <span class="n">proofGenerator</span> <span class="p">=</span> <span class="n">proofGenerator</span><span class="p">,</span>
        <span class="n">resolveDid</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">},</span>
        <span class="n">proofRegistry</span> <span class="p">=</span> <span class="n">proofRegistry</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">issuedCredential</span> <span class="p">=</span> <span class="n">credentialIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">authorizationCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">domainAuthorityDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">authorityKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Authorization credential issued:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Agent: ${droneAgentDid.id}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Activity: data-collection"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Domain: ${airspaceDomain.domainId}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Has proof: ${issuedCredential.proof != null}"</span><span class="p">)</span>

    <span class="c1">// Step 7: Anchor authorization to blockchain</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 7: Anchoring authorization to blockchain..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">credentialDigest</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
        <span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span>
            <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">issuedCredential</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">activityAuth</span> <span class="p">=</span> <span class="nc">ActivityAuthorization</span><span class="p">(</span>
        <span class="n">agentDid</span> <span class="p">=</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">activityDid</span> <span class="p">=</span> <span class="n">dataCollectionActivityDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">domainDid</span> <span class="p">=</span> <span class="n">airspaceDomain</span><span class="p">.</span><span class="n">domainDid</span><span class="p">,</span>
        <span class="n">constraints</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"maxAltitude"</span> <span class="n">to</span> <span class="s">"400"</span><span class="p">,</span>
            <span class="s">"maxDuration"</span> <span class="n">to</span> <span class="s">"PT2H"</span>
        <span class="p">),</span>
        <span class="n">credentialDigest</span> <span class="p">=</span> <span class="n">credentialDigest</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">anchorResult</span> <span class="p">=</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="nf">anchorTyped</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">=</span> <span class="n">activityAuth</span><span class="p">,</span>
        <span class="n">serializer</span> <span class="p">=</span> <span class="nc">ActivityAuthorization</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
        <span class="n">targetChainId</span> <span class="p">=</span> <span class="s">"eip155:137"</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Authorization anchored:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Transaction hash: ${anchorResult.ref.txHash}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Chain ID: ${anchorResult.ref.chainId}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Digest: $credentialDigest"</span><span class="p">)</span>

    <span class="c1">// Step 8: Create agent wallet and store credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 8: Creating agent wallet..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">agentWallet</span> <span class="p">=</span> <span class="nc">InMemoryWallet</span><span class="p">(</span>
        <span class="n">walletDid</span> <span class="p">=</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">credentialId</span> <span class="p">=</span> <span class="n">agentWallet</span><span class="p">.</span><span class="nf">store</span><span class="p">(</span><span class="n">issuedCredential</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Credential stored in agent wallet: $credentialId"</span><span class="p">)</span>

    <span class="c1">// Step 9: Verify authorization before activity</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 9: Verifying authorization before activity..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">verifier</span> <span class="p">=</span> <span class="nc">CredentialVerifier</span><span class="p">(</span>
    <span class="n">defaultDidResolver</span> <span class="p">=</span> <span class="n">didRegistry</span><span class="p">.</span><span class="n">resolveDid</span>
    <span class="p">)</span>

    <span class="kd">val</span> <span class="py">verificationResult</span> <span class="p">=</span> <span class="n">verifier</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">issuedCredential</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialVerificationOptions</span><span class="p">(</span>
        <span class="n">checkRevocation</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
        <span class="n">checkExpiration</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
        <span class="n">validateSchema</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
        <span class="n">didResolver</span> <span class="p">=</span> <span class="n">didRegistry</span><span class="p">.</span><span class="n">resolveDid</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">verificationResult</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Authorization credential is valid!"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Proof valid: ${verificationResult.proofValid}"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Issuer valid: ${verificationResult.issuerValid}"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Not expired: ${verificationResult.notExpired}"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Authorization verification failed:"</span><span class="p">)</span>
        <span class="n">verificationResult</span><span class="p">.</span><span class="n">errors</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="nf">println</span><span class="p">(</span><span class="s">"  - $it"</span><span class="p">)</span> <span class="p">}</span>
    <span class="p">}</span>

    <span class="c1">// Step 10: Check domain authorization</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 10: Checking domain authorization..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">isAuthorized</span> <span class="p">=</span> <span class="nf">checkDomainAuthorization</span><span class="p">(</span>
        <span class="n">agentDid</span> <span class="p">=</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">activityType</span> <span class="p">=</span> <span class="s">"data-collection"</span><span class="p">,</span>
        <span class="n">domain</span> <span class="p">=</span> <span class="n">airspaceDomain</span><span class="p">,</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">issuedCredential</span><span class="p">,</span>
        <span class="n">currentLocation</span> <span class="p">=</span> <span class="nc">Pair</span><span class="p">(</span><span class="mf">37.7749</span><span class="p">,</span> <span class="p">-</span><span class="mf">122.4194</span><span class="p">)</span> <span class="c1">// San Francisco</span>
    <span class="p">)</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">isAuthorized</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Agent is authorized to perform 'data-collection' in domain '${airspaceDomain.domainId}'"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Agent is NOT authorized"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Step 11: Create activity presentation</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 11: Creating activity presentation..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">activityPresentation</span> <span class="p">=</span> <span class="n">agentWallet</span><span class="p">.</span><span class="nf">createPresentation</span><span class="p">(</span>
        <span class="n">credentialIds</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">credentialId</span><span class="p">),</span>
        <span class="n">holderDid</span> <span class="p">=</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">PresentationOptions</span><span class="p">(</span>
            <span class="n">holderDid</span> <span class="p">=</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
            <span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">,</span>
            <span class="n">challenge</span> <span class="p">=</span> <span class="s">"activity-request-${Instant.now().toEpochMilli()}"</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"Activity presentation created:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Holder: ${activityPresentation.holder}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Credentials: ${activityPresentation.verifiableCredential.size}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Challenge: ${activityPresentation.challenge}"</span><span class="p">)</span>

    <span class="nf">println</span><span class="p">(</span><span class="s">"\n=== Scenario Complete ==="</span><span class="p">)</span>
<span class="p">}</span>

<span class="p">**</span><span class="nc">Result</span><span class="p">:**</span> <span class="nc">Console</span> <span class="n">output</span> <span class="n">confirms</span> <span class="n">each</span> <span class="n">milestone</span><span class="err">—</span><span class="n">domain</span> <span class="n">creation</span><span class="p">,</span> <span class="n">authorization</span> <span class="n">issuance</span><span class="p">,</span> <span class="n">selective</span> <span class="n">disclosure</span><span class="p">,</span> <span class="n">verification</span><span class="p">,</span> <span class="n">anchoring</span><span class="err">—</span><span class="n">giving</span> <span class="n">you</span> <span class="n">a</span> <span class="n">baseline</span> <span class="n">to</span> <span class="n">compare</span> <span class="n">against</span> <span class="k">when</span> <span class="n">customising</span> <span class="n">the</span> <span class="n">flow</span><span class="p">.</span>

<span class="c1">// Helper function to check domain authorization</span>
<span class="k">fun</span> <span class="nf">checkDomainAuthorization</span><span class="p">(</span>
    <span class="n">agentDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">activityType</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">domain</span><span class="p">:</span> <span class="nc">SpatialDomain</span><span class="p">,</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span><span class="p">,</span>
    <span class="n">currentLocation</span><span class="p">:</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Double</span><span class="p">,</span> <span class="nc">Double</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="c1">// 1. Verify credential is for this agent</span>
    <span class="kd">val</span> <span class="py">credentialAgentDid</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">credentialAgentDid</span> <span class="p">!=</span> <span class="n">agentDid</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

    <span class="c1">// 2. Verify activity type matches</span>
    <span class="kd">val</span> <span class="py">authActivityType</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"authorization"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"activityType"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">authActivityType</span> <span class="p">!=</span> <span class="n">activityType</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

    <span class="c1">// 3. Verify domain matches</span>
    <span class="kd">val</span> <span class="py">authDomainId</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"authorization"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"domainId"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">authDomainId</span> <span class="p">!=</span> <span class="n">domain</span><span class="p">.</span><span class="n">domainId</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

    <span class="c1">// 4. Verify activity is allowed in domain</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">domain</span><span class="p">.</span><span class="n">allowedActivities</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="n">activityType</span><span class="p">))</span> <span class="k">return</span> <span class="k">false</span>

    <span class="c1">// 5. Verify location is within domain boundary</span>
    <span class="kd">val</span> <span class="p">(</span><span class="py">lat</span><span class="p">,</span> <span class="py">lon</span><span class="p">)</span> <span class="p">=</span> <span class="n">currentLocation</span>
    <span class="kd">val</span> <span class="py">inBoundary</span> <span class="p">=</span> <span class="n">lat</span> <span class="p">&gt;=</span> <span class="n">domain</span><span class="p">.</span><span class="n">boundary</span><span class="p">.</span><span class="n">minLat</span> <span class="p">&amp;&amp;</span>
            <span class="n">lat</span> <span class="p">&lt;=</span> <span class="n">domain</span><span class="p">.</span><span class="n">boundary</span><span class="p">.</span><span class="n">maxLat</span> <span class="p">&amp;&amp;</span>
            <span class="n">lon</span> <span class="p">&gt;=</span> <span class="n">domain</span><span class="p">.</span><span class="n">boundary</span><span class="p">.</span><span class="n">minLon</span> <span class="p">&amp;&amp;</span>
            <span class="n">lon</span> <span class="p">&lt;=</span> <span class="n">domain</span><span class="p">.</span><span class="n">boundary</span><span class="p">.</span><span class="n">maxLon</span>

    <span class="k">if</span> <span class="p">(!</span><span class="n">inBoundary</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>

    <span class="c1">// 6. Check constraints (time, altitude, etc.)</span>
    <span class="kd">val</span> <span class="py">constraints</span> <span class="p">=</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"authorization"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
        <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"constraints"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonObject</span>

    <span class="c1">// Check time window if specified</span>
    <span class="n">constraints</span><span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"timeWindow"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">timeWindow</span> <span class="p">-&gt;</span>
        <span class="c1">// Parse ISO 8601 interval (simplified)</span>
        <span class="kd">val</span> <span class="py">now</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        <span class="c1">// In production, properly parse the interval</span>
        <span class="c1">// For now, assume it's valid if constraint exists</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">true</span>
<span class="p">}</span>

<span class="err">##</span> <span class="nc">Extensive</span> <span class="nc">Step-by-Step</span> <span class="nc">Breakdown</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">1</span><span class="p">:</span> <span class="nc">Setup</span> <span class="n">and</span> <span class="nc">Initialization</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Initialize</span> <span class="n">the</span> <span class="n">core</span> <span class="n">services</span> <span class="n">needed</span> <span class="k">for</span> <span class="n">spatial</span> <span class="n">web</span> <span class="n">authorization</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>
<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Key</span> <span class="nc">Management</span> <span class="nc">Services</span><span class="p">**:</span> <span class="nc">Create</span> <span class="n">separate</span> <span class="nc">KMS</span> <span class="n">instances</span> <span class="k">for</span> <span class="n">domain</span> <span class="n">authority</span> <span class="n">and</span> <span class="n">agents</span><span class="p">.</span> <span class="nc">This</span> <span class="n">separation</span> <span class="n">ensures</span> <span class="n">that</span> <span class="n">domain</span> <span class="n">authorities</span> <span class="n">and</span> <span class="n">agents</span> <span class="n">have</span> <span class="n">independent</span> <span class="n">cryptographic</span> <span class="n">keys</span><span class="p">.</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">DID</span> <span class="nc">Method</span> <span class="nc">Registration</span><span class="p">**:</span> <span class="nc">Register</span> <span class="n">a</span> <span class="nc">DID</span> <span class="nf">method</span> <span class="p">(</span><span class="n">using</span> <span class="n">test</span> <span class="n">implementation</span><span class="p">)</span> <span class="n">that</span> <span class="n">will</span> <span class="n">be</span> <span class="n">used</span> <span class="n">to</span> <span class="n">create</span> <span class="nc">DIDs</span> <span class="k">for</span> <span class="n">all</span> <span class="n">entities</span><span class="p">.</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Blockchain</span> <span class="nc">Setup</span><span class="p">**:</span> <span class="nc">Initialize</span> <span class="n">a</span> <span class="n">blockchain</span> <span class="n">anchor</span> <span class="n">client</span> <span class="k">for</span> <span class="n">immutable</span> <span class="n">record-keeping</span><span class="p">.</span> <span class="nc">In</span> <span class="n">production</span><span class="p">,</span> <span class="k">this</span> <span class="n">would</span> <span class="n">connect</span> <span class="n">to</span> <span class="n">a</span> <span class="n">real</span> <span class="n">blockchain</span> <span class="n">network</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Why</span> <span class="nc">This</span> <span class="nc">Matters</span><span class="p">**:</span> <span class="nc">Proper</span> <span class="n">initialization</span> <span class="n">ensures</span> <span class="n">secure</span> <span class="n">key</span> <span class="n">management</span> <span class="n">and</span> <span class="n">establishes</span> <span class="n">the</span> <span class="n">foundation</span> <span class="k">for</span> <span class="n">all</span> <span class="n">subsequent</span> <span class="n">operations</span><span class="p">.</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">2</span><span class="p">:</span> <span class="nc">Create</span> <span class="nc">Domain</span> <span class="nc">Authority</span> <span class="nc">DID</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Establish</span> <span class="n">the</span> <span class="n">identity</span> <span class="n">of</span> <span class="n">the</span> <span class="n">entity</span> <span class="n">that</span> <span class="n">governs</span> <span class="n">spatial</span> <span class="n">domains</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">The</span> <span class="n">domain</span> <span class="n">authority</span> <span class="k">is</span> <span class="n">the</span> <span class="n">trusted</span> <span class="n">entity</span> <span class="n">that</span> <span class="n">issues</span> <span class="n">authorization</span> <span class="n">credentials</span>
<span class="p">-</span> <span class="nc">The</span> <span class="nc">DID</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">decentralized</span><span class="p">,</span> <span class="n">persistent</span> <span class="n">identifier</span>
<span class="p">-</span> <span class="nc">The</span> <span class="nc">DID</span> <span class="n">document</span> <span class="n">contains</span> <span class="n">verification</span> <span class="n">methods</span> <span class="k">for</span> <span class="n">signing</span> <span class="n">credentials</span>

<span class="p">**</span><span class="nc">Key</span> <span class="nc">Considerations</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">Domain</span> <span class="n">authorities</span> <span class="n">should</span> <span class="n">be</span> <span class="n">well-known</span><span class="p">,</span> <span class="n">trusted</span> <span class="n">entities</span>
<span class="p">-</span> <span class="nc">In</span> <span class="n">production</span><span class="p">,</span> <span class="n">domain</span> <span class="n">authority</span> <span class="nc">DIDs</span> <span class="n">should</span> <span class="n">be</span> <span class="n">published</span> <span class="n">and</span> <span class="n">resolvable</span>
<span class="p">-</span> <span class="nc">Multiple</span> <span class="n">domain</span> <span class="n">authorities</span> <span class="n">can</span> <span class="n">exist</span> <span class="k">for</span> <span class="n">different</span> <span class="n">regions</span> <span class="n">or</span> <span class="n">purposes</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">3</span><span class="p">:</span> <span class="nc">Define</span> <span class="nc">Spatial</span> <span class="nc">Domain</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Create</span> <span class="n">a</span> <span class="n">spatial</span> <span class="n">domain</span> <span class="n">that</span> <span class="n">defines</span> <span class="n">geographic</span> <span class="n">boundaries</span> <span class="n">and</span> <span class="n">allowed</span> <span class="n">activities</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>
<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Geographic</span> <span class="nc">Boundary</span><span class="p">**:</span> <span class="nc">The</span> <span class="n">bounding</span> <span class="n">box</span> <span class="n">defines</span> <span class="n">the</span> <span class="n">geographic</span> <span class="n">extent</span> <span class="n">of</span> <span class="n">the</span> <span class="n">domain</span><span class="p">.</span> <span class="nc">In</span> <span class="n">production</span><span class="p">,</span> <span class="n">you</span> <span class="n">might</span> <span class="n">use</span> <span class="n">complex</span> <span class="n">polygons</span> <span class="k">for</span> <span class="n">irregular</span> <span class="n">boundaries</span><span class="p">.</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Allowed</span> <span class="nc">Activities</span><span class="p">**:</span> <span class="nc">List</span> <span class="n">of</span> <span class="n">activity</span> <span class="n">types</span> <span class="n">that</span> <span class="n">can</span> <span class="n">be</span> <span class="n">performed</span> <span class="k">in</span> <span class="k">this</span> <span class="n">domain</span><span class="p">.</span> <span class="nc">This</span> <span class="n">provides</span> <span class="n">a</span> <span class="n">whitelist</span> <span class="n">approach</span> <span class="n">to</span> <span class="n">authorization</span><span class="p">.</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Domain</span> <span class="nc">Metadata</span><span class="p">**:</span> <span class="nc">Additional</span> <span class="n">information</span> <span class="n">like</span> <span class="n">description</span> <span class="n">helps</span> <span class="n">with</span> <span class="n">domain</span> <span class="n">discovery</span> <span class="n">and</span> <span class="n">understanding</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Real-World</span> <span class="nc">Example</span><span class="p">**:</span> <span class="nc">An</span> <span class="n">airspace</span> <span class="n">domain</span> <span class="n">might</span> <span class="n">allow</span> <span class="s">"data-collection"</span> <span class="n">and</span> <span class="s">"monitoring"</span> <span class="n">but</span> <span class="n">not</span> <span class="s">"transportation"</span> <span class="k">for</span> <span class="n">certain</span> <span class="n">areas</span><span class="p">.</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">4</span><span class="p">:</span> <span class="nc">Create</span> <span class="nc">Entity</span> <span class="nc">DIDs</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Establish</span> <span class="n">unique</span><span class="p">,</span> <span class="n">verifiable</span> <span class="n">identities</span> <span class="k">for</span> <span class="n">all</span> <span class="n">spatial</span> <span class="n">web</span> <span class="n">entities</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="p">**</span><span class="nc">Agent</span> <span class="nc">DID</span><span class="p">**:</span> <span class="nc">Represents</span> <span class="n">an</span> <span class="n">actor</span> <span class="n">that</span> <span class="n">can</span> <span class="n">perform</span> <span class="n">activities</span>
<span class="p">-</span> <span class="nc">Examples</span><span class="p">:</span> <span class="nc">Drone</span><span class="p">,</span> <span class="n">autonomous</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">robot</span><span class="p">,</span> <span class="n">human</span> <span class="k">operator</span>
<span class="p">-</span> <span class="nc">Agents</span> <span class="n">hold</span> <span class="n">authorization</span> <span class="n">credentials</span>
<span class="p">-</span> <span class="nc">Agents</span> <span class="n">initiate</span> <span class="n">activities</span>

<span class="p">**</span><span class="nc">Activity</span> <span class="nc">DID</span><span class="p">**:</span> <span class="nc">Represents</span> <span class="n">a</span> <span class="n">type</span> <span class="n">of</span> <span class="n">action</span>
<span class="p">-</span> <span class="nc">Examples</span><span class="p">:</span> <span class="s">"data-collection"</span><span class="p">,</span> <span class="s">"monitoring"</span><span class="p">,</span> <span class="s">"maintenance"</span>
<span class="p">-</span> <span class="nc">Activities</span> <span class="n">are</span> <span class="n">defined</span> <span class="k">by</span> <span class="n">domain</span> <span class="n">authorities</span>
<span class="p">-</span> <span class="nc">Activities</span> <span class="n">have</span> <span class="n">associated</span> <span class="n">constraints</span> <span class="n">and</span> <span class="n">requirements</span>

<span class="p">**</span><span class="nc">Thing</span> <span class="nc">DID</span><span class="p">**:</span> <span class="nc">Represents</span> <span class="n">a</span> <span class="n">physical</span> <span class="n">or</span> <span class="n">digital</span> <span class="kd">object</span>
<span class="err">- </span><span class="nc">Examples</span><span class="p">:</span> <span class="nc">Sensor</span><span class="p">,</span> <span class="n">vehicle</span><span class="p">,</span> <span class="n">data</span> <span class="n">stream</span><span class="p">,</span> <span class="n">device</span>
<span class="p">-</span> <span class="nc">Things</span> <span class="n">can</span> <span class="n">be</span> <span class="n">associated</span> <span class="n">with</span> <span class="n">activities</span>
<span class="p">-</span> <span class="nc">Things</span> <span class="n">have</span> <span class="n">capabilities</span> <span class="n">and</span> <span class="n">properties</span>

<span class="p">**</span><span class="nc">Spatial</span> <span class="nc">Feature</span> <span class="nc">DID</span><span class="p">**:</span> <span class="nc">Represents</span> <span class="n">a</span> <span class="n">geographic</span> <span class="n">feature</span>
<span class="p">-</span> <span class="nc">Examples</span><span class="p">:</span> <span class="nc">Building</span><span class="p">,</span> <span class="n">park</span><span class="p">,</span> <span class="n">zone</span><span class="p">,</span> <span class="n">airspace</span><span class="p">,</span> <span class="n">waterway</span>
<span class="p">-</span> <span class="nc">Features</span> <span class="n">have</span> <span class="n">geographic</span> <span class="n">representation</span>
<span class="p">-</span> <span class="nc">Features</span> <span class="n">can</span> <span class="n">be</span> <span class="n">part</span> <span class="n">of</span> <span class="n">domains</span>

<span class="p">**</span><span class="nc">Why</span> <span class="nc">DIDs</span> <span class="nc">Matter</span><span class="p">**:</span> <span class="nc">DIDs</span> <span class="n">provide</span><span class="p">:</span>
<span class="p">-</span> <span class="nc">Decentralized</span> <span class="nf">identity</span> <span class="p">(</span><span class="n">no</span> <span class="n">central</span> <span class="n">registry</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Persistence</span> <span class="p">(</span><span class="n">don</span><span class="err">'</span><span class="n">t</span> <span class="n">change</span> <span class="k">when</span> <span class="n">providers</span> <span class="n">change</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Cryptographic</span> <span class="n">verifiability</span>
<span class="p">-</span> <span class="nc">Interoperability</span> <span class="n">across</span> <span class="n">systems</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">5</span><span class="p">:</span> <span class="nc">Create</span> <span class="nc">Authorization</span> <span class="nc">Credential</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Issue</span> <span class="n">a</span> <span class="n">verifiable</span> <span class="n">credential</span> <span class="n">that</span> <span class="n">grants</span> <span class="n">an</span> <span class="n">agent</span> <span class="n">permission</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">an</span> <span class="n">activity</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="p">**</span><span class="nc">Credential</span> <span class="nc">Structure</span><span class="p">**:</span>
<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Agent</span> <span class="nc">Reference</span><span class="p">**:</span> <span class="nc">Links</span> <span class="n">credential</span> <span class="n">to</span> <span class="n">the</span> <span class="n">agent</span> <span class="nc">DID</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Activity</span> <span class="nc">Reference</span><span class="p">**:</span> <span class="nc">Specifies</span> <span class="n">which</span> <span class="n">activity</span> <span class="k">is</span> <span class="n">authorized</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Domain</span> <span class="nc">Reference</span><span class="p">**:</span> <span class="nc">Limits</span> <span class="n">authorization</span> <span class="n">to</span> <span class="n">specific</span> <span class="n">domain</span>
<span class="mi">4</span><span class="p">.</span> <span class="p">**</span><span class="nc">Constraints</span><span class="p">**:</span> <span class="nc">Defines</span> <span class="n">limits</span> <span class="n">and</span> <span class="n">conditions</span><span class="p">:</span>
   <span class="p">-</span> <span class="nc">Time</span> <span class="nf">windows</span> <span class="p">(</span><span class="k">when</span> <span class="n">activity</span> <span class="k">is</span> <span class="n">allowed</span><span class="p">)</span>
   <span class="p">-</span> <span class="nc">Resource</span> <span class="nf">limits</span> <span class="p">(</span><span class="n">altitude</span><span class="p">,</span> <span class="n">duration</span><span class="p">,</span> <span class="n">etc</span><span class="p">.)</span>
   <span class="p">-</span> <span class="nc">Associated</span> <span class="nf">entities</span> <span class="p">(</span><span class="n">things</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>

<span class="p">**</span><span class="nc">Constraint</span> <span class="nc">Examples</span><span class="p">**:</span>
<span class="p">-</span> <span class="n">`maxAltitude</span><span class="p">:</span> <span class="s">"400"</span><span class="err">`</span> <span class="p">-</span> <span class="nc">Maximum</span> <span class="n">altitude</span> <span class="k">in</span> <span class="n">feet</span>
<span class="p">-</span> <span class="n">`maxDuration</span><span class="p">:</span> <span class="s">"PT2H"</span><span class="err">`</span> <span class="p">-</span> <span class="nc">Maximum</span> <span class="nf">duration</span> <span class="p">(</span><span class="nc">ISO</span> <span class="mi">8601</span><span class="p">)</span>
<span class="p">-</span> <span class="n">`timeWindow</span><span class="p">:</span> <span class="s">"2024-01-01T08:00:00Z/2024-01-01T18:00:00Z"</span><span class="err">`</span> <span class="p">-</span> <span class="nc">Allowed</span> <span class="n">time</span> <span class="n">range</span>
<span class="p">-</span> <span class="n">`allowedResources</span><span class="p">:</span> <span class="s">"sensor-data-collection"</span><span class="err">`</span> <span class="p">-</span> <span class="nc">Specific</span> <span class="n">resource</span> <span class="n">types</span>

<span class="p">**</span><span class="nc">Why</span> <span class="nc">Constraints</span> <span class="nc">Matter</span><span class="p">**:</span> <span class="nc">Constraints</span> <span class="n">provide</span> <span class="n">fine-grained</span> <span class="n">control</span> <span class="n">over</span> <span class="n">authorization</span><span class="p">,</span> <span class="n">enabling</span><span class="p">:</span>
<span class="p">-</span> <span class="nc">Time-based</span> <span class="nf">restrictions</span> <span class="p">(</span><span class="n">daylight-only</span> <span class="n">operations</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Resource</span> <span class="nf">limits</span> <span class="p">(</span><span class="n">prevent</span> <span class="n">resource</span> <span class="n">exhaustion</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Conditional</span> <span class="nf">permissions</span> <span class="p">(</span><span class="n">weather-dependent</span> <span class="n">activities</span><span class="p">)</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">6</span><span class="p">:</span> <span class="nc">Issue</span> <span class="nc">Credential</span> <span class="n">with</span> <span class="nc">Proof</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Cryptographically</span> <span class="n">sign</span> <span class="n">the</span> <span class="n">authorization</span> <span class="n">credential</span> <span class="n">to</span> <span class="n">make</span> <span class="n">it</span> <span class="n">verifiable</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Key</span> <span class="nc">Generation</span><span class="p">**:</span> <span class="nc">Generate</span> <span class="n">a</span> <span class="n">signing</span> <span class="n">key</span> <span class="k">for</span> <span class="n">the</span> <span class="n">domain</span> <span class="n">authority</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Proof</span> <span class="nc">Generator</span><span class="p">**:</span> <span class="nc">Create</span> <span class="n">an</span> <span class="nc">Ed25519</span> <span class="n">proof</span> <span class="n">generator</span> <span class="n">that</span> <span class="n">uses</span> <span class="n">the</span> <span class="nc">KMS</span> <span class="k">for</span> <span class="n">signing</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Proof</span> <span class="nc">Registration</span><span class="p">**:</span> <span class="nc">Register</span> <span class="n">the</span> <span class="n">proof</span> <span class="n">generator</span> <span class="n">so</span> <span class="n">it</span> <span class="n">can</span> <span class="n">be</span> <span class="n">used</span>
<span class="mi">4</span><span class="p">.</span> <span class="p">**</span><span class="nc">Credential</span> <span class="nc">Issuance</span><span class="p">**:</span> <span class="nc">Issue</span> <span class="n">the</span> <span class="n">credential</span> <span class="n">with</span> <span class="n">cryptographic</span> <span class="n">proof</span>

<span class="p">**</span><span class="nc">Proof</span> <span class="nc">Generation</span> <span class="nc">Process</span><span class="p">**:</span>
<span class="mi">1</span><span class="p">.</span> <span class="nc">Build</span> <span class="n">proof</span> <span class="nf">document</span> <span class="p">(</span><span class="n">credential</span> <span class="n">without</span> <span class="n">proof</span> <span class="n">field</span><span class="p">)</span>
<span class="mi">2</span><span class="p">.</span> <span class="nc">Canonicalize</span> <span class="n">and</span> <span class="n">hash</span> <span class="n">the</span> <span class="n">document</span>
<span class="mi">3</span><span class="p">.</span> <span class="nc">Sign</span> <span class="n">the</span> <span class="n">hash</span> <span class="n">with</span> <span class="n">domain</span> <span class="n">authority</span><span class="err">'</span><span class="n">s</span> <span class="k">private</span> <span class="n">key</span>
<span class="mi">4</span><span class="p">.</span> <span class="nc">Create</span> <span class="n">proof</span> <span class="kd">object</span> <span class="err">with signature and metadata
5. </span><span class="nc">Attach</span> <span class="n">proof</span> <span class="n">to</span> <span class="n">credential</span>

<span class="p">**</span><span class="nc">Security</span> <span class="nc">Considerations</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">Private</span> <span class="n">keys</span> <span class="n">must</span> <span class="n">be</span> <span class="n">securely</span> <span class="nf">stored</span> <span class="p">(</span><span class="n">use</span> <span class="n">hardware</span> <span class="n">security</span> <span class="n">modules</span> <span class="k">in</span> <span class="n">production</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Proof</span> <span class="n">generation</span> <span class="n">should</span> <span class="n">be</span> <span class="nf">atomic</span> <span class="p">(</span><span class="n">all-or-nothing</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Proofs</span> <span class="n">should</span> <span class="n">include</span> <span class="n">timestamps</span> <span class="n">and</span> <span class="n">nonces</span> <span class="n">to</span> <span class="n">prevent</span> <span class="n">replay</span> <span class="n">attacks</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">7</span><span class="p">:</span> <span class="nc">Anchor</span> <span class="nc">Authorization</span> <span class="n">to</span> <span class="nc">Blockchain</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Create</span> <span class="n">an</span> <span class="n">immutable</span> <span class="n">record</span> <span class="n">of</span> <span class="n">the</span> <span class="n">authorization</span> <span class="n">on</span> <span class="n">a</span> <span class="n">blockchain</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Digest</span> <span class="nc">Computation</span><span class="p">**:</span> <span class="nc">Compute</span> <span class="n">a</span> <span class="n">cryptographic</span> <span class="n">hash</span> <span class="n">of</span> <span class="n">the</span> <span class="n">credential</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Authorization</span> <span class="nc">Record</span><span class="p">**:</span> <span class="nc">Create</span> <span class="n">a</span> <span class="n">structured</span> <span class="n">record</span> <span class="n">containing</span><span class="p">:</span>
   <span class="p">-</span> <span class="nc">Agent</span> <span class="nc">DID</span>
   <span class="p">-</span> <span class="nc">Activity</span> <span class="nc">DID</span>
   <span class="p">-</span> <span class="nc">Domain</span> <span class="nc">DID</span>
   <span class="p">-</span> <span class="nc">Constraints</span>
   <span class="p">-</span> <span class="nc">Credential</span> <span class="n">digest</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Blockchain</span> <span class="nc">Anchoring</span><span class="p">**:</span> <span class="nc">Anchor</span> <span class="n">the</span> <span class="n">record</span> <span class="n">to</span> <span class="n">blockchain</span>

<span class="p">**</span><span class="nc">Why</span> <span class="nc">Anchor</span> <span class="n">to</span> <span class="nc">Blockchain</span><span class="p">**:</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Immutability</span><span class="p">**:</span> <span class="nc">Cannot</span> <span class="n">be</span> <span class="n">tampered</span> <span class="n">with</span> <span class="n">after</span> <span class="n">anchoring</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Audit</span> <span class="nc">Trail</span><span class="p">**:</span> <span class="nc">Provides</span> <span class="n">permanent</span> <span class="n">record</span> <span class="n">of</span> <span class="n">all</span> <span class="n">authorizations</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Trust</span><span class="p">**:</span> <span class="nc">Third</span> <span class="n">parties</span> <span class="n">can</span> <span class="n">verify</span> <span class="n">authorizations</span> <span class="n">independently</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Non-repudiation</span><span class="p">**:</span> <span class="nc">Domain</span> <span class="n">authority</span> <span class="n">cannot</span> <span class="n">deny</span> <span class="n">issuing</span> <span class="n">authorization</span>

<span class="p">**</span><span class="nc">Blockchain</span> <span class="nc">Considerations</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">Choose</span> <span class="n">blockchain</span> <span class="n">based</span> <span class="n">on</span> <span class="nf">requirements</span> <span class="p">(</span><span class="n">cost</span><span class="p">,</span> <span class="n">speed</span><span class="p">,</span> <span class="n">finality</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Consider</span> <span class="nf">privacy</span> <span class="p">(</span><span class="k">public</span> <span class="n">vs</span> <span class="k">private</span> <span class="n">blockchains</span><span class="p">)</span>
<span class="p">-</span> <span class="nc">Handle</span> <span class="n">blockchain</span> <span class="n">failures</span> <span class="n">gracefully</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">8</span><span class="p">:</span> <span class="nc">Store</span> <span class="nc">Credential</span> <span class="k">in</span> <span class="nc">Agent</span> <span class="nc">Wallet</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Enable</span> <span class="n">the</span> <span class="n">agent</span> <span class="n">to</span> <span class="n">present</span> <span class="n">authorization</span> <span class="n">credentials</span> <span class="k">when</span> <span class="n">needed</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Wallet</span> <span class="nc">Creation</span><span class="p">**:</span> <span class="nc">Create</span> <span class="n">a</span> <span class="n">wallet</span> <span class="k">for</span> <span class="n">the</span> <span class="n">agent</span> <span class="n">using</span> <span class="n">its</span> <span class="nc">DID</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Credential</span> <span class="nc">Storage</span><span class="p">**:</span> <span class="nc">Store</span> <span class="n">the</span> <span class="n">authorization</span> <span class="n">credential</span> <span class="k">in</span> <span class="n">the</span> <span class="n">wallet</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Organization</span><span class="p">**:</span> <span class="nc">Use</span> <span class="n">collections</span> <span class="n">and</span> <span class="n">tags</span> <span class="n">to</span> <span class="n">organize</span> <span class="n">credentials</span>

<span class="p">**</span><span class="nc">Wallet</span> <span class="nc">Benefits</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">Secure</span> <span class="n">storage</span> <span class="n">of</span> <span class="n">credentials</span>
<span class="p">-</span> <span class="nc">Easy</span> <span class="n">retrieval</span> <span class="n">and</span> <span class="n">presentation</span>
<span class="p">-</span> <span class="nc">Organization</span> <span class="n">and</span> <span class="n">querying</span> <span class="n">capabilities</span>
<span class="p">-</span> <span class="nc">Privacy</span> <span class="nf">control</span> <span class="p">(</span><span class="n">selective</span> <span class="n">disclosure</span><span class="p">)</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">9</span><span class="p">:</span> <span class="nc">Verify</span> <span class="nc">Authorization</span> <span class="nc">Credential</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">that</span> <span class="n">an</span> <span class="n">authorization</span> <span class="n">credential</span> <span class="k">is</span> <span class="n">valid</span> <span class="n">before</span> <span class="n">allowing</span> <span class="n">an</span> <span class="n">activity</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="p">**</span><span class="nc">Verification</span> <span class="nc">Steps</span><span class="p">**:</span>
<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Proof</span> <span class="nc">Verification</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">cryptographic</span> <span class="n">signature</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Issuer</span> <span class="nc">Verification</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">domain</span> <span class="n">authority</span> <span class="nc">DID</span> <span class="k">is</span> <span class="n">valid</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Expiration</span> <span class="nc">Check</span><span class="p">**:</span> <span class="nc">Ensure</span> <span class="n">credential</span> <span class="n">hasn</span><span class="err">'</span><span class="n">t</span> <span class="n">expired</span>
<span class="mi">4</span><span class="p">.</span> <span class="p">**</span><span class="nc">Revocation</span> <span class="nc">Check</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">credential</span> <span class="n">hasn</span><span class="err">'</span><span class="n">t</span> <span class="n">been</span> <span class="n">revoked</span>
<span class="mi">5</span><span class="p">.</span> <span class="p">**</span><span class="nc">Schema</span> <span class="nc">Validation</span><span class="p">**:</span> <span class="nc">Validate</span> <span class="n">credential</span> <span class="n">structure</span>

<span class="p">**</span><span class="nc">Verification</span> <span class="nc">Result</span><span class="p">**:</span>
<span class="p">-</span> <span class="n">`valid`</span><span class="p">:</span> <span class="nc">Overall</span> <span class="n">validity</span>
<span class="p">-</span> <span class="n">`proofValid`</span><span class="p">:</span> <span class="nc">Cryptographic</span> <span class="n">proof</span> <span class="k">is</span> <span class="n">valid</span>
<span class="p">-</span> <span class="n">`issuerValid`</span><span class="p">:</span> <span class="nc">Issuer</span> <span class="nc">DID</span> <span class="n">resolves</span> <span class="n">correctly</span>
<span class="p">-</span> <span class="n">`notExpired`</span><span class="p">:</span> <span class="nc">Credential</span> <span class="k">is</span> <span class="n">within</span> <span class="n">validity</span> <span class="n">period</span>
<span class="p">-</span> <span class="n">`notRevoked`</span><span class="p">:</span> <span class="nc">Credential</span> <span class="n">hasn</span><span class="err">'</span><span class="n">t</span> <span class="n">been</span> <span class="n">revoked</span>
<span class="p">-</span> <span class="n">`schemaValid`</span><span class="p">:</span> <span class="nc">Credential</span> <span class="n">matches</span> <span class="n">schema</span>

<span class="p">**</span><span class="nc">Error</span> <span class="nc">Handling</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">Invalid</span> <span class="n">proof</span><span class="p">:</span> <span class="nc">Credential</span> <span class="n">may</span> <span class="n">be</span> <span class="n">tampered</span> <span class="n">with</span>
<span class="p">-</span> <span class="nc">Expired</span> <span class="n">credential</span><span class="p">:</span> <span class="nc">Need</span> <span class="n">to</span> <span class="n">request</span> <span class="n">renewal</span>
<span class="p">-</span> <span class="nc">Revoked</span> <span class="n">credential</span><span class="p">:</span> <span class="nc">Authorization</span> <span class="n">has</span> <span class="n">been</span> <span class="n">withdrawn</span>
<span class="p">-</span> <span class="nc">Invalid</span> <span class="n">issuer</span><span class="p">:</span> <span class="nc">Credential</span> <span class="n">from</span> <span class="n">untrusted</span> <span class="n">source</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">10</span><span class="p">:</span> <span class="nc">Check</span> <span class="nc">Domain</span> <span class="nc">Authorization</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">that</span> <span class="n">an</span> <span class="n">agent</span> <span class="k">is</span> <span class="n">authorized</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">an</span> <span class="n">activity</span> <span class="k">in</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">domain</span> <span class="n">at</span> <span class="n">a</span> <span class="n">specific</span> <span class="n">location</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="p">**</span><span class="nc">Authorization</span> <span class="nc">Check</span> <span class="nc">Process</span><span class="p">**:</span>
<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Agent</span> <span class="nc">Verification</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">credential</span> <span class="k">is</span> <span class="k">for</span> <span class="n">the</span> <span class="n">requesting</span> <span class="n">agent</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Activity</span> <span class="nc">Verification</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">activity</span> <span class="n">type</span> <span class="n">matches</span> <span class="n">request</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Domain</span> <span class="nc">Verification</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">domain</span> <span class="n">matches</span> <span class="n">and</span> <span class="n">activity</span> <span class="k">is</span> <span class="n">allowed</span>
<span class="mi">4</span><span class="p">.</span> <span class="p">**</span><span class="nc">Location</span> <span class="nc">Verification</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">current</span> <span class="n">location</span> <span class="k">is</span> <span class="n">within</span> <span class="n">domain</span> <span class="n">boundary</span>
<span class="mi">5</span><span class="p">.</span> <span class="p">**</span><span class="nc">Constraint</span> <span class="nc">Verification</span><span class="p">**:</span> <span class="nc">Verify</span> <span class="n">constraints</span> <span class="n">are</span> <span class="nf">satisfied</span> <span class="p">(</span><span class="n">time</span><span class="p">,</span> <span class="n">altitude</span><span class="p">,</span> <span class="n">etc</span><span class="p">.)</span>

<span class="p">**</span><span class="nc">Geographic</span> <span class="nc">Boundary</span> <span class="nc">Check</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">Simple</span> <span class="n">bounding</span> <span class="n">box</span><span class="p">:</span> <span class="nc">Check</span> <span class="k">if</span> <span class="n">coordinates</span> <span class="n">are</span> <span class="n">within</span> <span class="n">min</span><span class="p">/</span><span class="n">max</span> <span class="n">lat</span><span class="p">/</span><span class="n">lon</span>
<span class="p">-</span> <span class="nc">Complex</span> <span class="n">polygons</span><span class="p">:</span> <span class="nc">Use</span> <span class="n">point-in-polygon</span> <span class="n">algorithms</span>
<span class="p">-</span> <span class="mi">3</span><span class="nc">D</span> <span class="n">boundaries</span><span class="p">:</span> <span class="nc">Include</span> <span class="n">altitude</span> <span class="n">checks</span> <span class="k">for</span> <span class="n">airspace</span> <span class="n">domains</span>

<span class="p">**</span><span class="nc">Constraint</span> <span class="nc">Validation</span><span class="p">**:</span>
<span class="p">-</span> <span class="nc">Time</span> <span class="n">windows</span><span class="p">:</span> <span class="nc">Check</span> <span class="n">current</span> <span class="n">time</span> <span class="k">is</span> <span class="n">within</span> <span class="n">allowed</span> <span class="n">range</span>
<span class="p">-</span> <span class="nc">Resource</span> <span class="n">limits</span><span class="p">:</span> <span class="nc">Verify</span> <span class="n">requested</span> <span class="n">resources</span> <span class="n">don</span><span class="err">'</span><span class="n">t</span> <span class="n">exceed</span> <span class="n">limits</span>
<span class="p">-</span> <span class="nc">Conditions</span><span class="p">:</span> <span class="nc">Check</span> <span class="n">any</span> <span class="n">conditional</span> <span class="n">requirements</span>

<span class="err">###</span> <span class="nc">Step</span> <span class="mi">11</span><span class="p">:</span> <span class="nc">Create</span> <span class="nc">Activity</span> <span class="nc">Presentation</span>

<span class="p">**</span><span class="nc">Purpose</span><span class="p">**:</span> <span class="nc">Create</span> <span class="n">a</span> <span class="n">verifiable</span> <span class="n">presentation</span> <span class="n">that</span> <span class="n">the</span> <span class="n">agent</span> <span class="n">can</span> <span class="n">use</span> <span class="n">to</span> <span class="n">prove</span> <span class="n">authorization</span><span class="p">.</span>

<span class="p">**</span><span class="nc">Detailed</span> <span class="nc">Explanation</span><span class="p">**:</span>

<span class="p">**</span><span class="nc">Presentation</span> <span class="nc">Creation</span><span class="p">**:</span>
<span class="mi">1</span><span class="p">.</span> <span class="p">**</span><span class="nc">Credential</span> <span class="nc">Selection</span><span class="p">**:</span> <span class="nc">Select</span> <span class="n">relevant</span> <span class="n">authorization</span> <span class="n">credentials</span>
<span class="mi">2</span><span class="p">.</span> <span class="p">**</span><span class="nc">Presentation</span> <span class="nc">Options</span><span class="p">**:</span> <span class="nc">Set</span> <span class="n">options</span> <span class="n">like</span> <span class="nf">challenge</span> <span class="p">(</span><span class="n">prevents</span> <span class="n">replay</span> <span class="n">attacks</span><span class="p">)</span>
<span class="mi">3</span><span class="p">.</span> <span class="p">**</span><span class="nc">Presentation</span> <span class="nc">Signing</span><span class="p">**:</span> <span class="nc">Sign</span> <span class="n">the</span> <span class="n">presentation</span> <span class="n">with</span> <span class="n">agent</span><span class="err">'</span><span class="n">s</span> <span class="n">key</span>

<span class="p">**</span><span class="nc">Presentation</span> <span class="nc">Use</span> <span class="nc">Cases</span><span class="p">**:</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Activity</span> <span class="nc">Request</span><span class="p">**:</span> <span class="nc">Present</span> <span class="n">to</span> <span class="n">domain</span> <span class="n">authority</span> <span class="k">when</span> <span class="n">requesting</span> <span class="n">to</span> <span class="n">perform</span> <span class="n">activity</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Access</span> <span class="nc">Control</span><span class="p">**:</span> <span class="nc">Present</span> <span class="n">to</span> <span class="n">systems</span> <span class="n">that</span> <span class="n">control</span> <span class="n">access</span> <span class="n">to</span> <span class="n">resources</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Audit</span><span class="p">**:</span> <span class="nc">Provide</span> <span class="n">proof</span> <span class="n">of</span> <span class="n">authorization</span> <span class="k">for</span> <span class="n">compliance</span>

<span class="p">**</span><span class="nc">Security</span> <span class="nc">Features</span><span class="p">**:</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Challenge</span><span class="p">**:</span> <span class="nc">Random</span> <span class="n">value</span> <span class="n">prevents</span> <span class="n">replay</span> <span class="n">attacks</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Domain</span><span class="p">**:</span> <span class="nc">Optional</span> <span class="n">domain</span> <span class="n">parameter</span> <span class="k">for</span> <span class="n">additional</span> <span class="n">security</span>
<span class="p">-</span> <span class="p">**</span><span class="nc">Timestamp</span><span class="p">**:</span> <span class="nc">Proves</span> <span class="k">when</span> <span class="n">presentation</span> <span class="n">was</span> <span class="n">created</span>

<span class="err">##</span> <span class="nc">Advanced</span> <span class="nc">Features</span>

<span class="err">###</span> <span class="nc">Multi-Domain</span> <span class="nc">Activities</span>

<span class="nc">Activities</span> <span class="n">that</span> <span class="n">span</span> <span class="n">multiple</span> <span class="n">domains</span> <span class="n">require</span> <span class="n">coordination</span><span class="p">:</span>

<span class="err">``</span><span class="n">`kotlin</span>
<span class="k">fun</span> <span class="nf">createMultiDomainAuthorization</span><span class="p">(</span>
    <span class="n">agentDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">activityDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">domains</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">SpatialDomain</span><span class="p">&gt;,</span>
    <span class="n">domainAuthorities</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;</span> <span class="c1">// domainId -&gt; authorityDid</span>
<span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">domains</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">domain</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">authorityDid</span> <span class="p">=</span> <span class="n">domainAuthorities</span><span class="p">[</span><span class="n">domain</span><span class="p">.</span><span class="n">domainId</span><span class="p">]</span><span class="o">!!</span>
        <span class="c1">// Issue credential for each domain</span>
        <span class="nf">createAuthorizationCredential</span><span class="p">(</span>
            <span class="n">agentDid</span> <span class="p">=</span> <span class="n">agentDid</span><span class="p">,</span>
            <span class="n">activityDid</span> <span class="p">=</span> <span class="n">activityDid</span><span class="p">,</span>
            <span class="n">domain</span> <span class="p">=</span> <span class="n">domain</span><span class="p">,</span>
            <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">authorityDid</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="c1">// Verify multi-domain authorization</span>
<span class="k">fun</span> <span class="nf">verifyMultiDomainAuthorization</span><span class="p">(</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;,</span>
    <span class="n">requiredDomains</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">authorizedDomains</span> <span class="p">=</span> <span class="n">credentials</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="n">credential</span> <span class="p">-&gt;</span>
        <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"authorization"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonObject</span>
            <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"domainId"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
    <span class="p">}.</span><span class="nf">toSet</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">requiredDomains</span><span class="p">.</span><span class="nf">all</span> <span class="p">{</span> <span class="n">it</span> <span class="k">in</span> <span class="n">authorizedDomains</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="activity-constraints">


    <a href="#activity-constraints" class="anchor-heading" aria-labelledby="activity-constraints"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Activity Constraints


</h3>


<p>Advanced constraint checking:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="kd">data class</span> <span class="nc">ActivityConstraints</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">maxAltitude</span><span class="p">:</span> <span class="nc">Double</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">maxDuration</span><span class="p">:</span> <span class="n">java</span><span class="p">.</span><span class="n">time</span><span class="p">.</span><span class="nc">Duration</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timeWindow</span><span class="p">:</span> <span class="nc">Pair</span><span class="p">&lt;</span><span class="nc">Instant</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">&gt;?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">weatherConditions</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">resourceLimits</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">Double</span><span class="p">&gt;?</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">requiredCapabilities</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;?</span> <span class="p">=</span> <span class="k">null</span>
<span class="p">)</span>

<span class="k">fun</span> <span class="nf">checkConstraints</span><span class="p">(</span>
    <span class="n">credential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span><span class="p">,</span>
    <span class="n">currentConditions</span><span class="p">:</span> <span class="nc">CurrentConditions</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="kd">val</span> <span class="py">constraints</span> <span class="p">=</span> <span class="nf">extractConstraints</span><span class="p">(</span><span class="n">credential</span><span class="p">)</span>

    <span class="c1">// Check altitude</span>
    <span class="n">constraints</span><span class="p">.</span><span class="n">maxAltitude</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">currentConditions</span><span class="p">.</span><span class="n">altitude</span> <span class="p">&gt;</span> <span class="n">it</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
    <span class="p">}</span>

    <span class="c1">// Check time window</span>
    <span class="n">constraints</span><span class="p">.</span><span class="n">timeWindow</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="p">(</span><span class="n">start</span><span class="p">,</span> <span class="n">end</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">now</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">()</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">now</span><span class="p">.</span><span class="nf">isBefore</span><span class="p">(</span><span class="n">start</span><span class="p">)</span> <span class="p">||</span> <span class="n">now</span><span class="p">.</span><span class="nf">isAfter</span><span class="p">(</span><span class="n">end</span><span class="p">))</span> <span class="k">return</span> <span class="k">false</span>
    <span class="p">}</span>

    <span class="c1">// Check weather conditions</span>
    <span class="n">constraints</span><span class="p">.</span><span class="n">weatherConditions</span><span class="o">?.</span><span class="nf">let</span> <span class="p">{</span> <span class="n">allowedConditions</span> <span class="p">-&gt;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">currentConditions</span><span class="p">.</span><span class="n">weather</span> <span class="p">!</span><span class="k">in</span> <span class="n">allowedConditions</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="k">true</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="entity-relationships">


    <a href="#entity-relationships" class="anchor-heading" aria-labelledby="entity-relationships"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Entity Relationships


</h3>


<p>Model relationships between entities:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createEntityRelationshipCredential</span><span class="p">(</span>
    <span class="n">sourceEntityDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">targetEntityDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">relationshipType</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">issuerDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"EntityRelationshipCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">issuerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"sourceEntityDid"</span><span class="p">,</span> <span class="n">sourceEntityDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"targetEntityDid"</span><span class="p">,</span> <span class="n">targetEntityDid</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"relationshipType"</span><span class="p">,</span> <span class="n">relationshipType</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"properties"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="c1">// Relationship-specific properties</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Example: Associate agent with thing</span>
<span class="kd">val</span> <span class="py">agentThingRelationship</span> <span class="p">=</span> <span class="nf">createEntityRelationshipCredential</span><span class="p">(</span>
    <span class="n">sourceEntityDid</span> <span class="p">=</span> <span class="n">droneAgentDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">targetEntityDid</span> <span class="p">=</span> <span class="n">sensorThingDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
    <span class="n">relationshipType</span> <span class="p">=</span> <span class="s">"controls"</span><span class="p">,</span>
    <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">domainAuthorityDid</span><span class="p">.</span><span class="n">id</span>
<span class="p">)</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="revocation">


    <a href="#revocation" class="anchor-heading" aria-labelledby="revocation"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Revocation


</h3>


<p>Revoke authorizations when needed:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">revokeAuthorization</span><span class="p">(</span>
    <span class="n">credentialId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">revocationReason</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">revokerDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="c1">// Add revocation status to credential</span>
    <span class="k">return</span> <span class="n">credential</span><span class="p">.</span><span class="nf">copy</span><span class="p">(</span>
        <span class="n">credentialStatus</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialStatus</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/revocation-list"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"StatusList2021Entry"</span><span class="p">,</span>
            <span class="n">statusPurpose</span> <span class="p">=</span> <span class="s">"revocation"</span><span class="p">,</span>
            <span class="n">statusListIndex</span> <span class="p">=</span> <span class="n">credentialId</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="c1">// Check revocation status</span>
<span class="k">fun</span> <span class="nf">isRevoked</span><span class="p">(</span><span class="n">credential</span><span class="p">:</span> <span class="nc">VerifiableCredential</span><span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">credential</span><span class="p">.</span><span class="n">credentialStatus</span> <span class="p">!=</span> <span class="k">null</span> <span class="p">&amp;&amp;</span>
            <span class="n">credential</span><span class="p">.</span><span class="n">credentialStatus</span><span class="o">?.</span><span class="n">statusPurpose</span> <span class="p">==</span> <span class="s">"revocation"</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="real-world-use-cases">


    <a href="#real-world-use-cases" class="anchor-heading" aria-labelledby="real-world-use-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-World Use Cases


</h2>

<h3 id="1-drone-operations-in-controlled-airspace">


    <a href="#1-drone-operations-in-controlled-airspace" class="anchor-heading" aria-labelledby="1-drone-operations-in-controlled-airspace"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Drone Operations in Controlled Airspace


</h3>


<p><strong>Scenario</strong>: Commercial drone operator needs authorization to fly in controlled airspace for data collection.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">authorizeDroneOperation</span><span class="p">(</span>
    <span class="n">droneDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">operatorDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">airspaceDomain</span><span class="p">:</span> <span class="nc">SpatialDomain</span><span class="p">,</span>
    <span class="n">flightPlan</span><span class="p">:</span> <span class="nc">FlightPlan</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="c1">// Verify operator has required certifications</span>
    <span class="kd">val</span> <span class="py">operatorCert</span> <span class="p">=</span> <span class="nf">verifyOperatorCertification</span><span class="p">(</span><span class="n">operatorDid</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">operatorCert</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"Operator not certified"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Check flight plan is within domain boundaries</span>
    <span class="kd">val</span> <span class="py">flightPathInDomain</span> <span class="p">=</span> <span class="n">flightPlan</span><span class="p">.</span><span class="n">waypoints</span><span class="p">.</span><span class="nf">all</span> <span class="p">{</span> <span class="n">waypoint</span> <span class="p">-&gt;</span>
        <span class="nf">isWithinBoundary</span><span class="p">(</span><span class="n">waypoint</span><span class="p">.</span><span class="n">location</span><span class="p">,</span> <span class="n">airspaceDomain</span><span class="p">.</span><span class="n">boundary</span><span class="p">)</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">flightPathInDomain</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"Flight plan outside domain"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Create authorization credential</span>
    <span class="k">return</span> <span class="nf">createAuthorizationCredential</span><span class="p">(</span>
        <span class="n">agentDid</span> <span class="p">=</span> <span class="n">droneDid</span><span class="p">,</span>
        <span class="n">activityDid</span> <span class="p">=</span> <span class="s">"data-collection"</span><span class="p">,</span>
        <span class="n">domain</span> <span class="p">=</span> <span class="n">airspaceDomain</span><span class="p">,</span>
        <span class="n">constraints</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"maxAltitude"</span> <span class="n">to</span> <span class="n">flightPlan</span><span class="p">.</span><span class="n">maxAltitude</span><span class="p">.</span><span class="nf">toString</span><span class="p">(),</span>
            <span class="s">"timeWindow"</span> <span class="n">to</span> <span class="s">"${flightPlan.startTime}/${flightPlan.endTime}"</span><span class="p">,</span>
            <span class="s">"operatorDid"</span> <span class="n">to</span> <span class="n">operatorDid</span>
        <span class="p">),</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">airspaceDomain</span><span class="p">.</span><span class="n">authorityDid</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="2-iot-sensor-data-collection-permissions">


    <a href="#2-iot-sensor-data-collection-permissions" class="anchor-heading" aria-labelledby="2-iot-sensor-data-collection-permissions"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. IoT Sensor Data Collection Permissions


</h3>


<p><strong>Scenario</strong>: Environmental monitoring sensors need authorization to collect data in protected areas.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">authorizeSensorDataCollection</span><span class="p">(</span>
    <span class="n">sensorDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">monitoringDomain</span><span class="p">:</span> <span class="nc">SpatialDomain</span><span class="p">,</span>
    <span class="n">dataTypes</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="c1">// Verify sensor capabilities match requirements</span>
    <span class="kd">val</span> <span class="py">sensorCapabilities</span> <span class="p">=</span> <span class="nf">getSensorCapabilities</span><span class="p">(</span><span class="n">sensorDid</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">requiredCapabilities</span> <span class="p">=</span> <span class="n">monitoringDomain</span><span class="p">.</span><span class="n">requiredCapabilities</span>

    <span class="k">if</span> <span class="p">(!</span><span class="n">requiredCapabilities</span><span class="p">.</span><span class="nf">all</span> <span class="p">{</span> <span class="n">it</span> <span class="k">in</span> <span class="n">sensorCapabilities</span> <span class="p">})</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"Sensor lacks required capabilities"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Create authorization with data type constraints</span>
    <span class="k">return</span> <span class="nf">createAuthorizationCredential</span><span class="p">(</span>
        <span class="n">agentDid</span> <span class="p">=</span> <span class="n">sensorDid</span><span class="p">,</span>
        <span class="n">activityDid</span> <span class="p">=</span> <span class="s">"environmental-monitoring"</span><span class="p">,</span>
        <span class="n">domain</span> <span class="p">=</span> <span class="n">monitoringDomain</span><span class="p">,</span>
        <span class="n">constraints</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
            <span class="s">"allowedDataTypes"</span> <span class="n">to</span> <span class="n">dataTypes</span><span class="p">.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">","</span><span class="p">),</span>
            <span class="s">"collectionInterval"</span> <span class="n">to</span> <span class="s">"PT1H"</span><span class="p">,</span> <span class="c1">// Hourly</span>
            <span class="s">"dataRetention"</span> <span class="n">to</span> <span class="s">"P1Y"</span> <span class="c1">// 1 year</span>
        <span class="p">),</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">monitoringDomain</span><span class="p">.</span><span class="n">authorityDid</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="3-autonomous-vehicle-route-authorization">


    <a href="#3-autonomous-vehicle-route-authorization" class="anchor-heading" aria-labelledby="3-autonomous-vehicle-route-authorization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Autonomous Vehicle Route Authorization


</h3>


<p><strong>Scenario</strong>: Autonomous vehicle needs authorization to travel through multiple domains.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">authorizeVehicleRoute</span><span class="p">(</span>
    <span class="n">vehicleDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">route</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">RouteSegment</span><span class="p">&gt;,</span>
    <span class="n">domains</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">SpatialDomain</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="c1">// Group route segments by domain</span>
    <span class="kd">val</span> <span class="py">segmentsByDomain</span> <span class="p">=</span> <span class="n">route</span><span class="p">.</span><span class="nf">groupBy</span> <span class="p">{</span> <span class="n">segment</span> <span class="p">-&gt;</span>
        <span class="nf">findDomainForLocation</span><span class="p">(</span><span class="n">segment</span><span class="p">.</span><span class="n">location</span><span class="p">,</span> <span class="n">domains</span><span class="p">.</span><span class="n">values</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Request authorization for each domain</span>
    <span class="k">return</span> <span class="n">segmentsByDomain</span><span class="p">.</span><span class="nf">mapNotNull</span> <span class="p">{</span> <span class="p">(</span><span class="n">domain</span><span class="p">,</span> <span class="n">segments</span><span class="p">)</span> <span class="p">-&gt;</span>
        <span class="k">if</span> <span class="p">(</span><span class="n">domain</span> <span class="p">==</span> <span class="k">null</span><span class="p">)</span> <span class="k">return</span><span class="nd">@mapNotNull</span> <span class="k">null</span>

        <span class="nf">createAuthorizationCredential</span><span class="p">(</span>
            <span class="n">agentDid</span> <span class="p">=</span> <span class="n">vehicleDid</span><span class="p">,</span>
            <span class="n">activityDid</span> <span class="p">=</span> <span class="s">"transportation"</span><span class="p">,</span>
            <span class="n">domain</span> <span class="p">=</span> <span class="n">domain</span><span class="p">,</span>
            <span class="n">constraints</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
                <span class="s">"routeSegments"</span> <span class="n">to</span> <span class="n">segments</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">id</span> <span class="p">}.</span><span class="nf">joinToString</span><span class="p">(</span><span class="s">","</span><span class="p">),</span>
                <span class="s">"vehicleType"</span> <span class="n">to</span> <span class="nf">getVehicleType</span><span class="p">(</span><span class="n">vehicleDid</span><span class="p">),</span>
                <span class="s">"maxSpeed"</span> <span class="n">to</span> <span class="n">segments</span><span class="p">.</span><span class="nf">maxOf</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">maxSpeed</span> <span class="p">}.</span><span class="nf">toString</span><span class="p">()</span>
            <span class="p">),</span>
            <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">domain</span><span class="p">.</span><span class="n">authorityDid</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="4-environmental-monitoring-activities">


    <a href="#4-environmental-monitoring-activities" class="anchor-heading" aria-labelledby="4-environmental-monitoring-activities"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 4. Environmental Monitoring Activities


</h3>


<p><strong>Scenario</strong>: Research organization needs authorization for multiple monitoring activities across different zones.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">authorizeMonitoringActivities</span><span class="p">(</span>
    <span class="n">organizationDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">researcherDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">monitoringZones</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">SpatialDomain</span><span class="p">&gt;,</span>
    <span class="n">activities</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="c1">// Verify researcher credentials</span>
    <span class="kd">val</span> <span class="py">researcherCreds</span> <span class="p">=</span> <span class="nf">verifyResearcherCredentials</span><span class="p">(</span><span class="n">researcherDid</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(!</span><span class="n">researcherCreds</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">throw</span> <span class="nc">IllegalArgumentException</span><span class="p">(</span><span class="s">"Researcher not authorized"</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="c1">// Create authorizations for each zone-activity combination</span>
    <span class="k">return</span> <span class="n">monitoringZones</span><span class="p">.</span><span class="nf">flatMap</span> <span class="p">{</span> <span class="n">zone</span> <span class="p">-&gt;</span>
        <span class="n">activities</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">activity</span> <span class="p">-&gt;</span>
            <span class="kd">val</span> <span class="py">authId</span> <span class="p">=</span> <span class="s">"${zone.domainId}-${activity}"</span>
            <span class="n">authId</span> <span class="n">to</span> <span class="nf">createAuthorizationCredential</span><span class="p">(</span>
                <span class="n">agentDid</span> <span class="p">=</span> <span class="n">organizationDid</span><span class="p">,</span>
                <span class="n">activityDid</span> <span class="p">=</span> <span class="n">activity</span><span class="p">,</span>
                <span class="n">domain</span> <span class="p">=</span> <span class="n">zone</span><span class="p">,</span>
                <span class="n">constraints</span> <span class="p">=</span> <span class="nf">mapOf</span><span class="p">(</span>
                    <span class="s">"researcherDid"</span> <span class="n">to</span> <span class="n">researcherDid</span><span class="p">,</span>
                    <span class="s">"organizationDid"</span> <span class="n">to</span> <span class="n">organizationDid</span><span class="p">,</span>
                    <span class="s">"monitoringPurpose"</span> <span class="n">to</span> <span class="s">"research"</span>
                <span class="p">),</span>
                <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">zone</span><span class="p">.</span><span class="n">authorityDid</span>
            <span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}.</span><span class="nf">toMap</span><span class="p">()</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="benefits">


    <a href="#benefits" class="anchor-heading" aria-labelledby="benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Benefits


</h2>


<ol>
  <li><strong>Decentralized Authorization</strong>: No single point of failure, works across organizational boundaries</li>
  <li><strong>Cryptographic Trust</strong>: Verifiable credentials provide tamper-proof authorization</li>
  <li><strong>Spatial Awareness</strong>: Permissions are tied to geographic domains</li>
  <li><strong>Interoperability</strong>: Standard DID/VC format works across different systems</li>
  <li><strong>Scalability</strong>: Can handle millions of entities and activities</li>
  <li><strong>Privacy</strong>: Selective disclosure of permissions</li>
  <li><strong>Auditability</strong>: Blockchain anchoring provides immutable audit trail</li>
  <li><strong>Flexibility</strong>: Supports complex constraints and multi-domain scenarios</li>
  <li><strong>Real-time Verification</strong>: Fast permission checks without API calls</li>
  <li><strong>Revocation</strong>: Can revoke permissions when needed</li>
</ol>
<h2 id="best-practices">


    <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices


</h2>


<ol>
  <li><strong>Domain Design</strong>: Design domains with clear boundaries and well-defined activities</li>
  <li><strong>Constraint Definition</strong>: Define constraints that are verifiable and enforceable</li>
  <li><strong>Credential Lifecycle</strong>: Implement proper issuance, renewal, and revocation processes</li>
  <li><strong>Key Management</strong>: Use secure key management for domain authorities</li>
  <li><strong>Verification</strong>: Always verify credentials before allowing activities</li>
  <li><strong>Location Verification</strong>: Verify location is within domain boundary</li>
  <li><strong>Constraint Checking</strong>: Check all constraints before authorizing activity</li>
  <li><strong>Audit Logging</strong>: Log all authorization checks for compliance</li>
  <li><strong>Error Handling</strong>: Handle verification failures gracefully</li>
  <li><strong>Performance</strong>: Cache verification results for frequently checked credentials</li>
</ol>
<h2 id="next-steps">


    <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps


</h2>


<ul>
  <li>Learn about <a href="/trustweave/tutorials/wallet-api-tutorial/">Wallet API Tutorial</a></li>
  <li>Explore <a href="/trustweave/scenarios/proof-of-location-scenario/">Proof of Location Scenario</a> for related geospatial concepts</li>
  <li>Check out <a href="/trustweave/scenarios/iot-device-identity-scenario/">IoT &amp; Device Identity Scenario</a> for device authorization</li>
  <li>Review <a href="/trustweave/core-concepts/dids/">Core Concepts: DIDs</a> for identity management</li>
  <li>Study <a href="/trustweave/core-concepts/verifiable-credentials/">Core Concepts: Verifiable Credentials</a> for credential details</li>
</ul>






        </main>


  <hr>
  <footer>


    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with ❤️ by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();

        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
        footer.style.marginTop = 'auto'; // Push to bottom in flexbox layout
        footer.style.zIndex = '0'; // Below search overlay
      }
    }

    // Function to update footer visibility based on search state
    function updateFooterVisibility() {
      const footer = document.querySelector('.site-footer');
      const htmlElement = document.documentElement;

      if (footer && htmlElement) {
        const isSearchActive = htmlElement.classList.contains('search-active');
        if (isSearchActive) {
          // Hide footer when search is active - use multiple methods to ensure it's hidden
          footer.style.display = 'none';
          footer.style.visibility = 'hidden';
          footer.style.opacity = '0';
          footer.style.zIndex = '-999';
          footer.style.pointerEvents = 'none';
        } else {
          // Show footer when search is not active
          footer.style.display = 'block';
          footer.style.visibility = 'visible';
          footer.style.opacity = '1';
          footer.style.marginTop = 'auto';
          footer.style.position = 'relative';
          footer.style.zIndex = '-1';
          footer.style.pointerEvents = 'auto';
        }
      }
    }

    // Monitor search state and hide/show footer appropriately
    const observer = new MutationObserver(function(mutations) {
      updateFooterVisibility();
    });

    // Also listen for input events on search input as a backup
    // This ensures footer is hidden immediately when user starts typing
    const searchInput = document.getElementById('search-input');
    if (searchInput) {
      // Use requestAnimationFrame for better performance
      const handleSearchChange = function() {
        requestAnimationFrame(updateFooterVisibility);
      };

      searchInput.addEventListener('input', handleSearchChange);
      searchInput.addEventListener('focus', handleSearchChange);
      searchInput.addEventListener('keydown', handleSearchChange);
    }

    // Observe documentElement (html) for class changes (like search-active)
    // The search script adds 'search-active' to documentElement, not body
    if (document.documentElement) {
      observer.observe(document.documentElement, {
        attributes: true,
        attributeFilter: ['class']
      });

      // Initial check
      updateFooterVisibility();
    }
  });
</script>



  </footer>


      </div>
    </div>



<div class="search-overlay"></div>


  </div>








<script type="module">

  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';


  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>




</body>
</html>

