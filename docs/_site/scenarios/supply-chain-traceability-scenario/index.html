

<!DOCTYPE html>

<html lang="en-US">
<head>
  <meta charset="UTF-8">
  <meta http-equiv="X-UA-Compatible" content="IE=Edge">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-default.css">

  <link rel="stylesheet" href="/trustweave/assets/css/just-the-docs-head-nav.css" id="jtd-head-nav-stylesheet">

  <style id="jtd-nav-activation">
  
    .site-nav ul li a {
      background-image: none;
    }

  </style>

  

  
    <script src="/trustweave/assets/js/vendor/lunr.min.js"></script>
  

  <script src="/trustweave/assets/js/just-the-docs.js"></script>

  <meta name="viewport" content="width=device-width, initial-scale=1">

  



  <!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Supply Chain &amp; Traceability Scenario | TrustWeave Developer Documentation</title>
<meta name="generator" content="Jekyll v4.4.1" />
<meta property="og:title" content="Supply Chain &amp; Traceability Scenario" />
<meta name="author" content="GeoKnoesis" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<meta property="og:description" content="Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin" />
<link rel="canonical" href="https://geoknoesis.github.io/trustweave/scenarios/supply-chain-traceability-scenario/" />
<meta property="og:url" content="https://geoknoesis.github.io/trustweave/scenarios/supply-chain-traceability-scenario/" />
<meta property="og:site_name" content="TrustWeave Developer Documentation" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Supply Chain &amp; Traceability Scenario" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","author":{"@type":"Person","name":"GeoKnoesis"},"description":"Comprehensive developer documentation for TrustWeave - A neutral, reusable trust and identity core library for Kotlin","headline":"Supply Chain &amp; Traceability Scenario","url":"https://geoknoesis.github.io/trustweave/scenarios/supply-chain-traceability-scenario/"}</script>
<!-- End Jekyll SEO tag -->


  <!-- Main Navigation Styles - Consistent across all pages -->
<style>
  :root {
    --primary: #2563eb;
    --primary-dark: #1e40af;
    --secondary: #7c3aed;
    --accent: #10b981;
    --text: #1f2937;
    --text-light: #6b7280;
    --bg: #ffffff;
    --bg-light: #f9fafb;
    --border: #e5e7eb;
    --gradient: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
  }

  .main-nav {
    position: fixed;
    top: 0;
    width: 100%;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    border-bottom: 1px solid var(--border);
    z-index: 1000;
    padding: 0.5rem 0;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
  }
  
  .main-nav .nav-container {
    max-width: 1200px;
    margin: 0 auto;
    padding: 0 2rem;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }
  
  .main-nav .logo {
    display: flex;
    align-items: center;
    gap: 0.75rem;
    text-decoration: none;
    transition: opacity 0.3s;
  }

  .main-nav .logo-img {
    height: 120px;
    width: auto;
    transition: opacity 0.3s;
    display: block;
  }

  .main-nav .logo-img:not([src]),
  .main-nav .logo-img[src=""],
  .main-nav .logo-img[src*="undefined"] {
    display: none;
  }


  .main-nav .logo:hover {
    opacity: 0.8;
  }

  .main-nav .logo:hover .logo-img {
    opacity: 0.8;
  }
  
  .main-nav .nav-links {
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }
  
  .main-nav .nav-links .nav-link {
    text-decoration: none;
    color: var(--text);
    font-weight: 500;
    font-size: 0.95rem;
    padding: 0.5rem 0;
    transition: color 0.3s;
    position: relative;
    white-space: nowrap;
  }
  
  .main-nav .nav-links .nav-link:hover {
    color: var(--primary);
  }

  .main-nav .nav-links .nav-link::after {
    content: '';
    position: absolute;
    bottom: 0;
    left: 0;
    width: 0;
    height: 2px;
    background: var(--primary);
    transition: width 0.3s ease;
  }

  .main-nav .nav-links .nav-link:hover::after,
  .main-nav .nav-links .nav-link.active::after {
    width: 100%;
  }

  .main-nav .nav-links .nav-link.active {
    color: var(--primary);
    font-weight: 600;
  }

  /* GitHub icon button */
  .main-nav .nav-links .github-icon {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 48px;
    height: 48px;
    border-radius: 0.5rem;
    transition: all 0.3s;
    padding: 0.5rem;
    color: var(--text);
    text-decoration: none;
    margin-left: 0.5rem;
  }

  .main-nav .nav-links .github-icon:hover {
    background: var(--bg-light);
    transform: translateY(-2px);
    color: var(--primary);
  }

  .main-nav .nav-links .github-icon svg {
    width: 32px;
    height: 32px;
  }

  /* Mobile menu toggle */
  .menu-toggle {
    display: none;
    flex-direction: column;
    cursor: pointer;
    gap: 5px;
    padding: 0.5rem;
    z-index: 1001;
  }

  .menu-toggle span {
    width: 25px;
    height: 3px;
    background: var(--text);
    transition: all 0.3s;
    border-radius: 2px;
  }

  .menu-toggle.active span:nth-child(1) {
    transform: rotate(45deg) translate(8px, 8px);
  }

  .menu-toggle.active span:nth-child(2) {
    opacity: 0;
  }

  .menu-toggle.active span:nth-child(3) {
    transform: rotate(-45deg) translate(7px, -7px);
  }

  /* Footer styles */
  .site-footer {
    background: var(--text);
    color: white;
    padding: 3rem 2rem;
    text-align: center;
    margin-top: 4rem;
  }

  .site-footer .footer-content {
    max-width: 1200px;
    margin: 0 auto;
  }

  .site-footer .footer-links {
    display: flex;
    justify-content: center;
    gap: 2rem;
    margin-bottom: 2rem;
    flex-wrap: wrap;
  }

  .site-footer .footer-links a {
    color: rgba(255, 255, 255, 0.8);
    text-decoration: none;
    transition: color 0.3s;
  }

  .site-footer .footer-links a:hover {
    color: white;
  }

  .site-footer .footer-text {
    color: rgba(255, 255, 255, 0.6);
    font-size: 0.875rem;
  }

  /* Adjust content for fixed nav */
  body {
    padding-top: 160px;
  }

  /* Just the Docs theme adjustments */
  .site-header {
    margin-top: 0 !important;
  }

  /* Mobile responsive */
  @media (max-width: 968px) {
    .menu-toggle {
      display: flex;
    }

    .main-nav .nav-links {
      position: fixed;
      top: 160px;
      left: 0;
      right: 0;
      background: white;
      flex-direction: column;
      padding: 2rem;
      border-bottom: 1px solid var(--border);
      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
      transform: translateY(-100%);
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
      gap: 1.5rem;
      align-items: flex-start;
      max-height: calc(100vh - 160px);
      overflow-y: auto;
    }

    .main-nav .nav-links.active {
      transform: translateY(0);
      opacity: 1;
      visibility: visible;
    }

    .main-nav .nav-links .nav-link {
      width: 100%;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .nav-links .nav-link::after {
      display: none;
    }

    .main-nav .nav-links .github-icon {
      width: 100%;
      justify-content: flex-start;
      margin-left: 0;
      padding: 0.75rem 0;
      border-bottom: 1px solid var(--border);
    }

    .main-nav .logo-img {
      height: 120px;
    }

    .site-footer .footer-links {
      flex-direction: column;
      gap: 1rem;
    }
  }

  /* Tablet adjustments */
  @media (max-width: 968px) and (min-width: 769px) {
    .main-nav .nav-links {
      gap: 1rem;
    }

    .main-nav .nav-links .nav-link {
      font-size: 0.9rem;
    }
  }
</style>

<style>
  body { padding-top: 160px !important; }
  .main-nav { z-index: 1000; position: fixed; top: 0; width: 100%; }
  #header-template { display: none; }
  
  /* Ensure footer spans full width and breaks out of containers */
  .site-footer {
    position: relative !important;
    width: 100vw !important;
    max-width: 100vw !important;
    margin-left: calc(-50vw + 50%) !important;
    margin-right: calc(-50vw + 50%) !important;
    left: 0 !important;
    right: 0 !important;
    clear: both !important;
    z-index: 100 !important;
    box-sizing: border-box !important;
  }
</style>
<!-- Hidden template for header injection -->
<div id="header-template" style="display: none;">
  <!-- Site Header - Consistent across all pages -->
<nav class="main-nav">
    <div class="nav-container">
        <a href="/trustweave/" class="logo">
            <img src="/trustweave/assets/images/trustweave-logo.jpg" alt="TrustWeave Logo" class="logo-img">
        </a>
        <div class="menu-toggle" id="menuToggle" aria-label="Toggle menu">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="nav-links" id="navLinks">
            <a href="/trustweave/" class="nav-link">Home</a>
            <a href="/trustweave/#features" class="nav-link">Features</a>
            <a href="/trustweave/use-scenarios/" class="nav-link">Use Scenarios</a>
            <a href="/trustweave/getting-started/README/" class="nav-link">Docs</a>
            <a href="/trustweave/partnership/" class="nav-link">Partners</a>
            <a href="/trustweave/about/" class="nav-link">About</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank" rel="noopener noreferrer" class="github-icon" title="View on GitHub" aria-label="GitHub Repository">
                <svg viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                    <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
                </svg>
            </a>
        </div>
    </div>
</nav>
<script>
    // Mobile menu toggle and active page highlighting
    (function() {
        const menuToggle = document.getElementById('menuToggle');
        const navLinks = document.getElementById('navLinks');
        
        // Mobile menu toggle
        if (menuToggle && navLinks) {
            menuToggle.addEventListener('click', () => {
                navLinks.classList.toggle('active');
                menuToggle.classList.toggle('active');
            });
            
            // Close menu when clicking on a link
            document.querySelectorAll('.nav-links a').forEach(link => {
                link.addEventListener('click', () => {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                });
            });
            
            // Close menu when clicking outside
            document.addEventListener('click', (e) => {
                if (!menuToggle.contains(e.target) && !navLinks.contains(e.target)) {
                    navLinks.classList.remove('active');
                    menuToggle.classList.remove('active');
                }
            });
        }

        // Highlight active page
        const currentPath = window.location.pathname;
        const navLinksList = document.querySelectorAll('.nav-links .nav-link');
        
        navLinksList.forEach(link => {
            try {
                const linkUrl = new URL(link.href, window.location.origin);
                const linkPath = linkUrl.pathname;
                const baseUrl = '/trustweave' || '';
                
                // Normalize paths
                let cleanCurrentPath = currentPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                let cleanLinkPath = linkPath.replace(baseUrl, '').replace(/\/$/, '') || '/';
                
                // Handle index pages
                if (cleanCurrentPath === '' || cleanCurrentPath === '/index.html') cleanCurrentPath = '/';
                if (cleanLinkPath === '' || cleanLinkPath === '/index.html') cleanLinkPath = '/';
                
                // Check if current path matches link path
                if (cleanCurrentPath === cleanLinkPath) {
                    link.classList.add('active');
                } else if (cleanLinkPath !== '/' && cleanCurrentPath.startsWith(cleanLinkPath + '/')) {
                    // Handle sub-pages (e.g., /introduction/ matches /introduction/README/)
                    link.classList.add('active');
                }
            } catch (e) {
                // Fallback for relative URLs or errors
                const href = link.getAttribute('href');
                if (href && (currentPath.includes(href) || (href === '/' && currentPath.endsWith('index.html')))) {
                    link.classList.add('active');
                }
            }
        });
    })();
</script>


</div>
<script>
  // Move header from template to body top
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('header-template');
    if (template) {
      const header = template.querySelector('.main-nav');
      if (header) {
        document.body.insertBefore(header, document.body.firstChild);
        template.remove();
      }
    }
  });
</script>


</head>

<body>
  <a class="skip-to-main" href="#main-content">Skip to main content</a>
  <svg xmlns="http://www.w3.org/2000/svg" class="d-none">
  <symbol id="svg-link" viewBox="0 0 24 24">
  <title>Link</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link">
    <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path>
  </svg>
</symbol>

  <symbol id="svg-menu" viewBox="0 0 24 24">
  <title>Menu</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu">
    <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line>
  </svg>
</symbol>

  <symbol id="svg-arrow-right" viewBox="0 0 24 24">
  <title>Expand</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right">
    <polyline points="9 18 15 12 9 6"></polyline>
  </svg>
</symbol>

  <!-- Feather. MIT License: https://github.com/feathericons/feather/blob/master/LICENSE -->
<symbol id="svg-external-link" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-external-link">
  <title id="svg-external-link-title">(external link)</title>
  <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path><polyline points="15 3 21 3 21 9"></polyline><line x1="10" y1="14" x2="21" y2="3"></line>
</symbol>

  
    <symbol id="svg-doc" viewBox="0 0 24 24">
  <title>Document</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file">
    <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline>
  </svg>
</symbol>

    <symbol id="svg-search" viewBox="0 0 24 24">
  <title>Search</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search">
    <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line>
  </svg>
</symbol>

  
  
    <!-- Bootstrap Icons. MIT License: https://github.com/twbs/icons/blob/main/LICENSE.md -->
<symbol id="svg-copy" viewBox="0 0 16 16">
  <title>Copy</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard" viewBox="0 0 16 16">
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/>
    <path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3zm-3-1A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3z"/>
  </svg>
</symbol>
<symbol id="svg-copied" viewBox="0 0 16 16">
  <title>Copied</title>
  <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-clipboard-check-fill" viewBox="0 0 16 16">
    <path d="M6.5 0A1.5 1.5 0 0 0 5 1.5v1A1.5 1.5 0 0 0 6.5 4h3A1.5 1.5 0 0 0 11 2.5v-1A1.5 1.5 0 0 0 9.5 0h-3Zm3 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3Z"/>
    <path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1A2.5 2.5 0 0 1 9.5 5h-3A2.5 2.5 0 0 1 4 2.5v-1Zm6.854 7.354-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708.708Z"/>
  </svg>
</symbol>

  
</svg>

  
    <div class="side-bar">
  <div class="site-header" role="banner">
    <a href="/trustweave/" class="site-title lh-tight">
  TrustWeave Developer Documentation

</a>
    <button id="menu-button" class="site-button btn-reset" aria-label="Toggle menu" aria-pressed="false">
      <svg viewBox="0 0 24 24" class="icon" aria-hidden="true"><use xlink:href="#svg-menu"></use></svg>
    </button>
  </div>

  <nav aria-label="Main" id="site-nav" class="site-nav">
  
  
    <ul class="nav-list"><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Introduction category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/introduction/README/" class="nav-list-link">Introduction</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/introduction/what-is-trustweave/" class="nav-list-link">What is TrustWeave?</a></li><li class="nav-list-item"><a href="/trustweave/introduction/executive-overview/" class="nav-list-link">Executive Overview: TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/introduction/key-features/" class="nav-list-link">Key Features</a></li><li class="nav-list-item"><a href="/trustweave/introduction/use-cases/" class="nav-list-link">Use Cases</a></li><li class="nav-list-item"><a href="/trustweave/introduction/architecture-overview/" class="nav-list-link">Architecture Overview</a></li><li class="nav-list-item"><a href="/trustweave/introduction/mental-model/" class="nav-list-link">TrustWeave Mental Model</a></li><li class="nav-list-item"><a href="/trustweave/introduction/web-of-trust/" class="nav-list-link">The Web of Trust: Foundation for Decentralized Trust</a></li></ul></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Core Concepts category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/core-concepts/README/" class="nav-list-link">Core Concepts</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/core-concepts/dids/" class="nav-list-link">Decentralized Identifiers (DIDs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/verifiable-credentials/" class="nav-list-link">Verifiable Credentials (VCs)</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/wallets/" class="nav-list-link">Wallets</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/blockchain-anchoring/" class="nav-list-link">Blockchain Anchoring</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/smart-contracts/" class="nav-list-link">Smart Contracts</a></li><li class="nav-list-item"><a href="/trustweave/core-concepts/key-management/" class="nav-list-link">Key Management</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/integrations/README/" class="nav-list-link">Integration Modules</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Advanced Topics category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/advanced/README/" class="nav-list-link">Advanced Topics</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/advanced/error-handling/" class="nav-list-link">Error Handling</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/modules/core-modules/" class="nav-list-link">Core Modules</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in Getting Started category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/getting-started/README/" class="nav-list-link">Getting Started</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/getting-started/installation/" class="nav-list-link">Installation</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/quick-start/" class="nav-list-link">Quick Start</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/your-first-application/" class="nav-list-link">Your First Application</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/project-setup/" class="nav-list-link">Project Setup</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/ide-setup/" class="nav-list-link">IDE Setup Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/common-patterns/" class="nav-list-link">Common Patterns</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/api-patterns/" class="nav-list-link">API Patterns and Best Practices</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/workflows/" class="nav-list-link">Common Workflows</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/dsl-guide/" class="nav-list-link">TrustWeave DSL Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/troubleshooting/" class="nav-list-link">Troubleshooting Guide</a></li><li class="nav-list-item"><a href="/trustweave/getting-started/production-deployment/" class="nav-list-link">Production Deployment Guide</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/contributing/README/" class="nav-list-link">Contributing to TrustWeave</a></li><li class="nav-list-item"><a href="/trustweave/faq/" class="nav-list-link">Frequently Asked Questions</a></li><li class="nav-list-item"><a href="/trustweave/tutorials/README/" class="nav-list-link">Tutorials</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in How-To Guides category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/how-to/README/" class="nav-list-link">How-To Guides</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/how-to/create-dids/" class="nav-list-link">Create and Manage DIDs</a></li><li class="nav-list-item"><a href="/trustweave/how-to/issue-credentials/" class="nav-list-link">Issue Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/verify-credentials/" class="nav-list-link">Verify Credentials</a></li><li class="nav-list-item"><a href="/trustweave/how-to/manage-wallets/" class="nav-list-link">Manage Wallets</a></li><li class="nav-list-item"><a href="/trustweave/how-to/blockchain-anchoring/" class="nav-list-link">Anchor to Blockchain</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/concepts/README/" class="nav-list-link">Concepts</a></li><li class="nav-list-item"><button class="nav-list-expander btn-reset" aria-label="toggle items in API Reference category" aria-pressed="false">
        <svg viewBox="0 0 24 24" aria-hidden="true"><use xlink:href="#svg-arrow-right"></use></svg>
      </button><a href="/trustweave/api-reference/README/" class="nav-list-link">API Reference</a><ul class="nav-list"><li class="nav-list-item"><a href="/trustweave/api-reference/quick-reference/" class="nav-list-link">Quick Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/error-types/" class="nav-list-link">Error Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/data-types/" class="nav-list-link">Data Types</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/core-api/" class="nav-list-link">Core API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/wallet-api/" class="nav-list-link">Wallet API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/credential-service-api/" class="nav-list-link">Credential Service API Reference</a></li><li class="nav-list-item"><a href="/trustweave/api-reference/smart-contract-api/" class="nav-list-link">Smart Contract API Reference</a></li></ul></li><li class="nav-list-item"><a href="/trustweave/reference/README/" class="nav-list-link">Reference</a></li></ul>
  
</nav>




  
  
    <footer class="site-footer">
      This site uses <a href="https://github.com/just-the-docs/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll.
    </footer>
  
</div>

  
  <div class="main" id="top">
    <div id="main-header" class="main-header">
  
    

<div class="search" role="search">
  <div class="search-input-wrap">
    <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search TrustWeave Developer Documentation" aria-label="Search TrustWeave Developer Documentation" autocomplete="off">
    <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label>
  </div>
  <div id="search-results" class="search-results"></div>
</div>

  
  
  
</div>

    <div class="main-content-wrap">
      
      <div id="main-content" class="main-content">
        <main>
          
            <h1 id="supply-chain--traceability-scenario">
  
  
    <a href="#supply-chain--traceability-scenario" class="anchor-heading" aria-labelledby="supply-chain--traceability-scenario"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Supply Chain &amp; Traceability Scenario
  
  
</h1>
    

<p>This guide demonstrates how to build a supply chain traceability system using TrustWeave that enables multi-party credentials, provenance tracking, product authenticity verification, and immutable chain of custody records.</p>
<h2 id="what-youll-build">
  
  
    <a href="#what-youll-build" class="anchor-heading" aria-labelledby="what-youll-build"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> What You’ll Build
  
  
</h2>
    

<p>By the end of this tutorial, you’ll have:</p>

<ul>
  <li>✅ Created DIDs for supply chain participants (manufacturers, distributors, retailers)</li>
  <li>✅ Issued product credentials at each supply chain stage</li>
  <li>✅ Built provenance tracking system</li>
  <li>✅ Implemented chain of custody verification</li>
  <li>✅ Created product authenticity verification</li>
  <li>✅ Anchored supply chain events to blockchain</li>
  <li>✅ Built multi-party credential workflow</li>
</ul>
<h2 id="big-picture--significance">
  
  
    <a href="#big-picture--significance" class="anchor-heading" aria-labelledby="big-picture--significance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Big Picture &amp; Significance
  
  
</h2>
    
<h3 id="the-supply-chain-transparency-revolution">
  
  
    <a href="#the-supply-chain-transparency-revolution" class="anchor-heading" aria-labelledby="the-supply-chain-transparency-revolution"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Supply Chain Transparency Revolution
  
  
</h3>
    

<p>Modern supply chains are complex, global networks involving multiple parties. Consumers and regulators demand transparency, authenticity, and ethical sourcing. Blockchain-anchored verifiable credentials provide immutable proof of product journey from origin to consumer.</p>

<p><strong>Industry Context</strong>:</p>
<ul>
  <li><strong>Market Size</strong>: Global supply chain management market projected to reach $37.4 billion by 2027</li>
  <li><strong>Regulatory Pressure</strong>: Increasing requirements for product traceability (FDA, EU regulations)</li>
  <li><strong>Consumer Demand</strong>: 73% of consumers want to know product origins</li>
  <li><strong>Fraud Impact</strong>: Counterfeit goods cost $1.7 trillion annually globally</li>
  <li><strong>Sustainability</strong>: Growing demand for ethical and sustainable sourcing</li>
</ul>

<p><strong>Why This Matters</strong>:</p>
<ol>
  <li><strong>Product Authenticity</strong>: Prevent counterfeiting with cryptographic proof</li>
  <li><strong>Food Safety</strong>: Track food from farm to table for safety recalls</li>
  <li><strong>Ethical Sourcing</strong>: Verify fair trade and ethical labor practices</li>
  <li><strong>Regulatory Compliance</strong>: Meet traceability requirements</li>
  <li><strong>Consumer Trust</strong>: Build trust through transparency</li>
  <li><strong>Sustainability</strong>: Track carbon footprint and environmental impact</li>
</ol>
<h3 id="the-supply-chain-challenge">
  
  
    <a href="#the-supply-chain-challenge" class="anchor-heading" aria-labelledby="the-supply-chain-challenge"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> The Supply Chain Challenge
  
  
</h3>
    

<p>Traditional supply chains face critical issues:</p>
<ul>
  <li><strong>Lack of Transparency</strong>: No visibility into product journey</li>
  <li><strong>Counterfeiting</strong>: Fake products enter supply chain</li>
  <li><strong>Data Silos</strong>: Each party maintains separate records</li>
  <li><strong>Trust Issues</strong>: No cryptographic proof of authenticity</li>
  <li><strong>Regulatory Compliance</strong>: Difficult to prove compliance</li>
  <li><strong>Recall Challenges</strong>: Slow and incomplete recall processes</li>
</ul>
<h2 id="value-proposition">
  
  
    <a href="#value-proposition" class="anchor-heading" aria-labelledby="value-proposition"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Value Proposition
  
  
</h2>
    
<h3 id="problems-solved">
  
  
    <a href="#problems-solved" class="anchor-heading" aria-labelledby="problems-solved"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Problems Solved
  
  
</h3>
    

<ol>
  <li><strong>Provenance Tracking</strong>: Complete product journey from origin to consumer</li>
  <li><strong>Authenticity Verification</strong>: Cryptographic proof prevents counterfeiting</li>
  <li><strong>Multi-Party Coordination</strong>: Standard format works across all participants</li>
  <li><strong>Regulatory Compliance</strong>: Immutable records meet traceability requirements</li>
  <li><strong>Recall Efficiency</strong>: Instant identification of affected products</li>
  <li><strong>Consumer Trust</strong>: Transparent product information</li>
  <li><strong>Sustainability</strong>: Track environmental impact</li>
</ol>
<h3 id="business-benefits">
  
  
    <a href="#business-benefits" class="anchor-heading" aria-labelledby="business-benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Business Benefits
  
  
</h3>
    

<p><strong>For Manufacturers</strong>:</p>
<ul>
  <li><strong>Brand Protection</strong>: Prevent counterfeiting</li>
  <li><strong>Compliance</strong>: Meet regulatory requirements</li>
  <li><strong>Efficiency</strong>: Faster recall processes</li>
  <li><strong>Trust</strong>: Build consumer confidence</li>
</ul>

<p><strong>For Retailers</strong>:</p>
<ul>
  <li><strong>Authenticity</strong>: Verify product authenticity</li>
  <li><strong>Compliance</strong>: Meet regulatory requirements</li>
  <li><strong>Consumer Trust</strong>: Provide product transparency</li>
  <li><strong>Risk Reduction</strong>: Reduce liability from counterfeit products</li>
</ul>

<p><strong>For Consumers</strong>:</p>
<ul>
  <li><strong>Authenticity</strong>: Verify product is genuine</li>
  <li><strong>Transparency</strong>: See product journey</li>
  <li><strong>Safety</strong>: Track product safety information</li>
  <li><strong>Ethics</strong>: Verify ethical sourcing</li>
</ul>
<h3 id="roi-considerations">
  
  
    <a href="#roi-considerations" class="anchor-heading" aria-labelledby="roi-considerations"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> ROI Considerations
  
  
</h3>
    

<ul>
  <li><strong>Counterfeit Prevention</strong>: Saves millions in lost revenue</li>
  <li><strong>Recall Efficiency</strong>: 10x faster recall processes</li>
  <li><strong>Compliance</strong>: Automated regulatory compliance</li>
  <li><strong>Consumer Trust</strong>: Increased brand loyalty</li>
  <li><strong>Sustainability</strong>: Enable premium pricing for verified products</li>
</ul>
<h2 id="understanding-the-problem">
  
  
    <a href="#understanding-the-problem" class="anchor-heading" aria-labelledby="understanding-the-problem"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Understanding the Problem
  
  
</h2>
    

<p>Supply chain management faces several critical challenges:</p>

<ol>
  <li><strong>Provenance</strong>: Track product from origin to consumer</li>
  <li><strong>Authenticity</strong>: Verify products are genuine</li>
  <li><strong>Multi-Party</strong>: Coordinate across multiple organizations</li>
  <li><strong>Data Integrity</strong>: Ensure records aren’t tampered with</li>
  <li><strong>Regulatory Compliance</strong>: Meet traceability requirements</li>
  <li><strong>Recall Management</strong>: Quickly identify affected products</li>
  <li><strong>Consumer Trust</strong>: Provide transparent product information</li>
</ol>
<h3 id="real-world-pain-points">
  
  
    <a href="#real-world-pain-points" class="anchor-heading" aria-labelledby="real-world-pain-points"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-World Pain Points
  
  
</h3>
    

<p><strong>Example 1: Food Safety Recall</strong></p>
<ul>
  <li>Current: Manual tracking, slow identification, incomplete recalls</li>
  <li>Problem: Public health risk, financial losses</li>
  <li>Solution: Instant product tracking with verifiable credentials</li>
</ul>

<p><strong>Example 2: Counterfeit Products</strong></p>
<ul>
  <li>Current: No way to verify authenticity</li>
  <li>Problem: Brand damage, lost revenue, consumer harm</li>
  <li>Solution: Cryptographic proof of authenticity</li>
</ul>

<p><strong>Example 3: Ethical Sourcing</strong></p>
<ul>
  <li>Current: Difficult to verify supply chain ethics</li>
  <li>Problem: Consumer distrust, regulatory issues</li>
  <li>Solution: Verifiable credentials for each supply chain stage</li>
</ul>
<h2 id="how-it-works-supply-chain-traceability-flow">
  
  
    <a href="#how-it-works-supply-chain-traceability-flow" class="anchor-heading" aria-labelledby="how-it-works-supply-chain-traceability-flow"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> How It Works: Supply Chain Traceability Flow
  
  
</h2>
    

<pre><code class="language-mermaid">flowchart TD
    A["Manufacturer&lt;br/&gt;Creates Product Credential&lt;br/&gt;Issues Origin Credential"] --&gt;|transfers product| B["Distributor&lt;br/&gt;Receives Product&lt;br/&gt;Issues Transfer Credential&lt;br/&gt;Updates Chain of Custody"]
    B --&gt;|transfers product| C["Retailer&lt;br/&gt;Receives Product&lt;br/&gt;Issues Sale Credential&lt;br/&gt;Provides Consumer Access"]
    C --&gt;|anchors to blockchain| D["Blockchain Anchor&lt;br/&gt;Immutable Supply Chain Record&lt;br/&gt;Provenance Trail"]
    
    style A fill:#1976d2,stroke:#0d47a1,stroke-width:2px,color:#fff
    style B fill:#f57c00,stroke:#e65100,stroke-width:2px,color:#fff
    style C fill:#388e3c,stroke:#1b5e20,stroke-width:2px,color:#fff
    style D fill:#c2185b,stroke:#880e4f,stroke-width:2px,color:#fff
</code></pre>
<h2 id="key-concepts">
  
  
    <a href="#key-concepts" class="anchor-heading" aria-labelledby="key-concepts"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Key Concepts
  
  
</h2>
    
<h3 id="supply-chain-participants">
  
  
    <a href="#supply-chain-participants" class="anchor-heading" aria-labelledby="supply-chain-participants"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Supply Chain Participants
  
  
</h3>
    

<ol>
  <li><strong>Manufacturer</strong>: Creates products, issues origin credentials</li>
  <li><strong>Distributor</strong>: Transports products, issues transfer credentials</li>
  <li><strong>Retailer</strong>: Sells products, issues sale credentials</li>
  <li><strong>Consumer</strong>: Receives products, can verify provenance</li>
</ol>
<h3 id="product-credentials">
  
  
    <a href="#product-credentials" class="anchor-heading" aria-labelledby="product-credentials"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Product Credentials
  
  
</h3>
    

<ol>
  <li><strong>Origin Credential</strong>: Product creation at manufacturer</li>
  <li><strong>Transfer Credential</strong>: Product transfer between parties</li>
  <li><strong>Processing Credential</strong>: Product processing or transformation</li>
  <li><strong>Sale Credential</strong>: Product sale to consumer</li>
  <li><strong>Chain of Custody</strong>: Complete history of product ownership</li>
</ol>
<h3 id="provenance-tracking">
  
  
    <a href="#provenance-tracking" class="anchor-heading" aria-labelledby="provenance-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Provenance Tracking
  
  
</h3>
    

<ul>
  <li><strong>Product ID</strong>: Unique identifier for each product</li>
  <li><strong>Event Chain</strong>: Sequence of credentials showing product journey</li>
  <li><strong>Verification</strong>: Verify each step in the chain</li>
  <li><strong>Blockchain Anchoring</strong>: Immutable record of supply chain events</li>
</ul>
<h2 id="prerequisites">
  
  
    <a href="#prerequisites" class="anchor-heading" aria-labelledby="prerequisites"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Prerequisites
  
  
</h2>
    

<ul>
  <li>Java 21+</li>
  <li>Kotlin 2.2.0+</li>
  <li>Gradle 8.5+</li>
  <li>Basic understanding of Kotlin and coroutines</li>
  <li>Familiarity with supply chain concepts (helpful but not required)</li>
</ul>
<h2 id="step-1-add-dependencies">
  
  
    <a href="#step-1-add-dependencies" class="anchor-heading" aria-labelledby="step-1-add-dependencies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Add Dependencies
  
  
</h2>
    

<p>Add TrustWeave dependencies to your <code class="language-plaintext highlighter-rouge">build.gradle.kts</code>. These modules provide DID/credential APIs plus the in-memory services used to simulate the supply chain workflow.</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
</pre></td><td class="rouge-code"><pre><span class="nf">dependencies</span> <span class="p">{</span>
    <span class="c1">// Core TrustWeave modules</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-core:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-json:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-kms:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-did:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-anchor:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    
    <span class="c1">// Test kit for in-memory implementations</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"com.trustweave:trustweave-testkit:1.0.0-SNAPSHOT"</span><span class="p">)</span>
    
    <span class="c1">// Kotlinx Serialization</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-serialization-json:1.6.0"</span><span class="p">)</span>
    
    <span class="c1">// Coroutines</span>
    <span class="nf">implementation</span><span class="p">(</span><span class="s">"org.jetbrains.kotlinx:kotlinx-coroutines-core:1.7.3"</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>

<p><strong>Result:</strong> After syncing, you can run the supply chain examples end-to-end without extra wiring.</p>
<h2 id="step-2-complete-example">
  
  
    <a href="#step-2-complete-example" class="anchor-heading" aria-labelledby="step-2-complete-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Complete Example
  
  
</h2>
    

<p>Here’s a complete example demonstrating supply chain traceability:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156
157
158
159
160
161
162
163
164
165
166
167
168
169
170
171
172
173
174
175
176
177
178
179
180
181
182
183
184
185
186
187
188
189
190
191
192
193
194
195
196
197
198
199
200
201
202
203
204
205
206
207
208
209
210
211
212
213
214
215
216
217
218
219
220
221
222
223
224
225
226
227
228
229
230
231
232
233
234
235
236
237
238
239
240
241
242
243
244
245
246
247
248
249
250
251
252
253
254
255
256
257
258
259
260
261
262
263
264
265
266
267
268
269
270
271
272
273
274
275
276
277
278
279
280
281
282
283
284
285
286
287
288
289
290
291
292
293
294
295
296
297
298
299
300
301
302
303
304
305
306
307
308
309
310
311
312
313
314
315
316
317
318
319
320
321
322
323
324
325
326
327
328
329
330
331
332
333
334
335
336
337
338
339
340
341
342
343
344
345
346
347
348
349
350
351
352
353
354
355
356
357
358
359
360
361
362
363
364
365
366
367
368
369
370
371
372
373
374
375
376
377
378
379
380
381
382
383
384
385
386
387
388
389
390
391
392
393
394
395
396
397
398
399
400
401
402
403
404
405
406
407
408
409
410
411
412
413
414
415
416
417
418
419
420
421
422
423
424
425
426
427
428
429
430
431
432
433
434
435
436
437
438
439
440
441
442
443
444
</pre></td><td class="rouge-code"><pre><span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiableCredential</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.models.VerifiablePresentation</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialIssuanceOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.CredentialVerificationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.PresentationOptions</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.issuer.CredentialIssuer</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.verifier.CredentialVerifier</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.Ed25519ProofGenerator</span>
<span class="k">import</span> <span class="nn">com.trustweave.credential.proof.ProofGeneratorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.credential.InMemoryWallet</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.did.DidKeyMockMethod</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.kms.InMemoryKeyManagementService</span>
<span class="k">import</span> <span class="nn">com.trustweave.testkit.anchor.InMemoryBlockchainAnchorClient</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.BlockchainAnchorRegistry</span>
<span class="k">import</span> <span class="nn">com.trustweave.anchor.anchorTyped</span>
<span class="k">import</span> <span class="nn">com.trustweave.did.DidMethodRegistry</span>
<span class="k">import</span> <span class="nn">kotlinx.coroutines.runBlocking</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.Serializable</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.buildJsonObject</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.put</span>
<span class="k">import</span> <span class="nn">kotlinx.serialization.json.Json</span>
<span class="k">import</span> <span class="nn">java.time.Instant</span>
<span class="k">import</span> <span class="nn">java.util.UUID</span>

<span class="nd">@Serializable</span>
<span class="kd">data class</span> <span class="nc">SupplyChainEvent</span><span class="p">(</span>
    <span class="kd">val</span> <span class="py">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">eventType</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">participantDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">timestamp</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">credentialDigest</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="kd">val</span> <span class="py">previousEventDigest</span><span class="p">:</span> <span class="nc">String</span><span class="p">?</span> <span class="p">=</span> <span class="k">null</span>
<span class="p">)</span>

<span class="k">fun</span> <span class="nf">main</span><span class="p">()</span> <span class="p">=</span> <span class="nf">runBlocking</span> <span class="p">{</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"=== Supply Chain &amp; Traceability Scenario ===\n"</span><span class="p">)</span>
    
    <span class="c1">// Step 1: Setup services</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Step 1: Setting up services..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">manufacturerKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">distributorKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
    <span class="kd">val</span> <span class="py">retailerKms</span> <span class="p">=</span> <span class="nc">InMemoryKeyManagementService</span><span class="p">()</span>
    
    <span class="kd">val</span> <span class="py">didMethod</span> <span class="p">=</span> <span class="nc">DidKeyMockMethod</span><span class="p">(</span><span class="n">manufacturerKms</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">didRegistry</span> <span class="p">=</span> <span class="nc">DidMethodRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">didMethod</span><span class="p">)</span> <span class="p">}</span>
    
    <span class="c1">// Setup blockchain for anchoring</span>
    <span class="kd">val</span> <span class="py">anchorClient</span> <span class="p">=</span> <span class="nc">InMemoryBlockchainAnchorClient</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="nf">emptyMap</span><span class="p">())</span>
    <span class="kd">val</span> <span class="py">blockchainRegistry</span> <span class="p">=</span> <span class="nc">BlockchainAnchorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span>
        <span class="nf">register</span><span class="p">(</span><span class="s">"eip155:1"</span><span class="p">,</span> <span class="n">anchorClient</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1">// Step 2: Create supply chain participant DIDs</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 2: Creating supply chain participant DIDs..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">manufacturerDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Manufacturer DID: ${manufacturerDid.id}"</span><span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">distributorDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Distributor DID: ${distributorDid.id}"</span><span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">retailerDid</span> <span class="p">=</span> <span class="n">didMethod</span><span class="p">.</span><span class="nf">createDid</span><span class="p">()</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"Retailer DID: ${retailerDid.id}"</span><span class="p">)</span>
    
    <span class="c1">// Step 3: Create product</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 3: Creating product..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">productId</span> <span class="p">=</span> <span class="s">"PROD-${UUID.randomUUID()}"</span>
    <span class="kd">val</span> <span class="py">productName</span> <span class="p">=</span> <span class="s">"Organic Coffee Beans"</span>
    <span class="kd">val</span> <span class="py">batchNumber</span> <span class="p">=</span> <span class="s">"BATCH-2024-001"</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Product created:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Product ID: $productId"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Name: $productName"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Batch: $batchNumber"</span><span class="p">)</span>
    
    <span class="c1">// Step 4: Manufacturer issues origin credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 4: Manufacturer issues origin credential..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">originCredential</span> <span class="p">=</span> <span class="nf">createOriginCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">productName</span> <span class="p">=</span> <span class="n">productName</span><span class="p">,</span>
        <span class="n">batchNumber</span> <span class="p">=</span> <span class="n">batchNumber</span><span class="p">,</span>
        <span class="n">manufacturerDid</span> <span class="p">=</span> <span class="n">manufacturerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">originLocation</span> <span class="p">=</span> <span class="s">"Farm XYZ, Colombia"</span><span class="p">,</span>
        <span class="n">productionDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">certifications</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"Organic"</span><span class="p">,</span> <span class="s">"Fair Trade"</span><span class="p">)</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">manufacturerKey</span> <span class="p">=</span> <span class="n">manufacturerKms</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span><span class="s">"Ed25519"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">manufacturerProofGenerator</span> <span class="p">=</span> <span class="nc">Ed25519ProofGenerator</span><span class="p">(</span>
        <span class="n">signer</span> <span class="p">=</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">manufacturerKms</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">keyId</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="p">},</span>
        <span class="n">getPublicKeyId</span> <span class="p">=</span> <span class="p">{</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">manufacturerKey</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">manufacturerProofRegistry</span> <span class="p">=</span> <span class="nc">ProofGeneratorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">manufacturerProofGenerator</span><span class="p">)</span> <span class="p">}</span>
    
<span class="kd">val</span> <span class="py">didResolver</span> <span class="p">=</span> <span class="nc">CredentialDidResolver</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span>
    <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">).</span><span class="nf">toCredentialDidResolution</span><span class="p">()</span>
<span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">manufacturerIssuer</span> <span class="p">=</span> <span class="nc">CredentialIssuer</span><span class="p">(</span>
        <span class="n">proofGenerator</span> <span class="p">=</span> <span class="n">manufacturerProofGenerator</span><span class="p">,</span>
        <span class="n">resolveDid</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="n">didResolver</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span><span class="o">?.</span><span class="n">isResolvable</span> <span class="p">==</span> <span class="k">true</span> <span class="p">},</span>
        <span class="n">proofRegistry</span> <span class="p">=</span> <span class="n">manufacturerProofRegistry</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">issuedOriginCredential</span> <span class="p">=</span> <span class="n">manufacturerIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">originCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">manufacturerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">manufacturerKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Origin credential issued:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Product: $productName"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Origin: Farm XYZ, Colombia"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Certifications: Organic, Fair Trade"</span><span class="p">)</span>
    
    <span class="c1">// Step 5: Anchor origin event to blockchain</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 5: Anchoring origin event to blockchain..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">originDigest</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
        <span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span>
            <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">issuedOriginCredential</span>
        <span class="p">)</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">originEvent</span> <span class="p">=</span> <span class="nc">SupplyChainEvent</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">eventType</span> <span class="p">=</span> <span class="s">"origin"</span><span class="p">,</span>
        <span class="n">participantDid</span> <span class="p">=</span> <span class="n">manufacturerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">timestamp</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">credentialDigest</span> <span class="p">=</span> <span class="n">originDigest</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">originAnchorResult</span> <span class="p">=</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="nf">anchorTyped</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">=</span> <span class="n">originEvent</span><span class="p">,</span>
        <span class="n">serializer</span> <span class="p">=</span> <span class="nc">SupplyChainEvent</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
        <span class="n">targetChainId</span> <span class="p">=</span> <span class="s">"eip155:1"</span>
    <span class="p">)</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Origin event anchored:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Transaction hash: ${originAnchorResult.ref.txHash}"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Digest: $originDigest"</span><span class="p">)</span>
    
    <span class="c1">// Step 6: Distributor receives product and issues transfer credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 6: Distributor receives product..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">transferCredential</span> <span class="p">=</span> <span class="nf">createTransferCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">fromDid</span> <span class="p">=</span> <span class="n">manufacturerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">toDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">transferDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">transferLocation</span> <span class="p">=</span> <span class="s">"Distribution Center A"</span><span class="p">,</span>
        <span class="n">previousCredentialDigest</span> <span class="p">=</span> <span class="n">originDigest</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">distributorKey</span> <span class="p">=</span> <span class="n">distributorKms</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span><span class="s">"Ed25519"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">distributorProofGenerator</span> <span class="p">=</span> <span class="nc">Ed25519ProofGenerator</span><span class="p">(</span>
        <span class="n">signer</span> <span class="p">=</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">distributorKms</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">keyId</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="p">},</span>
        <span class="n">getPublicKeyId</span> <span class="p">=</span> <span class="p">{</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">distributorKey</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">distributorProofRegistry</span> <span class="p">=</span> <span class="nc">ProofGeneratorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">distributorProofGenerator</span><span class="p">)</span> <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">distributorIssuer</span> <span class="p">=</span> <span class="nc">CredentialIssuer</span><span class="p">(</span>
        <span class="n">proofGenerator</span> <span class="p">=</span> <span class="n">distributorProofGenerator</span><span class="p">,</span>
        <span class="n">resolveDid</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="n">didResolver</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span><span class="o">?.</span><span class="n">isResolvable</span> <span class="p">==</span> <span class="k">true</span> <span class="p">},</span>
        <span class="n">proofRegistry</span> <span class="p">=</span> <span class="n">distributorProofRegistry</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">issuedTransferCredential</span> <span class="p">=</span> <span class="n">distributorIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">transferCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">distributorKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Transfer credential issued:"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - From: Manufacturer"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - To: Distributor"</span><span class="p">)</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"  - Location: Distribution Center A"</span><span class="p">)</span>
    
    <span class="c1">// Step 7: Anchor transfer event</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 7: Anchoring transfer event..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">transferDigest</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
        <span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span>
            <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
            <span class="n">issuedTransferCredential</span>
        <span class="p">)</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">transferEvent</span> <span class="p">=</span> <span class="nc">SupplyChainEvent</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">eventType</span> <span class="p">=</span> <span class="s">"transfer"</span><span class="p">,</span>
        <span class="n">participantDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">timestamp</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">credentialDigest</span> <span class="p">=</span> <span class="n">transferDigest</span><span class="p">,</span>
        <span class="n">previousEventDigest</span> <span class="p">=</span> <span class="n">originDigest</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">transferAnchorResult</span> <span class="p">=</span> <span class="n">blockchainRegistry</span><span class="p">.</span><span class="nf">anchorTyped</span><span class="p">(</span>
        <span class="n">value</span> <span class="p">=</span> <span class="n">transferEvent</span><span class="p">,</span>
        <span class="n">serializer</span> <span class="p">=</span> <span class="nc">SupplyChainEvent</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
        <span class="n">targetChainId</span> <span class="p">=</span> <span class="s">"eip155:1"</span>
    <span class="p">)</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Transfer event anchored"</span><span class="p">)</span>
    
    <span class="c1">// Step 8: Retailer receives product and issues sale credential</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 8: Retailer receives product..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">saleCredential</span> <span class="p">=</span> <span class="nf">createSaleCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">fromDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">toDid</span> <span class="p">=</span> <span class="n">retailerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">saleDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">saleLocation</span> <span class="p">=</span> <span class="s">"Retail Store B"</span><span class="p">,</span>
        <span class="n">previousCredentialDigest</span> <span class="p">=</span> <span class="n">transferDigest</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">retailerKey</span> <span class="p">=</span> <span class="n">retailerKms</span><span class="p">.</span><span class="nf">generateKey</span><span class="p">(</span><span class="s">"Ed25519"</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">retailerProofGenerator</span> <span class="p">=</span> <span class="nc">Ed25519ProofGenerator</span><span class="p">(</span>
        <span class="n">signer</span> <span class="p">=</span> <span class="p">{</span> <span class="n">data</span><span class="p">,</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">retailerKms</span><span class="p">.</span><span class="nf">sign</span><span class="p">(</span><span class="n">keyId</span><span class="p">,</span> <span class="n">data</span><span class="p">)</span> <span class="p">},</span>
        <span class="n">getPublicKeyId</span> <span class="p">=</span> <span class="p">{</span> <span class="n">keyId</span> <span class="p">-&gt;</span> <span class="n">retailerKey</span><span class="p">.</span><span class="n">id</span> <span class="p">}</span>
    <span class="p">)</span>
    <span class="kd">val</span> <span class="py">retailerProofRegistry</span> <span class="p">=</span> <span class="nc">ProofGeneratorRegistry</span><span class="p">().</span><span class="nf">apply</span> <span class="p">{</span> <span class="nf">register</span><span class="p">(</span><span class="n">retailerProofGenerator</span><span class="p">)</span> <span class="p">}</span>
    
    <span class="kd">val</span> <span class="py">retailerIssuer</span> <span class="p">=</span> <span class="nc">CredentialIssuer</span><span class="p">(</span>
        <span class="n">proofGenerator</span> <span class="p">=</span> <span class="n">retailerProofGenerator</span><span class="p">,</span>
        <span class="n">resolveDid</span> <span class="p">=</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span> <span class="n">didResolver</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">)</span><span class="o">?.</span><span class="n">isResolvable</span> <span class="p">==</span> <span class="k">true</span> <span class="p">},</span>
        <span class="n">proofRegistry</span> <span class="p">=</span> <span class="n">retailerProofRegistry</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">issuedSaleCredential</span> <span class="p">=</span> <span class="n">retailerIssuer</span><span class="p">.</span><span class="nf">issue</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">saleCredential</span><span class="p">,</span>
        <span class="n">issuerDid</span> <span class="p">=</span> <span class="n">retailerDid</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">keyId</span> <span class="p">=</span> <span class="n">retailerKey</span><span class="p">.</span><span class="n">id</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialIssuanceOptions</span><span class="p">(</span><span class="n">proofType</span> <span class="p">=</span> <span class="s">"Ed25519Signature2020"</span><span class="p">)</span>
    <span class="p">)</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Sale credential issued"</span><span class="p">)</span>
    
    <span class="c1">// Step 9: Verify product provenance</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 9: Verifying product provenance..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">provenanceChain</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span>
        <span class="n">issuedOriginCredential</span><span class="p">,</span>
        <span class="n">issuedTransferCredential</span><span class="p">,</span>
        <span class="n">issuedSaleCredential</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">provenanceValid</span> <span class="p">=</span> <span class="nf">verifyProvenanceChain</span><span class="p">(</span><span class="n">provenanceChain</span><span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">provenanceValid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Product provenance verified!"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Origin: Farm XYZ, Colombia"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Transfer: Manufacturer → Distributor"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Sale: Distributor → Retailer"</span><span class="p">)</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"❌ Provenance verification failed"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1">// Step 10: Verify product authenticity</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 10: Verifying product authenticity..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">verifier</span> <span class="p">=</span> <span class="nc">CredentialVerifier</span><span class="p">(</span>
        <span class="n">didResolver</span> <span class="p">=</span> <span class="nc">CredentialDidResolver</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span>
            <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">).</span><span class="nf">toCredentialDidResolution</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">authenticityValid</span> <span class="p">=</span> <span class="n">verifier</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">issuedOriginCredential</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialVerificationOptions</span><span class="p">(</span>
            <span class="n">checkRevocation</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
            <span class="n">checkExpiration</span> <span class="p">=</span> <span class="k">false</span><span class="p">,</span>
            <span class="n">validateSchema</span> <span class="p">=</span> <span class="k">true</span>
        <span class="p">)</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(</span><span class="n">authenticityValid</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"✅ Product is authentic!"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Verified manufacturer: ${manufacturerDid.id}"</span><span class="p">)</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - Certifications: Organic, Fair Trade"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="c1">// Step 11: Trace product history</span>
    <span class="nf">println</span><span class="p">(</span><span class="s">"\nStep 11: Tracing product history..."</span><span class="p">)</span>
    <span class="kd">val</span> <span class="py">productHistory</span> <span class="p">=</span> <span class="nf">traceProductHistory</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">events</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">originEvent</span><span class="p">,</span> <span class="n">transferEvent</span><span class="p">)</span>
    <span class="p">)</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"Product history:"</span><span class="p">)</span>
    <span class="n">productHistory</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">event</span> <span class="p">-&gt;</span>
        <span class="nf">println</span><span class="p">(</span><span class="s">"  - ${event.eventType}: ${event.participantDid} at ${event.timestamp}"</span><span class="p">)</span>
    <span class="p">}</span>
    
    <span class="nf">println</span><span class="p">(</span><span class="s">"\n=== Scenario Complete ==="</span><span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">createOriginCredential</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">productName</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">batchNumber</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">manufacturerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">originLocation</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">productionDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">certifications</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://manufacturer.example.com/products/$productId/origin"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"OriginCredential"</span><span class="p">,</span> <span class="s">"SupplyChainCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">manufacturerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productName"</span><span class="p">,</span> <span class="n">productName</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"batchNumber"</span><span class="p">,</span> <span class="n">batchNumber</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"origin"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"location"</span><span class="p">,</span> <span class="n">originLocation</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"productionDate"</span><span class="p">,</span> <span class="n">productionDate</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"certifications"</span><span class="p">,</span> <span class="n">certifications</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/origin-credential.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">createTransferCredential</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">fromDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">toDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">transferDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">transferLocation</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">previousCredentialDigest</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://distributor.example.com/transfers/$productId-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"TransferCredential"</span><span class="p">,</span> <span class="s">"SupplyChainCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">toDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"transfer"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"fromDid"</span><span class="p">,</span> <span class="n">fromDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"toDid"</span><span class="p">,</span> <span class="n">toDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"transferDate"</span><span class="p">,</span> <span class="n">transferDate</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"transferLocation"</span><span class="p">,</span> <span class="n">transferLocation</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"previousCredentialDigest"</span><span class="p">,</span> <span class="n">previousCredentialDigest</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/transfer-credential.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">createSaleCredential</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">fromDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">toDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">saleDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">saleLocation</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">previousCredentialDigest</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">id</span> <span class="p">=</span> <span class="s">"https://retailer.example.com/sales/$productId-${Instant.now().toEpochMilli()}"</span><span class="p">,</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"SaleCredential"</span><span class="p">,</span> <span class="s">"SupplyChainCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">toDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"sale"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"fromDid"</span><span class="p">,</span> <span class="n">fromDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"toDid"</span><span class="p">,</span> <span class="n">toDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"saleDate"</span><span class="p">,</span> <span class="n">saleDate</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"saleLocation"</span><span class="p">,</span> <span class="n">saleLocation</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"previousCredentialDigest"</span><span class="p">,</span> <span class="n">previousCredentialDigest</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">expirationDate</span> <span class="p">=</span> <span class="k">null</span><span class="p">,</span>
        <span class="n">credentialSchema</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">CredentialSchema</span><span class="p">(</span>
            <span class="n">id</span> <span class="p">=</span> <span class="s">"https://example.com/schemas/sale-credential.json"</span><span class="p">,</span>
            <span class="n">type</span> <span class="p">=</span> <span class="s">"JsonSchemaValidator2018"</span><span class="p">,</span>
            <span class="n">schemaFormat</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">spi</span><span class="p">.</span><span class="nc">SchemaFormat</span><span class="p">.</span><span class="nc">JSON_SCHEMA</span>
        <span class="p">)</span>
    <span class="p">)</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">verifyProvenanceChain</span><span class="p">(</span><span class="n">credentials</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">credentials</span><span class="p">.</span><span class="nf">isEmpty</span><span class="p">())</span> <span class="k">return</span> <span class="k">false</span>
    
    <span class="c1">// Verify each credential</span>
    <span class="kd">val</span> <span class="py">verifier</span> <span class="p">=</span> <span class="nc">CredentialVerifier</span><span class="p">(</span>
        <span class="n">didResolver</span> <span class="p">=</span> <span class="nc">CredentialDidResolver</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span>
            <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">).</span><span class="nf">toCredentialDidResolution</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">)</span>
    
    <span class="n">credentials</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="n">credential</span> <span class="p">-&gt;</span>
        <span class="kd">val</span> <span class="py">verification</span> <span class="p">=</span> <span class="n">verifier</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
            <span class="n">credential</span> <span class="p">=</span> <span class="n">credential</span><span class="p">,</span>
            <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialVerificationOptions</span><span class="p">(</span>
                <span class="n">checkRevocation</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
                <span class="n">checkExpiration</span> <span class="p">=</span> <span class="k">false</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">if</span> <span class="p">(!</span><span class="n">verification</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
    <span class="p">}</span>
    
    <span class="c1">// Verify chain continuity (each credential references previous)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="k">in</span> <span class="mi">1</span> <span class="n">until</span> <span class="n">credentials</span><span class="p">.</span><span class="n">size</span><span class="p">)</span> <span class="p">{</span>
        <span class="kd">val</span> <span class="py">current</span> <span class="p">=</span> <span class="n">credentials</span><span class="p">[</span><span class="n">i</span><span class="p">]</span>
        <span class="kd">val</span> <span class="py">previous</span> <span class="p">=</span> <span class="n">credentials</span><span class="p">[</span><span class="n">i</span> <span class="p">-</span> <span class="mi">1</span><span class="p">]</span>
        
        <span class="kd">val</span> <span class="py">previousDigest</span> <span class="p">=</span> <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">json</span><span class="p">.</span><span class="nc">DigestUtils</span><span class="p">.</span><span class="nf">sha256DigestMultibase</span><span class="p">(</span>
            <span class="nc">Json</span><span class="p">.</span><span class="nf">encodeToJsonElement</span><span class="p">(</span>
                <span class="n">com</span><span class="p">.</span><span class="n">trustweave</span><span class="p">.</span><span class="n">credential</span><span class="p">.</span><span class="n">models</span><span class="p">.</span><span class="nc">VerifiableCredential</span><span class="p">.</span><span class="nf">serializer</span><span class="p">(),</span>
                <span class="n">previous</span>
            <span class="p">)</span>
        <span class="p">)</span>
        
        <span class="kd">val</span> <span class="py">referencedDigest</span> <span class="p">=</span> <span class="n">current</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span>
            <span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"transfer"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonObject</span>
            <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"previousCredentialDigest"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
            <span class="o">?:</span> <span class="n">current</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span>
                <span class="p">.</span><span class="k">get</span><span class="p">(</span><span class="s">"sale"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonObject</span>
                <span class="o">?.</span><span class="k">get</span><span class="p">(</span><span class="s">"previousCredentialDigest"</span><span class="p">)</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span>
        
        <span class="k">if</span> <span class="p">(</span><span class="n">referencedDigest</span> <span class="p">!=</span> <span class="n">previousDigest</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
    <span class="p">}</span>
    
    <span class="k">return</span> <span class="k">true</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">traceProductHistory</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">events</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">SupplyChainEvent</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">SupplyChainEvent</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">events</span><span class="p">.</span><span class="nf">filter</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">productId</span> <span class="p">==</span> <span class="n">productId</span> <span class="p">}</span>
        <span class="p">.</span><span class="nf">sortedBy</span> <span class="p">{</span> <span class="n">it</span><span class="p">.</span><span class="n">timestamp</span> <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="extensive-step-by-step-breakdown">
  
  
    <a href="#extensive-step-by-step-breakdown" class="anchor-heading" aria-labelledby="extensive-step-by-step-breakdown"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Extensive Step-by-Step Breakdown
  
  
</h2>
    
<h3 id="step-1-setup-and-initialization">
  
  
    <a href="#step-1-setup-and-initialization" class="anchor-heading" aria-labelledby="step-1-setup-and-initialization"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 1: Setup and Initialization
  
  
</h3>
    

<p><strong>Purpose</strong>: Initialize supply chain traceability system with proper key management for multiple participants.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Multiple Participant KMS</strong>: Separate key management for manufacturer, distributor, retailer ensures proper key isolation</li>
  <li><strong>DID Method Registration</strong>: Register DID method for creating participant identities</li>
  <li><strong>Blockchain Setup</strong>: Initialize blockchain for anchoring supply chain events</li>
</ol>

<p><strong>Why This Matters</strong>: Supply chains involve multiple independent parties. Proper initialization ensures each party has secure, independent cryptographic capabilities.</p>
<h3 id="step-2-create-supply-chain-participant-dids">
  
  
    <a href="#step-2-create-supply-chain-participant-dids" class="anchor-heading" aria-labelledby="step-2-create-supply-chain-participant-dids"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 2: Create Supply Chain Participant DIDs
  
  
</h3>
    

<p><strong>Purpose</strong>: Establish verifiable identities for all supply chain participants.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ul>
  <li><strong>Manufacturer DID</strong>: Represents product manufacturer</li>
  <li><strong>Distributor DID</strong>: Represents product distributor</li>
  <li><strong>Retailer DID</strong>: Represents product retailer</li>
</ul>

<p><strong>Key Considerations</strong>:</p>
<ul>
  <li>Each participant has independent DID</li>
  <li>DIDs provide persistent, verifiable identities</li>
  <li>No central registry required</li>
  <li>Works across different systems</li>
</ul>
<h3 id="step-3-create-product">
  
  
    <a href="#step-3-create-product" class="anchor-heading" aria-labelledby="step-3-create-product"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 3: Create Product
  
  
</h3>
    

<p><strong>Purpose</strong>: Define product with unique identifier.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ul>
  <li><strong>Product ID</strong>: Unique identifier for tracking</li>
  <li><strong>Product Name</strong>: Human-readable product name</li>
  <li><strong>Batch Number</strong>: Batch identifier for grouping products</li>
</ul>

<p><strong>Why This Matters</strong>: Unique product identification enables precise tracking throughout the supply chain.</p>
<h3 id="step-4-manufacturer-issues-origin-credential">
  
  
    <a href="#step-4-manufacturer-issues-origin-credential" class="anchor-heading" aria-labelledby="step-4-manufacturer-issues-origin-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 4: Manufacturer Issues Origin Credential
  
  
</h3>
    

<p><strong>Purpose</strong>: Create verifiable credential for product origin.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Origin Data</strong>: Location, production date, certifications</li>
  <li><strong>Credential Structure</strong>: Follows W3C VC standard</li>
  <li><strong>Proof Generation</strong>: Cryptographic signature from manufacturer</li>
  <li><strong>Certifications</strong>: Include certifications (Organic, Fair Trade, etc.)</li>
</ol>

<p><strong>Security Features</strong>:</p>
<ul>
  <li>Tamper-proof cryptographic proof</li>
  <li>Verifiable manufacturer</li>
  <li>Certifications provide additional trust signals</li>
  <li>Can be verified by any party</li>
</ul>
<h3 id="step-5-anchor-origin-event-to-blockchain">
  
  
    <a href="#step-5-anchor-origin-event-to-blockchain" class="anchor-heading" aria-labelledby="step-5-anchor-origin-event-to-blockchain"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 5: Anchor Origin Event to Blockchain
  
  
</h3>
    

<p><strong>Purpose</strong>: Create immutable record of product origin.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Event Record</strong>: Create structured record of origin event</li>
  <li><strong>Blockchain Anchoring</strong>: Anchor to blockchain for immutability</li>
  <li><strong>Digest</strong>: Cryptographic hash of credential</li>
</ol>

<p><strong>Benefits</strong>:</p>
<ul>
  <li>Immutable record</li>
  <li>Timestamped origin</li>
  <li>Cannot be tampered with</li>
  <li>Provides audit trail</li>
</ul>
<h3 id="step-6-distributor-issues-transfer-credential">
  
  
    <a href="#step-6-distributor-issues-transfer-credential" class="anchor-heading" aria-labelledby="step-6-distributor-issues-transfer-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 6: Distributor Issues Transfer Credential
  
  
</h3>
    

<p><strong>Purpose</strong>: Create verifiable credential for product transfer.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Transfer Data</strong>: From/to parties, location, date</li>
  <li><strong>Chain Continuity</strong>: References previous credential digest</li>
  <li><strong>Proof Generation</strong>: Cryptographic signature from distributor</li>
</ol>

<p><strong>Chain of Custody</strong>:</p>
<ul>
  <li>Links to previous credential</li>
  <li>Maintains provenance chain</li>
  <li>Verifiable transfer</li>
  <li>Immutable record</li>
</ul>
<h3 id="step-7-anchor-transfer-event">
  
  
    <a href="#step-7-anchor-transfer-event" class="anchor-heading" aria-labelledby="step-7-anchor-transfer-event"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 7: Anchor Transfer Event
  
  
</h3>
    

<p><strong>Purpose</strong>: Create immutable record of product transfer.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Event Record</strong>: Create structured record of transfer</li>
  <li><strong>Previous Event Reference</strong>: Links to origin event</li>
  <li><strong>Blockchain Anchoring</strong>: Anchor to blockchain</li>
</ol>

<p><strong>Provenance Benefits</strong>:</p>
<ul>
  <li>Complete product journey</li>
  <li>Verifiable chain of custody</li>
  <li>Immutable transfer records</li>
  <li>Audit trail</li>
</ul>
<h3 id="step-8-retailer-issues-sale-credential">
  
  
    <a href="#step-8-retailer-issues-sale-credential" class="anchor-heading" aria-labelledby="step-8-retailer-issues-sale-credential"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 8: Retailer Issues Sale Credential
  
  
</h3>
    

<p><strong>Purpose</strong>: Create verifiable credential for product sale.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Sale Data</strong>: From/to parties, location, date</li>
  <li><strong>Chain Continuity</strong>: References previous credential digest</li>
  <li><strong>Proof Generation</strong>: Cryptographic signature from retailer</li>
</ol>

<p><strong>Final Step</strong>:</p>
<ul>
  <li>Completes supply chain journey</li>
  <li>Enables consumer verification</li>
  <li>Provides sale record</li>
  <li>Maintains provenance chain</li>
</ul>
<h3 id="step-9-verify-product-provenance">
  
  
    <a href="#step-9-verify-product-provenance" class="anchor-heading" aria-labelledby="step-9-verify-product-provenance"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 9: Verify Product Provenance
  
  
</h3>
    

<p><strong>Purpose</strong>: Verify complete product journey from origin to sale.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Credential Verification</strong>: Verify each credential in chain</li>
  <li><strong>Chain Continuity</strong>: Verify each credential references previous</li>
  <li><strong>Participant Verification</strong>: Verify all participants are legitimate</li>
</ol>

<p><strong>Verification Process</strong>:</p>
<ul>
  <li>Check cryptographic proofs</li>
  <li>Verify credential signatures</li>
  <li>Check chain continuity</li>
  <li>Validate participant DIDs</li>
</ul>
<h3 id="step-10-verify-product-authenticity">
  
  
    <a href="#step-10-verify-product-authenticity" class="anchor-heading" aria-labelledby="step-10-verify-product-authenticity"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 10: Verify Product Authenticity
  
  
</h3>
    

<p><strong>Purpose</strong>: Verify product is genuine and from claimed manufacturer.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Origin Verification</strong>: Verify origin credential</li>
  <li><strong>Manufacturer Verification</strong>: Verify manufacturer DID</li>
  <li><strong>Certification Verification</strong>: Verify certifications</li>
</ol>

<p><strong>Authenticity Benefits</strong>:</p>
<ul>
  <li>Prevents counterfeiting</li>
  <li>Verifies manufacturer</li>
  <li>Confirms certifications</li>
  <li>Builds consumer trust</li>
</ul>
<h3 id="step-11-trace-product-history">
  
  
    <a href="#step-11-trace-product-history" class="anchor-heading" aria-labelledby="step-11-trace-product-history"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Step 11: Trace Product History
  
  
</h3>
    

<p><strong>Purpose</strong>: Retrieve complete product history from blockchain.</p>

<p><strong>Detailed Explanation</strong>:</p>
<ol>
  <li><strong>Event Retrieval</strong>: Retrieve all events for product</li>
  <li><strong>Chronological Order</strong>: Sort events by timestamp</li>
  <li><strong>History Display</strong>: Show complete product journey</li>
</ol>

<p><strong>Traceability Benefits</strong>:</p>
<ul>
  <li>Complete visibility</li>
  <li>Consumer transparency</li>
  <li>Regulatory compliance</li>
  <li>Recall efficiency</li>
</ul>
<h2 id="advanced-features">
  
  
    <a href="#advanced-features" class="anchor-heading" aria-labelledby="advanced-features"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Advanced Features
  
  
</h2>
    
<h3 id="multi-stage-processing">
  
  
    <a href="#multi-stage-processing" class="anchor-heading" aria-labelledby="multi-stage-processing"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multi-Stage Processing
  
  
</h3>
    

<p>Track product through processing stages:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createProcessingCredential</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">processorDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">processingType</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">processingDate</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">previousCredentialDigest</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"ProcessingCredential"</span><span class="p">,</span> <span class="s">"SupplyChainCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">processorDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"processing"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"processingType"</span><span class="p">,</span> <span class="n">processingType</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"processingDate"</span><span class="p">,</span> <span class="n">processingDate</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"processorDid"</span><span class="p">,</span> <span class="n">processorDid</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"previousCredentialDigest"</span><span class="p">,</span> <span class="n">previousCredentialDigest</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="quality-certifications">
  
  
    <a href="#quality-certifications" class="anchor-heading" aria-labelledby="quality-certifications"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Quality Certifications
  
  
</h3>
    

<p>Add quality certifications at each stage:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">addQualityCertification</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">certifierDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">certificationType</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">testResults</span><span class="p">:</span> <span class="nc">Map</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">,</span> <span class="nc">String</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">VerifiableCredential</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"QualityCertificationCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">certifierDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"certification"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"certificationType"</span><span class="p">,</span> <span class="n">certificationType</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"testResults"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                    <span class="n">testResults</span><span class="p">.</span><span class="nf">forEach</span> <span class="p">{</span> <span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span> <span class="p">-&gt;</span>
                        <span class="nf">put</span><span class="p">(</span><span class="n">key</span><span class="p">,</span> <span class="n">value</span><span class="p">)</span>
                    <span class="p">}</span>
                <span class="p">})</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="recall-management">
  
  
    <a href="#recall-management" class="anchor-heading" aria-labelledby="recall-management"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Recall Management
  
  
</h3>
    

<p>Enable efficient product recalls:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">recallProducts</span><span class="p">(</span>
    <span class="n">batchNumber</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">recallReason</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">affectedProducts</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">String</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">affectedProducts</span><span class="p">.</span><span class="nf">map</span> <span class="p">{</span> <span class="n">productId</span> <span class="p">-&gt;</span>
        <span class="nc">VerifiableCredential</span><span class="p">(</span>
            <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"RecallCredential"</span><span class="p">),</span>
            <span class="n">issuer</span> <span class="p">=</span> <span class="s">"did:example:regulatory-authority"</span><span class="p">,</span>
            <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"batchNumber"</span><span class="p">,</span> <span class="n">batchNumber</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"recallReason"</span><span class="p">,</span> <span class="n">recallReason</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"recallDate"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
            <span class="p">},</span>
            <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
        <span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">fun</span> <span class="nf">checkProductRecall</span><span class="p">(</span><span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span> <span class="n">credentials</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="k">return</span> <span class="n">credentials</span><span class="p">.</span><span class="nf">any</span> <span class="p">{</span> <span class="n">credential</span> <span class="p">-&gt;</span>
        <span class="n">credential</span><span class="p">.</span><span class="n">type</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"RecallCredential"</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
        <span class="n">credential</span><span class="p">.</span><span class="n">credentialSubject</span><span class="p">.</span><span class="n">jsonObject</span><span class="p">[</span><span class="s">"productId"</span><span class="p">]</span><span class="o">?.</span><span class="n">jsonPrimitive</span><span class="o">?.</span><span class="n">content</span> <span class="p">==</span> <span class="n">productId</span>
    <span class="p">}</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="real-world-use-cases">
  
  
    <a href="#real-world-use-cases" class="anchor-heading" aria-labelledby="real-world-use-cases"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Real-World Use Cases
  
  
</h2>
    
<h3 id="1-food-traceability-farm-to-table">
  
  
    <a href="#1-food-traceability-farm-to-table" class="anchor-heading" aria-labelledby="1-food-traceability-farm-to-table"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 1. Food Traceability (Farm to Table)
  
  
</h3>
    

<p><strong>Scenario</strong>: Track organic produce from farm to consumer.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createFarmToTableTraceability</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">farmDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">processorDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">distributorDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">retailerDid</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="c1">// Farm origin</span>
    <span class="kd">val</span> <span class="py">farmCredential</span> <span class="p">=</span> <span class="nf">createOriginCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">productName</span> <span class="p">=</span> <span class="s">"Organic Tomatoes"</span><span class="p">,</span>
        <span class="n">batchNumber</span> <span class="p">=</span> <span class="s">"BATCH-2024-001"</span><span class="p">,</span>
        <span class="n">manufacturerDid</span> <span class="p">=</span> <span class="n">farmDid</span><span class="p">,</span>
        <span class="n">originLocation</span> <span class="p">=</span> <span class="s">"Organic Farm XYZ"</span><span class="p">,</span>
        <span class="n">productionDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">certifications</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"Organic"</span><span class="p">,</span> <span class="s">"Non-GMO"</span><span class="p">)</span>
    <span class="p">)</span>
    
    <span class="c1">// Processing</span>
    <span class="kd">val</span> <span class="py">processingCredential</span> <span class="p">=</span> <span class="nf">createProcessingCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">processorDid</span> <span class="p">=</span> <span class="n">processorDid</span><span class="p">,</span>
        <span class="n">processingType</span> <span class="p">=</span> <span class="s">"Washing and Packaging"</span><span class="p">,</span>
        <span class="n">processingDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">previousCredentialDigest</span> <span class="p">=</span> <span class="s">"farm-digest"</span>
    <span class="p">)</span>
    
    <span class="c1">// Distribution</span>
    <span class="kd">val</span> <span class="py">distributionCredential</span> <span class="p">=</span> <span class="nf">createTransferCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">fromDid</span> <span class="p">=</span> <span class="n">processorDid</span><span class="p">,</span>
        <span class="n">toDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">,</span>
        <span class="n">transferDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">transferLocation</span> <span class="p">=</span> <span class="s">"Cold Storage Facility"</span><span class="p">,</span>
        <span class="n">previousCredentialDigest</span> <span class="p">=</span> <span class="s">"processing-digest"</span>
    <span class="p">)</span>
    
    <span class="c1">// Retail sale</span>
    <span class="kd">val</span> <span class="py">saleCredential</span> <span class="p">=</span> <span class="nf">createSaleCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">fromDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">,</span>
        <span class="n">toDid</span> <span class="p">=</span> <span class="n">retailerDid</span><span class="p">,</span>
        <span class="n">saleDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">saleLocation</span> <span class="p">=</span> <span class="s">"Grocery Store ABC"</span><span class="p">,</span>
        <span class="n">previousCredentialDigest</span> <span class="p">=</span> <span class="s">"distribution-digest"</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">farmCredential</span><span class="p">,</span> <span class="n">processingCredential</span><span class="p">,</span> <span class="n">distributionCredential</span><span class="p">,</span> <span class="n">saleCredential</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="2-pharmaceutical-tracking">
  
  
    <a href="#2-pharmaceutical-tracking" class="anchor-heading" aria-labelledby="2-pharmaceutical-tracking"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 2. Pharmaceutical Tracking
  
  
</h3>
    

<p><strong>Scenario</strong>: Track pharmaceuticals through supply chain to prevent counterfeiting.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">createPharmaceuticalTracking</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">manufacturerDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">distributorDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">pharmacyDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">lotNumber</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">expirationDate</span><span class="p">:</span> <span class="nc">String</span>
<span class="p">):</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span> <span class="p">{</span>
    <span class="c1">// Manufacturer origin</span>
    <span class="kd">val</span> <span class="py">originCredential</span> <span class="p">=</span> <span class="nc">VerifiableCredential</span><span class="p">(</span>
        <span class="n">type</span> <span class="p">=</span> <span class="nf">listOf</span><span class="p">(</span><span class="s">"VerifiableCredential"</span><span class="p">,</span> <span class="s">"PharmaceuticalOriginCredential"</span><span class="p">),</span>
        <span class="n">issuer</span> <span class="p">=</span> <span class="n">manufacturerDid</span><span class="p">,</span>
        <span class="n">credentialSubject</span> <span class="p">=</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"productId"</span><span class="p">,</span> <span class="n">productId</span><span class="p">)</span>
            <span class="nf">put</span><span class="p">(</span><span class="s">"pharmaceutical"</span><span class="p">,</span> <span class="nf">buildJsonObject</span> <span class="p">{</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"drugName"</span><span class="p">,</span> <span class="s">"Medication XYZ"</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"lotNumber"</span><span class="p">,</span> <span class="n">lotNumber</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"manufacturingDate"</span><span class="p">,</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">())</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"expirationDate"</span><span class="p">,</span> <span class="n">expirationDate</span><span class="p">)</span>
                <span class="nf">put</span><span class="p">(</span><span class="s">"manufacturerDid"</span><span class="p">,</span> <span class="n">manufacturerDid</span><span class="p">)</span>
            <span class="p">})</span>
        <span class="p">},</span>
        <span class="n">issuanceDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">()</span>
    <span class="p">)</span>
    
    <span class="c1">// Distribution</span>
    <span class="kd">val</span> <span class="py">distributionCredential</span> <span class="p">=</span> <span class="nf">createTransferCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">fromDid</span> <span class="p">=</span> <span class="n">manufacturerDid</span><span class="p">,</span>
        <span class="n">toDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">,</span>
        <span class="n">transferDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">transferLocation</span> <span class="p">=</span> <span class="s">"Pharmaceutical Distribution Center"</span><span class="p">,</span>
        <span class="n">previousCredentialDigest</span> <span class="p">=</span> <span class="s">"origin-digest"</span>
    <span class="p">)</span>
    
    <span class="c1">// Pharmacy receipt</span>
    <span class="kd">val</span> <span class="py">pharmacyCredential</span> <span class="p">=</span> <span class="nf">createSaleCredential</span><span class="p">(</span>
        <span class="n">productId</span> <span class="p">=</span> <span class="n">productId</span><span class="p">,</span>
        <span class="n">fromDid</span> <span class="p">=</span> <span class="n">distributorDid</span><span class="p">,</span>
        <span class="n">toDid</span> <span class="p">=</span> <span class="n">pharmacyDid</span><span class="p">,</span>
        <span class="n">saleDate</span> <span class="p">=</span> <span class="nc">Instant</span><span class="p">.</span><span class="nf">now</span><span class="p">().</span><span class="nf">toString</span><span class="p">(),</span>
        <span class="n">saleLocation</span> <span class="p">=</span> <span class="s">"Pharmacy ABC"</span><span class="p">,</span>
        <span class="n">previousCredentialDigest</span> <span class="p">=</span> <span class="s">"distribution-digest"</span>
    <span class="p">)</span>
    
    <span class="k">return</span> <span class="nf">listOf</span><span class="p">(</span><span class="n">originCredential</span><span class="p">,</span> <span class="n">distributionCredential</span><span class="p">,</span> <span class="n">pharmacyCredential</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h3 id="3-luxury-goods-authentication">
  
  
    <a href="#3-luxury-goods-authentication" class="anchor-heading" aria-labelledby="3-luxury-goods-authentication"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> 3. Luxury Goods Authentication
  
  
</h3>
    

<p><strong>Scenario</strong>: Verify authenticity of luxury goods.</p>

<p><strong>Implementation</strong>:</p>

<div class="language-kotlin highlighter-rouge"><div class="highlight"><pre class="highlight"><code><div class="table-wrapper"><table class="rouge-table"><tbody><tr><td class="rouge-gutter gl"><pre class="lineno">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
</pre></td><td class="rouge-code"><pre><span class="k">fun</span> <span class="nf">verifyLuxuryGoodAuthenticity</span><span class="p">(</span>
    <span class="n">productId</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">brandDid</span><span class="p">:</span> <span class="nc">String</span><span class="p">,</span>
    <span class="n">credentials</span><span class="p">:</span> <span class="nc">List</span><span class="p">&lt;</span><span class="nc">VerifiableCredential</span><span class="p">&gt;</span>
<span class="p">):</span> <span class="nc">Boolean</span> <span class="p">{</span>
    <span class="c1">// Find origin credential from brand</span>
    <span class="kd">val</span> <span class="py">originCredential</span> <span class="p">=</span> <span class="n">credentials</span><span class="p">.</span><span class="nf">firstOrNull</span> <span class="p">{</span> <span class="n">credential</span> <span class="p">-&gt;</span>
        <span class="n">credential</span><span class="p">.</span><span class="n">type</span><span class="p">.</span><span class="nf">contains</span><span class="p">(</span><span class="s">"OriginCredential"</span><span class="p">)</span> <span class="p">&amp;&amp;</span>
        <span class="n">credential</span><span class="p">.</span><span class="n">issuer</span> <span class="p">==</span> <span class="n">brandDid</span>
    <span class="p">}</span> <span class="o">?:</span> <span class="k">return</span> <span class="k">false</span>
    
    <span class="c1">// Verify origin credential</span>
    <span class="kd">val</span> <span class="py">verifier</span> <span class="p">=</span> <span class="nc">CredentialVerifier</span><span class="p">(</span>
        <span class="n">didResolver</span> <span class="p">=</span> <span class="nc">CredentialDidResolver</span> <span class="p">{</span> <span class="n">did</span> <span class="p">-&gt;</span>
            <span class="n">didRegistry</span><span class="p">.</span><span class="nf">resolve</span><span class="p">(</span><span class="n">did</span><span class="p">).</span><span class="nf">toCredentialDidResolution</span><span class="p">()</span>
        <span class="p">}</span>
    <span class="p">)</span>
    
    <span class="kd">val</span> <span class="py">verification</span> <span class="p">=</span> <span class="n">verifier</span><span class="p">.</span><span class="nf">verify</span><span class="p">(</span>
        <span class="n">credential</span> <span class="p">=</span> <span class="n">originCredential</span><span class="p">,</span>
        <span class="n">options</span> <span class="p">=</span> <span class="nc">CredentialVerificationOptions</span><span class="p">(</span>
            <span class="n">checkRevocation</span> <span class="p">=</span> <span class="k">true</span><span class="p">,</span>
            <span class="n">checkExpiration</span> <span class="p">=</span> <span class="k">false</span>
        <span class="p">)</span>
    <span class="p">)</span>
    
    <span class="k">if</span> <span class="p">(!</span><span class="n">verification</span><span class="p">.</span><span class="n">valid</span><span class="p">)</span> <span class="k">return</span> <span class="k">false</span>
    
    <span class="c1">// Verify provenance chain</span>
    <span class="k">return</span> <span class="nf">verifyProvenanceChain</span><span class="p">(</span><span class="n">credentials</span><span class="p">)</span>
<span class="p">}</span>
</pre></td></tr></tbody></table></div></code></pre></div></div>
<h2 id="benefits">
  
  
    <a href="#benefits" class="anchor-heading" aria-labelledby="benefits"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Benefits
  
  
</h2>
    

<ol>
  <li><strong>Provenance Tracking</strong>: Complete product journey visibility</li>
  <li><strong>Authenticity Verification</strong>: Cryptographic proof prevents counterfeiting</li>
  <li><strong>Multi-Party Coordination</strong>: Standard format works across all participants</li>
  <li><strong>Regulatory Compliance</strong>: Immutable records meet traceability requirements</li>
  <li><strong>Recall Efficiency</strong>: Instant identification of affected products</li>
  <li><strong>Consumer Trust</strong>: Transparent product information</li>
  <li><strong>Sustainability</strong>: Track environmental impact</li>
  <li><strong>Fraud Prevention</strong>: Tamper-proof credentials prevent fraud</li>
  <li><strong>Efficiency</strong>: Faster verification processes</li>
  <li><strong>Interoperability</strong>: Works across different systems</li>
</ol>
<h2 id="best-practices">
  
  
    <a href="#best-practices" class="anchor-heading" aria-labelledby="best-practices"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Best Practices
  
  
</h2>
    

<ol>
  <li><strong>Unique Product IDs</strong>: Use unique identifiers for each product</li>
  <li><strong>Chain Continuity</strong>: Always reference previous credential digest</li>
  <li><strong>Blockchain Anchoring</strong>: Anchor critical events to blockchain</li>
  <li><strong>Verification</strong>: Verify credentials at each stage</li>
  <li><strong>Schema Validation</strong>: Validate credential structure</li>
  <li><strong>Error Handling</strong>: Handle verification failures gracefully</li>
  <li><strong>Audit Logging</strong>: Log all supply chain events</li>
  <li><strong>Key Management</strong>: Use secure key storage</li>
  <li><strong>Participant Verification</strong>: Verify participant DIDs</li>
  <li><strong>Recall Planning</strong>: Plan for efficient recalls</li>
</ol>
<h2 id="next-steps">
  
  
    <a href="#next-steps" class="anchor-heading" aria-labelledby="next-steps"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Next Steps
  
  
</h2>
    

<ul>
  <li>Learn about <a href="/trustweave/core-concepts/blockchain-anchoring/">Blockchain Anchoring</a></li>
  <li>Explore <a href="/trustweave/scenarios/proof-of-location-scenario/">Proof of Location Scenario</a> for geospatial tracking</li>
  <li>Check out <a href="/trustweave/scenarios/financial-services-kyc-scenario/">Financial Services &amp; KYC Scenario</a> for related verification</li>
  <li>Review <a href="/trustweave/core-concepts/verifiable-credentials/">Core Concepts: Verifiable Credentials</a> for credential details</li>
</ul>

          

          
            
          
        </main>
        

  <hr>
  <footer>
    

    <!-- Hidden template for footer injection -->
<div id="footer-template" style="display: none;">
  <!-- Site Footer - Consistent across all pages -->
<footer class="site-footer">
    <div class="footer-content">
        <div class="footer-links">
            <a href="/trustweave/">Home</a>
            <a href="/trustweave/getting-started/README/">Documentation</a>
            <a href="https://github.com/geoknoesis/TrustWeave" target="_blank">GitHub</a>
            <a href="/trustweave/partnership/">Partners</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/docs/README.md" target="_blank">Docs</a>
            <a href="https://github.com/geoknoesis/TrustWeave/blob/main/LICENSE" target="_blank">License</a>
            <a href="https://www.geoknoesis.com" target="_blank">Geoknoesis LLC</a>
        </div>
        <p class="footer-text">Made with ❤️ by Geoknoesis LLC</p>
    </div>
</footer>


</div>
<script>
  // Move footer from template to body bottom and make it full width
  document.addEventListener('DOMContentLoaded', function() {
    const template = document.getElementById('footer-template');
    if (template) {
      const footer = template.querySelector('.site-footer');
      if (footer) {
        // Move footer to body level (outside of any containers)
        document.body.appendChild(footer);
        template.remove();
        
        // Ensure footer spans full width by removing any parent constraints
        footer.style.position = 'relative';
        footer.style.width = '100vw';
        footer.style.marginLeft = 'calc(-50vw + 50%)';
        footer.style.marginRight = 'calc(-50vw + 50%)';
      }
    }
  });
</script>


    
  </footer>


      </div>
    </div>
    
      

<div class="search-overlay"></div>

    
  </div>

  
    





<script type="module">
  
  import mermaid from 'https://cdn.jsdelivr.net/npm/mermaid@10.6.1/dist/mermaid.esm.min.mjs';
  

  var config = {}
;
  mermaid.initialize(config);
  mermaid.run({
    querySelector: '.language-mermaid',
  });
</script>



  
</body>
</html>

